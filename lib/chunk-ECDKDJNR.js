import{a as mi,c as er,n as yc,s as Ac}from"./chunk-MD4DUP6A.js";import{$ as Ka,$a as W,$c as V,$d as Se,$g as _e,A as po,Ab as ue,Ac as Qo,Ad as Ls,Ae as fc,Af as xe,Ai as Oi,Bb as he,Bd as xt,Be as _i,Bf as Or,Bh as Ws,Bi as Gn,Ca as Ko,Cb as $,Cc as Zo,Ce as sr,Cf as Oc,Ch as J,Ci as en,Da as Ke,Db as We,De as gc,Df as br,Di as bi,Eb as pe,Ec as ji,Ed as qo,Ee as ar,Ef as Ir,Eh as Ae,Ei as tl,Fb as gt,Fc as wi,Fd as mo,Fe as cr,Ff as bc,Fh as Eo,Ga as de,Gf as Ic,H as Ge,Hb as Mn,Hc as $e,Hd as $i,Hh as Qe,Hi as il,I as Di,Ic as pc,Id as ks,Ie as lr,Ih as zc,Ii as nl,Jb as E,Jc as Nt,Jd as ho,Je as To,Ji as ol,K as Xt,Kb as S,Ke as pr,La as l,Lg as Ot,Lh as Ji,M as L,Ma as ec,Mb as He,Mc as oi,Mg as vi,N as $a,Nb as Y,O as Ya,Oa as Qt,Ob as oc,Od as wn,Pa as m,Pd as q,Pe as dr,Pf as yr,Pg as bt,Pi as tn,Qa as Ei,Qd as fn,Qe as ur,Qf as Vn,R as jo,Ra as j,Rb as rc,Rd as Ye,Ri as rl,Sa as ut,Sb as Je,Sc as dc,Sd as Dt,Se as si,Sf as le,Ta as Pn,Tb as Ue,Tc as uc,Td as Yi,Tf as De,Tg as Fc,Th as Hc,Ub as be,Ud as F,Ue as mr,Ug as Vc,Uh as jc,Va as R,Vb as un,Vd as Ln,Ve as hr,Vh as $c,Vi as Wn,W as ui,Wb as mn,Wd as Jo,Wf as Ar,Wg as ye,X as ii,Xb as uo,Xc as Mt,Xg as Tn,Y as Xa,Ya as G,Yb as Ce,Yc as st,Ye as _r,Yf as Xe,Z as Bt,Za as p,Zb as sc,Zd as Ve,Ze as fr,Zf as Wp,_a as qe,_f as Rc,_g as wt,a as Oe,aa as Qa,ac,af as gr,ah as Uc,ai as Yc,aj as zn,b as rt,ba as $o,bb as Nn,bc as mt,bd as Z,be as _c,bf as Cr,bh as En,bi as Lr,ce as Xi,cf as Cc,cg as Cn,ch as Bc,ci as kr,db as h,df as Tc,dg as Zt,dh as Gc,di as Xc,e as Gp,eb as _,ee as tr,ef as Ec,eh as Bn,ei as Kc,f as v,fb as I,fd as Fe,fe as vt,ff as Sc,fg as ki,fh as Rr,fi as Re,ga as Za,gb as Te,gc as cc,gd as U,ge as Ki,gf as Tr,h as Ho,ha as Yo,hb as Ee,hd as Wt,hf as Er,ia as Gt,ib as dn,id as et,ie as _o,if as Fs,ig as qt,j as pt,ja as Xo,jb as w,jd as mc,je as tt,jf as xc,jh as Pr,k as zi,kd as Li,ke as ri,kf as vc,kg as Un,l as Ds,la as je,lb as tc,ld as A,le as fo,lh as Nr,li as Be,mb as O,md as hn,me as gn,mf as Sr,mg as Pc,mi as It,na as qa,nb as d,nd as T,ne as go,nf as oe,ng as a,nh as Mr,ni as kt,ob as ic,od as ws,of as ai,og as B,oh as ge,oi as Fr,pa as Ti,pb as nc,pd as ve,pg as Nc,ph as fe,q as ee,qa as dt,qe as Co,qf as xr,qg as y,qi as Qc,ra as Ja,rb as se,rd as hc,rf as vr,rg as Mc,rh as qi,ri as Zc,sa as Kt,sb as ae,se as Qi,sh as Lt,tb as ce,te as kn,tg as K,th as Dr,ti as qc,u as Hi,ub as we,ue as Fn,ug as Dc,uh as Us,ui as Jc,va as Ie,vb as M,ve as ir,vg as Zi,vh as _t,wa as f,wb as k,wc as lc,we as nr,wg as wc,wh as Bs,xa as g,xb as ke,xc as P,xd as _n,xe as or,xg as Vs,xh as Gs,xi as el,ya as ne,yc as Dn,yd as ht,ye as hi,yg as Lc,yh as wr,z as St,zb as me,zc as Si,zd as xi,ze as rr,zg as kc,zh as Wc}from"./chunk-GMSVUTYH.js";var Fi=function(r){return r.UI_DISPLAY_SETTINGS="UI_DISPLAY_SETTINGS",r.FEATURE_SETTINGS="FEATURE_SETTINGS",r.CONTEXT_MENU_SETTINGS="CONTEXT_MENU_SETTINGS",r.ANNOT_PROPERTY_SETTINGS="ANNOT_PROPERTY_SETTINGS",r}(Fi||{});var H=function(r){return r.ROOT="__IGNORED_ROOT",r.EMBEDDED_FILE_VIEW="__IGNORED_EMBEDDED_FILE_VIEW",r.TEXT_SEARCH_VIEW="__IGNORED_TEXT_SEARCH_VIEW",r.REGEX_BUTTON="__IGNORED_REGEX_BUTTON",r.MAIN_TOOLBAR="__IGNORED_MAIN_TOOLBAR",r.MAIN_MENU="__IGNORED_MAIN_MENU",r.DEFAULT_REDACTION_COLOR="__IGNORED_DEFAULT_REDACTION_COLOR",r.SAVE_OPTION="__IGNORED_SAVE_OPTION",r.DEFAULT_VIEW_MODE="__IGNORED_DEFAULT_VIEW_MODE",r.DEFAULT_ZOOM="__IGNORED_DEFAULT_ZOOM",r.DEFAULT_DRAG_MODE="__IGNORED_DEFAULT_DRAG_MODE",r.DEFAULT_VIEWED_DAP_LIST="__IGNORED_DEFAULT_VIEWED_DAP_LIST",r.SHORTCUT="__IGNORED_SHORTCUT",r.RENDERING_OPTION="__IGNORED_RENDERING_OPTION",r.STAMP_DRAWING_GESTURE="__IGNORED_STAMP_DRAWING_GESTURE",r.FRONTEND_API="__IGNORED_FRONTEND_API",r.DEFAULT_CONTINUE_WRITING="__IGNORED_DEFAULT_CONTINUE_WRITING",r.DAP_VIEW="__IGNORED_DAP_VIEW",r.DIALOG="__IGNORED_DIALOG",r.STMAP_DIALOG="__IGNORED_STAMP_DIALOG",r.SIGNATURE_DIALOG="__IGNORED_SIGNATURE_DIALOG",r.PANEL="__IGNORED_PANEL",r.THUMBNAIL_VIEW="__IGNORED_THUMBNAIL_VIEW",r.OUTLINE_VIEW="__IGNORED_OUTLINE_VIEW",r.ETC_UI="__IGNORED_ETC_UI",r.ANNOTATION_CONTROL="__IGNORED_ANNOTATION_CONTROL",r.FORM_CONTROL="__IGNORED_FORM_CONTROL",r.DEFAULT_SCREEN_THEME="__IGNORED_DEFAULT_SCREEN_THEME",r.ANNOTATION_VIEW="__IGNORED_ANNOTATION_VIEW",r}(H||{}),sl=[a.FORM_VIEW_BUTTON,a.SIGNATURE_VIEW_BUTTON,a.ANNOT_TOOLBAR_DRAG_MODE_SELECT_ANNOT,a.CLOUD_ANNOTATION_BUTTON,B.MEASURE_ANNOTATION_BUTTONS,a.LINE_DIMENSION_ANNOTATION_BUTTON,a.POLYLINE_DIMENSION_ANNOTATION_BUTTON,a.POLYGON_DIMENSION_ANNOTATION_BUTTON,a.SIGNATURE_WIDGET_BUTTON,B.FORM_TOOLBAR,a.FORM_TOOLBAR_UNDO_REDO_BUTTON,a.ANNOT_TOOLBAR_DRAG_MODE_SELECT_ANNOT,a.TEXT_FIELD_WIDGET_BUTTON,a.COMBO_BOX_WIDGET_BUTTON,a.LIST_BOX_WIDGET_BUTTON,a.CHECK_BOX_WIDGET_BUTTON,a.RADIO_BUTTON_WIDGET_BUTTON,a.BUTTON_WIDGET_BUTTON,a.RULER_BUTTON,a.WIDGET_HIGHLIGHT_BUTTON,a.FORM_TOOLBAR_ANNOT_PROPERTY_BUTTON,B.PKI_SIGNATURE_TOOLBAR,a.PKI_INSTANT_SIGNATURE_BUTTON,a.PKI_INVISIBLE_SIGNATURE_BUTTON,a.PREFERENCES_WIDGET_HIGHLIGHT,a.PREFERENCES_REDACTION_COLOR,H.SIGNATURE_DIALOG,a.SIGN_DIALOG_HISTORY,H.THUMBNAIL_VIEW,a.THUMBNAIL_VIEW_EDIT,B.ANNOT_PROPERTY_VIEW_ATTRIBUTES,a.WIDGET_PROPERTY_OPTION,a.WIDGET_PROPERTY_CALCULATION,a.WIDGET_PROPERTY_ACTION,H.FORM_CONTROL,B.RESIZE_AND_MOVE_FORM,a.DELETE_FORM],al=[a.ORIGINAL_DOWNLOAD_BUTTON,a.USE_SPREADSHEETS_VIEWER],cl=[B.PKI_SIGNATURE_TOOLBAR,a.PKI_INSTANT_SIGNATURE_BUTTON,a.PKI_INVISIBLE_SIGNATURE_BUTTON],ll={key:H.ROOT,children:[{key:H.MAIN_TOOLBAR,children:[{key:H.MAIN_MENU,children:[a.SAVE_BUTTON,a.ORIGINAL_DOWNLOAD_BUTTON,a.PDF_DOWNLOAD_BUTTON,a.PRINT_BUTTON,a.DOCUMENT_INFO_BUTTON,a.SLIDESHOW_BUTTON,a.EBOOK_BUTTON,a.PREFERENCES_BUTTON,a.SCREEN_THEME_MENU,a.SD_INFO_BUTTON]},{key:B.LEFT_SIDE_VIEW_BUTTON,children:[a.THUMBNAIL_VIEW_BUTTON,a.OUTLINE_VIEW_BUTTON,a.ANNOTATION_VIEW_BUTTON,a.REDACTION_VIEW_BUTTON,a.EMBEDDED_FILE_VIEW_BUTTON,a.FORM_VIEW_BUTTON,a.SIGNATURE_VIEW_BUTTON]},a.QUICK_ACTION_BUTTON,a.CAPTURE_MODE_BUTTON,a.SCALE_DROPDOWN,a.FIT_BUTTON,{key:B.VIEW_MODE_BUTTON,children:[a.VIEW_MODE_BUTTON,a.ROTATION_BUTTON]},{key:B.DRAG_MODE_BUTTONS,children:[a.DRAG_MODE_MOVE_BUTTON,a.DRAG_MODE_SELECT_TEXT_BUTTON,a.DRAG_MODE_MAGNIFY_BUTTON]},{key:B.ANNOT_TOOLBAR,children:[a.ANNOT_TOOLBAR_UNDO_REDO_BUTTONS,a.ANNOT_TOOLBAR_DRAG_MODE_SELECT_ANNOT,{key:B.DRAWING_ANNOTATION_BUTTONS,children:[a.INK_ANNOTATION_BUTTON,a.LINE_ANNOTATION_BUTTON,a.SQUARE_ANNOTATION_BUTTON,a.CIRCLE_ANNOTATION_BUTTON,a.POLYGON_ANNOTATION_BUTTON,a.POLYLINE_ANNOTATION_BUTTON,a.CLOUD_ANNOTATION_BUTTON]},a.FREE_TEXT_ANNOTATION_BUTTON,a.FREE_TEXT_CALLOUT_ANNOTATION_BUTTON,a.MEMO_ANNOTATION_BUTTON,{key:B.MEASURE_ANNOTATION_BUTTONS,children:[a.LINE_DIMENSION_ANNOTATION_BUTTON,a.POLYLINE_DIMENSION_ANNOTATION_BUTTON,a.POLYGON_DIMENSION_ANNOTATION_BUTTON]},a.STAMP_ANNOTATION_BUTTON,a.HIGHLIGHT_ANNOTATION_BUTTON,a.STRIKEOUT_ANNOTATION_BUTTON,a.UNDERLINE_ANNOTATION_BUTTON,a.LINK_ANNOTATION_BUTTON,a.ERASER_BUTTON,a.SIGNATURE_WIDGET_BUTTON,a.ANNOT_TOOLBAR_ANNOT_PROPERTY_BUTTON]},{key:B.FORM_TOOLBAR,children:[a.FORM_TOOLBAR_UNDO_REDO_BUTTON,a.FORM_TOOLBAR_DRAG_MODE_SELECT_ANNOT,a.TEXT_FIELD_WIDGET_BUTTON,a.COMBO_BOX_WIDGET_BUTTON,a.LIST_BOX_WIDGET_BUTTON,a.CHECK_BOX_WIDGET_BUTTON,a.RADIO_BUTTON_WIDGET_BUTTON,a.BUTTON_WIDGET_BUTTON,a.RULER_BUTTON,a.WIDGET_HIGHLIGHT_BUTTON,a.FORM_TOOLBAR_ANNOT_PROPERTY_BUTTON]},{key:B.PKI_SIGNATURE_TOOLBAR,children:[a.PKI_INSTANT_SIGNATURE_BUTTON,a.PKI_INVISIBLE_SIGNATURE_BUTTON]},a.DAP_VIEW_BUTTON]},{key:B.FLOATING_NAVIGATION,children:[a.FLOATING_NAVIGATION_AUTO_HIDE,a.PAGE_NAVIGATION,a.MOVE_TO_ADJACENT_PAGE_BUTTON,a.ZOOM_BUTTON,a.QUICK_SEARCH_BUTTON,a.FULL_SEARCH_BUTTON]},{key:H.DIALOG,children:[{key:B.PRINT_DIALOG,children:[a.BROWSER_PRINT,a.PLUGIN_PRINT]},{key:B.DOCUMENT_INFO_DIALOG,children:[a.DOCUMENT_INFO_DESCRIPTION,a.DOCUMENT_INFO_SECURITY]},{key:B.PREFERENCES_DIALOG,children:[a.PREFERENCES_DEFAULT_FIT,a.PREFERENCES_LINK_ACTIVATION,a.PREFERENCES_LANGUAGE,a.PREFERENCES_WIDGET_HIGHLIGHT,a.PREFERENCES_ANNOTATION_AUTHOR,a.PREFERENCES_POPUP_TEXT_SIZE,a.PREFERENCES_CONTINUOUS_ANNOT_WRITING,a.PREFERENCES_REDACTION_COLOR,a.PREFERENCES_DISPLAY_ORIENTATION]},{key:H.STMAP_DIALOG,children:[a.USE_SAMPLE_STAMP_IMAGE,a.UPLOAD_STAMP_IMAGE]},{key:H.SIGNATURE_DIALOG,children:[a.SIGN_DIALOG_HISTORY]}]},{key:H.PANEL,children:[{key:H.THUMBNAIL_VIEW,children:[a.THUMBNAIL_VIEW_EDIT]},{key:H.OUTLINE_VIEW,children:[a.OUTLINE_VIEW_EDIT,a.OUTLINE_VIEW_DEFAULT_EXPAND]},{key:H.ANNOTATION_VIEW,children:[a.ANNOTATION_VIEW_REPLY]},{key:H.EMBEDDED_FILE_VIEW,children:[a.EMBEDDED_FILE_VIEW_EDIT,a.EMBEDDED_FILE_VIEW_DOWNLOAD]},{key:B.ANNOT_PROPERTY_VIEW_ATTRIBUTES,children:[a.WIDGET_PROPERTY_OPTION,a.WIDGET_PROPERTY_CALCULATION,a.WIDGET_PROPERTY_ACTION]},{key:H.TEXT_SEARCH_VIEW,children:[{key:a.TEXT_SEARCH_VIEW_REGEX,children:[H.REGEX_BUTTON]}]},{key:H.DAP_VIEW,children:[a.DAP_VIEW_TREE,a.DAP_VIEW_TABLE,a.DAP_VIEW_DEFAULT_OPEN,{key:H.DEFAULT_VIEWED_DAP_LIST,children:[a.DAP_VIEW_DEFAULT_VIEW_TREE,a.DAP_VIEW_DEFAULT_VIEW_TABLE]}]}]},{key:H.ETC_UI,children:[{key:B.INDICATOR,children:[a.SCALE_INDICATOR,a.MEASURE_INDICATOR,a.PAGE_INDICATOR]},a.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU,{key:B.ANNOTATION_FLOATING_MENU,children:[a.ANNOT_FLOATING_PROPERTY,a.ANNOT_FLOATING_POPUP_NOTE,a.ANNOT_FLOATING_ADD_RADIO_BUTTON,a.ANNOT_FLOATING_DELETE]}]}]},pl={key:H.ROOT,children:[{key:a.CHANGE_PRIMARY_COLOR,children:[a.PRIMARY_50,a.PRIMARY_70]},{key:H.DEFAULT_SCREEN_THEME,children:[a.SCREEN_THEME_LIGHT,a.SCREEN_THEME_DARK,a.SCREEN_THEME_SYSTEM]},a.WELCOME_PAGE_VISIBLE,a.USE_SPREADSHEETS_VIEWER,{key:H.FRONTEND_API,children:[a.USE_STREAMDOCS_API,a.DELAY_LOADING]},a.PAGE_TITLE,a.WARNING_LEAVE_WITHOUT_SAVE,{key:H.DEFAULT_VIEW_MODE,children:[a.DEFAULT_VIEW_MODE_ONE,a.DEFAULT_VIEW_MODE_ONE_C,a.DEFAULT_VIEW_MODE_TWO,a.DEFAULT_VIEW_MODE_TWO_C,a.DEFAULT_VIEW_MODE_EBOOK]},{key:H.DEFAULT_ZOOM,children:[a.DEFAULT_ZOOM_READ,a.DEFAULT_ZOOM_FIT_WIDTH,a.DEFAULT_ZOOM_FIT_HEIGHT,a.DEFAULT_ZOOM_FIT_PAGE,a.DEFAULT_ZOOM_FIT_ACTUAL_SIZE,a.DEFAULT_ZOOM_MAINTAIN]},{key:H.DEFAULT_DRAG_MODE,children:[a.DEFAULT_DRAG_MODE_SCROLL,a.DEFAULT_DRAG_MODE_TEXT_SELECT,a.DEFAULT_DRAG_MODE_MAGNIFY]},{key:H.DEFAULT_CONTINUE_WRITING,children:[a.DEFAULT_CONTINUE_WRITING_ACTIVE,a.DEFAULT_CONTINUE_WRITING_INACTIVE]},{key:H.DEFAULT_REDACTION_COLOR,children:[a.DEFAULT_REDACTION_OUTLINE_COLOR,a.DEFAULT_REDACTION_INTERIOR_COLOR]},{key:a.USE_CLIENT_RENDERING,children:[a.CLIENT_RENDERING_HYBRID,{key:H.RENDERING_OPTION,children:[a.CLIENT_RENDERING_OPTION_QUALITY_FIRST,a.CLIENT_RENDERING_OPTION_BALANCE,a.CLIENT_RENDERING_OPTION_SPEED_FIRST]},a.CLIENT_RENDERING_MAXIMUM_SCALE,a.CLIENT_RENDERING_PIXELATED]},a.PAGE_TEXT_FOR_SCREEN_READER,{key:H.ANNOTATION_CONTROL,children:[a.RESIZE_ANNOTATION,a.MOVE_ANNOTATION,a.DELETE_ANNOTATION,{key:H.STAMP_DRAWING_GESTURE,children:[a.DRAWING_STAMP_VIA_DRAG,a.DRAWING_STAMP_VIA_CLICK]}]},{key:H.FORM_CONTROL,children:[B.RESIZE_AND_MOVE_FORM,a.DELETE_FORM]},{key:H.SHORTCUT,children:[a.SHORTCUT_COPY_PASTE,a.SHORTCUT_UNDO_REDO,a.SHORTCUT_COPY_TEXT,a.SHORTCUT_PRINT,a.SHORTCUT_QUICK_ACTION]},{key:H.SAVE_OPTION,children:[a.SAVE_OPTION_SPEED_OPTIMIZE,a.SAVE_OPTION_SIZE_OPTIMIZE]},a.AUTO_SAVE,a.COLLECT_STATISTIC_BY_VIEWER]},Vr={[H.MAIN_TOOLBAR]:{value:!1,name:"MAIN_TOOLBAR",description:"SETTINGS_MAIN_TOOLBAR_DESCRIPTION"},[H.MAIN_MENU]:{value:!1,name:"MENU",description:"SETTINGS_MENU_DESCRIPTION"},[a.SAVE_BUTTON]:{value:y(a.SAVE_BUTTON),name:"SAVE",description:"SETTINGS_SAVE_DESCRIPTION",tooltip:"SETTINGS_SAVE_TOOLTIP"},[a.ORIGINAL_DOWNLOAD_BUTTON]:{value:y(a.ORIGINAL_DOWNLOAD_BUTTON),name:"ORIGINAL_DOWNLOAD",description:"SETTINGS_DOWNLOAD_ORIGINAL_DESCRIPTION"},[a.PDF_DOWNLOAD_BUTTON]:{value:y(a.PDF_DOWNLOAD_BUTTON),name:"PDF_DOWNLOAD",description:"SETTINGS_DOWNLOAD_PDF_DESCRIPTION"},[a.PRINT_BUTTON]:{value:y(a.PRINT_BUTTON),name:"PRINT",description:"SETTINGS_PRINT_DESCRIPTION"},[a.QUICK_ACTION_BUTTON]:{value:y(a.QUICK_ACTION_BUTTON),name:"QUICK_ACTION",description:"SETTINGS_QUICK_ACTION_DESCRIPTION",icons:["map-magnifier"]},[a.CAPTURE_MODE_BUTTON]:{value:y(a.CAPTURE_MODE_BUTTON),name:"CAPTURE",description:"SETTINGS_CAPTURE_MODE_DESCRIPTION",icons:["capture-tool"]},[a.DOCUMENT_INFO_BUTTON]:{value:y(a.DOCUMENT_INFO_BUTTON),name:"DOC_PROPERTY",description:"SETTINGS_DOC_PROPERTY_DESCRIPTION"},[a.SLIDESHOW_BUTTON]:{value:y(a.SLIDESHOW_BUTTON),name:"SLIDESHOW",description:"SETTINGS_SLIDESHOW_DESCRIPTION"},[a.EBOOK_BUTTON]:{value:y(a.EBOOK_BUTTON),name:"EBOOK",description:"SETTINGS_EBOOK_MODE_DESCRIPTION"},[a.PREFERENCES_BUTTON]:{value:y(a.PREFERENCES_BUTTON),name:"PREFERENCES",description:"SETTINGS_PREFERENCES_DESCRIPTION"},[a.SCREEN_THEME_MENU]:{value:y(a.SCREEN_THEME_MENU),name:"SCREEN_THEME",description:"SETTINGS_SCREEN_THEME_DESCRIPTION"},[a.SD_INFO_BUTTON]:{value:y(a.SD_INFO_BUTTON),name:"SD_INFO",description:"SETTINGS_SD_INFO_DESCRIPTION"},[B.LEFT_SIDE_VIEW_BUTTON]:{value:y(B.LEFT_SIDE_VIEW_BUTTON),name:"LEFT_SIDE_VIEW_BUTTON",description:"SETTINGS_LEFT_SIDE_VIEW_DESCRIPTION"},[a.THUMBNAIL_VIEW_BUTTON]:{value:y(a.THUMBNAIL_VIEW_BUTTON),icons:["list"],name:"THUMBNAIL",description:"SETTINGS_THUMBNAIL_DESCRIPTION"},[a.OUTLINE_VIEW_BUTTON]:{value:y(a.OUTLINE_VIEW_BUTTON),icons:["bookmark"],name:"OUTLINE",description:"SETTINGS_OUTLINE_DESCRIPTION"},[a.ANNOTATION_VIEW_BUTTON]:{value:y(a.ANNOTATION_VIEW_BUTTON),icons:["annotation-list"],name:"ANNOTATION_LIST",description:"SETTINGS_ANNOTATION_LIST_DESCRIPTION"},[a.REDACTION_VIEW_BUTTON]:{value:y(a.REDACTION_VIEW_BUTTON),icons:["redaction2"],name:"REDACT",description:"SETTINGS_REDACTION_DESCRIPTION"},[a.EMBEDDED_FILE_VIEW_BUTTON]:{value:y(a.EMBEDDED_FILE_VIEW_BUTTON),icons:["clip"],name:"EMBEDDED_FILE",description:"SETTINGS_ATTACHMENTS_DESCRIPTION"},[a.FORM_VIEW_BUTTON]:{value:y(a.FORM_VIEW_BUTTON),icons:["formfield"],name:"FORM_TOOL",description:"SETTINGS_FORM_TOOL_DESCRIPTION"},[a.SIGNATURE_VIEW_BUTTON]:{value:y(a.SIGNATURE_VIEW_BUTTON),icons:["sign-list"],name:"SIGN_LIST",description:"SETTINGS_SIGN_LIST_DESCRIPTION"},[a.SCALE_DROPDOWN]:{value:y(a.SCALE_DROPDOWN),name:"EDIT_MAGNIFICATION",description:"SETTINGS_EDIT_MAGNIFICATION_DESCRIPTION"},[a.FIT_BUTTON]:{value:y(a.FIT_BUTTON),icons:["fit-height3","fit-width3"],name:"FIT_TO_HEIGHT_AND_WIDTH",description:"SETTINGS_FIT_TO_HEIGHT_AND_WIDTH_DESCRIPTION"},[B.VIEW_MODE_BUTTON]:{value:y(B.VIEW_MODE_BUTTON),name:"VIEW_MODE_AND_ROTATE",description:"SETTINGS_VIEW_MODE_AND_ROTATE_DESCRIPTION"},[a.VIEW_MODE_BUTTON]:{value:y(a.VIEW_MODE_BUTTON),icons:["two-page-continuous3"],name:"VIEW_MODE",description:"SETTINGS_VIEW_MODE_DESCRIPTION"},[a.ROTATION_BUTTON]:{value:y(a.ROTATION_BUTTON),icons:["rotate"],name:"ROTATION",description:"SETTINGS_ROTATION_DESCRIPTION"},[B.DRAG_MODE_BUTTONS]:{value:y(B.DRAG_MODE_BUTTONS),name:"DRAG_MODE",description:"SETTINGS_DRAG_MODE_DESCRIPTION"},[a.DRAG_MODE_MOVE_BUTTON]:{value:y(a.DRAG_MODE_MOVE_BUTTON),icons:["hand"],name:"SCROLL_MODE",description:"SETTINGS_SCROLL_MODE_DESCRIPTION"},[a.DRAG_MODE_SELECT_TEXT_BUTTON]:{value:y(a.DRAG_MODE_SELECT_TEXT_BUTTON),icons:["selection-annotation-text"],name:"SELECT_TEXT",description:"SETTINGS_SELECT_TEXT_DESCRIPTION"},[a.DRAG_MODE_MAGNIFY_BUTTON]:{value:y(a.DRAG_MODE_MAGNIFY_BUTTON),icons:["area-zoom2"],name:"MAGNIFICATION_TOOL",description:"SETTINGS_MAGNIFICATION_TOOL_DESCRIPTION"},[B.ANNOT_TOOLBAR]:{value:y(B.ANNOT_TOOLBAR),name:"TOOL_ANNOT",description:"SETTINGS_TOOL_ANNOT_DESCRIPTION"},[a.ANNOT_TOOLBAR_UNDO_REDO_BUTTONS]:{value:y(a.ANNOT_TOOLBAR_UNDO_REDO_BUTTONS),icons:["undo","redo"],name:"UNDO_REDO",description:"SETTINGS_UNDO_REDO_DESCRIPTION"},[a.ANNOT_TOOLBAR_DRAG_MODE_SELECT_ANNOT]:{value:y(a.ANNOT_TOOLBAR_DRAG_MODE_SELECT_ANNOT),icons:["pointer"],name:"SELECT_ANNOT_TOOL",description:"SETTINGS_SELECT_ANNOT_TOOL_DESCRIPTION"},[B.DRAWING_ANNOTATION_BUTTONS]:{value:y(B.DRAWING_ANNOTATION_BUTTONS),name:"DRAW_ANNOTS_TOOL",description:"SETTINGS_DRAW_ANNOTS_TOOL_DESCRIPTION"},[a.INK_ANNOTATION_BUTTON]:{value:y(a.INK_ANNOTATION_BUTTON),icons:["pen"],name:"INK_TOOL",description:"SETTINGS_INK_TOOL_DESCRIPTION"},[a.LINE_ANNOTATION_BUTTON]:{value:y(a.LINE_ANNOTATION_BUTTON),icons:["line"],name:"LINE_TOOL",description:"SETTINGS_LINE_TOOL_DESCRIPTION"},[a.SQUARE_ANNOTATION_BUTTON]:{value:y(a.SQUARE_ANNOTATION_BUTTON),icons:["square"],name:"SQUARE_TOOL",description:"SETTINGS_SQUARE_TOOL_DESCRIPTION"},[a.CIRCLE_ANNOTATION_BUTTON]:{value:y(a.CIRCLE_ANNOTATION_BUTTON),icons:["circle"],name:"CIRCLE_TOOL",description:"SETTINGS_CIRCLE_TOOL_DESCRIPTION"},[a.POLYGON_ANNOTATION_BUTTON]:{value:y(a.POLYGON_ANNOTATION_BUTTON),icons:["polygon"],name:"POLYGON_TOOL",description:"SETTINGS_POLYGON_TOOL_DESCRIPTION"},[a.POLYLINE_ANNOTATION_BUTTON]:{value:y(a.POLYLINE_ANNOTATION_BUTTON),icons:["polyline"],name:"POLYLINE_TOOL",description:"SETTINGS_POLYLINE_TOOL_DESCRIPTION"},[a.CLOUD_ANNOTATION_BUTTON]:{value:y(a.CLOUD_ANNOTATION_BUTTON),icons:["revisioncloud"],name:"POLYGON_CLOUD_TOOL",description:"SETTINGS_POLYGON_CLOUD_TOOL_DESCRIPTION"},[a.FREE_TEXT_ANNOTATION_BUTTON]:{value:y(a.FREE_TEXT_ANNOTATION_BUTTON),icons:["textbox"],name:"FREE_TEXT_TOOL",description:"SETTINGS_FREE_TEXT_TOOL_DESCRIPTION"},[a.FREE_TEXT_CALLOUT_ANNOTATION_BUTTON]:{value:y(a.FREE_TEXT_CALLOUT_ANNOTATION_BUTTON),icons:["callout2"],name:"FREE_TEXT_CALLOUT_TOOL",description:"SETTINGS_FREE_TEXT_CALLOUT_TOOL_DESCRIPTION"},[a.MEMO_ANNOTATION_BUTTON]:{value:y(a.MEMO_ANNOTATION_BUTTON),icons:["memo3"],name:"TEXT_TOOL",description:"SETTINGS_TEXT_TOOL_DESCRIPTION"},[B.MEASURE_ANNOTATION_BUTTONS]:{value:y(B.MEASURE_ANNOTATION_BUTTONS),name:"MEASUREMENT_TOOLS",description:"SETTINGS_MEASUREMENT_TOOLS_DESCRIPTION"},[a.LINE_DIMENSION_ANNOTATION_BUTTON]:{value:y(a.LINE_DIMENSION_ANNOTATION_BUTTON),icons:["line-measure2"],name:"DISTANCE_TOOL",description:"SETTINGS_DISTANCE_TOOL_DESCRIPTION"},[a.POLYLINE_DIMENSION_ANNOTATION_BUTTON]:{value:y(a.POLYLINE_DIMENSION_ANNOTATION_BUTTON),icons:["polyline-measure2"],name:"PERIMETER_TOOL",description:"SETTINGS_PERIMETER_TOOL_DESCRIPTION"},[a.POLYGON_DIMENSION_ANNOTATION_BUTTON]:{value:y(a.POLYGON_DIMENSION_ANNOTATION_BUTTON),icons:["polygon-measure2"],name:"AREA_TOOL",description:"SETTINGS_AREA_TOOL_DESCRIPTION"},[a.STAMP_ANNOTATION_BUTTON]:{value:y(a.STAMP_ANNOTATION_BUTTON),icons:["stamp2"],name:"STAMP_TOOL",description:"SETTINGS_STAMP_TOOL_DESCRIPTION"},[a.HIGHLIGHT_ANNOTATION_BUTTON]:{value:y(a.HIGHLIGHT_ANNOTATION_BUTTON),icons:["text-highlight"],name:"HIGHLIGHT",description:"SETTINGS_HIGHLIGHT_DESCRIPTION"},[a.STRIKEOUT_ANNOTATION_BUTTON]:{value:y(a.STRIKEOUT_ANNOTATION_BUTTON),icons:["text-strikeout"],name:"STRIKEOUT",description:"SETTINGS_STRIKEOUT_DESCRIPTION"},[a.UNDERLINE_ANNOTATION_BUTTON]:{value:y(a.UNDERLINE_ANNOTATION_BUTTON),icons:["text-underline"],name:"UNDERLINE",description:"SETTINGS_UNDERLINE_DESCRIPTION"},[a.LINK_ANNOTATION_BUTTON]:{value:y(a.LINK_ANNOTATION_BUTTON),icons:["link"],name:"CREATE_LINK",description:"SETTINGS_CREATE_LINK_DESCRIPTION"},[a.ERASER_BUTTON]:{value:y(a.ERASER_BUTTON),icons:["eraser"],name:"ERASER",description:"SETTINGS_ERASER_DESCRIPTION"},[a.SIGNATURE_WIDGET_BUTTON]:{value:y(a.SIGNATURE_WIDGET_BUTTON),icons:["signature"],name:"SIGN",description:"SETTINGS_SIGN_DESCRIPTION"},[a.ANNOT_TOOLBAR_ANNOT_PROPERTY_BUTTON]:{value:y(a.ANNOT_TOOLBAR_ANNOT_PROPERTY_BUTTON),icons:["show-panel"],name:"PROPERTIES_PANEL",description:"SETTINGS_PROPERTIES_PANEL_DESCRIPTION"},[B.FORM_TOOLBAR]:{value:y(B.FORM_TOOLBAR),name:"TOOL_FORM",description:"SETTINGS_TOOL_FORM_DESCRIPTION"},[a.FORM_TOOLBAR_UNDO_REDO_BUTTON]:{value:y(a.FORM_TOOLBAR_UNDO_REDO_BUTTON),icons:["undo","redo"],name:"UNDO_REDO",description:"SETTINGS_UNDO_REDO_DESCRIPTION"},[a.FORM_TOOLBAR_DRAG_MODE_SELECT_ANNOT]:{value:y(a.FORM_TOOLBAR_DRAG_MODE_SELECT_ANNOT),icons:["pointer"],name:"SELECT_ANNOT_TOOL",description:"SETTINGS_SELECT_ANNOT_TOOL_DESCRIPTION"},[a.TEXT_FIELD_WIDGET_BUTTON]:{value:y(a.TEXT_FIELD_WIDGET_BUTTON),icons:["text-field"],name:"TEXT_FIELD",description:"SETTINGS_TEXT_FIELD_DESCRIPTION"},[a.COMBO_BOX_WIDGET_BUTTON]:{value:y(a.COMBO_BOX_WIDGET_BUTTON),icons:["dropdown"],name:"COMBO_BOX",description:"SETTINGS_COMBO_BOX_DESCRIPTION"},[a.LIST_BOX_WIDGET_BUTTON]:{value:y(a.LIST_BOX_WIDGET_BUTTON),icons:["list-box"],name:"LIST_BOX",description:"SETTINGS_LIST_BOX_DESCRIPTION"},[a.CHECK_BOX_WIDGET_BUTTON]:{value:y(a.CHECK_BOX_WIDGET_BUTTON),icons:["check-mark3"],name:"CHECK_BUTTON",description:"SETTINGS_CHECK_BUTTON_DESCRIPTION"},[a.RADIO_BUTTON_WIDGET_BUTTON]:{value:y(a.RADIO_BUTTON_WIDGET_BUTTON),icons:["radio2-checked"],name:"RADIO_BUTTON",description:"SETTINGS_RADIO_BUTTON_DESCRIPTION"},[a.BUTTON_WIDGET_BUTTON]:{value:y(a.BUTTON_WIDGET_BUTTON),icons:["ok"],name:"BUTTON",description:"SETTINGS_BUTTON_DESCRIPTION"},[a.RULER_BUTTON]:{value:y(a.RULER_BUTTON),icons:["ruler-show"],name:"RULER",description:"SETTINGS_FORM_RULER_DESCRIPTION"},[a.WIDGET_HIGHLIGHT_BUTTON]:{value:y(a.WIDGET_HIGHLIGHT_BUTTON),icons:["area-show"],name:"FORM_HIGHLIGHTED",description:"SETTINGS_FORM_HIGHLIGHTED_DESCRIPTION"},[a.FORM_TOOLBAR_ANNOT_PROPERTY_BUTTON]:{value:y(a.FORM_TOOLBAR_ANNOT_PROPERTY_BUTTON),icons:["show-panel"],name:"PROPERTIES_PANEL",description:"SETTINGS_FORM_PROPERTIES_PANEL_DESCRIPTION"},[B.PKI_SIGNATURE_TOOLBAR]:{value:y(B.PKI_SIGNATURE_TOOLBAR),name:"PKI_SIGN",description:"SETTINGS_PKI_SIGN_DESCRIPTION"},[a.PKI_INSTANT_SIGNATURE_BUTTON]:{value:y(a.PKI_INSTANT_SIGNATURE_BUTTON),icons:["signature"],name:"INSTANT_SIGNATURE",description:"SETTINGS_INSTANT_SIGNATURE_DESCRIPTION"},[a.PKI_INVISIBLE_SIGNATURE_BUTTON]:{value:y(a.PKI_INVISIBLE_SIGNATURE_BUTTON),icons:["memo2"],name:"INVISIBLE_SIGNATURE",description:"SETTINGS_INVISIBLE_SIGNATURE_DESCRIPTION"},[a.DAP_VIEW_BUTTON]:{value:y(a.DAP_VIEW_BUTTON),icons:["composite-document"],name:"DAP_VIEW",description:"SETTINGS_DAP_VIEW_DESCRIPTION",deps:[B.DAP_VIEW]},[B.FLOATING_NAVIGATION]:{value:y(B.FLOATING_NAVIGATION),name:"FLOATING_NAVIGATION",description:"SETTINGS_FLOATING_NAVIGATION_DESCRIPTION",excludeDeps:[a.FLOATING_NAVIGATION_AUTO_HIDE]},[a.PAGE_NAVIGATION]:{value:y(a.PAGE_NAVIGATION),name:"MOVE_SPECIFYING_PAGE",description:"SETTINGS_MOVE_SPECIFYING_PAGE_DESCRIPTION"},[a.MOVE_TO_ADJACENT_PAGE_BUTTON]:{value:y(a.MOVE_TO_ADJACENT_PAGE_BUTTON),icons:["previous-symbol2","next-symbol2"],name:"MOVE_TO_ADJACENT_PAGE",description:"SETTINGS_MOVE_TO_ADJACENT_PAGE_DESCRIPTION"},[a.ZOOM_BUTTON]:{value:y(a.ZOOM_BUTTON),icons:["minus","plus"],name:"ZOOM_IN_OUT",description:"SETTINGS_ZOOM_IN_OUT_DESCRIPTION"},[a.QUICK_SEARCH_BUTTON]:{value:y(a.QUICK_SEARCH_BUTTON),icons:["search"],name:"QUICK_SEARCH",description:"SETTINGS_QUICK_SEARCH_DESCRIPTION"},[a.FULL_SEARCH_BUTTON]:{value:y(a.FULL_SEARCH_BUTTON),icons:["extend"],name:"TEXT_SEARCH_VIEW_TITLE",description:"SETTINGS_FULL_SEARCH_DESCRIPTION"},[a.FLOATING_NAVIGATION_AUTO_HIDE]:{value:y(a.FLOATING_NAVIGATION_AUTO_HIDE),name:"FLOATING_NAVIGATION_AUTO_HIDE",description:"SETTINGS_FLOATING_NAVIGATION_AUTO_HIDE_DESCRIPTION",deps:[B.FLOATING_NAVIGATION]},[H.DIALOG]:{value:!1,isDummy:!0,name:"SETTINGS_DIALOG",description:"SETTINGS_DIALOG_DESCRIPTION"},[B.PRINT_DIALOG]:{value:y(B.PRINT_DIALOG),name:"PRINT",description:"SETTINGS_PRINT_DESCRIPTION"},[a.BROWSER_PRINT]:{value:y(a.BROWSER_PRINT),icons:["print"],name:"BROWSER_PRINT",description:"SETTINGS_BROWSER_PRINT_DESCRIPTION"},[a.PLUGIN_PRINT]:{value:y(a.PLUGIN_PRINT),icons:["download"],name:"PLUGIN_PRINT",description:"SETTINGS_PLUGIN_PRINT_DESCRIPTION"},[B.DOCUMENT_INFO_DIALOG]:{value:y(B.DOCUMENT_INFO_DIALOG),name:"DOC_PROPERTY",description:"SETTINGS_DOC_PROPERTY_DESCRIPTION"},[a.DOCUMENT_INFO_DESCRIPTION]:{value:y(a.DOCUMENT_INFO_DESCRIPTION),name:"GENERAL",description:"SETTINGS_DOC_INFO_DESCRIPTION"},[a.DOCUMENT_INFO_SECURITY]:{value:y(a.DOCUMENT_INFO_SECURITY),name:"PERMISSIONS",description:"SETTINGS_PERMISSIONS_DESCRIPTION"},[B.PREFERENCES_DIALOG]:{value:y(B.PREFERENCES_DIALOG),name:"PREFERENCES",description:"SETTINGS_PREFERENCES_DESCRIPTION"},[a.PREFERENCES_DEFAULT_FIT]:{value:y(a.PREFERENCES_DEFAULT_FIT),name:"DEFAULT_ZOOM",description:"SETTINGS_DEFAULT_ZOOM_DESCRIPTION"},[a.PREFERENCES_LINK_ACTIVATION]:{value:y(a.PREFERENCES_LINK_ACTIVATION),name:"LINK_ACTIVATION",description:"SETTINGS_LINK_ACTIVATION_DESCRIPTION"},[a.PREFERENCES_LANGUAGE]:{value:y(a.PREFERENCES_LANGUAGE),name:"LANGUAGE",description:"SETTINGS_LANGUAGE_DESCRIPTION"},[a.PREFERENCES_WIDGET_HIGHLIGHT]:{value:y(a.PREFERENCES_WIDGET_HIGHLIGHT),name:"FORMFIELD_HIGHLIGHTED",description:"SETTINGS_FORMFIELD_HIGHLIGHTED_DESCRIPTION"},[a.PREFERENCES_ANNOTATION_AUTHOR]:{value:y(a.PREFERENCES_ANNOTATION_AUTHOR),name:"ANNOTATION_AUTHOR",description:"SETTINGS_ANNOTATION_AUTHOR_DESCRIPTION"},[a.PREFERENCES_POPUP_TEXT_SIZE]:{value:y(a.PREFERENCES_POPUP_TEXT_SIZE),name:"VIEW_POPUP",description:"SETTINGS_VIEW_POPUP_DESCRIPTION"},[a.PREFERENCES_CONTINUOUS_ANNOT_WRITING]:{value:y(a.PREFERENCES_CONTINUOUS_ANNOT_WRITING),name:"CONTINUOUS_ANNOT_WRITING",description:"SETTINGS_CONTINUOUS_ANNOT_WRITING_DESCRIPTION"},[a.PREFERENCES_REDACTION_COLOR]:{value:y(a.PREFERENCES_REDACTION_COLOR),name:"REDACT_COLOR",description:"SETTINGS_REDACT_COLOR_DESCRIPTION"},[a.PREFERENCES_DISPLAY_ORIENTATION]:{value:y(a.PREFERENCES_DISPLAY_ORIENTATION),name:"VIEWER_DIRECTION",description:"SETTINGS_VIEWER_DIRECTION_DESCRIPTION"},[H.STMAP_DIALOG]:{value:!1,isDummy:!0,name:"STAMP_SELECTION_DIALOG",description:"SETTINGS_STAMP_SELECTION_DIALOG_DESCRIPTION"},[a.USE_SAMPLE_STAMP_IMAGE]:{value:y(a.USE_SAMPLE_STAMP_IMAGE),name:"STAMP_SAMPLE",description:"SETTINGS_STAMP_SAMPLE_DESCRIPTION"},[a.UPLOAD_STAMP_IMAGE]:{value:y(a.UPLOAD_STAMP_IMAGE),name:"STAMP_FILE_ADD",description:"SETTINGS_STAMP_FILE_ADD_DESCRIPTION"},[H.SIGNATURE_DIALOG]:{value:!1,isDummy:!0,name:"SIGNATURE_DRAWING_DIALOG",description:"SETTINGS_SIGNATURE_DIALOG_DESCRIPTION"},[a.SIGN_DIALOG_HISTORY]:{value:y(a.SIGN_DIALOG_HISTORY),name:"SIGN_VIEW_HISTORY",description:"SETTINGS_SIGN_VIEW_HISTORY_DESCRIPTION"},[H.PANEL]:{value:!1,isDummy:!0,name:"PANEL_SETTINGS",description:"SETTINGS_PANEL_DESCRIPTION"},[H.THUMBNAIL_VIEW]:{value:!1,isDummy:!0,name:"THUMBNAIL",description:"SETTINGS_THUMBNAIL_DESCRIPTION"},[a.THUMBNAIL_VIEW_EDIT]:{value:y(a.THUMBNAIL_VIEW_EDIT),name:"EDIT",description:"SETTINGS_PAGE_EDIT_DESCRIPTION"},[H.OUTLINE_VIEW]:{value:!1,isDummy:!0,name:"OUTLINE",description:"SETTINGS_OUTLINE_DESCRIPTION"},[a.OUTLINE_VIEW_EDIT]:{value:y(a.OUTLINE_VIEW_EDIT),name:"ADD_AND_DELETE",description:"SETTINGS_OUTLINE_ADD_AND_DELETE_DESCRIPTION"},[a.OUTLINE_VIEW_DEFAULT_EXPAND]:{value:y(a.OUTLINE_VIEW_DEFAULT_EXPAND),name:"OUTLINE_DEFAULT_EXPAND",description:"SETTINGS_OUTLINE_DEFAULT_EXPAND_DESCRIPTION"},[H.ANNOTATION_VIEW]:{value:!1,isDummy:!0,name:"ANNOTATION_LIST",description:"SETTINGS_ANNOTATION_DESCRIPTION"},[a.ANNOTATION_VIEW_REPLY]:{value:y(a.ANNOTATION_VIEW_REPLY),name:"ANNOTATION_REPLY",description:"SETTINGS_ANNOTATION_REPLY_DESCRIPTION"},[H.EMBEDDED_FILE_VIEW]:{value:!1,isDummy:!0,name:"EMBEDDED_FILE",description:"SETTINGS_ATTACHMENTS_DESCRIPTION"},[a.EMBEDDED_FILE_VIEW_EDIT]:{value:y(a.EMBEDDED_FILE_VIEW_EDIT),name:"ATTACHMENTS_AND_DELETE",description:"SETTINGS_ATTACHMENTS_AND_DELETE_DESCRIPTION"},[a.EMBEDDED_FILE_VIEW_DOWNLOAD]:{value:y(a.EMBEDDED_FILE_VIEW_DOWNLOAD),name:"DOWNLOAD",description:"SETTINGS_ATTACHED_FILE_DOWNLOAD_DESCRIPTION"},[B.ANNOT_PROPERTY_VIEW_ATTRIBUTES]:{value:y(B.ANNOT_PROPERTY_VIEW_ATTRIBUTES),name:"ANNOTATION_PROPERTIES",description:"SETTINGS_PROPERTIES_PANEL_DESCRIPTION"},[a.WIDGET_PROPERTY_OPTION]:{value:y(a.WIDGET_PROPERTY_OPTION),name:"OPTION",description:"SETTINGS_OPTION_DESCRIPTION"},[a.WIDGET_PROPERTY_CALCULATION]:{value:y(a.WIDGET_PROPERTY_CALCULATION),name:"FIELD_PROPERTY_CALCULATE",description:"SETTINGS_FIELD_PROPERTY_CALCULATE_DESCRIPTION"},[a.WIDGET_PROPERTY_ACTION]:{value:y(a.WIDGET_PROPERTY_ACTION),name:"ACTION",description:"SETTINGS_ACTION_DESCRIPTION"},[H.TEXT_SEARCH_VIEW]:{value:!1,isDummy:!0,name:"TEXT_SEARCH_VIEW_TITLE",description:"SETTINGS_FULL_SEARCH_DESCRIPTION"},[a.TEXT_SEARCH_VIEW_REGEX]:{value:y(a.TEXT_SEARCH_VIEW_REGEX),name:"USE_REGEX",description:"SETTINGS_SEARCH_REGEX_DESCRIPTION"},[H.REGEX_BUTTON]:{value:!1,icons:["plus"],name:"ADD_USER_DEFINED_REGEX",description:"",editable:!0},[H.DAP_VIEW]:{value:!1,isDummy:!0,name:"DAP_VIEW",description:"SETTINGS_DAP_VIEW_DESCRIPTION"},[a.DAP_VIEW_TREE]:{value:y(a.DAP_VIEW_TREE),name:"VIEW_AS_TREE",description:"SETTINGS_VIEWED_DAP_LIST_TREE_DESCRIPTION"},[a.DAP_VIEW_TABLE]:{value:y(a.DAP_VIEW_TABLE),name:"VIEW_AS_TABLE",description:"SETTINGS_VIEWED_DAP_LIST_TABLE_DESCRIPTION"},[a.DAP_VIEW_DEFAULT_OPEN]:{value:y(a.DAP_VIEW_DEFAULT_OPEN),name:"DAP_VIEW_DEFAULT_OPEN",description:"SETTINGS_DAP_VIEW_DEFAULT_OPEN_DESCRIPTION",deps:[B.DAP_VIEW,a.DAP_VIEW_BUTTON]},[H.DEFAULT_VIEWED_DAP_LIST]:{value:!1,name:"DEFAULT_VIEWED_DAP_LIST",description:"SETTINGS_DEFAULT_VIEWED_DAP_LIST_DESCRIPTION",isRadio:!0,deps:[a.DAP_VIEW_TREE,a.DAP_VIEW_TABLE]},[a.DAP_VIEW_DEFAULT_VIEW_TREE]:{value:y(a.DAP_VIEW_DEFAULT_VIEW_TREE),name:"VIEW_AS_TREE",description:"SETTINGS_VIEWED_DAP_LIST_TREE_DESCRIPTION",isRadio:!0,deps:[a.DAP_VIEW_TREE,a.DAP_VIEW_TABLE]},[a.DAP_VIEW_DEFAULT_VIEW_TABLE]:{value:y(a.DAP_VIEW_DEFAULT_VIEW_TABLE),name:"VIEW_AS_TABLE",description:"SETTINGS_VIEWED_DAP_LIST_TABLE_DESCRIPTION",isRadio:!0,deps:[a.DAP_VIEW_TREE,a.DAP_VIEW_TABLE]},[H.ETC_UI]:{value:!1,isDummy:!0,name:"ETC",description:"SETTINGS_ETC_DESCRIPTION"},[B.INDICATOR]:{value:y(B.INDICATOR),name:"FUNCTION_GUIDE",description:"SETTINGS_FUNCTION_GUIDE_DESCRIPTION"},[a.SCALE_INDICATOR]:{value:y(a.SCALE_INDICATOR),name:"SCALE_GUIDE",description:"SETTINGS_SCALE_GUIDE_DESCRIPTION"},[a.MEASURE_INDICATOR]:{value:y(a.MEASURE_INDICATOR),name:"MEASURE_GUIDE",description:"SETTINGS_MEASURE_GUIDE_DESCRIPTION"},[a.PAGE_INDICATOR]:{value:y(a.PAGE_INDICATOR),name:"PAGE_GUIDE",description:"SETTINGS_PAGE_GUIDE_DESCRIPTION"},[a.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU]:{value:y(a.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU),name:"FILE_MENUS_UI",description:"SETTINGS_FILE_MENUS_UI_DESCRIPTION"},[B.ANNOTATION_FLOATING_MENU]:{value:y(B.ANNOTATION_FLOATING_MENU),name:"ANNOTATION_FLOATING_MENU",description:"SETTINGS_ANNOTATION_FLOATING_MENU_DESCRIPTION"},[a.ANNOT_FLOATING_PROPERTY]:{value:y(a.ANNOT_FLOATING_PROPERTY),icons:["settings"],name:"ANNOTATION_PROPERTIES",description:"SETTINGS_ANNOTATION_FLOATING_PROPERTY_DESCRIPTION"},[a.ANNOT_FLOATING_POPUP_NOTE]:{value:y(a.ANNOT_FLOATING_POPUP_NOTE),icons:["memo2"],name:"ANNOT_FLOATING_POPUP_NOTE",description:"SETTINGS_ANNOTATION_FLOATING_POPUP_NOTE_DESCRIPTION"},[a.ANNOT_FLOATING_ADD_RADIO_BUTTON]:{value:y(a.ANNOT_FLOATING_ADD_RADIO_BUTTON),icons:["plus"],name:"ANNOT_FLOATING_ADD_RADIO_BUTTON",description:"SETTINGS_ANNOTATION_FLOATING_ADD_RADIO_BUTTON_DESCRIPTION"},[a.ANNOT_FLOATING_DELETE]:{value:y(a.ANNOT_FLOATING_DELETE),icons:["trash-can"],name:"DELETE",description:"SETTINGS_ANNOTATION_FLOATING_DELETE_DESCRIPTION"},[a.CHANGE_PRIMARY_COLOR]:{value:y(a.CHANGE_PRIMARY_COLOR),name:"CHANGE_PRIMARY_COLOR",description:"SETTINGS_CHANGE_PRIMARY_COLOR_DESCRIPTION"},[H.DEFAULT_SCREEN_THEME]:{value:!1,name:"SCREEN_THEME",description:"SETTINGS_DEFAULT_SCREEN_THEME_DESCRIPTION",isRadio:!0},[a.SCREEN_THEME_LIGHT]:{value:y(a.SCREEN_THEME_LIGHT),name:"SETTINGS_SCREEN_THEME_LIGHT",description:"SETTINGS_SCREEN_THEME_LIGHT_DESCRIPTION",isRadio:!0},[a.SCREEN_THEME_DARK]:{value:y(a.SCREEN_THEME_DARK),name:"SETTINGS_SCREEN_THEME_DARK",description:"SETTINGS_SCREEN_THEME_DARK_DESCRIPTION",isRadio:!0},[a.SCREEN_THEME_SYSTEM]:{value:y(a.SCREEN_THEME_SYSTEM),name:"SETTINGS_SCREEN_THEME_SYSTEM",description:"SETTINGS_SCREEN_THEME_SYSTEM_DESCRIPTION",isRadio:!0},[a.PRIMARY_50]:{value:y(a.PRIMARY_50),name:"PRIMARY_COLOR_50",description:"SETTINGS_PRIMARY_50_DESCRIPTION",isColorPicker:!0,deps:[a.CHANGE_PRIMARY_COLOR]},[a.PRIMARY_70]:{value:y(a.PRIMARY_70),name:"PRIMARY_COLOR_70",description:"SETTINGS_PRIMARY_70_DESCRIPTION",isColorPicker:!0,deps:[a.CHANGE_PRIMARY_COLOR]},[a.WELCOME_PAGE_VISIBLE]:{value:y(a.WELCOME_PAGE_VISIBLE),name:"WELCOME_PAGE",description:"SETTINGS_WELCOME_PAGE_ACCESS"},[a.USE_SPREADSHEETS_VIEWER]:{value:y(a.USE_SPREADSHEETS_VIEWER),name:"SPREADSHEETS_VIEWER",description:"SETTINGS_SPREADSHEETS_VIEWER_DESCRIPTION"},[H.FRONTEND_API]:{value:!1,name:"FRONTEND_API",description:"SETTINGS_FRONTEND_API_DESCRIPTION"},[a.USE_STREAMDOCS_API]:{value:y(a.USE_STREAMDOCS_API),name:"FRONTEND_API_ALLOW",description:"SETTINGS_FRONTEND_API_ALLOW_DESCRIPTION"},[a.DELAY_LOADING]:{value:y(a.DELAY_LOADING),name:"DELAY_LOADING",description:"SETTINGS_DELAY_LOADING_DESCRIPTION"},[a.PAGE_TITLE]:{value:y(a.PAGE_TITLE),name:"PAGE_TITLE",description:"SETTINGS_PAGE_TITLE_DESCRIPTION",isText:!0},[a.WARNING_LEAVE_WITHOUT_SAVE]:{value:y(a.WARNING_LEAVE_WITHOUT_SAVE),name:"LEAVE_PAGE",description:"SETTINGS_LEAVE_PAGE_DESCRIPTION"},[H.DEFAULT_VIEW_MODE]:{value:y(H.DEFAULT_VIEW_MODE),name:"DEFAULT_VIEW_MODE",description:"SETTINGS_DEFAULT_VIEW_MODE_DESCRIPTION",isRadio:!0},[a.DEFAULT_VIEW_MODE_ONE]:{value:y(a.DEFAULT_VIEW_MODE_ONE),name:"SINGLE_PAGE_VIEW",description:"SETTINGS_VIEW_MODE_ONE_DESCRIPTION",isRadio:!0},[a.DEFAULT_VIEW_MODE_ONE_C]:{value:y(a.DEFAULT_VIEW_MODE_ONE_C),name:"SINGLE_PAGE_CONTINUOUS",description:"SETTINGS_VIEW_MODE_ONE_C_DESCRIPTION",isRadio:!0},[a.DEFAULT_VIEW_MODE_TWO]:{value:y(a.DEFAULT_VIEW_MODE_TWO),name:"TWO_PAGE_VIEW",description:"SETTINGS_VIEW_MODE_TWO_DESCRIPTION",isRadio:!0},[a.DEFAULT_VIEW_MODE_TWO_C]:{value:y(a.DEFAULT_VIEW_MODE_TWO_C),name:"TWO_PAGE_CONTINUOUS",description:"SETTINGS_VIEW_MODE_TWO_C_DESCRIPTION",isRadio:!0},[a.DEFAULT_VIEW_MODE_EBOOK]:{value:y(a.DEFAULT_VIEW_MODE_EBOOK),name:"VIEW_MODE_EBOOK",description:"SETTINGS_VIEW_MODE_EBOOK_DESCRIPTION",isRadio:!0},[H.DEFAULT_ZOOM]:{value:y(H.DEFAULT_ZOOM),name:"DEFAULT_ZOOM",description:"SETTINGS_ADMIN_DEFAULT_ZOOM_DESCRIPTION",isRadio:!0},[a.DEFAULT_ZOOM_READ]:{value:y(a.DEFAULT_ZOOM_READ),name:"FIT_TO_READ",description:"SETTINGS_ZOOM_READ_DESCRIPTION",isRadio:!0},[a.DEFAULT_ZOOM_FIT_WIDTH]:{value:y(a.DEFAULT_ZOOM_FIT_WIDTH),name:"FIT_TO_WIDTH_2",description:"SETTINGS_ZOOM_FIT_WIDTH_DESCRIPTION",isRadio:!0},[a.DEFAULT_ZOOM_FIT_HEIGHT]:{value:y(a.DEFAULT_ZOOM_FIT_HEIGHT),name:"FIT_TO_HEIGHT_2",description:"SETTINGS_ZOOM_FIT_HEIGHT_DESCRIPTION",isRadio:!0},[a.DEFAULT_ZOOM_FIT_PAGE]:{value:y(a.DEFAULT_ZOOM_FIT_PAGE),name:"FIT",description:"SETTINGS_ZOOM_FIT_DESCRIPTION",isRadio:!0},[a.DEFAULT_ZOOM_FIT_ACTUAL_SIZE]:{value:y(a.DEFAULT_ZOOM_FIT_ACTUAL_SIZE),name:"FIT_ACTUAL_SIZE",description:"SETTINGS_ZOOM_FIT_ACTUAL_SIZE_DESCRIPTION",isRadio:!0},[a.DEFAULT_ZOOM_MAINTAIN]:{value:y(a.DEFAULT_ZOOM_MAINTAIN),name:"MAINTAIN",description:"SETTINGS_ZOOM_MAINTAIN_DESCRIPTION",tooltip:"SETTINGS_ZOOM_MAINTAIN_TOOLTIP",isRadio:!0},[H.DEFAULT_DRAG_MODE]:{value:y(H.DEFAULT_DRAG_MODE),name:"DEFAULT_DRAG_MODE",description:"SETTINGS_DEFAULT_DRAG_MODE_DESCRIPTION",isRadio:!0},[a.DEFAULT_DRAG_MODE_SCROLL]:{value:y(a.DEFAULT_DRAG_MODE_SCROLL),name:"SCROLL_MODE",description:"SETTINGS_DRAG_MODE_SCROLL_DESCRIPTION",isRadio:!0},[a.DEFAULT_DRAG_MODE_TEXT_SELECT]:{value:y(a.DEFAULT_DRAG_MODE_TEXT_SELECT),name:"SELECT_TEXT",description:"SETTINGS_DRAG_MODE_TEXT_SELECT_DESCRIPTION",isRadio:!0},[a.DEFAULT_DRAG_MODE_MAGNIFY]:{value:y(a.DEFAULT_DRAG_MODE_MAGNIFY),name:"MAGNIFY_TOOL",description:"SETTINGS_DRAG_MODE_MAGNIFY_DESCRIPTION",isRadio:!0},[H.DEFAULT_CONTINUE_WRITING]:{value:!1,name:"DEFAULT_CONTINUE_WRITING",description:"SETTINGS_DEFAULT_CONTINUE_WRITING_DESCRIPTION",isRadio:!0},[a.DEFAULT_CONTINUE_WRITING_ACTIVE]:{value:y(a.DEFAULT_CONTINUE_WRITING_ACTIVE),name:"ACTIVE",description:"SETTINGS_CONTINUE_WRITING_ACTIVE_DESCRIPTION",isRadio:!0},[a.DEFAULT_CONTINUE_WRITING_INACTIVE]:{value:y(a.DEFAULT_CONTINUE_WRITING_INACTIVE),name:"INACTIVE",description:"SETTINGS_CONTINUE_WRITING_INACTIVE_DESCRIPTION",isRadio:!0},[H.DEFAULT_REDACTION_COLOR]:{value:!1,name:"CHANGE_DEFAULT_REDACTION_COLOR",description:"SETTINGS_REDACTION_COLOR_DESCRIPTION",tooltip:"SETTINGS_REDACTION_COLOR_TOOLTIP",isDummy:!0},[a.DEFAULT_REDACTION_OUTLINE_COLOR]:{value:y(a.DEFAULT_REDACTION_OUTLINE_COLOR),name:"REDACTION_OUTLINE_COLOR",description:"SETTINGS_REDACTION_OUTLINE_COLOR_DESCRIPTION",isColorPicker:!0},[a.DEFAULT_REDACTION_INTERIOR_COLOR]:{value:y(a.DEFAULT_REDACTION_INTERIOR_COLOR),name:"REDACTION_INTERIOR_COLOR",description:"SETTINGS_REDACTION_INTERIOR_COLOR_DESCRIPTION",isColorPicker:!0},[a.USE_CLIENT_RENDERING]:{value:y(a.USE_CLIENT_RENDERING),name:"CLIENT_RENDERING",description:"SETTINGS_CLIENT_RENDERING_DESCRIPTION",tooltip:"SETTINGS_CLIENT_RENDERING_TOOLTIP"},[a.CLIENT_RENDERING_HYBRID]:{value:y(a.CLIENT_RENDERING_HYBRID),name:"HYBRID_MODE",description:"SETTINGS_HYBRID_MODE_DESCRIPTION"},[H.RENDERING_OPTION]:{value:!1,name:"RENDERING_OPTION",description:"SETTINGS_RENDERING_OPTION_DESCRIPTION",tooltip:"SETTINGS_RENDERING_OPTION_TOOLTIP",deps:[a.USE_CLIENT_RENDERING],isRadio:!0},[a.CLIENT_RENDERING_OPTION_QUALITY_FIRST]:{value:y(a.CLIENT_RENDERING_OPTION_QUALITY_FIRST),name:"QUALITY_FIRST",description:"SETTINGS_QUALITY_FIRST_DESCRIPTION",isRadio:!0},[a.CLIENT_RENDERING_OPTION_BALANCE]:{value:y(a.CLIENT_RENDERING_OPTION_BALANCE),name:"BALANCE",description:"SETTINGS_BALANCE_DESCRIPTION",isRadio:!0},[a.CLIENT_RENDERING_OPTION_SPEED_FIRST]:{value:y(a.CLIENT_RENDERING_OPTION_SPEED_FIRST),name:"SPEED_FIRST",description:"SETTINGS_SPEED_FIRST_DESCRIPTION",isRadio:!0},[a.CLIENT_RENDERING_MAXIMUM_SCALE]:{value:y(a.CLIENT_RENDERING_MAXIMUM_SCALE),name:"MAXIMUM_SCALE",description:"SETTINGS_MAXIMUM_SCALE_DESCRIPTION",tooltip:"SETTINGS_MAXIMUM_SCALE_TOOLTIP",deps:[a.USE_CLIENT_RENDERING],isDropDown:!0},[a.CLIENT_RENDERING_PIXELATED]:{value:y(a.CLIENT_RENDERING_PIXELATED),name:"PIXELATED_RENDERING",description:"SETTINGS_PIXELATE_DESCRIPTION"},[a.PAGE_TEXT_FOR_SCREEN_READER]:{value:y(a.PAGE_TEXT_FOR_SCREEN_READER),name:"PAGE_TEXT_FOR_SCREEN_READER",description:"SETTINGS_PAGE_TEXT_FOR_SCREEN_READER_DESCRIPTION"},[H.ANNOTATION_CONTROL]:{value:!1,isDummy:!0,name:"ANNOTATION_CONTROL",description:"SETTINGS_ANNOTATION_CONTROL_DESCRIPTION"},[a.RESIZE_ANNOTATION]:{value:y(a.RESIZE_ANNOTATION),name:"RESIZE",description:"SETTINGS_RESIZE_ANNOTATION_DESCRIPTION"},[a.MOVE_ANNOTATION]:{value:y(a.MOVE_ANNOTATION),name:"MOVE",description:"SETTINGS_MOVE_ANNOTATION_DESCRIPTION"},[a.DELETE_ANNOTATION]:{value:y(a.DELETE_ANNOTATION),name:"DELETE",description:"SETTINGS_REMOVE_ANNOTATION_DESCRIPTION"},[H.STAMP_DRAWING_GESTURE]:{value:!1,name:"STAMP_DRAWING_METHOD",description:"SETTINGS_STAMP_DRAWING_METHOD_DESCRIPTION",isRadio:!0},[a.DRAWING_STAMP_VIA_DRAG]:{value:y(a.DRAWING_STAMP_VIA_DRAG),name:"DRAG_TO_DRAW",description:"SETTINGS_DRAG_TO_DRAW_DESCRIPTION",isRadio:!0},[a.DRAWING_STAMP_VIA_CLICK]:{value:y(a.DRAWING_STAMP_VIA_CLICK),name:"CLICK_TO_DRAW",description:"SETTINGS_CLICK_TO_DRAW_DESCRIPTION",isRadio:!0},[H.FORM_CONTROL]:{value:!1,isDummy:!0,name:"FORM_CONTROL",description:"SETTINGS_FORM_CONTROL_DESCRIPTION"},[B.RESIZE_AND_MOVE_FORM]:{value:y(B.RESIZE_AND_MOVE_FORM),name:"RESIZE_AND_MOVE",description:"SETTINGS_RESIZE_AND_MOVE_FORM_DESCRIPTION"},[a.DELETE_FORM]:{value:y(a.DELETE_FORM),name:"DELETE",description:"SETTINGS_REMOVE_FORM_DESCRIPTION"},[H.SHORTCUT]:{value:y(H.SHORTCUT),name:"SHORTCUT",description:"SETTINGS_SHORTCUT_DESCRIPTION"},[a.SHORTCUT_COPY_PASTE]:{value:y(a.SHORTCUT_COPY_PASTE),name:"SHORTCUT_COPY_PASTE",description:"SETTINGS_SHORTCUT_COPY_PASTE_DESCRIPTION"},[a.SHORTCUT_UNDO_REDO]:{value:y(a.SHORTCUT_UNDO_REDO),name:"SHORTCUT_UNDO_REDO",description:"SETTINGS_SHORTCUT_UNDO_REDO_DESCRIPTION"},[a.SHORTCUT_COPY_TEXT]:{value:y(a.SHORTCUT_COPY_TEXT),name:"SHORTCUT_COPY_TEXT",description:"SETTINGS_SHORTCUT_COPY_TEXT_DESCRIPTION"},[a.SHORTCUT_PRINT]:{value:y(a.SHORTCUT_PRINT),name:"SHORTCUT_PRINT",description:"SETTINGS_SHORTCUT_PRINT_DESCRIPTION"},[a.SHORTCUT_QUICK_ACTION]:{value:y(a.SHORTCUT_PRINT),name:"SHORTCUT_QUICK_ACTION",description:"SETTINGS_SHORTCUT_QUICK_ACTION_DESCRIPTION"},[H.SAVE_OPTION]:{value:y(H.SAVE_OPTION),name:"SAVE_OPTION",description:"SETTINGS_SAVE_OPTION_DESCRIPTION",isRadio:!0},[a.SAVE_OPTION_SPEED_OPTIMIZE]:{value:y(a.SAVE_OPTION_SPEED_OPTIMIZE),name:"SPEED_OPTIMIZE",description:"SETTINGS_SPEED_OPTIMIZE_DESCRIPTION",isRadio:!0},[a.SAVE_OPTION_SIZE_OPTIMIZE]:{value:y(a.SAVE_OPTION_SIZE_OPTIMIZE),name:"SIZE_OPTIMIZE",description:"SETTINGS_SIZE_OPTIMIZE_DESCRIPTION",isRadio:!0},[a.AUTO_SAVE]:{value:y(a.AUTO_SAVE),name:"AUTO_SAVE",description:"SETTINGS_AUTO_SAVE_DESCRIPTION",tooltip:"SETTINGS_AUTO_SAVE_TOOLTIP",warning:{message:"SETTINGS_AUTO_SAVE_WARNING",triggerValue:!0}},[a.COLLECT_STATISTIC_BY_VIEWER]:{value:y(a.COLLECT_STATISTIC_BY_VIEWER),name:"COLLECT_STATISTIC_BY_VIEWER",description:"SETTINGS_COLLECT_STATISTIC_BY_VIEWER"}};var Ii=function(r){return r[r.TREE_VIEW=0]="TREE_VIEW",r[r.TABLE_VIEW=1]="TABLE_VIEW",r}(Ii||{});var Jt=(()=>{let n=class n{timeOffsetSrc;baseHref;httpClient;productService;signatureService;resetClickSrc=new pt;resetClick$=this.resetClickSrc.asObservable();cancelClickSrc=new pt;cancelClick$=this.cancelClickSrc.asObservable();configSavedSrc=new pt;configSaved$=this.configSavedSrc.asObservable();openWarningModalSrc=new pt;openWarningModal$=this.openWarningModalSrc.asObservable();_uiConfigTree;get uiConfigTree(){return typeof this._uiConfigTree>"u"&&(this._uiConfigTree=this.buildConfigTree(ll)),this._uiConfigTree}_featureConfigTree;get featureConfigTree(){return typeof this._featureConfigTree>"u"&&(this._featureConfigTree=this.buildConfigTree(pl)),this._featureConfigTree}t;constrainedConfigs={[a.SAVE_BUTTON]:{fixTo:!1,config:{key:a.AUTO_SAVE,triggerValue:!0}},[a.WARNING_LEAVE_WITHOUT_SAVE]:{fixTo:!0,config:{key:a.AUTO_SAVE,triggerValue:!0}}};radioConfig={[H.DEFAULT_SCREEN_THEME]:{items:[{key:a.SCREEN_THEME_LIGHT,value:"light"},{key:a.SCREEN_THEME_DARK,value:"dark"},{key:a.SCREEN_THEME_SYSTEM,value:"System synchronization"}],value:a.SCREEN_THEME_LIGHT},[H.SAVE_OPTION]:{items:[{key:a.SAVE_OPTION_SPEED_OPTIMIZE,value:null},{key:a.SAVE_OPTION_SIZE_OPTIMIZE,value:null}],value:a.SAVE_OPTION_SPEED_OPTIMIZE},[H.DEFAULT_VIEW_MODE]:{items:[{key:a.DEFAULT_VIEW_MODE_ONE,value:0},{key:a.DEFAULT_VIEW_MODE_ONE_C,value:1},{key:a.DEFAULT_VIEW_MODE_TWO,value:2},{key:a.DEFAULT_VIEW_MODE_TWO_C,value:3},{key:a.DEFAULT_VIEW_MODE_EBOOK,value:4}],value:a.DEFAULT_VIEW_MODE_ONE_C},[H.DEFAULT_ZOOM]:{items:[{key:a.DEFAULT_ZOOM_READ,value:5},{key:a.DEFAULT_ZOOM_FIT_WIDTH,value:0},{key:a.DEFAULT_ZOOM_FIT_HEIGHT,value:1},{key:a.DEFAULT_ZOOM_FIT_PAGE,value:3},{key:a.DEFAULT_ZOOM_FIT_ACTUAL_SIZE,value:4},{key:a.DEFAULT_ZOOM_MAINTAIN,value:7}],value:a.DEFAULT_ZOOM_READ},[H.DEFAULT_DRAG_MODE]:{items:[{key:a.DEFAULT_DRAG_MODE_SCROLL,value:ye.MOVE},{key:a.DEFAULT_DRAG_MODE_TEXT_SELECT,value:ye.SELECT_TEXT},{key:a.DEFAULT_DRAG_MODE_MAGNIFY,value:ye.MAGNIFY},{key:a.DEFAULT_DRAG_MODE_AUTO,value:ye.AUTO}],value:a.DEFAULT_DRAG_MODE_SCROLL},[H.DEFAULT_CONTINUE_WRITING]:{items:[{key:a.DEFAULT_CONTINUE_WRITING_ACTIVE,value:!0},{key:a.DEFAULT_CONTINUE_WRITING_INACTIVE,value:!1}],value:a.DEFAULT_CONTINUE_WRITING_INACTIVE},[H.DEFAULT_VIEWED_DAP_LIST]:{items:[{key:a.DAP_VIEW_DEFAULT_VIEW_TREE,value:Ii.TREE_VIEW},{key:a.DAP_VIEW_DEFAULT_VIEW_TABLE,value:Ii.TABLE_VIEW}],value:a.DAP_VIEW_DEFAULT_VIEW_TABLE},[H.RENDERING_OPTION]:{items:[{key:a.CLIENT_RENDERING_OPTION_QUALITY_FIRST,value:Ar.QUALITY_FIRST},{key:a.CLIENT_RENDERING_OPTION_BALANCE,value:Ar.BALANCE},{key:a.CLIENT_RENDERING_OPTION_SPEED_FIRST,value:Ar.SPEED_FIRST}],value:a.CLIENT_RENDERING_OPTION_QUALITY_FIRST},[H.STAMP_DRAWING_GESTURE]:{items:[{key:a.DRAWING_STAMP_VIA_DRAG,value:Zi.DRAG},{key:a.DRAWING_STAMP_VIA_CLICK,value:Zi.CLICK_ONLY}],value:a.DRAWING_STAMP_VIA_DRAG}};pkiSignatureEnabled=!1;constructor(e,t,o,s,c){this.timeOffsetSrc=e,this.baseHref=t,this.httpClient=o,this.productService=s,this.signatureService=c,this.timeOffsetSrc.subscribe({next:u=>this.t=u}),this.signatureService.metadata$.pipe(ii(1)).subscribe({next:u=>this.pkiSignatureEnabled=!!u.pki.enable})}get standardPresetKeys(){let e=[a.SAVE_BUTTON,a.ORIGINAL_DOWNLOAD_BUTTON,a.PDF_DOWNLOAD_BUTTON,a.PRINT_BUTTON,a.DOCUMENT_INFO_BUTTON,a.SLIDESHOW_BUTTON,a.EBOOK_BUTTON,a.PREFERENCES_BUTTON,a.SCREEN_THEME_MENU,a.SD_INFO_BUTTON,B.LEFT_SIDE_VIEW_BUTTON,a.SCALE_DROPDOWN,a.FIT_BUTTON,B.VIEW_MODE_BUTTON,B.DRAG_MODE_BUTTONS,a.DAP_VIEW_BUTTON,B.ANNOT_TOOLBAR,B.FORM_TOOLBAR,B.ANNOT_PROPERTY_VIEW_ATTRIBUTES,B.FLOATING_NAVIGATION,B.INDICATOR,a.THUMBNAIL_VIEW_EDIT,a.OUTLINE_VIEW_EDIT,a.EMBEDDED_FILE_VIEW_DOWNLOAD,a.EMBEDDED_FILE_VIEW_EDIT,B.DAP_VIEW,a.DAP_VIEW_DEFAULT_OPEN,B.PRINT_DIALOG,B.DOCUMENT_INFO_DIALOG,B.PREFERENCES_DIALOG,B.ANNOTATION_FLOATING_MENU,a.WARNING_LEAVE_WITHOUT_SAVE,a.RESIZE_ANNOTATION,a.MOVE_ANNOTATION,a.DELETE_ANNOTATION,a.USE_SAMPLE_STAMP_IMAGE,a.UPLOAD_STAMP_IMAGE,B.RESIZE_AND_MOVE_FORM,a.DELETE_FORM,a.SIGN_DIALOG_HISTORY,a.SHORTCUT_COPY_PASTE,a.SHORTCUT_COPY_TEXT,a.SHORTCUT_UNDO_REDO],t=[a.AUTO_SAVE,a.PDF_DOWNLOAD_BUTTON,a.OUTLINE_VIEW_DEFAULT_EXPAND,a.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU,a.USE_CLIENT_RENDERING];return this.productService.isStreamDocsVu&&t.push(a.ORIGINAL_DOWNLOAD_BUTTON),{activateKeys:e,deactivateKeys:t}}get litePresetKeys(){let e=[a.AUTO_SAVE,a.ORIGINAL_DOWNLOAD_BUTTON,a.PDF_DOWNLOAD_BUTTON,a.PRINT_BUTTON,a.DOCUMENT_INFO_BUTTON,a.SLIDESHOW_BUTTON,a.EBOOK_BUTTON,a.PREFERENCES_BUTTON,a.SCREEN_THEME_MENU,a.SD_INFO_BUTTON,a.THUMBNAIL_VIEW_BUTTON,a.OUTLINE_VIEW_BUTTON,a.ANNOTATION_VIEW_BUTTON,a.REDACTION_VIEW_BUTTON,a.EMBEDDED_FILE_VIEW_BUTTON,a.SCALE_DROPDOWN,a.FIT_BUTTON,B.VIEW_MODE_BUTTON,B.DRAG_MODE_BUTTONS,a.DAP_VIEW_BUTTON,B.ANNOT_TOOLBAR,B.ANNOT_PROPERTY_VIEW_ATTRIBUTES,B.FLOATING_NAVIGATION,B.INDICATOR,a.THUMBNAIL_VIEW_EDIT,a.OUTLINE_VIEW_EDIT,a.EMBEDDED_FILE_VIEW_DOWNLOAD,a.EMBEDDED_FILE_VIEW_EDIT,B.DAP_VIEW,a.DAP_VIEW_DEFAULT_OPEN,B.PRINT_DIALOG,B.DOCUMENT_INFO_DIALOG,B.PREFERENCES_DIALOG,B.ANNOTATION_FLOATING_MENU,a.USE_CLIENT_RENDERING,a.CLIENT_RENDERING_HYBRID,a.CLIENT_RENDERING_PIXELATED,a.CLIENT_RENDERING_OPTION_QUALITY_FIRST,a.WARNING_LEAVE_WITHOUT_SAVE,a.RESIZE_ANNOTATION,a.MOVE_ANNOTATION,a.DELETE_ANNOTATION,a.USE_SAMPLE_STAMP_IMAGE,a.UPLOAD_STAMP_IMAGE,B.RESIZE_AND_MOVE_FORM,a.DELETE_FORM,a.SIGN_DIALOG_HISTORY,a.SHORTCUT_COPY_PASTE,a.SHORTCUT_COPY_TEXT,a.SHORTCUT_UNDO_REDO],t=[a.SAVE_BUTTON,a.PDF_DOWNLOAD_BUTTON,a.FORM_VIEW_BUTTON,a.SIGNATURE_VIEW_BUTTON,B.FORM_TOOLBAR,a.OUTLINE_VIEW_DEFAULT_EXPAND,a.CLIENT_RENDERING_OPTION_BALANCE,a.CLIENT_RENDERING_OPTION_SPEED_FIRST];return this.productService.isStreamDocsVu&&t.push(a.ORIGINAL_DOWNLOAD_BUTTON),{activateKeys:e,deactivateKeys:t}}isMergedRuntimeEnvKey(e){return xi.hasDefinedProp(Nc,e)}isIgnoredKey(e){return Object.values(H).some(t=>e===t)}publishResetClick(){this.resetClickSrc.next()}publishCancelClick(){this.resetClickSrc.next()}publishConfigSaved(){this.configSavedSrc.next()}getViewConfigs(){return this.httpClient.get(`${this.baseHref}v4/preference/view`,{observe:"response",responseType:"text"}).pipe(Gt(e=>hc.c2NzkzMzg2(e,this.t)),St(e=>{if(e.body===null)throw new uc("No response body received.");return JSON.parse(e.body)}))}postViewConfig(e){return this.httpClient.post(`${this.baseHref}v4/preference/view`,e)}buildConfigTree(e,t=-1){if(typeof e=="string"){let c=Vr[e];if(!T.isDefined(c)&&e!==H.ROOT)throw new $e(`No configuration description found for the key '${e}'.`);let u=rt(Oe({},c),{key:e,depth:t});return u.formControl=new tt(u.value),{data:u,expanded:e===H.ROOT,parent:null,children:[]}}let o=this.buildConfigTree(e.key,t),s=e.children.reduce((c,u)=>{let C=this.buildConfigTree(u,t+1);return this.productService.isStreamDocsVu&&sl.includes(C.data.key)||this.productService.isStreamDocs&&al.includes(C.data.key)||!this.pkiSignatureEnabled&&cl.includes(C.data.key)?c:[...c,C]},[]);return s.forEach(c=>c.parent=o),o.children=s,o}getStampImage(){let e=new XMLHttpRequest;e.open("GET","assets/images/stamp/stamp2.png",!0),e.responseType="arraybuffer",e.onload=()=>{if(e.status===200){let t=new Blob([e.response],{type:"image/png"}),o=new FileReader;o.onload=()=>{if(typeof o.result!="string")return;let s=o.result.split(",")[1];ki[V.STAMP].attributes.appearance={type:"image",data:s,format:"png",height:220,width:220}},o.readAsDataURL(t)}},e.send()}modifyConfigsByProductType(e,t){let o=t?"StreamDocs":"StreamDocs Vu!";e.some(c=>c.key===a.PAGE_TITLE)||e.push({key:a.PAGE_TITLE,value:`"${o}"`});let s=e.find(c=>c.key===a.CONTEXT_MENU_TOOLS_IN_USE);if(s!==void 0){let u=JSON.parse(s.value).filter(C=>{let x=["REDACTION","SELECT_ANNOT_TOOL"].map(N=>N.toString());return t||xi.hasDefinedProp(C,"id")&&!x.includes(C.id)});s.value=JSON.stringify(u)}}fireOpenWarningModal(e){this.openWarningModalSrc.next(e)}};v(n,"\u0275fac",function(t){return new(t||n)(Kt(Vc),Kt(rc),Kt(cc),Kt(Vn),Kt(Wn))}),v(n,"\u0275prov",Ti({token:n,factory:n.\u0275fac}));let r=n;return r})();function Hp(r,n){if(r&1){let i=w();Te(0),h(1,"sd-configs-item",11),O("onRegexDialogConfirm",function(t){f(i);let o=d(2);return g(o.confirmRegex(t))})("onRegexDelete",function(){let t=f(i).$implicit,o=d(2);return g(o.deleteConfig(t))})("onToggle",function(){let t=f(i).$implicit,o=d(2);return g(o.toggleConfig(t))})("onRadioModelChange",function(){let t=f(i).$implicit,o=d(2);return g(o.changeRadioConfig(t))})("onColorModelChange",function(){let t=f(i).$implicit,o=d(2);return g(o.changeColorConfig(t))})("onDropDownModelChange",function(){let t=f(i).$implicit,o=d(2);return g(o.changeDropDownConfig(t))})("onTextModelChange",function(){let t=f(i).$implicit,o=d(2);return g(o.changeTextConfig(t))}),_(),Ee()}if(r&2){let i=n.$implicit;l(),p("item",i)("formControl",i.data.formControl)}}function jp(r,n){if(r&1&&(Te(0),R(1,Hp,2,2,"ng-container",10),Ee()),r&2){let i=d();l(),p("eTreeFrom",i.selectedConfigTree)}}function $p(r,n){r&1&&I(0,"sd-context-menu-config")}function Yp(r,n){r&1&&I(0,"sd-annot-property-config")}function Xp(r,n){r&1&&(h(0,"div",15),I(1,"i",16),_())}function Kp(r,n){r&1&&(h(0,"div",15),I(1,"i",16),_())}function Qp(r,n){if(r&1){let i=w();Te(0),h(1,"button",12),O("click",function(){f(i);let t=d();return g(t.onClickUIMode(!1))}),R(2,Xp,2,0,"div",13),M(3),E(4,"translate"),_(),h(5,"button",14),O("click",function(){f(i);let t=d();return g(t.onClickUIMode(!0))}),R(6,Kp,2,0,"div",13),M(7),E(8,"translate"),_(),Ee()}if(r&2){let i=d();l(2),p("ngIf",i.isLiteUIPreset),l(),ke(" ",S(4,4,"LITE_UI")," "),l(3),p("ngIf",i.isStandardUIPreset),l(),ke(" ",S(8,6,"STANDARD_UI")," ")}}function Zp(r,n){if(r&1){let i=w();h(0,"button",17),O("click",function(){f(i);let t=d();return g(t.onResetButtonClick())}),I(1,"i",18),M(2),E(3,"translate"),_()}r&2&&(l(2),ke(" ",S(3,1,"RESET_CONTEXT_MENU"),""))}var ml=(()=>{let n=class n{configsService;subs;toastService;changeDetectorRef;translatePipe;formBuilder;dialogService;productService;modalService;i18nService;loggingService;get TabItem(){return Fi}tabItems=[Fi.UI_DISPLAY_SETTINGS,Fi.FEATURE_SETTINGS,Fi.CONTEXT_MENU_SETTINGS,Fi.ANNOT_PROPERTY_SETTINGS];selectedTab=this.tabItems[0];selectedConfigTree=null;fetchError=!1;isLoading=!1;formChanged=!1;excludeRecursionListForLoad=[{key:a.CHANGE_PRIMARY_COLOR,value:[!1]},{key:a.THUMBNAIL_VIEW_BUTTON,value:[!0]},{key:a.OUTLINE_VIEW_BUTTON,value:[!0]},{key:a.TEXT_SEARCH_VIEW_REGEX,value:[!0]},{key:a.USE_CLIENT_RENDERING,value:[!0]},{key:B.FLOATING_NAVIGATION,value:[!1]}];dropDownItem=[{key:a.CLIENT_RENDERING_MAXIMUM_SCALE,options:[{label:"400%",value:400},{label:"500%",value:500},{label:"600%",value:600},{label:"700%",value:700},{label:"800%",value:800}]}];constructor(e,t,o,s,c,u,C,x,N,D,X){this.configsService=e,this.subs=t,this.toastService=o,this.changeDetectorRef=s,this.translatePipe=c,this.formBuilder=u,this.dialogService=C,this.productService=x,this.modalService=N,this.i18nService=D,this.loggingService=X,this.selectedConfigTree=this.configsService.uiConfigTree}ngOnInit(){this.isLoading=!0,this.fetchConfigs(),this.subs.push(this.dialogService.dialogEvent$.pipe(L(e=>e.dialogType===mi.WARNING&&e.action==="confirm"),je(()=>this.configsService.publishCancelClick())).subscribe({next:()=>{ve.runAsync(()=>this.dialogService.closeCurrentActiveDialog()),this.formChanged=!1,K.clear(),this.fetchConfigs()}}),this.dialogService.dialogEvent$.pipe(L(e=>this.isUIModeDialog(e.dialogType)&&e.action==="confirm")).subscribe({next:e=>{let t=e.dialogType===mi.STANDARD_UI_MODE;this.getConfigPresets(t).forEach(({node:o,value:s})=>{this.setConfigValue(o,s),this.setChildrenValue(o,s)}),this.saveConfig(),this.dialogService.closeCurrentActiveDialog()}}),this.configsService.openWarningModal$.subscribe({next:e=>this.modalService.createCommonModal({type:Cn.WARN,content:e.content,confirmButton:!0,cancelButton:!0}).addOnDisposeListener(e.onDispose)}))}getConfigPresets(e){let t=e?this.configsService.standardPresetKeys:this.configsService.litePresetKeys;return[...t.activateKeys.map(o=>({node:this.findConfig(o),value:!0})),...t.deactivateKeys.map(o=>({node:this.findConfig(o),value:!1}))].filter(o=>T.isDefined(o.node))}get isStandardUIPreset(){let e=!0;return this.configsService.standardPresetKeys.activateKeys.forEach(t=>{K.get(t)||(e=!1)}),this.configsService.standardPresetKeys.deactivateKeys.forEach(t=>{K.get(t)&&(e=!1)}),e}get isLiteUIPreset(){let e=!0;return this.configsService.litePresetKeys.activateKeys.forEach(t=>{K.get(t)||(e=!1)}),this.configsService.litePresetKeys.deactivateKeys.forEach(t=>{K.get(t)&&(e=!1)}),e}isUIModeDialog(e){return e===mi.STANDARD_UI_MODE||e===mi.LITE_UI_MODE}onTabChange(e){switch(this.selectedTab=e,e){case Fi.UI_DISPLAY_SETTINGS:this.selectedConfigTree=this.configsService.uiConfigTree;break;case Fi.FEATURE_SETTINGS:this.selectedConfigTree=this.configsService.featureConfigTree;break;default:{this.selectedConfigTree=null;break}}}onClickUIMode(e){this.dialogService.toggleDialogVisibility(e?mi.STANDARD_UI_MODE:mi.LITE_UI_MODE,!0,{size:{width:336,height:this.i18nService.language==="ko"?263:295},title:this.translatePipe.transform(`${e?"STANDARD_UI":"LITE_UI"}`),description:this.translatePipe.transform(`${e?"STANDARD_UI_DESCRIPTION":"LITE_UI_DESCRIPTION"}`)})}onResetButtonClick(){this.configsService.publishResetClick()}toggleConfig(e){this.formChanged=!0,this.setConfigValue(e,e.data.value),this.setChildrenValue(e,e.data.value),this.changeParentToggleButton(e)}applyConstraint(e){Object.keys(this.configsService.constrainedConfigs).forEach(t=>{let o=this.configsService.constrainedConfigs[t];if(!(o?.config.key===e.data.key))return;let c=this.findConfig(t),u=e.data.value===o.config.triggerValue;if(!c?.data.isDummy)if(u)if(c?.data.isRadio)if(o.fixTo)c.parent?.children.forEach(C=>C.data.disable=!0),this.changeRadioConfig(c);else{c.data.disable=!0,c.data.formControl?.setValue(!1);let C=c.parent?.children.filter(x=>x.data.key!==c.data.key)[0]??null;this.changeRadioConfig(C)}else c.data.disable=!0,this.setConfigValue(c,o.fixTo);else c?.data.isRadio&&o.fixTo?c.parent?.children.forEach(C=>C.data.disable=!1):c.data.disable=!1})}changeRadioConfig(e){this.formChanged=!0;let o=e?.parent?.children.filter(s=>s.data.key!==e?.data.key);this.configsService.radioConfig=Object.keys(this.configsService.radioConfig).reduce((s,c)=>(c!==e?.parent?.data.key||(s[c].value=e.data.key),s),Oe({},this.configsService.radioConfig)),o?.forEach(s=>{K.set(s.data.key,!1),s.data.formControl?.setValue(!1)}),this.setConfigValue(e,!0)}changeColorConfig(e){this.formChanged=!0,this.setConfigValue(e,e.data.value)}changeDropDownConfig(e){e.data.options?.includes(e.data.value)&&(this.formChanged=!0,this.setConfigValue(e,e.data.value))}changeTextConfig(e){this.formChanged=!0;let t=this.productService.productType;if(typeof e.data.value=="string"&&!e.data.value.length){K.set(e.data.key,t);return}this.setConfigValue(e,e.data.value)}confirmRegex(e){let t=this.findConfig(a.TEXT_SEARCH_VIEW_REGEX),o;if(e.type==="create"&&t?.children.find(C=>C.data.name===e.values.title)){this.toastService.create({icon:"failed",content:this.translatePipe.transform("DUPLICATED_REGEX_NAME")});return}this.formChanged=!0;let s=this.getNewRegexItemConfig(t,e.values.title,e.values.content,!0);if(e.type==="edit"){let C=t?.children.find(x=>x.data.name===e.values.id);o=t?.children.findIndex(x=>C?.data.name===x.data.name),this.deleteConfig(C)}let c=typeof o=="number"?o:t.children.length-1;t?.children.splice(c,0,s);let u={name:s.data.name,regex:s.data.description??"",value:s.data.value};this.addEnvRegexItem(u,o)}cancel(){this.dialogService.toggleDialogVisibility(mi.WARNING,!0,{size:{width:336,height:280},title:this.translatePipe.transform("CANCEL"),description:this.translatePipe.transform("RESET_CONFIG")})}saveConfig(){this.isLoading=!0;let e=K.entries().map(t=>({key:t.key,value:JSON.stringify(t.value)}));this.subs.set("save",this.configsService.postViewConfig(e).subscribe({next:()=>{this.isLoading=!1,this.formChanged=!1,this.toastService.create({icon:"success",content:this.translatePipe.transform("SUCCESS_SAVE_CHANGES")}),this.fetchConfigs(),this.changeDetectorRef.markForCheck(),this.configsService.publishConfigSaved()},error:()=>{this.isLoading=!1,this.changeDetectorRef.markForCheck()}}))}deleteConfig(e){if(!e)return;this.formChanged=!0,this.deleteEnvRegexItem(e.data.name);let t=this.findConfig(a.TEXT_SEARCH_VIEW_REGEX);if(!T.isDefined(t)){this.loggingService.common("debug",le.NOT_EXIST,"regexConfig");return}t.children=t.children.filter(o=>o.data.name!==e.data.name)}changeParentToggleButton(e){if(!e.parent||e.parent.data.key===H.ROOT||e.data.isDropDown||e.data.isText||e.data.isColorPicker||e.data.isRadio||e.parent.data.isDummy||e.parent.data.isRadio)return;let t=e.parent.children.filter(o=>!e.parent?.data.excludeDeps?.includes(o.data.key)).some(o=>o.data.value);this.configsService.isMergedRuntimeEnvKey(e.parent.data.key)||this.configsService.isIgnoredKey(e.parent.data.key)?e.parent.data.formControl?.setValue(t):this.setConfigValue(e.parent,t),this.changeParentToggleButton(e.parent)}setChildrenValue(e,t){e?.children.forEach(o=>{!o.data.isRadio&&!o.data.isDropDown&&!o.data.isColorPicker&&!o.data.isText&&!o.data.disable&&(o.data.formControl?.setValue(t),this.setConfigValue(o,t)),this.setChildrenValue(o,t)})}assignValueDepth(e){if(!e)return;let t=(o,s)=>{s.map((c,u)=>{let C;if(c.isFirst=u===0,c.isLast=u===s.length-1,c.data.key===a.REGEX_EXPRESSION_JSON?C=K.get(c.data.key).find(x=>x.name===c.data.name)?.value:C=K.get(c.data.key),c.data.isDropDown){let x=this.dropDownItem.find(N=>N.key===c.data.key);c.data.options=x?.options}if(c.data.isDropDown){let x=this.dropDownItem.find(N=>N.key===c.data.key);c.data.options=x?.options}if(c.data.disable||(c.data.formControl?.setValue(C),c.data.value=C,this.applyConstraint(c)),c.data.key===a.TEXT_SEARCH_VIEW_REGEX){let N=K.get(a.REGEX_EXPRESSION_JSON).map(D=>this.getNewRegexItemConfig(c,D.name,D.regex,D.value));c.children=[...N,c.children.pop()]}return c.children.length>0&&(t(o+1,c.children),this.isExcludeRecursion(c,this.excludeRecursionListForLoad)||c.data.formControl?.setValue(c.children.filter(x=>!x.data.isRadio&&!x.data.isDropDown).some(x=>x.data.value))),c})};t(0,e.children)}fetchConfigs(){this.subs.set("fetchConfigs",this.configsService.getViewConfigs().subscribe({next:e=>{this.configsService.modifyConfigsByProductType(e,this.productService.isStreamDocs),this.fetchError=!1,e.forEach(t=>{let o=t.key;K.set(o,JSON.parse(t.value)),this.configsService.radioConfig=Object.keys(this.configsService.radioConfig).reduce((s,c)=>(this.configsService.radioConfig[c]?.items.some(u=>u.key===o)&&JSON.parse(t.value)&&(s[c].value=o),s),Oe({},this.configsService.radioConfig))}),Dc.apply(),this.assignValueDepth(this.configsService.uiConfigTree),this.assignValueDepth(this.configsService.featureConfigTree),this.isLoading=!1,this.changeDetectorRef.markForCheck()},error:()=>{this.fetchError=!0,this.isLoading=!1,this.toastService.create({icon:"failed",content:this.translatePipe.transform("FAILED_TO_FETCH_DATA")}),this.changeDetectorRef.markForCheck()}}))}findConfig(e){let t=o=>{for(let s of o){if(s.data.key===e)return s;let c=t(s.children);if(c)return c}return null};return t([this.configsService.uiConfigTree,this.configsService.featureConfigTree])}deleteEnvRegexItem(e){let t=K.get(a.REGEX_EXPRESSION_JSON);if(!T.isDefined(t)){this.loggingService.common("debug",le.NOT_EXIST,"regexItems");return}let o=t.find(c=>c.name===e),s=T.isDefined(o)?t.indexOf(o):-1;s>-1&&(t.splice(s,1),K.set(a.REGEX_EXPRESSION_JSON,t))}addEnvRegexItem(e,t){let o=K.get(a.REGEX_EXPRESSION_JSON);typeof t=="number"?o.splice(t,0,e):o=[...o,e],K.set(a.REGEX_EXPRESSION_JSON,o)}setConfigValue(e,t){if(!(!e||this.configsService.isIgnoredKey(e.data.key))){if(e.data.key===a.REGEX_EXPRESSION_JSON){let o=K.get(a.REGEX_EXPRESSION_JSON),s=o?.find(c=>c.name===e.data.name);T.isDefined(s)&&(this.loggingService.common("debug",le.NOT_EXIST,"changedItem"),s.value=t),K.set(a.REGEX_EXPRESSION_JSON,o);return}e.data.formControl?.setValue(t),K.set(e.data.key,t),this.applyConstraint(e)}}isExcludeRecursion(e,t){return e.data.key?t.some(o=>o.key===e.data.key&&o.value.some(s=>s===e.data.value)):!1}getNewRegexItemConfig(e,t,o,s){return{data:{key:a.REGEX_EXPRESSION_JSON,value:s,name:t,description:o,depth:2,editable:!0,formControl:this.formBuilder.control(s)},expanded:!1,parent:e,children:[]}}};v(n,"\u0275fac",function(t){return new(t||n)(m(Jt),m(P),m(Ic),m(Y),m(oe),m(Qi),m(er),m(Vn),m(Zt),m(Sr),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-configs"]],standalone:!1,features:[$([P])],decls:18,vars:18,consts:[[3,"selectedTabChange","tabItems","selectedTab"],[3,"fetchError","isLoading"],[3,"ngSwitch"],[4,"ngSwitchDefault"],[4,"ngSwitchCase"],[1,"container"],[4,"ngIf"],["class","ep-button reset","size","small","color","white",3,"click",4,"ngIf"],["size","small","color","white",1,"ep-button","cancel",3,"click"],["size","small","color","primary",1,"ep-button",3,"click"],[4,"eTree","eTreeFrom"],[3,"onRegexDialogConfirm","onRegexDelete","onToggle","onRadioModelChange","onColorModelChange","onDropDownModelChange","onTextModelChange","item","formControl"],["size","small","color","white",1,"ep-button","lite",3,"click"],["class","check-container",4,"ngIf"],["size","small","color","white",1,"ep-button","standard",3,"click"],[1,"check-container"],[1,"papycon","papycon-check-mark5"],["size","small","color","white",1,"ep-button","reset",3,"click"],[1,"papycon","papycon-redo"]],template:function(t,o){t&1&&(h(0,"h1"),M(1),E(2,"translate"),_(),h(3,"e-tab-panel",0),O("selectedTabChange",function(c){return o.onTabChange(c)}),h(4,"sd-card",1),Te(5,2),R(6,jp,2,1,"ng-container",3)(7,$p,1,0,"sd-context-menu-config",4)(8,Yp,1,0,"sd-annot-property-config",4),Ee(),h(9,"footer",5),R(10,Qp,9,8,"ng-container",6)(11,Zp,4,3,"button",7),h(12,"button",8),O("click",function(){return o.cancel()}),M(13),E(14,"translate"),_(),h(15,"button",9),O("click",function(){return o.saveConfig()}),M(16),E(17,"translate"),_()()()()),t&2&&(l(),k(S(2,12,"SETTINGS")),l(2),p("tabItems",o.tabItems)("selectedTab",o.selectedTab),l(),p("fetchError",o.fetchError)("isLoading",o.isLoading),l(),p("ngSwitch",o.selectedTab),l(2),p("ngSwitchCase",o.TabItem.CONTEXT_MENU_SETTINGS),l(),p("ngSwitchCase",o.TabItem.ANNOT_PROPERTY_SETTINGS),l(2),p("ngIf",o.selectedTab===o.TabItem.UI_DISPLAY_SETTINGS||o.selectedTab===o.TabItem.FEATURE_SETTINGS),l(),p("ngIf",o.selectedTab===o.TabItem.CONTEXT_MENU_SETTINGS),l(2),k(S(14,14,"CANCEL")),l(3),k(S(17,16,"SAVE_CHANGES")))},styles:["[_nghost-%COMP%]{min-width:766px}.horizontal-division-line[_ngcontent-%COMP%]{width:calc(100% + 60px);height:1px;background-color:#dadada;position:relative;top:1px;left:-30px}sd-card[_ngcontent-%COMP%]{flex-direction:column;border-radius:0 0 4px 4px;border:solid 1px #DADADA;border-top:none;background-color:#fff;padding:0;box-sizing:border-box}e-tab-panel[_ngcontent-%COMP%]{display:inline-block;min-width:706px;border:none;margin-top:0}e-tab-panel[_ngcontent-%COMP%]   sd-card[_ngcontent-%COMP%]{flex:auto}footer.container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;padding:40px 36px 24px 30px;margin-top:auto;border-top:solid 1px #DADADA}footer.container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}footer.container[_ngcontent-%COMP%]   button.standard[_ngcontent-%COMP%], footer.container[_ngcontent-%COMP%]   button.lite[_ngcontent-%COMP%]{min-width:112px;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:0 12px}footer.container[_ngcontent-%COMP%]   button.standard[_ngcontent-%COMP%]   .check-container[_ngcontent-%COMP%], footer.container[_ngcontent-%COMP%]   button.lite[_ngcontent-%COMP%]   .check-container[_ngcontent-%COMP%]{width:26px;height:26px;margin-right:2px}footer.container[_ngcontent-%COMP%]   button.standard[_ngcontent-%COMP%]   .check-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], footer.container[_ngcontent-%COMP%]   button.lite[_ngcontent-%COMP%]   .check-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin:auto;color:#363636;font-size:19px}footer.container[_ngcontent-%COMP%]   button.standard[_ngcontent-%COMP%]{margin-right:auto}footer.container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child.reset{margin-right:auto}footer.container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child.cancel{margin-left:auto}"],changeDetection:0}));let r=n;return r})();var hl=(()=>{let n=class n{dialogService;translatePipe;constructor(e,t){this.dialogService=e,this.translatePipe=t}canDeactivate(e){return e.formChanged?(this.dialogService.toggleDialogVisibility(mi.WARNING,!0,{size:{width:336,height:280},title:this.translatePipe.transform("CANCEL"),description:this.translatePipe.transform("CHANGES_NOT_SAVED")}),this.dialogService.dialogEvent$.pipe(L(t=>t.dialogType===mi.WARNING),Qa(),St(t=>(t.action==="confirm"&&this.dialogService.closeCurrentActiveDialog(),t.action==="confirm")))):!0}};v(n,"\u0275fac",function(t){return new(t||n)(Kt(er),Kt(oe))}),v(n,"\u0275prov",Ti({token:n,factory:n.\u0275fac}));let r=n;return r})();var _l=(()=>{let n=class n{differs;templateRef;viewContainerRef;_eTreeFrom;set eTreeFrom(e){this._eTreeFrom=e,this.resolveFlattened(),this.ngForDirective.ngForOf=this.flattened}flattened=[];ngForDirective;constructor(e,t,o){this.differs=e,this.templateRef=t,this.viewContainerRef=o,this.ngForDirective=new Ue(this.viewContainerRef,this.templateRef,this.differs)}ngDoCheck(){this.resolveFlattened(),this.ngForDirective.ngDoCheck()}resolveFlattened(){this.flattened.splice(0,this.flattened.length,...this.flatten(this._eTreeFrom).slice(1))}flatten(e){return e.children.length===0||!e.expanded?[e]:[e].concat(...e.children.map(t=>this.flatten(t)))}};v(n,"\u0275fac",function(t){return new(t||n)(m(oc),m(ec),m(Ei))}),v(n,"\u0275dir",Pn({type:n,selectors:[["","eTree",""]],inputs:{eTreeFrom:"eTreeFrom"},standalone:!1}));let r=n;return r})();var fl=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({imports:[mt]}));let r=n;return r})();var yi={vertical:{decrease:new Set(["Down","ArrowDown"]),increase:new Set(["Up","ArrowUp"])},horizontal:{decrease:new Set(["Left","ArrowLeft"]),increase:new Set(["Right","ArrowRight"])}};yi.all={decrease:new Set([...yi.vertical.decrease,...yi.horizontal.decrease]),increase:new Set([...yi.vertical.increase,...yi.horizontal.increase])};var xo=(()=>{let n=class n{static numberOf(e,t=1){let o=0;return typeof e=="string"&&!isNaN(o=Number(e))?o:typeof e=="number"?e:(console.warn("value is NaN",e),t)}set puInputStep(e){e?typeof e=="string"?this.stepKeys=yi[e]||yi.vertical:e.increase instanceof Set&&e.decrease instanceof Set?this.stepKeys=e:(console.warn("Unsupported type",e),this.stepKeys=yi.vertical):this.stepKeys=yi.vertical}set puStep(e){this.step=n.numberOf(e)}set puAlterStep(e){this.alternativeStep=n.numberOf(e)}puStepDisabled=!1;puStepApply=new Ke;step=1;alternativeStep=10;stepKeys=yi.vertical;emit(e){if(this.puStepDisabled)return;let t=this.stepKeys.decrease.has(e.key);if(!t&&!this.stepKeys.increase.has(e.key))return;e.preventDefault(),e.stopPropagation();let o=(e.shiftKey?this.alternativeStep:this.step)*(t?-1:1);this.puStepApply.emit(o)}};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275dir",Pn({type:n,selectors:[["","puInputStep",""]],hostBindings:function(t,o){t&1&&O("keydown",function(c){return o.emit(c)})},inputs:{puInputStep:"puInputStep",puStep:"puStep",puAlterStep:"puAlterStep",puStepDisabled:"puStepDisabled"},outputs:{puStepApply:"puStepApply"},standalone:!1}));let r=n;return r})();var Ur=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({imports:[mt]}));let r=n;return r})();var Jp=["itemRef"];function ed(r,n){r&1&&I(0,"i",4)}function td(r,n){if(r&1&&(h(0,"div",2,0)(2,"span"),M(3),_(),R(4,ed,1,0,"i",3),_()),r&2){let i=n.$implicit,e=n.last;l(3),k(i),l(),p("ngIf",!e)}}var Cl=(()=>{let n=class n{elementRef;renderer;store$;changeDetectorRef;subscriptionService;list;itemRef;rightSideViewSize;constructor(e,t,o,s,c){this.elementRef=e,this.renderer=t,this.store$=o,this.changeDetectorRef=s,this.subscriptionService=c}ngOnInit(){this.subscriptionService.push(this.store$.pipe(_e("rightSideViewSize")).subscribe({next:e=>{this.rightSideViewSize=e,this.itemRef?.length>0&&(this.itemRef.forEach(t=>{this.renderer.setStyle(t.nativeElement,"width","auto")}),this.setEllipsis()),this.changeDetectorRef.markForCheck()}}))}ngAfterViewInit(){this.setEllipsis()}setEllipsis(){let e=Ve.nativeWindow.getComputedStyle(this.elementRef.nativeElement).padding.split(" ").filter((N,D)=>D%2===1).map(N=>parseInt(N)).reduce((N,D)=>N+D,0),t=this.rightSideViewSize-e,o=this.itemRef.reduce((N,D)=>N+D.nativeElement.offsetWidth,0);if(o<t)return;let s=this.itemRef.toArray().slice(1,this.itemRef.length-1),c=this.rightSideViewSize/(5*s.length),u=o-t,C=0;s.forEach(N=>{C+=Math.max(N.nativeElement.offsetWidth-u,N.nativeElement.offsetWidth-c),this.renderer.setStyle(N.nativeElement,"width",`${Math.max(N.nativeElement.offsetWidth-u,c)}px`)});let x=this.itemRef.last.nativeElement;this.renderer.setStyle(x,"width",`${x.offsetWidth-(u-C)}px`)}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Qt),m(xe),m(Y),m(P))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-breadcrumb"]],viewQuery:function(t,o){if(t&1&&se(Jp,5),t&2){let s;ae(s=ce())&&(o.itemRef=s)}},inputs:{list:"list"},standalone:!1,features:[$([P])],decls:1,vars:1,consts:[["itemRef",""],["class","breadcrumb-item",4,"ngFor","ngForOf"],[1,"breadcrumb-item"],["class","papycon papycon-next-symbol2",4,"ngIf"],[1,"papycon","papycon-next-symbol2"]],template:function(t,o){t&1&&R(0,td,5,2,"div",1),t&2&&p("ngForOf",o.list)},dependencies:[Ue,be],styles:["[_nghost-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif;padding:12px 12px 8px 16px;color:var(--mono-70);display:flex}.breadcrumb-item[_ngcontent-%COMP%]{display:flex;align-items:center}.breadcrumb-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.breadcrumb-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-family:NotoSans-Medium,sans-serif;color:var(--mono-99)}.breadcrumb-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:9px;padding:0 8px;color:#415073}"],changeDetection:0}));let r=n;return r})();var Tl=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({imports:[mt]}));let r=n;return r})();function nd(r,n){if(r&1){let i=w();h(0,"div",14),O("click",function(){let t=f(i).index,o=d();return g(o.onItemSelect(t))}),M(1),_()}if(r&2){let i=n.$implicit,e=n.index,t=d();p("ngClass",t.getOptionClass(e)),l(),k(i[1])}}var jn=class jn{ngControl;changeDetectorRef;subscriptionService;store$;toastService;fb;translatePipe;selectedIndexChange=new Ke;newOptionForm;disabled=!1;selectedIndex=-1;list=[];isSmallWidthScreen=Ve.isSmallWidth();get isDisable(){return this.disabled||this.list?.length===0||!this.list?.[this.selectedIndex]}screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}onChange;constructor(n,i,e,t,o,s,c){this.ngControl=n,this.changeDetectorRef=i,this.subscriptionService=e,this.store$=t,this.toastService=o,this.fb=s,this.translatePipe=c,this.ngControl&&(this.ngControl.valueAccessor=this),this.newOptionForm=this.fb.group({name:this.fb.nonNullable.control(""),value:this.fb.nonNullable.control("")},{validators:[u=>{let C=u.value;return C.name.length>0&&C.value.length>0?null:{length:!0}}]})}ngOnInit(){this.subscriptionService.push(this.store$.pipe(Xe("screenTheme")).subscribe({next:n=>{this.screenTheme=n,this.changeDetectorRef.markForCheck()}}))}writeValue(n){this.list=n.map(i=>typeof i=="string"?[i,i]:i),this.changeDetectorRef.markForCheck()}registerOnChange(n){this.onChange=n}registerOnTouched(){}setDisabledState(n){this.disabled=n,this.newOptionForm[n?"disable":"enable"](),this.changeDetectorRef.markForCheck()}getOptionClass(n){return{disabled:this.disabled,selected:n===this.selectedIndex}}onItemSelect(n){let[i,e]=this.list[n];this.list.length!==0&&(this.selectedIndex===n?(this.selectedIndex=-1,this.newOptionForm.reset()):(this.selectedIndex=n,this.newOptionForm.reset({name:e,value:i})),this.selectedIndexChange.emit(this.selectedIndex))}onDeleteButtonClick(){let n=[];try{n=this.deleteItem(this.list)}catch(i){if(i instanceof Error){this.toastService.create({toastStyle:Ot.FAILURE,content:this.translatePipe.transform(i.message)});return}}this.writeValue(n),this.onChange(n)}onAddButtonClick(){let n=this.newOptionForm.getRawValue(),i=[];try{i=this.addItem(this.list,n)}catch(e){if(e instanceof Error){this.toastService.create({toastStyle:Ot.FAILURE,content:this.translatePipe.transform(e.message)});return}}this.writeValue(i),this.onChange(i),this.newOptionForm.reset()}onItemMove(n){this.list.length!==0&&(n&&this.list.length>this.selectedIndex+1&&(this.list=this.moveItemFromArray(this.list,this.selectedIndex,this.selectedIndex+1),this.selectedIndex=this.selectedIndex+1),!n&&this.selectedIndex-1>=0&&(this.list=this.moveItemFromArray(this.list,this.selectedIndex,this.selectedIndex-1),this.selectedIndex=this.selectedIndex-1),this.selectedIndexChange.emit(this.selectedIndex),this.onChange(this.list))}deleteItem(n){if(n.length===0)return n;if(!n.some((i,e)=>this.selectedIndex===e))throw new Error("NO_SELECTED_ITEM");return n.filter((i,e)=>this.selectedIndex!==e)}addItem(n,i){if(this.list.some(t=>i.value===t[0]))throw new Error("COMBO_LIST_VALUE_DUPLICATION_ERROR");if(this.list.some(t=>i.name===t[1]))throw new Error("COMBO_LIST_NAME_DUPLICATION_ERROR");let e=[i.value,i.name];return[...n,e]}moveItemFromArray(n,i,e){let t=[...n],o=t[i];return t[i]=t[e],t[e]=o,t}};v(jn,"\u0275fac",function(i){return new(i||jn)(m(tr,10),m(Y),m(P),m(xe),m(vi),m(Qi),m(oe))}),v(jn,"\u0275cmp",j({type:jn,selectors:[["sd-annot-property-option"]],outputs:{selectedIndexChange:"selectedIndexChange"},standalone:!1,features:[$([P])],decls:31,vars:53,consts:[[3,"formGroup"],[1,"property-title"],["formControlName","name",3,"size","ariaLabel"],["formControlName","value",3,"size","ariaLabel"],["color","primary",1,"ep-button",3,"click","disabled"],["tabindex","0",1,"property-title"],[1,"list-container"],[1,"list"],["tabindex","0",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"buttons"],["size","tiny","color","grey",1,"ep-button",3,"click","disabled"],[1,"papycon","papycon-up-symbol"],[1,"papycon","papycon-down-symbol"],[1,"papycon","papycon-trash-can"],["tabindex","0",3,"click","ngClass"]],template:function(i,e){i&1&&(Te(0,0),h(1,"span",1),M(2),E(3,"translate"),_(),I(4,"pu-input",2),E(5,"translate"),h(6,"span",1),M(7),E(8,"translate"),_(),I(9,"pu-input",3),E(10,"translate"),h(11,"button",4),E(12,"translate"),O("click",function(){return e.onAddButtonClick()}),M(13),E(14,"translate"),_(),Ee(),h(15,"span",5),M(16),E(17,"translate"),_(),h(18,"div",6)(19,"div",7),R(20,nd,2,2,"div",8),_(),h(21,"nav",9)(22,"button",10),E(23,"translate"),O("click",function(){return e.onItemMove(!1)}),I(24,"i",11),_(),h(25,"button",10),E(26,"translate"),O("click",function(){return e.onItemMove(!0)}),I(27,"i",12),_(),h(28,"button",10),E(29,"translate"),O("click",function(){return e.onDeleteButtonClick()}),I(30,"i",13),_()()()),i&2&&(p("formGroup",e.newOptionForm),l(),W("disabled",e.disabled),l(),k(S(3,33,"ITEM")),l(2),p("size",e.isSmallWidthScreen?"small":"tiny")("ariaLabel",S(5,35,"ITEM")),l(2),W("disabled",e.disabled),l(),k(S(8,37,"EXPORT_VALUE")),l(2),p("size",e.isSmallWidthScreen?"small":"tiny")("ariaLabel",S(10,39,"EXPORT_VALUE")),l(2),W("dark",e.isDarkMode),p("disabled",e.disabled||e.newOptionForm.invalid),G("size",e.isSmallWidthScreen?"small":"tiny")("aria-label",S(12,41,"ADD")),l(2),k(S(14,43,"ADD")),l(2),W("disabled",e.disabled),l(),k(S(17,45,"ITEM_LIST")),l(4),p("ngForOf",e.list),l(2),W("dark",e.isDarkMode),p("disabled",e.isDisable||e.selectedIndex===0),G("aria-label",S(23,47,"MOVE_UP")),l(3),W("dark",e.isDarkMode),p("disabled",e.isDisable||e.selectedIndex===e.list.length-1),G("aria-label",S(26,49,"MOVE_DOWN")),l(3),W("dark",e.isDarkMode),p("disabled",e.isDisable),G("aria-label",S(29,51,"REMOVE")))},styles:["[_nghost-%COMP%]{display:flex;width:100%;height:100%;flex-direction:column}.property-title[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);margin-top:4px;margin-bottom:2px}.property-title.disabled[_ngcontent-%COMP%]{opacity:.5;-webkit-user-select:none;user-select:none}pu-input[_ngcontent-%COMP%]{margin-bottom:8px}.list-container[_ngcontent-%COMP%]{width:100%;height:100%;overflow:hidden}.list[_ngcontent-%COMP%]{display:block;overflow:auto;height:170px;width:100%;box-sizing:border-box;padding:4px 0;border-radius:2px;border:1px solid var(--mono-30);outline:none;-webkit-appearance:none;appearance:none}.list[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);display:flex;width:100%;height:30px;align-items:center;box-sizing:border-box;padding:0 11px;-webkit-appearance:none;appearance:none;outline:none}.list[_ngcontent-%COMP%]   div.selected[_ngcontent-%COMP%]{color:var(--mono-99);background-color:var(--mono-30)}.list[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:not(.disabled):hover{background-color:var(--mono-30)}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;margin-top:8px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.buttons[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-99);background-color:var(--mono-50)}.buttons[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:disabled{color:var(--font-disable);background-color:var(--mono-30)}.buttons[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{background-color:#9f9f9f}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}.dark[_ngcontent-%COMP%]{color:var(--mono-00)}.dark[_ngcontent-%COMP%]:disabled{background-color:#946516}"],changeDetection:0}));var on=jn;ee([Ae(J.annotPropertyOption.changeOption)],on.prototype,"onDeleteButtonClick",null);ee([Ae(J.annotPropertyOption.changeOption)],on.prototype,"onAddButtonClick",null);ee([Ae(J.annotPropertyOption.changeOption)],on.prototype,"onItemMove",null);var Hs=Gp(Wp());var Gr=(()=>{let n=class n{modalService;portalRef;subscriptionService;elementRef;store$;changeDetectorRef;templateName;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}constructor(e,t,o,s,c,u){this.modalService=e,this.portalRef=t,this.subscriptionService=o,this.elementRef=s,this.store$=c,this.changeDetectorRef=u}ngOnInit(){this.subscriptionService.push(this.store$.pipe(Xe("screenTheme")).subscribe({next:e=>{this.screenTheme=e,this.changeDetectorRef.markForCheck()}}),Ge(window,"keydown",{capture:!0}).pipe(L(e=>e.key==="Escape"),L(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.onButtonClick(!1)})),this.elementRef.nativeElement.parentElement.style.minWidth="400px"}onButtonClick(e){this.portalRef.dispose(e?this.templateName:void 0)}};v(n,"\u0275fac",function(t){return new(t||n)(m(Qo),m(Si),m(P),m(de),m(xe),m(Y))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-add-template-modal"]],standalone:!1,features:[$([P])],decls:18,vars:27,consts:[[1,"title"],[3,"ngModelChange","ariaLabel","ngModel"],["size","small","color","white",1,"ep-button","cancel",3,"click"],["color","primary","size","small",1,"ep-button","confirm",3,"click","disabled"]],template:function(t,o){t&1&&(h(0,"h3"),M(1),E(2,"translate"),_(),h(3,"main")(4,"span",0),M(5),E(6,"translate"),_(),h(7,"pu-input",1),E(8,"translate"),he("ngModelChange",function(c){return ue(o.templateName,c)||(o.templateName=c),c}),_()(),h(9,"footer")(10,"button",2),E(11,"translate"),O("click",function(){return o.onButtonClick(!1)}),M(12),E(13,"translate"),_(),h(14,"button",3),E(15,"translate"),O("click",function(){return o.onButtonClick(!0)}),M(16),E(17,"translate"),_()()),t&2&&(l(),k(S(2,13,"ADD_TEMPLATE")),l(4),k(S(6,15,"TITLE")),l(2),p("ariaLabel",S(8,17,"TITLE")),me("ngModel",o.templateName),l(3),W("dark",o.isDarkMode),G("aria-label",S(11,19,"CANCEL")),l(2),k(S(13,21,"CANCEL")),l(2),W("dark",o.isDarkMode),p("disabled",!o.templateName),G("aria-label",S(15,23,"OK")),l(2),k(S(17,25,"OK")))},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:24px}main[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70)}main[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{font-size:14px;line-height:24px;height:40px}footer[_ngcontent-%COMP%]{text-align:right;margin-top:20px}footer[_ngcontent-%COMP%]   button.cancel.dark[_ngcontent-%COMP%]{color:var(--mono-90);border-color:var(--mono-30);background-color:var(--mono-30)}footer[_ngcontent-%COMP%]   button.cancel.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7;border-color:#474747;background-color:#474747}footer[_ngcontent-%COMP%]   button.confirm.dark[_ngcontent-%COMP%]{color:var(--mono-00)}footer[_ngcontent-%COMP%]   button.confirm.dark[_ngcontent-%COMP%]:disabled{background-color:#946516}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));let r=n;return r})();var rd=["scriptTemplateInput"];function sd(r,n){if(r&1){let i=w();h(0,"p",8),O("click",function(t){f(i);let o=d().$implicit,s=d();return g(s.startEditScriptTemplate(t,o))}),M(1),_()}if(r&2){let i=d().$implicit;l(),k(i.name)}}function ad(r,n){if(r&1){let i=w();h(0,"pu-input",9,0),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.editInputValue,t)||(o.editInputValue=t),g(t)}),O("keydown.enter",function(){f(i);let t=d().$implicit,o=d();return o.modifyScriptTemplate(t),g(o.editId=null)}),_()}if(r&2){let i=d(2);p("useClearButton",!0)("autofocus",!0)("ariaLabel",S(2,4,"TEMPLATE_TITLE")),me("ngModel",i.editInputValue)}}function cd(r,n){if(r&1){let i=w();h(0,"div",10),O("click",function(){f(i);let t=d().$implicit,o=d();return g(o.deleteScriptTemplate(t))}),I(1,"i",11),_()}}function ld(r,n){if(r&1){let i=w();h(0,"li",4),O("click",function(){let t=f(i).$implicit,o=d();return g(o.selectScriptTemplate(t))})("mouseenter",function(){let t=f(i).$implicit,o=d();return g(o.hoverId=t.id)})("mouseleave",function(){f(i);let t=d();return g(t.hoverId=null)}),R(1,sd,2,1,"p",5)(2,ad,3,6,"pu-input",6)(3,cd,2,0,"div",7),_()}if(r&2){let i=n.$implicit,e=d();W("selected",i.id===(e.selectedTemplate==null?null:e.selectedTemplate.id))("dark",e.isDarkMode),l(),p("ngIf",e.editId!==i.id),l(),p("ngIf",e.editId===i.id),l(),p("ngIf",i.id===e.hoverId)}}var Wr=(()=>{let n=class n{modalService;portalRef;subscriptionService;elementRef;translatePipe;pdfDataService;toastService;changeDetectorRef;store$;loggingService;templates=[];editId=null;hoverId=null;editInputValue="";selectedTemplate;scriptTemplateInput;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}constructor(e,t,o,s,c,u,C,x,N,D){this.modalService=e,this.portalRef=t,this.subscriptionService=o,this.elementRef=s,this.translatePipe=c,this.pdfDataService=u,this.toastService=C,this.changeDetectorRef=x,this.store$=N,this.loggingService=D}fetchScriptTemplate(){return this.pdfDataService.getScriptTemplates().pipe(je(e=>{this.templates=e}))}ngOnInit(){this.subscriptionService.push(this.store$.pipe(Xe("screenTheme")).subscribe({next:e=>{this.screenTheme=e,this.changeDetectorRef.markForCheck()}}),this.fetchScriptTemplate().subscribe({next:()=>this.changeDetectorRef.markForCheck(),error:e=>{this.toastService.create({toastStyle:Ot.FAILURE,header:this.translatePipe.transform("FAILED_TO_LOAD_TEMPLATE"),content:e}),this.onButtonClick(!1)}}),Ge(window,"keydown",{capture:!0}).pipe(L(e=>e.key==="Escape"),L(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.onButtonClick(!1)})),this.elementRef.nativeElement.parentElement.style.minWidth="460px"}onButtonClick(e){let t=this.selectedTemplate;this.portalRef.dispose(e&&T.isDefined(t)?t.body:void 0)}selectScriptTemplate(e){this.selectedTemplate?.id!==e.id&&(this.selectedTemplate!==void 0&&this.editId===this.selectedTemplate?.id&&this.modifyScriptTemplate(this.selectedTemplate),this.selectedTemplate=e,this.editId=null)}modifyScriptTemplate(e){this.subscriptionService.push(this.pdfDataService.putScriptTemplates(e.id,{name:this.editInputValue,description:e.description,body:e.body}).pipe(Gt(()=>this.fetchScriptTemplate())).subscribe({next:()=>this.changeDetectorRef.markForCheck(),error:()=>{this.toastService.create({toastStyle:Ot.FAILURE,content:this.translatePipe.transform("ERROR_PAGES_500")})}}))}startEditScriptTemplate(e,t){this.selectedTemplate?.id===t.id&&(e.stopPropagation(),this.editId=t.id,this.editInputValue=t.name,Di(0).subscribe(()=>{if(!T.isDefined(this.scriptTemplateInput)){this.loggingService.common("error",le.NOT_EXIST,"ScriptTemplateInput");return}this.scriptTemplateInput.inputElementRef.nativeElement.select()}))}deleteScriptTemplate(e){this.subscriptionService.push(this.pdfDataService.deleteScriptTemplates(e.id).pipe(Gt(()=>this.fetchScriptTemplate())).subscribe({next:()=>{this.toastService.create({toastStyle:Ot.SUCCESS,content:this.translatePipe.transform("SUCCESS_DELETE_TEMPLATE")}),this.changeDetectorRef.markForCheck()},error:()=>{this.toastService.create({toastStyle:Ot.FAILURE,content:this.translatePipe.transform("ERROR_PAGES_500")})}}))}};v(n,"\u0275fac",function(t){return new(t||n)(m(Qo),m(Si),m(P),m(de),m(oe),m(Pr),m(vi),m(Y),m(xe),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-view-template-modal"]],viewQuery:function(t,o){if(t&1&&se(rd,5),t&2){let s;ae(s=ce())&&(o.scriptTemplateInput=s.first)}},standalone:!1,features:[$([P])],decls:12,vars:13,consts:[["scriptTemplateInput",""],[1,"papycon","papycon-chevron3-left",3,"click"],[3,"selected","dark","click","mouseenter","mouseleave",4,"ngFor","ngForOf"],["color","primary","size","small",1,"ep-button",3,"click","disabled"],[3,"click","mouseenter","mouseleave"],[3,"click",4,"ngIf"],[3,"useClearButton","autofocus","ariaLabel","ngModel","ngModelChange","keydown.enter",4,"ngIf"],["class","delete-button",3,"click",4,"ngIf"],[3,"click"],[3,"ngModelChange","keydown.enter","useClearButton","autofocus","ariaLabel","ngModel"],[1,"delete-button",3,"click"],[1,"papycon","papycon-minus2"]],template:function(t,o){t&1&&(h(0,"h3")(1,"i",1),O("click",function(){return o.onButtonClick(!1)}),_(),M(2),E(3,"translate"),_(),h(4,"main")(5,"ul"),R(6,ld,4,7,"li",2),_()(),h(7,"footer")(8,"button",3),E(9,"translate"),O("click",function(){return o.onButtonClick(!0)}),M(10),E(11,"translate"),_()()),t&2&&(l(2),ke(" ",S(3,7,"VIEW_TEMPLATE"),`
`),l(4),p("ngForOf",o.templates),l(2),W("dark",o.isDarkMode),p("disabled",!o.selectedTemplate),G("aria-label",S(9,9,"ACTIVE")),l(2),k(S(11,11,"ACTIVE")))},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0 20px}h3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;line-height:30px;cursor:pointer}main[_ngcontent-%COMP%]{display:flex;flex-direction:column}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{width:412px;height:483px;box-sizing:border-box;margin:0;padding:0;border-radius:4px;border:solid 1.2px var(--mono-30);background-color:#dadada1a;overflow:auto}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14px;line-height:24px;height:40px;position:relative;box-sizing:border-box;display:flex;align-items:center;cursor:pointer}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(2n){background-color:var(--mono-10)}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{border:solid 1.2px var(--primary-50)}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]:not(.dark){background-color:rgba(var(--primary-50-rgb),.08)}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{max-width:348px;padding-left:8px;margin:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{width:348px;margin:0 0 0 8px}main[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:22px;height:22px;font-size:16px;position:absolute;top:8px;right:13px;cursor:pointer}footer[_ngcontent-%COMP%]{text-align:right;margin-top:20px}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}footer[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-00)}footer[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:disabled{background-color:#946516}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));let r=n;return r})();var pd=["customScriptTextareaRef"],dd=()=>({standalone:!0});function ud(r,n){if(r&1&&I(0,"i"),r&2){let i=d(2);Nn(i.customScriptValidation.icon)}}function md(r,n){if(r&1&&(h(0,"section",22)(1,"span",23),M(2),_()()),r&2){let i=d(2);l(2),k(i.customScriptValidation.rightSideMsg)}}function hd(r,n){if(r&1&&(Te(0),h(1,"section",17),R(2,ud,1,2,"i",18),h(3,"span",19),M(4),_()(),I(5,"div",20),R(6,md,3,1,"section",21),Ee()),r&2){let i=d();l(2),p("ngIf",i.customScriptValidation.icon),l(),p("title",i.customScriptValidation.msg),l(),k(i.customScriptValidation.msg),l(2),p("ngIf",i.customScriptValidation.rightSideMsg)}}function _d(r,n){r&1&&I(0,"div",24)}var zr=function(r){return r[r.ADD=0]="ADD",r[r.VIEW=1]="VIEW",r}(zr||{}),$n=class $n{tempCustomScript;modalService;toastService;portalRef;subscriptionService;elementRef;changeDetectorRef;translatePipe;annotSelectedService;acroFormService;scriptService;pdfDataService;store$;customScriptTextareaRef;customScriptValidation=null;isSmallWidthScreen=Ve.isSmallWidth();customScriptRowNumber=T.EMPTY_STRING;customScript=T.EMPTY_STRING;get TemplateModalType(){return zr}scriptValidateSubject=new pt;scriptCursorColumn=1;scriptCursorRow=1;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}constructor(n,i,e,t,o,s,c,u,C,x,N,D,X){this.tempCustomScript=n,this.modalService=i,this.toastService=e,this.portalRef=t,this.subscriptionService=o,this.elementRef=s,this.changeDetectorRef=c,this.translatePipe=u,this.annotSelectedService=C,this.acroFormService=x,this.scriptService=N,this.pdfDataService=D,this.store$=X}ngOnInit(){this.customScript=this.tempCustomScript,this.subscriptionService.push(this.store$.pipe(Xe("screenTheme")).subscribe({next:n=>{this.screenTheme=n,this.changeDetectorRef.markForCheck()}}),Ve.windowResize$.subscribe(()=>{this.isSmallWidthScreen=Ve.isSmallWidth(),this.changeDetectorRef.markForCheck()}),this.scriptValidateSubject.pipe(ui(500)).subscribe(()=>{if(this.annotSelectedService.length===0)return;let n=this.annotSelectedService.selectedComponents[0].data;if(A.isWidget(n)){let i=this.acroFormService.getAcroField(n.attributes.Parent),e=this.scriptService.validate(i,this.customScript);this.customScriptValidation={class:e?"error":null,icon:e?"papycon papycon-exclamation-mark":null,msg:e?e.message:this.translatePipe.transform("SCRIPT_HAS_NO_ERROR"),rightSideMsg:e?.lineNumber?`Ln ${e.lineNumber.toString(10)}`:null},this.changeDetectorRef.markForCheck()}}),Ge(window,"keydown",{capture:!0}).pipe(L(n=>n.key==="Escape"),L(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.onButtonClick(!1)})),this.elementRef.nativeElement.parentElement.style.minWidth="460px"}ngAfterViewInit(){this.customScriptValidation=null,this.scriptValidateSubject.next()}onButtonClick(n){this.portalRef.dispose(n?this.customScript:void 0)}onScriptKeyup(n){this.determineCursorPosition(n.target)}onScriptInput(n){this.determineCursorPosition(n.target),this.customScriptValidation=null,this.scriptValidateSubject.next()}onScriptMouseEvent(n){this.determineCursorPosition(n.target)}getCursorPositionString(){let n=this.translatePipe.transform("CURSOR_ROW"),i=this.translatePipe.transform("CURSOR_COL");return`${n} ${this.scriptCursorRow}, ${i} ${this.scriptCursorColumn}`}moveCustomScriptLine(){let n=Number(this.customScriptRowNumber);if(isNaN(n)||!this.customScriptTextareaRef)return;let i=this.customScriptTextareaRef.nativeElement,e=i.value,t=-1;for(;--n>0;){let o=e.indexOf(`
`,t+1);if(o===-1)break;t=o}this.customScriptRowNumber="",i.selectionStart=t+1,i.selectionEnd=t+1,this.determineCursorPosition(i),i.focus()}openTemplateHelper(n){switch(n){case zr.VIEW:this.modalService.createModal(Wr,T.EMPTY_STRING).addOnDisposeListener(i=>{T.isDefined(i)&&(this.customScript=i,this.scriptValidateSubject.next())});break;case zr.ADD:this.modalService.createModal(Gr,T.EMPTY_STRING).addOnDisposeListener(i=>{T.isDefined(i)&&this.addScriptTemplate(i)});break}}addScriptTemplate(n){this.subscriptionService.push(this.pdfDataService.postScriptTemplate(n,"",this.customScript).subscribe({next:()=>{this.toastService.create({toastStyle:Ot.SUCCESS,content:this.translatePipe.transform("SUCCESS_ADD_TEMPLATE")})},error:()=>{this.toastService.create({toastStyle:Ot.FAILURE,content:this.translatePipe.transform("ERROR_PAGES_500")})}}))}determineCursorPosition(n){let i=n.value,e=n.selectionStart,t=1,o=-1,s=i.indexOf(`
`);for(;s!==-1&&s<e;)t++,o=s,s=i.indexOf(`
`,s+1);this.scriptCursorColumn=e-o,this.scriptCursorRow=t}};v($n,"\u0275fac",function(i){return new(i||$n)(m(Dn),m(Zt),m(vi),m(Si),m(P),m(de),m(Y),m(oe),m(kt),m(Lt),m(Oi),m(Pr),m(xe))}),v($n,"\u0275cmp",j({type:$n,selectors:[["sd-template-modal"]],viewQuery:function(i,e){if(i&1&&se(pd,5),i&2){let t;ae(t=ce())&&(e.customScriptTextareaRef=t.first)}},standalone:!1,features:[$([P])],decls:43,vars:63,consts:[["customScriptTextareaRef",""],[3,"ngModelChange","input","keyup","mousedown","mouseup","ngModel"],[1,"row-info"],[1,"flex","align-center"],[3,"submit"],[3,"ngModelChange","ngModelOptions","size","ariaLabel","ngModel"],["color","white",1,"ep-button",3,"click"],[1,"script-validation-message",3,"ngClass"],[4,"ngIf"],["class","spin-loader",4,"ngIf"],[1,"save-script-container"],["size","small","color","white",1,"ep-button",3,"click","disabled"],[1,"papycon","papycon-plus3"],["size","small","color","white",1,"ep-button",3,"click"],[1,"papycon","papycon-list2"],["size","small","color","white",1,"ep-button","cancel",3,"click"],["color","primary","size","small",1,"ep-button","confirm",3,"click","disabled"],[1,"left"],[3,"class",4,"ngIf"],[1,"message",3,"title"],[1,"background"],["class","right",4,"ngIf"],[1,"right"],[1,"rightside-message"],[1,"spin-loader"]],template:function(i,e){if(i&1){let t=w();h(0,"h3"),M(1),E(2,"translate"),_(),h(3,"main")(4,"textarea",1,0),he("ngModelChange",function(s){return f(t),ue(e.customScript,s)||(e.customScript=s),g(s)}),O("input",function(s){return f(t),g(e.onScriptInput(s))})("keyup",function(s){return f(t),g(e.onScriptKeyup(s))})("mousedown",function(s){return f(t),g(e.onScriptMouseEvent(s))})("mouseup",function(s){return f(t),g(e.onScriptMouseEvent(s))}),_(),h(6,"nav",2)(7,"span"),M(8),_(),h(9,"div",3)(10,"span"),M(11),E(12,"translate"),_(),h(13,"form",4),O("submit",function(){return f(t),g(e.moveCustomScriptLine())}),h(14,"pu-input",5),E(15,"translate"),he("ngModelChange",function(s){return f(t),ue(e.customScriptRowNumber,s)||(e.customScriptRowNumber=s),g(s)}),_()(),h(16,"button",6),E(17,"translate"),O("click",function(){return f(t),g(e.moveCustomScriptLine())}),M(18),E(19,"translate"),_()()(),h(20,"div",7),R(21,hd,7,4,"ng-container",8)(22,_d,1,0,"div",9),_(),h(23,"section",10)(24,"button",11),E(25,"translate"),O("click",function(){return f(t),g(e.openTemplateHelper(e.TemplateModalType.ADD))}),I(26,"i",12),M(27),E(28,"translate"),_(),h(29,"button",13),E(30,"translate"),O("click",function(){return f(t),g(e.openTemplateHelper(e.TemplateModalType.VIEW))}),I(31,"i",14),M(32),E(33,"translate"),_()()(),h(34,"footer")(35,"button",15),E(36,"translate"),O("click",function(){return f(t),g(e.onButtonClick(!1))}),M(37),E(38,"translate"),_(),h(39,"button",16),E(40,"translate"),O("click",function(){return f(t),g(e.onButtonClick(!0))}),M(41),E(42,"translate"),_()()}i&2&&(l(),k(S(2,36,"CUSTOM_CALCULATION_SCRIPT")),l(3),W("dark",e.isDarkMode),me("ngModel",e.customScript),l(4),k(e.getCursorPositionString()),l(3),ke("",S(12,38,"COLUMN_NUMBER")," :"),l(3),p("ngModelOptions",pe(62,dd))("size",e.isSmallWidthScreen?"small":"tiny")("ariaLabel",S(15,40,"COLUMN_NUMBER")),me("ngModel",e.customScriptRowNumber),l(2),W("dark",e.isDarkMode),G("size",e.isSmallWidthScreen?"small":"tiny")("aria-label",S(17,42,"MOVE")),l(2),k(S(19,44,"MOVE")),l(2),p("ngClass",e.customScriptValidation==null?null:e.customScriptValidation.class),l(),p("ngIf",e.customScriptValidation),l(),p("ngIf",!e.customScriptValidation),l(2),W("dark",e.isDarkMode),p("disabled",!e.customScript),G("aria-label",S(25,46,"ADD_TEMPLATE")),l(3),ke(" ",S(28,48,"ADD_TEMPLATE")," "),l(2),W("dark",e.isDarkMode),G("aria-label",S(30,50,"VIEW_TEMPLATE")),l(3),ke(" ",S(33,52,"VIEW_TEMPLATE")," "),l(3),W("dark",e.isDarkMode),G("aria-label",S(36,54,"CANCEL")),l(2),k(S(38,56,"CANCEL")),l(2),W("dark",e.isDarkMode),p("disabled",!e.customScriptValidation||e.customScriptValidation.class==="error"),G("aria-label",S(40,58,"OK")),l(2),k(S(42,60,"OK")))},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0 12px}main[_ngcontent-%COMP%]{display:flex;flex-direction:column}main[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-family:Consolas;width:100%;height:260px;margin-bottom:12px;padding:8px 4px;box-sizing:border-box;border-radius:2px;border:1px solid var(--mono-30);color:var(--mono-90);background-color:var(--input-background);resize:none;outline:none;caret-color:var(--primary-50)}main[_ngcontent-%COMP%]   textarea.dark[_ngcontent-%COMP%]{border:1px solid var(--mono-00)}main[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{border:1px solid var(--primary-50)}main[_ngcontent-%COMP%]   .row-info[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}main[_ngcontent-%COMP%]   .row-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;align-items:center}main[_ngcontent-%COMP%]   .row-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90);background-color:var(--mono-30);border-color:var(--mono-30)}main[_ngcontent-%COMP%]   .row-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}main[_ngcontent-%COMP%]   .row-info[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{width:88px;margin:0 12px}main[_ngcontent-%COMP%]   .script-validation-message[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);position:relative;display:flex;height:32px;align-items:center;justify-content:space-between;padding:12px 12px 0;border-top:1px solid var(--mono-30);margin-bottom:24px;white-space:nowrap}main[_ngcontent-%COMP%]   .script-validation-message[_ngcontent-%COMP%]   .background[_ngcontent-%COMP%]{position:absolute;height:calc(100% - 12px);top:12px;left:0;width:100%;z-index:1}main[_ngcontent-%COMP%]   .script-validation-message[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{opacity:.5}main[_ngcontent-%COMP%]   .script-validation-message.error[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{opacity:1}main[_ngcontent-%COMP%]   .script-validation-message.error[_ngcontent-%COMP%]   .background[_ngcontent-%COMP%]{background-color:var(--exception);opacity:.08}main[_ngcontent-%COMP%]   .script-validation-message.error[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{display:flex;align-items:center}main[_ngcontent-%COMP%]   .script-validation-message.error[_ngcontent-%COMP%]   section.left[_ngcontent-%COMP%]{overflow:hidden}main[_ngcontent-%COMP%]   .script-validation-message.error[_ngcontent-%COMP%]   section.right[_ngcontent-%COMP%]{margin-left:8px}main[_ngcontent-%COMP%]   .script-validation-message.error[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{color:var(--exception);margin-right:4px;z-index:2}main[_ngcontent-%COMP%]   .script-validation-message.error[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{z-index:2;overflow:hidden;text-overflow:ellipsis;-webkit-user-select:all;user-select:all}main[_ngcontent-%COMP%]   .script-validation-message[_ngcontent-%COMP%]   .spin-loader[_ngcontent-%COMP%]{width:18px;height:18px;border-width:2px}main[_ngcontent-%COMP%]   .save-script-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}main[_ngcontent-%COMP%]   .save-script-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:relative}main[_ngcontent-%COMP%]   .save-script-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90);background-color:var(--mono-30);border-color:var(--mono-30)}main[_ngcontent-%COMP%]   .save-script-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:disabled{color:var(--font-disable);background-color:var(--mono-30)}main[_ngcontent-%COMP%]   .save-script-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{color:#d7d7d7}main[_ngcontent-%COMP%]   .save-script-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-top:12px;margin-left:0}main[_ngcontent-%COMP%]   .save-script-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;left:15px}footer[_ngcontent-%COMP%]{text-align:right;margin-top:40px}footer[_ngcontent-%COMP%]   button.dark.confirm[_ngcontent-%COMP%]{color:var(--mono-00);background-color:var(--primary-50)}footer[_ngcontent-%COMP%]   button.dark.confirm[_ngcontent-%COMP%]:disabled{background-color:#946516}footer[_ngcontent-%COMP%]   button.dark.confirm[_ngcontent-%COMP%]:hover{background-color:var(--primary-50-hover)}footer[_ngcontent-%COMP%]   button.dark.cancel[_ngcontent-%COMP%]{color:var(--mono-90);background-color:var(--mono-30);border-color:var(--mono-30)}footer[_ngcontent-%COMP%]   button.dark.cancel[_ngcontent-%COMP%]:hover{color:#d7d7d7;border-color:#474747;background-color:#474747}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));var Vi=$n;ee([Ae(J.templateModalComp.onButtonClick)],Vi.prototype,"onButtonClick",null);var gd=()=>["F"],El=()=>["opacity"],Sl=()=>["FillColor"],xl=()=>["StrokeColor"],Cd=()=>["CoverLineColor"],Td=()=>["width"],vl=()=>["FontSize"],Ol=()=>["FontColor"],bl=()=>["Measure"],Ed=()=>["borderStyle","style"],Sd=()=>["LE"],Il=()=>["LL"],yl=()=>["LLE"],Al=()=>["AP_N"],Rl=()=>["Opt"],xd=()=>["Parent","AA","C"];function vd(r,n){if(r&1){let i=w();h(0,"section",18)(1,"span"),M(2),E(3,"translate"),_(),h(4,"pu-toggle-button",19),O("ngModelChange",function(){f(i);let t=d();return g(t.toggleRedactionPreview())}),_()()}if(r&2){let i=d();l(2),k(S(3,3,"REDACTION_PREVIEW")),l(2),p("ngModel",i.isPreviewRedaction)("isDarkMode",i.isDarkMode)}}function Od(r,n){if(r&1){let i=w();h(0,"section",20)(1,"div")(2,"span"),M(3,"X"),_(),h(4,"pu-input-value",21),E(5,"translate"),O("mousedown",function(t){f(i);let o=d();return g(o.preventDragging(t))}),_()(),h(6,"div")(7,"span"),M(8,"Y"),_(),h(9,"pu-input-value",21),E(10,"translate"),O("mousedown",function(t){f(i);let o=d();return g(o.preventDragging(t))}),_()(),h(11,"div")(12,"span"),M(13),E(14,"translate"),_(),h(15,"pu-input-value",21),E(16,"translate"),O("mousedown",function(t){f(i);let o=d();return g(o.preventDragging(t))}),_()(),h(17,"div")(18,"span"),M(19),E(20,"translate"),_(),h(21,"pu-input-value",22),E(22,"translate"),O("puStepApply",function(t){f(i);let o=d();return g(o.heightAsLocaleUnit=o.heightAsLocaleUnit+t)}),_()()()}if(r&2){let i=d();l(2),W("disabled",i.someAnnotsLocked()||!i.isAlignable()||i.isSelectedNothing),l(2),p("width",100)("suffix",i.convertedUnit)("formControl",i.annotPositionXFormControl)("ariaLabel",S(5,26,"X_AXIS")),l(3),W("disabled",i.someAnnotsLocked()||!i.isAlignable()||i.isSelectedNothing),l(2),p("width",100)("suffix",i.convertedUnit)("formControl",i.annotPositionYFormControl)("ariaLabel",S(10,28,"Y_AXIS")),l(3),W("disabled",i.someAnnotsLocked()||!i.isAdjustable()||i.isSelectedNothing),l(),k(S(14,30,"WIDTH")),l(2),p("width",100)("suffix",i.convertedUnit)("formControl",i.annotWidthFormControl)("ariaLabel",S(16,32,"WIDTH")),l(3),W("disabled",i.someAnnotsLocked()||!i.isAdjustable()||i.isSelectedNothing),l(),k(S(20,34,"HEIGHT")),l(2),p("width",100)("suffix",i.convertedUnit)("formControl",i.annotHeightFormControl)("ariaLabel",S(22,36,"HEIGHT"))}}function bd(r,n){r&1&&(h(0,"section",23)(1,"span"),M(2),E(3,"translate"),_()()),r&2&&(l(2),k(S(3,1,"PLEASE_SELECT_ANNOTATION")))}function Id(r,n){if(r&1){let i=w();h(0,"div",29),O("click",function(){let t=f(i).$implicit,o=d(2);return g(o.activatedTabKey=t)}),h(1,"div",30),M(2),_(),I(3,"div",31)(4,"div",32),_()}if(r&2){let i=n.$implicit,e=d(2);W("active",e.activatedTabKey===i),l(2),k(e.getTabLabel(i)),l(2),p("ngClass",e.setClassOfMiddleBorder)}}function yd(r,n){if(r&1&&I(0,"div",33),r&2){let i=n.$implicit,e=d(2);qe("width",e.tabBottomBorderWidth(i)),p("ngClass",i==="GENERAL"?"left":"right")}}function Ad(r,n){if(r&1&&(h(0,"nav",24)(1,"nav",25),R(2,Id,5,4,"div",26),_(),h(3,"div",27),R(4,yd,1,3,"div",28),_()()),r&2){let i=d();l(2),p("ngForOf",i.tabKeys),l(2),p("ngForOf",i.tabKeys)}}function Rd(r,n){if(r&1&&(h(0,"span",41),M(1),E(2,"translate"),_()),r&2){let i=d(2);W("disabled",i.someAnnotsLocked()),l(),k(S(2,3,i.isFormField()?"NAME":"AUTHOR"))}}function Pd(r,n){if(r&1){let i=w();h(0,"pu-input",42),E(1,"translate"),E(2,"translate"),O("blur",function(){f(i);let t=d(2);return g(t.updateAnnotTitle())})("keydown.enter",function(){f(i);let t=d(2);return g(t.updateAnnotTitle())}),_()}if(r&2){let i=d(2);p("size",i.isSmallWidthScreen?"small":"tiny")("formControl",i.annotTitleFormControl)("placeholder",S(1,4,"ENTER_THE_AUTHOR_NAME"))("ariaLabel",S(2,6,"ENTER_THE_AUTHOR_NAME"))}}function Nd(r,n){if(r&1){let i=w();h(0,"pu-checkbox",43),E(1,"translate"),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.readOnly,t)||(o.readOnly=t),g(t)}),_()}if(r&2){let i=d(2);p("disableFocus",!0)("disabled",i.someAnnotsLocked())("label",S(1,4,"READONLY")),me("ngModel",i.readOnly)}}function Md(r,n){if(r&1){let i=w();h(0,"pu-checkbox",43),E(1,"translate"),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.required,t)||(o.required=t),g(t)}),_()}if(r&2){let i=d(2);p("disableFocus",!0)("disabled",i.someAnnotsLocked())("label",S(1,4,"REQUIRED")),me("ngModel",i.required)}}function Dd(r,n){if(r&1){let i=w();h(0,"pu-checkbox",44),E(1,"translate"),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.lock,t)||(o.lock=t),g(t)}),_()}if(r&2){let i=d(2);p("disableFocus",!0)("label",S(1,3,"LOCK")),me("ngModel",i.lock)}}function wd(r,n){if(r&1){let i=w();Te(0),h(1,"div",50)(2,"span",51),M(3),E(4,"translate"),_(),h(5,"span",52),M(6),_()(),h(7,"form",53),O("ngSubmit",function(){f(i);let t=d(4);return g(t.opacityAsPercentage=t.opacityAsPercentageFormControl.value)}),h(8,"pu-slider",54),E(9,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.opacity,t)||(o.opacity=t),g(t)}),O("puStepApply",function(t){f(i);let o=d(4);return g(o.opacityAsPercentage=((o.opacity+t)*100).toFixed(0))}),_(),h(10,"pu-input",55),E(11,"translate"),O("blur",function(){f(i);let t=d(4);return g(t.opacityAsPercentage=t.opacityAsPercentageFormControl.value)}),_()(),Ee()}if(r&2){let i=d(4);l(2),W("disabled",i.someAnnotsLocked()),l(),k(S(4,15,"OPACITY")),l(3),ke("",i.opacityAsPercentage," %"),l(2),p("min",0)("max",1)("step",.01)("puInputStep","all")("disabled",i.someAnnotsLocked())("puStep",.01)("puAlterStep",.1),me("ngModel",i.opacity),G("aria-label",S(9,17,"OPACITY")),l(2),p("formControl",i.opacityAsPercentageFormControl)("ariaLabel",S(11,19,"OPACITY"))}}function Ld(r,n){if(r&1){let i=w();h(0,"div",46)(1,"span",51),M(2),E(3,"translate"),_(),h(4,"div",56)(5,"div",57),E(6,"translate"),O("click",function(){f(i);let t=d(4);return g(t.onColorTabColorClick(t.ColorTabColor.FILL_COLOR))}),_()()()}if(r&2){let i=d(4);qe("order",i.isRedact?1:0),l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,12,i.fillColorTitle)),l(2),W("disabled",i.someAnnotsLocked())("selected",i.selectedColorTabColor===i.ColorTabColor.FILL_COLOR),l(),qe("background",i.fillColor===null?i.transparentBackground:i.fillColor),G("aria-label",S(6,14,i.fillColorTitle))}}function kd(r,n){if(r&1){let i=w();h(0,"div",46)(1,"span",51),M(2),E(3,"translate"),_(),h(4,"div",56)(5,"div",57),E(6,"translate"),O("click",function(){f(i);let t=d(4);return g(t.onColorTabColorClick(t.ColorTabColor.STROKE_COLOR))}),_()()()}if(r&2){let i=d(4);qe("order",0),l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,12,i.strokeColorTitle)),l(2),W("disabled",i.someAnnotsLocked())("selected",i.selectedColorTabColor===i.ColorTabColor.STROKE_COLOR),l(),qe("background",i.strokeColor===null?i.transparentBackground:i.strokeColor),G("aria-label",S(6,14,i.strokeColorTitle))}}function Fd(r,n){if(r&1){let i=w();h(0,"pu-color-palette",58),E(1,"translate"),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.activatedColorTabColor,t)||(o.activatedColorTabColor=t),g(t)}),_()}if(r&2){let i=d(4);p("nullable",i.isNullableStrokePalette)("customColorLabel",S(1,5,"CUSTOM_COLOR"))("defaultColorLabel",S(2,7,"DEFAULT_COLOR"))("defaultColorPanelExpandedd",!0),me("ngModel",i.activatedColorTabColor)}}function Vd(r,n){if(r&1&&(h(0,"section",46),R(1,wd,12,21,"ng-container",16),h(2,"div",47),R(3,Ld,7,16,"div",48)(4,kd,7,16,"div",48),_(),R(5,Fd,3,9,"pu-color-palette",49),_()),r&2){let i=d(3);l(),p("ngIf",i.isCommonAnnotAttribute(pe(4,El))),l(2),p("ngIf",i.isCommonAnnotAttribute(pe(5,Sl))&&!i.includeRedaction()),l(),p("ngIf",i.isCommonAnnotAttribute(pe(6,xl))&&!i.includeRedaction()),l(),p("ngIf",i.selectedColorTabColor!==null)}}function Ud(r,n){if(r&1&&(h(0,"pu-accordion-tab",45),E(1,"translate"),R(2,Vd,6,7,"ng-template",null,0,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"COLOR"))("borderHidden",!0)}}function Bd(r,n){if(r&1){let i=w();Te(0),h(1,"div",50)(2,"span",51),M(3),E(4,"translate"),_(),h(5,"span",52),M(6),_()(),h(7,"form",53),O("ngSubmit",function(){f(i);let t=d(4);return g(t.stringStrokeWidth=t.stringStrokeWidthFormControl.value+"")}),h(8,"pu-slider",59),E(9,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.strokeWidth,t)||(o.strokeWidth=t),g(t)}),O("puStepApply",function(t){f(i);let o=d(4);return g(o.stringStrokeWidth=(o.strokeWidth||0)+(t>0?1:-1)+"")}),_(),h(10,"pu-input",55),E(11,"translate"),O("blur",function(){f(i);let t=d(4);return g(t.stringStrokeWidth=t.stringStrokeWidthFormControl.value+"")}),_()(),Ee()}if(r&2){let i=d(4);l(2),W("disabled",i.someAnnotsLocked()),l(),k(S(4,12,"THICKNESS")),l(3),ke("",i.stringStrokeWidth," pt"),l(2),p("puInputStep","all")("disabled",i.someAnnotsLocked())("max",i.maximumStrokeWidth)("min",i.MinimumStrokeWidth),me("ngModel",i.strokeWidth),G("aria-label",S(9,14,"THICKNESS")),l(2),p("formControl",i.stringStrokeWidthFormControl)("ariaLabel",S(11,16,"THICKNESS"))}}function Gd(r,n){if(r&1){let i=w();Te(0),h(1,"span",41),M(2),E(3,"translate"),_(),h(4,"pu-dropdown",60),E(5,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedBorderStyle,t)||(o.selectedBorderStyle=t),g(t)}),O("mousedown",function(t){f(i);let o=d(4);return g(o.preventDragging(t))}),_(),Ee()}if(r&2){let i=d(4);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,9,"STYLE")),l(2),p("disabled",i.someAnnotsLocked())("isImageLabel",!0)("options",i.borderStyleOptions)("expandAriaLabel",S(5,11,"EXPAND"))("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedBorderStyle)}}function Wd(r,n){if(r&1){let i=w();Te(0),h(1,"span",41),M(2),E(3,"translate"),_(),h(4,"pu-dropdown",61),he("ngModelChange",function(t){f(i);let o=d(5);return ue(o.selectedEndLinecap,t)||(o.selectedEndLinecap=t),g(t)}),O("mousedown",function(t){f(i);let o=d(5);return g(o.preventDragging(t))}),_(),Ee()}if(r&2){let i=d(5);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,8,"END")),l(2),p("disabled",i.someAnnotsLocked())("isImageLabel",!0)("options",i.endLinecapOptions)("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedEndLinecap)}}function zd(r,n){if(r&1){let i=w();Te(0),h(1,"span",41),M(2),E(3,"translate"),_(),h(4,"pu-dropdown",61),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedStartLinecap,t)||(o.selectedStartLinecap=t),g(t)}),O("mousedown",function(t){f(i);let o=d(4);return g(o.preventDragging(t))}),_(),R(5,Wd,5,10,"ng-container",16),Ee()}if(r&2){let i=d(4);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,9,"START")),l(2),p("disabled",i.someAnnotsLocked())("isImageLabel",!0)("options",i.startLinecapOptions)("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedStartLinecap),l(),p("ngIf",!i.includeFreeTextCallout())}}function Hd(r,n){if(r&1&&(h(0,"section",46),R(1,Bd,12,18,"ng-container",16)(2,Gd,6,13,"ng-container",16)(3,zd,6,11,"ng-container",16),_()),r&2){let i=d(3);l(),p("ngIf",!i.isCommonAnnotAttribute(pe(3,bl))),l(),p("ngIf",i.isCommonAnnotAttribute(pe(4,Ed))&&!i.includePolygonCloud()&&!i.includeInk()),l(),p("ngIf",i.isCommonAnnotAttribute(pe(5,Sd)))}}function jd(r,n){if(r&1&&(h(0,"pu-accordion-tab",45),E(1,"translate"),R(2,Hd,4,6,"ng-template",null,1,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"LINE"))("borderHidden",!0)}}function $d(r,n){if(r&1){let i=w();h(0,"div",64)(1,"pu-checkbox",65),E(2,"translate"),O("ngModelChange",function(t){f(i);let o=d(4);return g(t?o.overlayTextFormControl.enable():o.overlayTextFormControl.disable())}),_(),I(3,"pu-input",66),E(4,"translate"),_()}if(r&2){let i=d(4);l(),p("label",S(2,5,"OVERLAY_TEXT_CHECK"))("disabled",i.someAnnotsLocked())("ngModel",!i.overlayTextFormControl.disabled),l(2),p("placeholder",S(4,7,"OVERLAY_TEXT_INPUT"))("formControl",i.overlayTextFormControl)}}function Yd(r,n){if(r&1){let i=w();h(0,"div",67)(1,"div",68)(2,"span",41),M(3),E(4,"translate"),_(),h(5,"pu-dropdown",69),E(6,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedFont,t)||(o.selectedFont=t),g(t)}),_()(),h(7,"div",68)(8,"span",41),M(9),E(10,"translate"),_(),h(11,"pu-dropdown",70),E(12,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedFontSize,t)||(o.selectedFontSize=t),g(t)}),_()()()}if(r&2){let i=d(4);l(2),W("disabled",i.someAnnotsLocked()),l(),k(S(4,18,"STYLE")),l(2),p("disabled",i.someAnnotsLocked())("size",i.isSmallWidthScreen?"small":"tiny")("options",i.fontOptions)("expandAriaLabel",S(6,20,"EXPAND"))("boxWidth",186),me("ngModel",i.selectedFont),l(3),W("disabled",i.someAnnotsLocked()),l(),k(S(10,22,"SIZE")),l(2),p("disabled",i.someAnnotsLocked())("editable",!0)("expandAriaLabel",S(12,24,"EXPAND"))("size",i.isSmallWidthScreen?"small":"tiny")("options",i.fontsizeOptions),me("ngModel",i.selectedFontSize)}}function Xd(r,n){if(r&1){let i=w();h(0,"pu-color-palette",72),E(1,"translate"),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(5);return ue(o.activatedFontTabColor,t)||(o.activatedFontTabColor=t),g(t)}),_()}if(r&2){let i=d(5);p("customColorLabel",S(1,4,"CUSTOM_COLOR"))("defaultColorLabel",S(2,6,"DEFAULT_COLOR"))("defaultColorPanelExpandedd",!0),me("ngModel",i.activatedFontTabColor)}}function Kd(r,n){if(r&1){let i=w();Te(0),h(1,"span",51),M(2),E(3,"translate"),_(),h(4,"div",56)(5,"div",57),E(6,"translate"),O("click",function(){f(i);let t=d(4);return g(t.onFontTabColorClick(t.FontTabColor.FONT_COLOR))}),_()(),R(7,Xd,3,8,"pu-color-palette",71),Ee()}if(r&2){let i=d(4);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,11,"COLOR")),l(2),W("disabled",i.someAnnotsLocked())("selected",i.selectedFontTabColor===i.FontTabColor.FONT_COLOR),l(),qe("background",i.fontColor===null?i.transparentBackground:i.fontColor),G("aria-label",S(6,13,"COLOR")),l(2),p("ngIf",i.selectedFontTabColor!==null)}}function Qd(r,n){if(r&1){let i=w();Te(0),h(1,"span",41),M(2),E(3,"translate"),_(),h(4,"div",73)(5,"button",74),E(6,"translate"),O("click",function(){f(i);let t=d(4);return g(t.textAlign="left")}),I(7,"i",75),_(),h(8,"button",74),E(9,"translate"),O("click",function(){f(i);let t=d(4);return g(t.textAlign="center")}),I(10,"i",76),_(),h(11,"button",74),E(12,"translate"),O("click",function(){f(i);let t=d(4);return g(t.textAlign="right")}),I(13,"i",77),_()(),Ee()}if(r&2){let i=d(4);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,24,"TEXT_ALIGN")),l(3),W("dark",i.isDarkMode)("active",i.textAlign==="left"),p("disabled",i.someAnnotsLocked()),G("aria-label",S(6,26,"LEFT_ALIGN"))("color",i.getTextAlignButtonColor("left")),l(3),W("dark",i.isDarkMode)("active",i.textAlign==="center"),p("disabled",i.someAnnotsLocked()),G("aria-label",S(9,28,"CENTER_ALIGN"))("color",i.getTextAlignButtonColor("center")),l(3),W("dark",i.isDarkMode)("active",i.textAlign==="right"),p("disabled",i.someAnnotsLocked()),G("aria-label",S(12,30,"RIGHT_ALIGN"))("color",i.getTextAlignButtonColor("right"))}}function Zd(r,n){if(r&1&&(h(0,"section",46),R(1,$d,5,9,"div",62)(2,Yd,13,26,"div",63)(3,Kd,8,15,"ng-container",16)(4,Qd,14,32,"ng-container",16),_()),r&2){let i=d(3);l(),p("ngIf",i.isRedact),l(),p("ngIf",i.isCommonAnnotAttribute(pe(4,vl))),l(),p("ngIf",i.isCommonAnnotAttribute(pe(5,Ol))),l(),p("ngIf",i.isTextField())}}function qd(r,n){if(r&1&&(h(0,"pu-accordion-tab",45),E(1,"translate"),R(2,Zd,5,6,"ng-template",null,2,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"TEXT_PROP"))("borderHidden",!0)}}function Jd(r,n){if(r&1){let i=w();h(0,"div",83)(1,"pu-input-value",84),E(2,"translate"),O("puStepApply",function(t){f(i);let o=d(5);return g(o.measureLength=o.fixRange(o.measureLength+t,0))})("mousedown",function(t){f(i);let o=d(5);return g(o.preventDragging(t))}),_(),h(3,"span",85),M(4),E(5,"translate"),_()()}if(r&2){let i=d(5);l(),p("width",70)("formControl",i.measureLengthFormControl)("puStepDisabled",i.isNaN(i.measureLength))("height",i.isSmallWidthScreen?40:30)("min",void 0)("ariaLabel",S(2,9,"LENGTH")),l(2),W("disabled",i.someAnnotsLocked()),l(),k(S(5,11,"LENGTH"))}}function eu(r,n){if(r&1){let i=w();h(0,"div",83)(1,"pu-input-value",86),E(2,"translate"),O("puStepApply",function(t){f(i);let o=d(5);return g(o.measureExtend=o.fixRange(o.measureExtend+t,0))})("mousedown",function(t){f(i);let o=d(5);return g(o.preventDragging(t))}),_(),h(3,"span",85),M(4),E(5,"translate"),_()()}if(r&2){let i=d(5);l(),p("width",70)("formControl",i.measureExtendFormControl)("puStepDisabled",i.isNaN(i.measureExtend))("height",i.isSmallWidthScreen?40:30)("ariaLabel",S(2,8,"EXTENSION")),l(2),W("disabled",i.someAnnotsLocked()),l(),k(S(5,10,"EXTENSION"))}}function tu(r,n){if(r&1&&(Te(0),h(1,"span",51),M(2),E(3,"translate"),_(),h(4,"div",67),R(5,Jd,6,13,"div",82)(6,eu,6,12,"div",82),_(),Ee()),r&2){let i=d(4);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,5,"LEADER_LINE")),l(3),p("ngIf",i.isCommonAnnotAttribute(pe(7,Il))),l(),p("ngIf",i.isCommonAnnotAttribute(pe(8,yl)))}}function iu(r,n){if(r&1){let i=w();h(0,"section",46),R(1,tu,7,9,"ng-container",16),h(2,"span",51),M(3),E(4,"translate"),_(),h(5,"div",78)(6,"pu-input",79),E(7,"translate"),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.measureInputRatio,t)||(o.measureInputRatio=t),g(t)}),O("ngModelChange",function(){f(i);let t=d(3);return g(t.onChangeMeasure())}),_(),h(8,"pu-dropdown",80),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.selectedMeasureInputUnit,t)||(o.selectedMeasureInputUnit=t),g(t)}),O("ngModelChange",function(){f(i);let t=d(3);return g(t.onChangeMeasure())}),_(),I(9,"div",81),h(10,"pu-input",79),E(11,"translate"),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.measureOutputRatio,t)||(o.measureOutputRatio=t),g(t)}),O("ngModelChange",function(){f(i);let t=d(3);return g(t.onChangeMeasure())}),_(),h(12,"pu-dropdown",80),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.selectedMeasureOutputUnit,t)||(o.selectedMeasureOutputUnit=t),g(t)}),O("ngModelChange",function(){f(i);let t=d(3);return g(t.onChangeMeasure())}),_()()()}if(r&2){let i=d(3);l(),p("ngIf",i.isCommonAnnotAttribute(pe(28,Il))||i.isCommonAnnotAttribute(pe(29,yl))),l(),W("disabled",i.someAnnotsLocked()),l(),k(S(4,22,"RATIO")),l(3),p("autoResize",!0)("disabled",i.someAnnotsLocked())("size",i.isSmallWidthScreen?"small":"tiny")("ariaLabel",S(7,24,"RATIO")),me("ngModel",i.measureInputRatio),l(2),p("disabled",i.someAnnotsLocked())("options",i.measureInputUnitOpts)("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedMeasureInputUnit),l(2),p("autoResize",!0)("disabled",i.someAnnotsLocked())("size",i.isSmallWidthScreen?"small":"tiny")("ariaLabel",S(11,26,"RATIO")),me("ngModel",i.measureOutputRatio),l(2),p("disabled",i.someAnnotsLocked())("options",i.measureOutputUnitOpts)("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedMeasureOutputUnit)}}function nu(r,n){if(r&1&&(h(0,"pu-accordion-tab",45),E(1,"translate"),R(2,iu,13,30,"ng-template",null,3,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"MEASURE"))("borderHidden",!0)}}function ou(r,n){if(r&1&&(Te(0),h(1,"section",34),R(2,Rd,3,5,"span",35)(3,Pd,3,8,"pu-input",36),h(4,"div",37),R(5,Nd,2,6,"pu-checkbox",38)(6,Md,2,6,"pu-checkbox",38)(7,Dd,2,5,"pu-checkbox",39),_()(),h(8,"pu-accordion"),R(9,Ud,4,6,"pu-accordion-tab",40)(10,jd,4,6,"pu-accordion-tab",40)(11,qd,4,6,"pu-accordion-tab",40)(12,nu,4,6,"pu-accordion-tab",40),_(),Ee()),r&2){let i=d();l(2),p("ngIf",!i.isDefaultProperty),l(),p("ngIf",!i.isDefaultProperty),l(2),p("ngIf",i.isFormField()),l(),p("ngIf",i.isFormField()),l(),p("ngIf",i.isCommonAnnotAttribute(pe(11,gd))),l(),W("show-border",!i.isDefaultProperty||i.isFormField()),l(),p("ngIf",i.isCommonAnnotAttribute(pe(12,El))||i.isCommonAnnotAttribute(pe(13,Sl))||i.isCommonAnnotAttribute(pe(14,xl))||i.isCommonAnnotAttribute(pe(15,Cd))),l(),p("ngIf",!i.isRedact&&i.isCommonAnnotAttribute(pe(16,Td))&&i.strokeWidth&&i.strokeWidth>0&&!i.includeRedaction()),l(),p("ngIf",(i.isCommonAnnotAttribute(pe(17,vl))||i.isCommonAnnotAttribute(pe(18,Ol)))&&!i.isCheckable()&&!i.includeSignature()&&!i.isRedact||i.isTextField()),l(),p("ngIf",i.isCommonAnnotAttribute(pe(19,bl)))}}function ru(r,n){if(r&1){let i=w();Te(0),h(1,"div",89),I(2,"div",90),_(),h(3,"span",51),M(4),E(5,"translate"),_(),h(6,"pu-dropdown",91),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedCheckableOption,t)||(o.selectedCheckableOption=t),g(t)}),_(),Ee()}if(r&2){let i=d(4);l(2),p("ngStyle",i.checkablePreviewStyle()),l(2),k(S(5,5,"BOX_STYLE")),l(2),p("disabled",i.someAnnotsLocked())("options",i.checkableOptions),me("ngModel",i.selectedCheckableOption)}}function su(r,n){if(r&1){let i=w();Te(0),h(1,"span",51),M(2),E(3,"translate"),_(),h(4,"pu-input",92),E(5,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.caption,t)||(o.caption=t),g(t)}),_(),Ee()}if(r&2){let i=d(4);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,5,"LABEL")),l(2),p("ariaLabel",S(5,7,"LABEL")),me("ngModel",i.caption)}}function au(r,n){if(r&1){let i=w();Te(0),h(1,"pu-checkbox",93),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.multiline,t)||(o.multiline=t),g(t)}),_(),Ee()}if(r&2){let i=d(4);l(),p("disabled",i.someAnnotsLocked())("disableFocus",!0)("label",S(2,4,"MULTILINE")),me("ngModel",i.multiline)}}function cu(r,n){if(r&1){let i=w();Te(0),h(1,"span",51),M(2),E(3,"translate"),_(),h(4,"pu-input",94),E(5,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.AP_N_exportValue,t)||(o.AP_N_exportValue=t),g(t)}),_(),Ee()}if(r&2){let i=d(4);l(),W("disabled",i.someAnnotsLocked()),l(),k(S(3,7,i.isRadioButton()?"RADIO_BUTTON_CHOICE":"EXPORT_VALUE")),l(2),p("disabled",i.someAnnotsLocked())("size",i.isSmallWidthScreen?"small":"tiny")("ariaLabel",S(5,9,"RADIO_BUTTON_CHOICE")),me("ngModel",i.AP_N_exportValue)}}function lu(r,n){if(r&1){let i=w();Te(0),h(1,"sd-annot-property-option",95),O("selectedIndexChange",function(t){f(i);let o=d(4);return g(o.setSelection(t))}),_(),Ee()}if(r&2){let i=d(4);l(),p("formControl",i.annotPropertyOptionFormControl)}}function pu(r,n){if(r&1&&(h(0,"section",46),R(1,ru,7,7,"ng-container",16)(2,su,6,9,"ng-container",16)(3,au,3,6,"ng-container",16)(4,cu,6,11,"ng-container",16)(5,lu,2,1,"ng-container",16),_()),r&2){let i=d(3);l(),p("ngIf",i.isCheckable()),l(),p("ngIf",i.isPushButton()),l(),p("ngIf",i.isTextField()),l(),p("ngIf",i.isCommonAnnotAttribute(pe(5,Al))),l(),p("ngIf",i.isCommonFieldAttribute(pe(6,Rl)))}}function du(r,n){if(r&1&&(h(0,"pu-accordion-tab",45),E(1,"translate"),R(2,pu,6,7,"ng-template",null,4,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"OPTION"))("borderHidden",!0)}}function uu(r,n){if(r&1){let i=w();h(0,"div",116)(1,"pu-checkbox",117),he("ngModelChange",function(t){let o=f(i).$implicit;return ue(o.checked,t)||(o.checked=t),g(t)}),_()()}if(r&2){let i=n.$implicit,e=d(4);l(),p("disabled",e.calculationCategory!=="predefined"||e.someAnnotsLocked())("label",i.T)("disableFocus",!0),me("ngModel",i.checked)}}function mu(r,n){if(r&1){let i=w();h(0,"section",97)(1,"pu-radio-button",98),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.calculationCategory,t)||(o.calculationCategory=t),g(t)}),_(),h(3,"div",99)(4,"pu-radio-button",100),E(5,"translate"),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.calculationCategory,t)||(o.calculationCategory=t),g(t)}),_(),h(6,"pu-dropdown",101),E(7,"translate"),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.selectedPredefinedCalculation,t)||(o.selectedPredefinedCalculation=t),g(t)}),O("ngModelChange",function(){f(i);let t=d(3);return g(t.updatePredefinedCalculation())}),_(),h(8,"span",102),M(9),E(10,"translate"),_()(),h(11,"article",103)(12,"pu-input",104),E(13,"translate"),E(14,"translate"),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.tempAcroFieldListFilter,t)||(o.tempAcroFieldListFilter=t),g(t)}),_(),h(15,"nav",105)(16,"pu-checkbox",106),E(17,"translate"),O("ngModelChange",function(t){f(i);let o=d(3);return g(t?o.selectAllField():o.deselectAllField())}),_()(),h(18,"div",107),R(19,uu,2,4,"div",108),_(),h(20,"aside",109),O("click",function(){f(i);let t=d(3);return g(t.toggleFieldSelectListExpend())}),I(21,"i",110),_()(),h(22,"div",111)(23,"button",112),E(24,"translate"),O("click",function(){f(i);let t=d(3);return g(t.confirmFieldSelectChange())}),M(25),E(26,"translate"),_()(),h(27,"pu-radio-button",113),E(28,"translate"),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.calculationCategory,t)||(o.calculationCategory=t),g(t)}),_(),h(29,"div",114),M(30),_(),h(31,"div",115)(32,"button",112),E(33,"translate"),O("click",function(){f(i);let t=d(3);return g(t.openCustomScriptDialog())}),M(34),E(35,"translate"),_()()()}if(r&2){let i=d(3);l(),p("disabled",i.someAnnotsLocked())("label",S(2,42,"VALUE_IS_NOT_CALCULATED")),me("ngModel",i.calculationCategory),l(3),p("disabled",i.someAnnotsLocked())("label",S(5,44,"VALUE_IS_PREDEFINED_CALCULATION_PREFIX")),me("ngModel",i.calculationCategory),l(2),p("disabled",i.calculationCategory!=="predefined"||i.someAnnotsLocked())("options",i.predefinedCalculationOptions)("size",i.isSmallWidthScreen?"small":"tiny")("expandAriaLabel",S(7,46,"EXPAND")),me("ngModel",i.selectedPredefinedCalculation),l(2),W("disabled",i.someAnnotsLocked()),l(),k(S(10,48,"VALUE_IS_PREDEFINED_CALCULATION_SUFFIX")),l(3),p("placeholder",S(13,50,"ENTER_HERE"))("useClearButton",!0)("disabled",i.calculationCategory!=="predefined"||i.someAnnotsLocked())("ariaLabel",S(14,52,"ENTER_HERE")),me("ngModel",i.tempAcroFieldListFilter),l(4),p("label",S(17,54,"SELECT_ALL"))("disableFocus",!0)("disabled",i.calculationCategory!=="predefined"||i.someAnnotsLocked())("ngModel",i.isAllFieldSelected()),l(2),p("@selectFileList",i.fieldSelectStatus),l(),p("ngForOf",i.filteredTempAcroFieldList),l(2),p("ngClass",i.getSelectCalFieldListClass()),l(2),W("dark",i.isDarkMode),p("disabled",i.calculationCategory!=="predefined"||i.someAnnotsLocked()||!i.isSelectedCalFields()),G("size",i.isSmallWidthScreen?"small":"tiny")("aria-label",S(24,56,"SELECT")),l(2),k(S(26,58,"SELECT")),l(2),p("disabled",i.someAnnotsLocked())("label",S(28,60,"CUSTOM_CALCULATION_SCRIPT")),me("ngModel",i.calculationCategory),l(3),k(i.customScript),l(2),W("dark",i.isDarkMode),p("disabled",i.calculationCategory!=="custom"||i.someAnnotsLocked()),G("size",i.isSmallWidthScreen?"small":"tiny")("aria-label",S(33,62,"EDIT")),l(2),k(S(35,64,"EDIT"))}}function hu(r,n){if(r&1&&(h(0,"pu-accordion-tab",96),E(1,"translate"),R(2,mu,36,66,"ng-template",null,5,He),_()),r&2){let i=we(3);p("borderHidden",!0)("contentTemplate",i)("header",S(1,4,"FIELD_PROPERTY_CALCULATE"))("selected",!0)}}function _u(r,n){if(r&1){let i=w();h(0,"section",118)(1,"div",46)(2,"span",41),M(3),E(4,"translate"),_(),h(5,"sd-widget-action-list",119),he("actionTriggerChange",function(t){f(i);let o=d(3);return ue(o.selectedActionTrigger,t)||(o.selectedActionTrigger=t),g(t)})("actionIndexChange",function(t){f(i);let o=d(3);return ue(o.selectedActionIndex,t)||(o.selectedActionIndex=t),g(t)}),_(),h(6,"div",120)(7,"button",121),E(8,"translate"),O("click",function(){f(i);let t=d(3);return g(t.onEditActionClick())}),I(9,"i",122),_(),h(10,"button",121),E(11,"translate"),O("click",function(){f(i);let t=d(3);return g(t.onRemoveActionClick())}),I(12,"i",123),_()()(),h(13,"div",46)(14,"span",41),M(15),E(16,"translate"),_(),I(17,"pu-dropdown",124),E(18,"translate"),_(),h(19,"div",125)(20,"button",126),E(21,"translate"),O("click",function(t){f(i);let o=d(3);return g(o.onAddActionClick(t))}),M(22),E(23,"translate"),_()()()}if(r&2){let i=d(3);l(2),W("disabled",i.someAnnotsLocked()),l(),k(S(4,25,"ACTION_LIST")),l(2),p("actionTriggerMap",i.actionTriggerMap),me("actionTrigger",i.selectedActionTrigger)("actionIndex",i.selectedActionIndex),l(2),W("dark",i.isDarkMode),p("disabled",i.selectedActionIndex===null),G("aria-label",S(8,27,"EDIT")),l(3),W("dark",i.isDarkMode),p("disabled",i.selectedActionIndex===null),G("aria-label",S(11,29,"REMOVE")),l(4),W("disabled",i.someAnnotsLocked()),l(),k(S(16,31,"EXECUTE")),l(2),p("expandAriaLabel",S(18,33,"EXPAND"))("formControl",i.actionTriggerFormControl)("options",i.actionOptions),l(3),W("dark",i.isDarkMode),G("size",i.isSmallWidthScreen?"small":"tiny")("aria-label",S(21,35,"ADD")),l(2),k(S(23,37,"ADD"))}}function fu(r,n){if(r&1&&(h(0,"pu-accordion-tab",96),E(1,"translate"),R(2,_u,24,39,"ng-template",null,6,He),_()),r&2){let i=we(3);p("borderHidden",!0)("contentTemplate",i)("header",S(1,4,"ACTION"))("selected",!0)}}function gu(r,n){if(r&1&&(Te(0),h(1,"pu-accordion",87),R(2,du,4,6,"pu-accordion-tab",40)(3,hu,4,6,"pu-accordion-tab",88)(4,fu,4,6,"pu-accordion-tab",88),_(),Ee()),r&2){let i=d();l(2),p("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.WIDGET_PROPERTY_OPTION)&&!i.isDefaultProperty&&(i.isTextField()||i.isPushButton()||i.isCommonAnnotAttribute(pe(3,Al))||i.isCommonFieldAttribute(pe(4,Rl)))),l(),p("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.WIDGET_PROPERTY_CALCULATION)&&i.isTextField()&&i.isCommonAnnotAttribute(pe(5,xd))),l(),p("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.WIDGET_PROPERTY_ACTION)&&i.isFormField()&&i.selectedComps.length<2)}}function Cu(r,n){if(r&1){let i=w();h(0,"section",127)(1,"button",128),O("click",function(){f(i);let t=d();return g(t.toggleSelectedAnnotToolUseDefaultConfig(!t.selectedAnnotToolUseDefaultConfig))}),I(2,"i",129),h(3,"span"),M(4),E(5,"translate"),_()()()}if(r&2){let i=d();l(2),W("papycon-rounded-square",!i.selectedAnnotToolUseDefaultConfig)("papycon-check-mark4-filled",i.selectedAnnotToolUseDefaultConfig),l(2),k(S(5,5,"SET_CURRENT_AS_DEFAULT"))}}var Sn=function(r){return r[r.HORIZONTAL_LEFT=0]="HORIZONTAL_LEFT",r[r.HORIZONTAL_CENTER=1]="HORIZONTAL_CENTER",r[r.HORIZONTAL_RIGHT=2]="HORIZONTAL_RIGHT",r[r.VERTICAL_TOP=3]="VERTICAL_TOP",r[r.VERTICAL_CENTER=4]="VERTICAL_CENTER",r[r.VERTICAL_BOTTOM=5]="VERTICAL_BOTTOM",r}(Sn||{}),Yn=function(r){return r[r.CALCULATION=0]="CALCULATION",r[r.ACTION=1]="ACTION",r}(Yn||{}),Ai=function(r){return r.OPEN="open",r.CLOSE="close",r}(Ai||{}),zs={[V.INK]:"INK_TOOL",[V.LINE]:"LINE_TOOL",[V.SQUARE]:"SQUARE_TOOL",[V.CIRCLE]:"CIRCLE_TOOL",[V.POLYGON]:"POLYGON_TOOL",[V.POLYLINE]:"POLYLINE_TOOL",[V.CLOUD]:"POLYGON_CLOUD_TOOL",[V.TEXT_FREE]:"FREE_TEXT_TOOL",[V.TEXT_CALLOUT]:"FREE_TEXT_CALLOUT_TOOL",[V.TEXT_POPUP]:"TEXT_TOOL",[V.LINE_DIMENSION]:"DISTANCE_TOOL",[V.POLYLINE_DIMENSION]:"PERIMETER_TOOL",[V.POLYGON_DIMENSION]:"AREA_TOOL",[V.STAMP]:"STAMP_TOOL",[V.HIGHLIGHT]:"HIGHLIGHT",[V.UNDERLINE]:"UNDERLINE",[V.STRIKE]:"STRIKEOUT",[V.LINK]:"CREATE_LINK",[V.ERASER]:"ERASER",[V.SIGNATURE]:"SIGN",[V.TEXT_FIELD]:"TEXT_FIELD",[V.COMBO_BOX]:"COMBO_BOX",[V.LIST_BOX]:"LIST_BOX",[V.CHECK_BUTTON]:"CHECK_BUTTON",[V.RADIO_BUTTON]:"RADIO_BUTTON",[V.BUTTON]:"BUTTON",[V.REDACTION]:"REDACTION"},vo={Circle:"CIRCLE_TOOL",FreeText:"FREE_TEXT_TOOL",Highlight:"HIGHLIGHT",Ink:"INK_TOOL",Line:"LINE_TOOL",Link:"CREATE_LINK",PolyLine:"POLYLINE_TOOL",Polygon:"POLYGON_TOOL",Square:"SQUARE_TOOL",Stamp:"STAMP_TOOL",StrikeOut:"STRIKEOUT",Text:"TEXT_TOOL",Underline:"UNDERLINE",Redact:"REDACTION_DESIGN",Sig:"SIGN",Tx:"TEXT_FIELD",Cx:"COMBO_BOX",Lx:"LIST_BOX",Cb:"CHECK_BUTTON",Rb:"RADIO_BUTTON",Btn:"BUTTON",FreeTextCallout:"FREE_TEXT_CALLOUT_TOOL",PolygonCloud:"POLYGON_CLOUD_TOOL",LineDimension:"DISTANCE_TOOL",PolyLineDimension:"PERIMETER_TOOL",PolygonDimension:"AREA_TOOL"},Xn=class Xn{contentService;changeDetectorRef;acroFormService;annotService;annotSelectedService;toastService;pageService;scriptService;subscriptionService;modalService;store$;translatePipe;unitPipe;defaultAnnotService;redactionService;localStorageService;loggingService;get RuntimeEnvKey(){return a}get MergedRuntimeEnvKey(){return B}get runtimeEnv(){return K}get ColorTabColor(){return Dt}get FontTabColor(){return Yi}get fontsizeOptions(){return F.fontsizeOptions}MinimumStrokeWidth=1;maximumStrokeWidth=0;tabLabels;get tabKeys(){return Object.keys(this.tabLabels)}borderStyleOptions=[{label:"assets/images/dropdown-image/line/Basic.svg",value:{style:"solid"}}];startLinecapOptions=[{label:"assets/images/dropdown-image/endline/Basic.svg",value:"None"}];endLinecapOptions=[{label:"assets/images/dropdown-image/endline/Basic.svg",value:"None"}];measureInputUnitOpts=[];measureOutputUnitOpts=[];fontOptions=[];customFontSizeOption=null;selectionInfo;language="ko";activatedTabKey="GENERAL";selectedColorTabColor=null;selectedFontTabColor=null;isPreviewRedaction=!1;useDefaultProperties={};savableDefaultProperties=[["opacity"],["StrokeColor"],["FillColor"],["width"],["borderStyle","style"],["LE"],["FontSize"],["FontName"],["FontColor"],["Measure"],["LL"],["LLE"],["CoverLineColor"],["CoverLineWidth"],["overlayText"],["alignment"]];get convertedUnit(){return this.unitPipe.transform(q.MILLIMETER)}get selectedMeasureInputUnit(){return this.measureInputUnitOpts.find(n=>n.value===this.measureInputUnitKey)}set selectedMeasureInputUnit(n){this.measureInputUnitKey=n.value}measureInputUnitKey;measureInputRatio=1;get selectedMeasureOutputUnit(){return this.measureOutputUnitOpts.find(n=>n.value===this.measureOutputUnitName)}set selectedMeasureOutputUnit(n){this.measureOutputUnitName=n.value}get selectedCheckableOption(){return this.checkableOptions.find(n=>n.value===this.commonAttributes.MK?.CA)}set selectedCheckableOption(n){this.commonAttributes.MK===void 0&&(this.commonAttributes.MK={CA:""}),this.commonAttributes.MK.CA===void 0&&(this.commonAttributes.MK.CA=""),this.commonAttributes.MK.CA=n.value,this.modifyAttributesChanges(["MK","CA"],n.value)}measureOutputUnitName;measureOutputRatio=1;checkableOptions=[];predefinedCalculationOptions=[];selectedImagePathMap={4:"check",l:"circle",8:"cross",u:"diamond",n:"square",H:"star"};get selectedPredefinedCalculation(){return this.predefinedCalculationOptions.find(n=>n.value===this.currentPredefinedCalculation)}set selectedPredefinedCalculation(n){this.currentPredefinedCalculation=n.value}currentPredefinedCalculation;acroFieldList=[];tempAcroFieldList=[];tempAcroFieldListFilter="";get filteredTempAcroFieldList(){return this.tempAcroFieldList.filter(({T:n})=>n.includes(this.tempAcroFieldListFilter))}fieldSelectStatus=Ai.CLOSE;customScript=T.EMPTY_STRING;isSmallWidthScreen=Ve.isSmallWidth();opacityAsPercentageFormControl=new tt;stringStrokeWidthFormControl=new tt;annotTitleFormControl=new tt;annotPropertyOptionFormControl=new tt;annotPositionXFormControl=new tt;annotPositionYFormControl=new tt;annotWidthFormControl=new tt;annotHeightFormControl=new tt;measureLengthFormControl=new tt;measureExtendFormControl=new tt;overlayTextFormControl=new tt;unalignableFilters=[A.isTextMarkup];unadjustableFilters=[A.isTextMarkup,A.isLine,A.isPolyLine,A.isPolygon,A.isPolygonCloud,A.isFreeTextCallout,A.isText];optionalAttributeMap={Square:{borderStyle:{style:"solid",dashPattern:void 0},InteriorColor:null},Circle:{borderStyle:{style:"solid",dashPattern:void 0},InteriorColor:null},Line:{borderStyle:{style:"solid",dashPattern:void 0},LE:["None","None"],InteriorColor:null},Polygon:{borderStyle:{style:"solid",dashPattern:void 0},InteriorColor:null},PolyLine:{borderStyle:{style:"solid",dashPattern:void 0},LE:["None","None"],InteriorColor:null},FreeText:{borderStyle:{style:"solid",dashPattern:void 0},color:null},FreeTextCallout:{borderStyle:{style:"solid",dashPattern:void 0},color:null,LE:["None"]},Widget:{MK:{borderColor:null,backgroundColor:null},Parent:{V:"",AA:{C:{S:null}}},width:void 0}};commonAttributes={};attributeProxyMapper=null;_calculationCategory;actionOptions=[];actionTriggerMap=new Map;selectedActionTrigger=null;selectedActionIndex=null;actionTriggerFormControl=new tt;pdfPages=[];selectedAnnotTool=null;get selectedAnnotToolName(){if(this.selectedComps.length>0){let n=this.selectedComps[this.selectedComps.length-1];if(A.isWidget(n.data)&&n.acroField)return vo[n.acroField.FT];if(!A.isWidget(n.data))return n.data.IT?vo[n.data.IT]:vo[n.data.type]}return this.selectedAnnotTool?zs[this.selectedAnnotTool]:"ANNOTATION_PROPERTIES"}get firstSelectedAnnot(){return this.selectedComps.length===0||this.selectedComps.length>1?null:this.selectedComps[0].data}get selectedAnnotToolUseDefaultConfig(){return T.isDefined(this.firstSelectedAnnot)?this.useDefaultProperties[this.firstSelectedAnnot.type]??!1:!1}get selectedComps(){return this.selectionInfo?.selectedComps??[]}get annotTitle(){return this.commonAttributes.Parent?.hasOwnProperty("T")?this.commonAttributes.Parent.T:(this.commonAttributes.T===void 0&&(this.commonAttributes.T=""),this.commonAttributes.T)}get selectedStartLinecap(){return this.startLinecapOptions.find(n=>n.value===this.startLinecap)}set selectedStartLinecap(n){this.startLinecap=n.value}get startLinecap(){return this.commonAttributes.LE===void 0&&(this.commonAttributes.LE=[]),this.commonAttributes.LE[0]}set startLinecap(n){this.commonAttributes.LE===void 0&&(this.commonAttributes.LE=[]),this.commonAttributes.LE[0]=n,this.modifyAttributesChanges(["LE"],this.commonAttributes.LE)}get selectedEndLinecap(){return this.endLinecapOptions.find(n=>n.value===this.endLinecap)}set selectedEndLinecap(n){this.endLinecap=n.value}get endLinecap(){return this.commonAttributes.LE===void 0&&(this.commonAttributes.LE=[]),this.commonAttributes.LE[1]}set endLinecap(n){this.commonAttributes.LE===void 0&&(this.commonAttributes.LE=[]),this.commonAttributes.LE[1]=n,this.modifyAttributesChanges(["LE"],this.commonAttributes.LE)}get readOnly(){return this.commonAttributes.Parent.Ff===void 0&&(this.commonAttributes.Parent.Ff=0),st.get(this.commonAttributes.Parent.Ff,0)}set readOnly(n){this.commonAttributes.Parent.Ff=st.set(this.commonAttributes.Parent.Ff,0,n),this.commonAttributes.Ff!==void 0&&(this.commonAttributes.Ff=this.commonAttributes.Parent.Ff,this.modifyAttributesChanges(["Ff"],{bitIndex:0,set:n})),this.modifyFieldsChanges(["Ff"],{bitIndex:0,set:n})}get required(){return this.commonAttributes.Parent.Ff===void 0&&(this.commonAttributes.Parent.Ff=0),st.get(this.commonAttributes.Parent.Ff,1)}set required(n){this.commonAttributes.Parent.Ff=st.set(this.commonAttributes.Parent.Ff,1,n),this.commonAttributes.Ff!==void 0&&(this.commonAttributes.Ff=this.commonAttributes.Parent.Ff,this.modifyAttributesChanges(["Ff"],{bitIndex:1,set:n})),this.modifyFieldsChanges(["Ff"],{bitIndex:1,set:n})}get multiline(){return this.commonAttributes.Parent.Ff===void 0&&(this.commonAttributes.Parent.Ff=0),st.get(this.commonAttributes.Parent.Ff,12)}set multiline(n){this.commonAttributes.Parent.Ff=st.set(this.commonAttributes.Parent.Ff,12,n),this.commonAttributes.Ff!==void 0&&(this.commonAttributes.Ff=this.commonAttributes.Parent.Ff,this.modifyAttributesChanges(["Ff"],{bitIndex:12,set:n})),this.modifyFieldsChanges(["Ff"],{bitIndex:12,set:n})}get lock(){return this.commonAttributes.F===void 0&&(this.commonAttributes.F=0),st.get(this.commonAttributes.F,7)}set lock(n){this.commonAttributes.F=st.set(this.commonAttributes.F??-1,7,n),this.modifyAttributesChanges(["F"],{bitIndex:7,set:n})}get activatedColorTabColor(){switch(this.selectedColorTabColor){case Dt.FILL_COLOR:return this.fillColor;case Dt.STROKE_COLOR:return this.strokeColor;case Dt.COVER_LINE_COLOR:return this.coverLineColor;default:return null}}set activatedColorTabColor(n){switch(this.selectedColorTabColor){case Dt.FILL_COLOR:this.fillColor=n;break;case Dt.STROKE_COLOR:this.strokeColor=n;break;case Dt.COVER_LINE_COLOR:this.coverLineColor=n;break;default:break}}get fillColor(){return this.commonAttributes.FillColor===void 0&&(this.commonAttributes.FillColor="#ffffff"),this.commonAttributes.FillColor}set fillColor(n){this.commonAttributes.FillColor=n,this.modifyAttributesChanges(["FillColor"],this.commonAttributes.FillColor)}get isRedact(){return this.selectedAnnotToolName===zs[V.REDACTION]||this.selectedAnnotToolName===vo.Redact}get fillColorTitle(){return this.isRedact?"REDACTED_AREA_FILL":"FILL"}get strokeColor(){return this.commonAttributes.StrokeColor===void 0&&(this.commonAttributes.StrokeColor="#ffffff"),this.commonAttributes.StrokeColor}set strokeColor(n){n===null?this.strokeWidth=null:(Number.isNaN(Number(this.strokeWidth))||this.strokeWidth!==null&&this.strokeWidth<=0)&&(this.strokeWidth=1),this.commonAttributes.StrokeColor=n,this.modifyAttributesChanges(["StrokeColor"],this.commonAttributes.StrokeColor)}get strokeColorTitle(){return this.selectedAnnotToolName===zs[V.REDACTION]||this.selectedAnnotToolName===vo.Redact?"REDACTION_OUTLINE":"STROKE"}get coverLineColor(){return this.commonAttributes.CoverLineColor??null}set coverLineColor(n){this.coverLineWidth=T.isDefined(n)?2:void 0,this.commonAttributes.CoverLineColor=n??void 0,this.modifyAttributesChanges(["CoverLineColor"],this.commonAttributes.CoverLineColor)}set coverLineWidth(n){this.commonAttributes.CoverLineWidth=n,this.modifyAttributesChanges(["CoverLineWidth"],this.commonAttributes.CoverLineWidth)}get isNullableStrokePalette(){return this.selectedColorTabColor===Dt.STROKE_COLOR?this.isCommonFieldAttribute(["FT"]):this.selectedColorTabColor===Dt.FILL_COLOR?!this.isRedact&&this.isCommonAnnotAttribute(["StrokeColor"]):!0}get overlayText(){return this.commonAttributes.overlayText}set overlayText(n){this.commonAttributes.overlayText=n,this.modifyAttributesChanges(["overlayText"],this.commonAttributes.overlayText)}get opacity(){return this.commonAttributes.opacity}set opacity(n){this.commonAttributes.opacity=n,this.modifyAttributesChanges(["opacity"],this.commonAttributes.opacity),this.opacityAsPercentageFormControl.setValue(this.opacityAsPercentage)}get opacityAsPercentage(){return`${this.opacity&&Math.floor(this.opacity*100)}`}set opacityAsPercentage(n){let i=Number.parseInt(n);if(Number.isNaN(i)){this.opacityAsPercentageFormControl.setValue(this.opacityAsPercentage);return}this.opacity=Math.min(Math.max(i/100,0),1)}get setClassOfMiddleBorder(){return{"left-tab":this.activatedTabKey==="GENERAL","right-tab":this.activatedTabKey==="ATTRIBUTES"}}get selectedBorderStyle(){return this.borderStyleOptions.find(n=>{let i=n.value.style===this.borderStyle.style,e=n.value.dashPattern,t=this.borderStyle.dashPattern;if(i){if(Array.isArray(e)&&Array.isArray(t))return e.every((o,s)=>o===t[s]);if(!Array.isArray(e)&&!Array.isArray(t))return!0}return!1})}set selectedBorderStyle(n){this.borderStyle=n.value}get borderStyle(){return this.commonAttributes.borderStyle===void 0&&(this.commonAttributes.borderStyle={style:"solid",dashPattern:[]}),this.commonAttributes.borderStyle}set borderStyle(n){this.commonAttributes.borderStyle===void 0&&(this.commonAttributes.borderStyle={style:"solid",dashPattern:[]}),this.commonAttributes.borderStyle.style=n.style,this.commonAttributes.borderStyle.dashPattern=n.dashPattern,this.modifyAttributesChanges(["borderStyle"],this.commonAttributes.borderStyle)}get strokeWidth(){return T.isDefined(this.commonAttributes.width)?this.commonAttributes.width:null}set strokeWidth(n){this.commonAttributes.width=n??void 0,this.modifyAttributesChanges(["width"],this.commonAttributes.width),this.stringStrokeWidthFormControl.setValue(this.commonAttributes.width??null)}get stringStrokeWidth(){return`${this.commonAttributes.width}`}set stringStrokeWidth(n){let i=Number.parseInt(n);if(Number.isNaN(i)){this.stringStrokeWidthFormControl.setValue(this.strokeWidth);return}this.strokeWidth=Math.min(Math.max(i,this.MinimumStrokeWidth),this.maximumStrokeWidth)}get caption(){return this.commonAttributes.MK===void 0&&(this.commonAttributes.MK={CA:""}),this.commonAttributes.MK.CA===void 0&&(this.commonAttributes.MK.CA=""),this.commonAttributes.MK.CA}set caption(n){this.commonAttributes.MK===void 0&&(this.commonAttributes.MK={CA:""}),this.commonAttributes.MK.CA===void 0&&(this.commonAttributes.MK.CA=""),this.commonAttributes.MK.CA=n,this.modifyAttributesChanges(["MK","CA"],this.commonAttributes.MK.CA)}get selectedFontSize(){let n=F.fontsizeOptions.find(i=>i.value===this.fontSize);return T.isDefined(n)?n:T.isDefined(this.customFontSizeOption)&&this.customFontSizeOption.value===this.fontSize?this.customFontSizeOption:T.isDefined(this.fontSize)?(this.customFontSizeOption={label:this.fontSize.toString(),value:this.fontSize},this.customFontSizeOption):null}set selectedFontSize(n){let i=Number(n.value);Number.isNaN(i)||(this.fontSize=i)}get fontSize(){return this.commonAttributes.FontSize===void 0&&(this.commonAttributes.FontSize=null),this.commonAttributes.FontSize}set fontSize(n){this.commonAttributes.fontSize=n,this.modifyAttributesChanges(["FontSize"],this.commonAttributes.fontSize)}get selectedFont(){return this.fontOptions.find(n=>n.value===this.fontName)}set selectedFont(n){this.fontName=n.value}get fontName(){return this.commonAttributes.FontName===void 0&&(this.commonAttributes.FontName=null),this.commonAttributes.FontName}set fontName(n){this.commonAttributes.fontName=n,this.modifyAttributesChanges(["FontName"],this.commonAttributes.fontName)}get activatedFontTabColor(){switch(this.selectedFontTabColor){case Yi.FONT_COLOR:return this.fontColor;default:return null}}set activatedFontTabColor(n){switch(this.selectedFontTabColor){case Yi.FONT_COLOR:this.fontColor=n;break;default:break}}get fontColor(){return this.commonAttributes.FontColor===void 0&&(this.commonAttributes.FontColor="#ffffff"),this.commonAttributes.FontColor}set fontColor(n){this.commonAttributes.FontColor=n,this.modifyAttributesChanges(["FontColor"],this.commonAttributes.FontColor)}get measureLength(){return this.commonAttributes.LL===void 0&&(this.commonAttributes.LL=0),this.commonAttributes.LL}set measureLength(n){this.resizeLeaderLine("LL",n)}get measureExtend(){return this.commonAttributes.LLE===void 0&&(this.commonAttributes.LLE=0),this.commonAttributes.LLE}set measureExtend(n){this.resizeLeaderLine("LLE",n)}get widthAsLocaleUnit(){if(!this.commonAttributes.rect)return 0;let n=this.selectedComps[0].data.attributes.rect.right-this.selectedComps[0].data.attributes.rect.left;if(this.isCommonSize(n,void 0))return this.unitPipe.isRegionUS()?this.unitPipe.convertToImperial(q.POINT,n):Ye.convert(q.POINT,q.MILLIMETER,n)}set widthAsLocaleUnit(n){let i;this.unitPipe.isRegionUS()?i=Ye.convert(fn[q.MILLIMETER],q.POINT,n):i=Ye.convert(q.MILLIMETER,q.POINT,n),this.selectedComps.forEach(e=>{this.resizeRect(e.data,i,void 0),this.annotService.dispatchModify(e.data)})}get heightAsLocaleUnit(){if(!this.commonAttributes.rect)return 0;let n=this.selectedComps[0].data.attributes.rect.top-this.selectedComps[0].data.attributes.rect.bottom;if(this.isCommonSize(void 0,n))return this.unitPipe.isRegionUS()?this.unitPipe.convertToImperial(q.POINT,n):Ye.convert(q.POINT,q.MILLIMETER,n)}set heightAsLocaleUnit(n){let i;this.unitPipe.isRegionUS()?i=Ye.convert(fn[q.MILLIMETER],q.POINT,n):i=Ye.convert(q.MILLIMETER,q.POINT,n),this.selectedComps.forEach(e=>{this.resizeRect(e.data,void 0,i),this.annotService.dispatchModify(e.data)})}get xAsLocaleUnit(){return this.commonAttributes.rect?this.unitPipe.isRegionUS()?this.unitPipe.convertToImperial(q.POINT,this.commonAttributes.rect.left):Ye.convert(q.POINT,q.MILLIMETER,this.commonAttributes.rect.left):0}set xAsLocaleUnit(n){let i;this.unitPipe.isRegionUS()?i=Ye.convert(fn[q.MILLIMETER],q.POINT,n):i=Ye.convert(q.MILLIMETER,q.POINT,n),this.selectedComps.forEach(e=>{this.annotService.moveAnnotRectAbsolutely(e,Number(i.toFixed(3)),void 0,void 0,this.commonAttributes),this.changeDetectorRef.detectChanges(),this.annotService.dispatchModify(e.data)})}get yAsLocaleUnit(){return this.commonAttributes.rect?this.unitPipe.isRegionUS()?this.unitPipe.convertToImperial(q.POINT,this.commonAttributes.rect.bottom):Ye.convert(q.POINT,q.MILLIMETER,this.commonAttributes.rect.bottom):0}set yAsLocaleUnit(n){let i;this.unitPipe.isRegionUS()?i=Ye.convert(fn[q.MILLIMETER],q.POINT,n):i=Ye.convert(q.MILLIMETER,q.POINT,n),this.selectedComps.forEach(e=>{this.annotService.moveAnnotRectAbsolutely(e,void 0,Number(i.toFixed(3)),void 0,this.commonAttributes),this.changeDetectorRef.detectChanges(),this.annotService.dispatchModify(e.data)})}get textAlign(){return this.commonAttributes.alignment}set textAlign(n){this.commonAttributes.alignment=n,this.modifyAttributesChanges(["alignment"],this.commonAttributes.alignment)}get AP_N_exportValue(){let n="";return this.commonAttributes.AP_N===void 0||this.commonAttributes.AP_N.forEach(i=>{i.toLowerCase()!=="off"&&(n=i)}),n}set AP_N_exportValue(n){T.isDefined(this.commonAttributes.AP_N)||(this.commonAttributes.AP_N=[]),this.commonAttributes.AP_N[this.commonAttributes.AP_N[0].toLowerCase()==="off"?1:0]=n,this.modifyAttributesChanges(["AP_N"],this.commonAttributes.AP_N)}get opt(){return this.commonAttributes.Parent.Opt}set opt(n){this.commonAttributes.Parent.Opt=n,this.modifyFieldsChanges(["Opt"],this.commonAttributes.Parent.Opt)}get additionalActionCalculate(){return this.commonAttributes.Parent.AA.C}set additionalActionCalculate(n){this.commonAttributes.Parent.AA.C=n,this.modifyFieldsChanges(["AA","C"],this.commonAttributes.Parent.AA.C)}get calculationCategory(){return this._calculationCategory??"none"}set calculationCategory(n){switch(n){case"none":this.additionalActionCalculate=null;break;case"predefined":let i=this.acroFieldList.filter(e=>e.checked).map(e=>`"${e.T}"`).join(",");this.additionalActionCalculate={S:"JavaScript",JS:`AFSimple_Calculate("${this.currentPredefinedCalculation}", new Array(${i}));`};break;case"custom":this.additionalActionCalculate={S:"JavaScript",JS:this.customScript};break;default:break}this._calculationCategory=n,this._calculationCategory!=="none"&&this.scriptService.executeAll(this.acroFormService.acroFields)}get isSelectedNothing(){return this.annotSelectedService.length===0}commonRectChanges=new pt;commonMeasureChanges=new pt;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get transparentBackground(){return F.getTransparentBackground()}constructor(n,i,e,t,o,s,c,u,C,x,N,D,X,Q,ft,di,cn){this.contentService=n,this.changeDetectorRef=i,this.acroFormService=e,this.annotService=t,this.annotSelectedService=o,this.toastService=s,this.pageService=c,this.scriptService=u,this.subscriptionService=C,this.modalService=x,this.store$=N,this.translatePipe=D,this.unitPipe=X,this.defaultAnnotService=Q,this.redactionService=ft,this.localStorageService=di,this.loggingService=cn,this.tabLabels=Object.freeze({GENERAL:this.translatePipe.transform("GENERAL"),ATTRIBUTES:this.translatePipe.transform("ATTRIBUTES")}),this.checkableOptions=[{label:this.translatePipe.transform("CHECKABLE_CHECK"),value:"4"},{label:this.translatePipe.transform("CHECKABLE_CIRCLE"),value:"l"},{label:this.translatePipe.transform("CHECKABLE_CROSS"),value:"8"},{label:this.translatePipe.transform("CHECKABLE_DIAMOND"),value:"u"},{label:this.translatePipe.transform("CHECKABLE_SQUARE"),value:"n"},{label:this.translatePipe.transform("CHECKABLE_STAR"),value:"H"}],this.predefinedCalculationOptions=[{label:this.translatePipe.transform("CALCULATION_SUM"),value:"SUM"},{label:this.translatePipe.transform("CALCULATION_PRODUCT"),value:"PRD"},{label:this.translatePipe.transform("CALCULATION_AVERAGE"),value:"AVG"},{label:this.translatePipe.transform("CALCULATION_MINIMUM"),value:"MIN"},{label:this.translatePipe.transform("CALCULATION_MAXIMUM"),value:"MAX"}],this.actionOptions=[{label:this.translatePipe.transform("EXECUTE_JAVASCRIPT"),value:"JavaScript"}],this.currentPredefinedCalculation=this.predefinedCalculationOptions[0].value,this.useDefaultProperties=JSON.parse(this.localStorageService.get("SD_AnnotUseDefaultProperties","{}"))}ngOnInit(){this.attributeProxyMapper=new Dr,this.initDropdownOptions(),this.initSubscriptions(),this.initMeasureUnits()}ngOnDestroy(){this.attributeProxyMapper=null,this.redactionService.publishRedactionPreview(!1)}onCloseButtonClick(){this.store$.dispatch(wt.set({key:"rightSideViewVisible",value:!1}))}someAnnotsLocked(){return this.annotSelectedService.selectedComponents.some(n=>st.get(n.data.attributes.F??-1,7))}onColorTabColorClick(n){this.someAnnotsLocked()||(this.selectedColorTabColor=this.selectedColorTabColor===n?null:n)}onFontTabColorClick(n){this.someAnnotsLocked()||(this.selectedFontTabColor=this.selectedFontTabColor===n?null:n)}isFormField(){return this.commonAttributes.Parent}isTextField(){return this.isFormField()&&this.commonAttributes.Parent.FT==="Tx"}isRadioButton(){return this.isFormField()&&this.commonAttributes.Parent.FT==="Rb"}isComboBox(){return this.isFormField()&&this.commonAttributes.Parent.FT==="Cx"}isPushButton(){return this.isFormField()&&this.commonAttributes.Parent.FT==="Btn"}includeInk(){return this.selectedComps.some(n=>A.isInk(n.data))}includeRedaction(){return this.selectedComps.some(n=>A.isRedact(n.data))}includeFreeTextCallout(){return this.annotSelectedService.selectedComponents.some(n=>A.isFreeTextCallout(n.data))}includeSignature(){return this.annotSelectedService.selectedComponents.some(n=>A.isSignatureWidget(n.data,this.acroFormService.acroFields||{}))}includePolygonCloud(){return this.annotSelectedService.selectedComponents.some(n=>A.isPolygonCloud(n.data))}isAvailableTab(n){switch(n){case"GENERAL":return!0;case"ATTRIBUTES":return K.get(B.ANNOT_PROPERTY_VIEW_ATTRIBUTES)&&!this.annotSelectedService.selectedComponents.some(i=>!A.isWidget(i.data)||A.isSignatureWidget(i.data,this.acroFormService.acroFields));default:return!1}}tabBottomBorderWidth(n){return this.activatedTabKey===n?"0":"calc(50% - 2px)"}setSelection(n){let i=this.commonAttributes.Parent.Opt.length-1,e=i<n?i:n;this.commonAttributes.Parent.V=this.getVfromOpt(this.opt[e]),this.modifyFieldsChanges(["V"],this.commonAttributes.Parent.V),this.commonAttributes.Parent.I=[e],this.modifyFieldsChanges(["I"],this.commonAttributes.Parent.I)}getVfromOpt(n){return typeof n=="string"?n:n?n[0]:null}isCommonAnnotAttribute(n){let i=this.commonAttributes;return n.every(e=>Se.hasKey(i,e)?(i=i[e],!0):!1)}getTextAlignButtonColor(n){return n===this.textAlign?"white":"dark"}isCheckable(){return this.commonAttributes.Parent&&(this.commonAttributes.Parent.FT==="Rb"||this.commonAttributes.Parent.FT==="Cb")}isCommonFieldAttribute(n){let i=["Parent"].concat(n);return this.isCommonAnnotAttribute(i)}isAlignable(){return this.selectedComps.every(n=>this.unalignableFilters.every(i=>!i(n.data))&&!n.data.attributes.quadPoints&&(A.isWidget(n.data)&&K.get(a.FORM_MOVE)||!A.isWidget(n.data)&&K.get(a.MOVE_ANNOTATION)))}isAdjustable(){return this.selectedComps.every(n=>this.unadjustableFilters.every(i=>!i(n.data))&&!n.data.attributes.quadPoints&&(A.isWidget(n.data)&&K.get(a.FORM_RESIZE)||!A.isWidget(n.data)&&K.get(a.RESIZE_ANNOTATION)))}get Measure(){return this.commonAttributes.Measure}set Measure(n){this.commonAttributes.Measure=n,this.modifyAttributesChanges(["Measure"],this.commonAttributes.Measure)}preventDragging(n){n.stopPropagation()}align(n){let i=1/0,e=-1/0,t=1/0,o=-1/0;this.selectedComps.forEach(s=>{let c=s.data.attributes.rect;i=Math.min(i,c.left),e=Math.max(e,c.right),t=Math.min(t,c.bottom),o=Math.max(o,c.top)}),this.selectedComps.forEach(s=>{let c=s.data.attributes.rect;switch(n){case Sn.HORIZONTAL_LEFT:this.moveRect(s.data,i-c.left,0);break;case Sn.HORIZONTAL_CENTER:this.moveRect(s.data,(e+i)/2-(c.right+c.left)/2,0);break;case Sn.HORIZONTAL_RIGHT:this.moveRect(s.data,e-c.right,0);break;case Sn.VERTICAL_TOP:this.moveRect(s.data,0,o-c.top);break;case Sn.VERTICAL_CENTER:this.moveRect(s.data,0,(o+t)/2-(c.top+c.bottom)/2);break;case Sn.VERTICAL_BOTTOM:this.moveRect(s.data,0,t-c.bottom);break;default:break}this.annotService.dispatchModify(s.data)})}onChangeMeasure(){this.measureOutputRatio.toString()===""&&(this.measureOutputRatio=0),this.measureInputRatio.toString()===""&&(this.measureInputRatio=0);let n=this.Measure;if(!T.isDefined(n)||!T.isDefined(n.X))throw new wi("Cannot change measure. No measure or measure.X is not defined.");n.X[0].C=Ye.convert(q.POINT,this.measureInputUnitKey,this.measureOutputRatio/this.measureInputRatio),n.X[0].U=this.measureOutputUnitName,n.R=`${this.measureInputRatio} ${this.measureInputUnitKey} = ${this.measureOutputRatio} ${this.measureOutputUnitName}`,this.Measure=n}get isDefaultProperty(){return this.selectionInfo.selectedComps.length===1&&this.selectionInfo.selectedComps[0].data.oid===null}updatePredefinedCalculation(){this.calculationCategory="predefined"}openCustomScriptDialog(){this.modalService.createModal(Vi,this.customScript).addOnDisposeListener(n=>{T.isDefined(n)&&this.confirmCustomScriptChange(Yn.CALCULATION,n)})}updateAnnotTitle(){let n=this.annotTitleFormControl.value;if(this.commonAttributes.Parent?.hasOwnProperty("T")){if(this.commonAttributes.Parent.T===n)return;this.commonAttributes.Parent.T=n,this.modifyFieldsChanges(["T"],this.commonAttributes.Parent.T)}else{if(this.commonAttributes.T===n)return;this.commonAttributes.T=n,this.modifyAttributesChanges(["T"],this.commonAttributes.T)}}isAllFieldSelected(){return this.filteredTempAcroFieldList.length>0&&this.filteredTempAcroFieldList.every(n=>n.checked)}selectAllField(){this.filteredTempAcroFieldList.forEach(n=>n.checked=!0)}deselectAllField(){this.tempAcroFieldList.forEach(n=>n.checked=!1)}confirmFieldSelectChange(){this.acroFieldList=this.tempAcroFieldList,this.calculationCategory="predefined",this.toastService.create({toastStyle:Ot.SUCCESS,content:this.translatePipe.transform("APPLY_CALCULATION_SUCCESSFULLY")})}confirmCustomScriptChange(n,i){switch(n){case Yn.CALCULATION:this.customScript=i,this.calculationCategory="custom";break;case Yn.ACTION:this.selectedActionTrigger==="U"&&(this.commonAttributes.type="JavaScript",this.modifyAttributesChanges(["type"],this.commonAttributes.type),this.commonAttributes.JS=i,this.modifyAttributesChanges(["JS"],this.commonAttributes.JS),this.initAction());break;default:break}}checkablePreviewStyle(){let n=this.getIsCheckBox()?"assets/images/checkbox":"assets/images/radio";return{"background-image":this.selectedCheckableOption?`url(${n}/${this.selectedImagePathMap[this.selectedCheckableOption.value]}.svg)`:null}}onEditActionClick(){if(!T.isDefined(this.selectedActionTrigger)||!T.isDefined(this.selectedActionIndex)||!T.isDefined(this.actionTriggerMap.get(this.selectedActionTrigger))){this.loggingService.common("debug",le.NOT_EXIST,"action trigger");return}this.modalService.createModal(Vi,this.actionTriggerMap.get(this.selectedActionTrigger)[this.selectedActionIndex]).addOnDisposeListener(n=>{T.isDefined(n)&&this.confirmCustomScriptChange(Yn.ACTION,n)})}onRemoveActionClick(){this.selectedActionTrigger==="U"&&(this.commonAttributes.JS=null,this.modifyAttributesChanges(["JS"],this.commonAttributes.JS),this.commonAttributes.type=null,this.modifyAttributesChanges(["type"],this.commonAttributes.type)),this.initAction()}onAddActionClick(n){if(n.stopPropagation(),!this.selectedActionTrigger){this.toastService.create({toastStyle:Ot.NOTIFICATION,content:this.translatePipe.transform("SELECT_TRIGGER")});return}let i=this.actionTriggerMap.get(this.selectedActionTrigger);if(T.isDefined(i)&&i.length>0){this.toastService.create({toastStyle:Ot.NOTIFICATION,content:this.translatePipe.transform("ONLY_ONE_ACTION_IN_ONE_TRIGGER")});return}switch(this.actionTriggerFormControl.value.value){case"JavaScript":this.modalService.createModal(Vi,T.EMPTY_STRING).addOnDisposeListener(e=>{T.isDefined(e)&&this.confirmCustomScriptChange(Yn.ACTION,e)});break;default:break}}toggleFieldSelectListExpend(){this.fieldSelectStatus=this.fieldSelectStatus===Ai.CLOSE?Ai.OPEN:Ai.CLOSE}isSelectedCalFields(){return this.tempAcroFieldList.some(n=>n.checked)}getSelectCalFieldListClass(){return`papycon-chevron2-${this.fieldSelectStatus===Ai.OPEN?"up":"down"}`}fixRange(n,i=-1/0,e=1/0){return Math.min(Math.max(n,i),e)}isNaN(n){return Number.isNaN(n)}getIsCheckBox(){return this.selectedComps.every(n=>A.isCheckBox(n.data,this.acroFormService.acroFields))}moveRect(n,i,e){let t=n.attributes.rect;if(t.left+=i,t.right+=i,t.bottom+=e,t.top+=e,A.isInk(n)&&n.attributes.inkList.forEach(o=>{o.forEach(s=>{s.x+=i,s.y+=e})}),(A.isPolygon(n)||A.isPolygonCloud(n)||A.isPolyLine(n))&&n.attributes.vertices.forEach(o=>{o.x+=i,o.y+=e}),A.isFreeTextCallout(n)){if(!T.isDefined(n.attributes.textRect)||!T.isDefined(n.attributes.vertices))throw new Nt("Failed to get data for free text callout.");let{textRect:o,vertices:s}=n.attributes;o.left+=i,o.right+=i,o.bottom+=e,o.top+=e,s.forEach(c=>{c.x+=i,c.y+=e})}if(A.isLine(n)){let{coordinates:o}=n.attributes;o.sp.x+=i,o.sp.y+=e,o.ep.x+=i,o.ep.y+=e}}resizeRect(n,i,e,t){let o=n.attributes.rect,s=this.pdfPages[n.attributes.pageIdx],c=1,u=1;if(i!==void 0){let C=i;C<Fe.annotation.resizeLimit.width&&(C=Fe.annotation.resizeLimit.width),!t&&C>s.bbox.w-(o.left-s.bbox.x)&&(C=s.bbox.w-(o.left-s.bbox.x)),c=C/(o.right-o.left),o.right=o.left+C}if(e!==void 0){let C=e;C<Fe.annotation.resizeLimit.height&&(C=Fe.annotation.resizeLimit.height),!t&&C>s.bbox.h-(o.bottom-s.bbox.y)&&(C=s.bbox.h-(o.bottom-s.bbox.y)),u=C/(o.top-o.bottom),o.top=o.bottom+C}if(A.isInk(n)){let{inkList:C}=n.attributes;C.forEach(x=>{x.forEach(N=>{c&&(N.x=(N.x-o.left)*c+o.left),u&&(N.y=(N.y-o.bottom)*u+o.bottom)})})}}initMeasureUnits(){let n={[q.POINT]:"UNIT_POINT",[q.INCH]:"UNIT_INCH",[q.MILLIMETER]:"UNIT_MILLIMETER",[q.CENTIMETER]:"UNIT_CENTIMETER",[q.PICA]:"UNIT_PICA"},i={[q.POINT]:"UNIT_POINT",[q.INCH]:"UNIT_INCH",[q.MILLIMETER]:"UNIT_MILLIMETER",[q.CENTIMETER]:"UNIT_CENTIMETER",[q.PICA]:"UNIT_PICA",[q.FEET]:"UNIT_FEET",[q.YARD]:"UNIT_YARD",[q.METER]:"UNIT_METER",[q.KILOMETER]:"UNIT_KILOMETER",[q.MILE]:"UNIT_MILE"};Object.keys(n).forEach(e=>{this.measureInputUnitOpts.push({label:e,value:e})}),Object.keys(i).forEach(e=>{this.measureOutputUnitOpts.push({label:e,value:e})}),this.setMeasureProperties()}setMeasureProperties(){let n=this.unitPipe.transform(q.MILLIMETER),i=this.measureInputUnitOpts.findIndex(o=>o.value===n),e=this.measureInputUnitOpts.findIndex(o=>o.value===n);if(this.measureInputUnitKey=this.measureInputUnitOpts[i].value,this.measureOutputUnitName=this.measureOutputUnitOpts[e].value,this.measureOutputRatio=1,this.measureInputRatio=this.measureOutputRatio,this.Measure===void 0)return;let t=/([^ ]+) +([^ ]+) += +([^ ]+) +([^ ]+)/.exec(this.Measure.R);t!==null&&(this.measureInputRatio=parseFloat(t[1]),this.measureInputUnitKey=t[2],this.measureOutputRatio=parseFloat(t[3]),this.measureOutputUnitName=t[4])}initDropdownOptions(){Wt.linecapList.forEach(n=>{[this.startLinecapOptions,this.endLinecapOptions].forEach(i=>{i.push({label:n.label,value:n.value})})}),Wt.borderStyleList.forEach(n=>{this.borderStyleOptions.push({label:n.label,value:n.value})})}initSubscriptions(){this.subscriptionService.push(this.commonRectChanges.pipe($o(),L(([n,i])=>n.left===i.left&&n.bottom===i.bottom&&n.top===i.top&&n.right===i.right),St(n=>n[1]),je(()=>{if(this.changeDetectorRef.markForCheck(),!T.isDefined(this.commonAttributes.rect)){this.loggingService.common("debug",le.NOT_EXIST,"commonAttributes.rect");return}this.commonAttributes.rect.right-=1e-4,this.commonAttributes.rect.top-=1e-4}),Xa(0),je(n=>{if(this.changeDetectorRef.markForCheck(),!T.isDefined(this.commonAttributes.rect)){this.loggingService.common("debug",le.NOT_EXIST,"commonAttributes.rect");return}this.commonAttributes.rect.right=n.right,this.commonAttributes.rect.top=n.top})).subscribe(),this.commonRectChanges.pipe(Bt(),je(()=>{this.annotPositionXFormControl.setValue(this.xAsLocaleUnit,{emitEvent:!1}),this.annotPositionYFormControl.setValue(this.yAsLocaleUnit,{emitEvent:!1}),this.annotWidthFormControl.setValue(this.widthAsLocaleUnit??0,{emitEvent:!1}),this.annotHeightFormControl.setValue(this.heightAsLocaleUnit??0,{emitEvent:!1})})).subscribe(),this.commonMeasureChanges.pipe(Bt(),je(n=>{this.measureLengthFormControl.setValue(n.LL,{emitEvent:!1}),this.measureExtendFormControl.setValue(n.LLE,{emitEvent:!1})})).subscribe(),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>{this.initVariable(),this.update()}}),Xt(this.annotSelectedService.selectionInfo$.pipe(je(n=>this.selectionInfo=n)),this.acroFormService.acroFields$,this.contentService.fieldEvent$,this.contentService.annotEvent$.pipe(L(T.isDefined),L(n=>n?.sdEventType===fe.UPDATE&&n.annot&&this.selectedComps?.findIndex(i=>i.data.oid===n.annot.oid)>-1)),this.contentService.annotListEvent$.pipe(L(T.isDefined),L(n=>n.sdEventType===fe.UPDATE),St(n=>n.annot),L(T.isDefined),L(n=>this.selectedComps.findIndex(i=>i.data.oid===n.oid)>-1))).pipe(ui(0)).subscribe({next:()=>this.update()}),this.redactionService.redactionPreview$.subscribe({next:n=>this.isPreviewRedaction=n}),this.store$.pipe(Xe("screenTheme")).subscribe({next:n=>{this.screenTheme=n,this.isDarkMode&&(this.borderStyleOptions.forEach(i=>{i.label=`${i.label.split(".svg")[0]}-white.svg`}),this.startLinecapOptions.forEach(i=>{i.label=`${i.label.split(".svg")[0]}-white.svg`}),this.endLinecapOptions.forEach(i=>{i.label=`${i.label.split(".svg")[0]}-white.svg`})),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Xe("language")).subscribe({next:n=>{this.language=n}}),this.store$.pipe(Bn()).subscribe({next:n=>{this.selectedAnnotTool=n}}),this.contentService.fontsResponse$.subscribe({next:n=>{this.fontOptions.splice(0),n.fontList.forEach(i=>{this.fontOptions.push({label:i.label[F.LANGUAGE_ID_MAP[this.language]]||i.label[0]||i.name,value:i.name,available:!0})}),this.fontOptions=this.fontOptions.slice().filter(i=>i.available),this.fontOptions=F.generateUnavailableFontOption(this.fontOptions,this.fontName,this.translatePipe),this.changeDetectorRef.markForCheck()}}),this.pageService.pdfPages$.subscribe({next:n=>this.pdfPages=n}),Ve.windowResize$.subscribe({next:()=>{this.isSmallWidthScreen=Ve.isSmallWidth(),this.changeDetectorRef.markForCheck()}}),this.acroFormService.titleRollback$.subscribe({next:n=>{this.commonAttributes.Parent.T=n,this.annotTitleFormControl.setValue(this.commonAttributes.Parent.T,{emitEvent:!1})}}),this.annotPropertyOptionFormControl.valueChanges.subscribe({next:n=>this.opt=n}),this.annotPositionXFormControl.valueChanges.pipe(Bt()).subscribe({next:n=>{this.annotPositionXFormControl.disabled||(this.xAsLocaleUnit=n)}}),this.annotPositionYFormControl.valueChanges.pipe(Bt()).subscribe({next:n=>{this.annotPositionYFormControl.disabled||(this.yAsLocaleUnit=n)}}),this.annotWidthFormControl.valueChanges.pipe(Bt()).subscribe({next:n=>{this.annotWidthFormControl.disabled||(this.widthAsLocaleUnit=n)}}),this.annotHeightFormControl.valueChanges.pipe(Bt()).subscribe({next:n=>{this.annotHeightFormControl.disabled||(this.heightAsLocaleUnit=n)}}),this.measureLengthFormControl.valueChanges.pipe(L(n=>n!==null),Bt()).subscribe({next:n=>this.measureLength=n}),this.measureExtendFormControl.valueChanges.pipe(L(n=>n!==null),Bt()).subscribe({next:n=>this.measureExtend=n}),this.overlayTextFormControl.valueChanges.pipe(L(n=>T.isDefined(n)),Bt(),ui(300)).subscribe({next:n=>this.overlayText=n}))}isCommonSize(n,i){return this.selectedComps.every(e=>(n?(e.data.attributes.rect.right-e.data.attributes.rect.left).toFixed(3)===n.toFixed(3):!0)&&(i?(e.data.attributes.rect.top-e.data.attributes.rect.bottom).toFixed(3)===i.toFixed(3):!0))}update(){this.selectionInfo&&this.acroFormService.isAcroFieldsInitialized()&&(this.changeDetectorRef.markForCheck(),this.isSelectedNothing?this.commonAttributes={}:(this.setMaximumStrokeWidth(),this.findAllCommonAttribute(),this.correctBitMaskAttribute(),this.updateFontSizeOptions(),this.fontOptions=this.fontOptions.filter(n=>n.available),this.fontOptions=F.generateUnavailableFontOption(this.fontOptions,this.fontName,this.translatePipe),this.validateActivatedTab(),this.initAction(),(this.isTextField()||this.isComboBox())&&(this.initAcroFieldList(),this.determineCalculationCategory())),this.tempAcroFieldList=T.deepClone(this.acroFieldList),this.changeDetectorRef.markForCheck(),xi.hasDefinedProp(this.commonAttributes,"rect")&&T.isDefined(this.commonAttributes.rect)&&Object.values(this.commonAttributes.rect).every(n=>!Number.isNaN(n))&&this.commonRectChanges.next(Oe({},this.commonAttributes.rect)),(this.commonAttributes.LL||this.commonAttributes.LLE)&&this.commonMeasureChanges.next({LL:this.commonAttributes.LL??0,LLE:this.commonAttributes.LLE??0}))}setMaximumStrokeWidth(){this.maximumStrokeWidth=this.annotSelectedService.selectedComponents.find(n=>n.data.type==="Line"&&n.data.IT==="LineDimension")?6:12}modifyFieldsChanges(n,i){this.selectedComps.forEach(e=>{let t=this.acroFormService.modifyByAnnot(e.data,n,i);if(n.includes("T")&&(this.annotService.putModel(e.data,"modify"),this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:fe.UPDATE,pageIdx:e.data.attributes.pageIdx,annot:e.data})),!t.isSuccess){t.showToast(this.toastService,this.translatePipe);return}})}modifyAttributesChanges(n,i){let e=(t,o,s)=>{let c=this.annotService.modifyAttribute(t,o,s);if(!c.isSuccess){c.showToast(this.toastService,this.translatePipe);return}};if(this.isDefaultProperty){this.saveDefaultAnnot(n,i);return}T.isDefined(this.firstSelectedAnnot)&&this.selectedAnnotToolUseDefaultConfig&&this.canSaveAnnotProperties(n)&&this.changeUseDefaultProperties(this.firstSelectedAnnot.type,!1),this.selectedComps.forEach(t=>{if(!(Se.hasKey(t.data.attributes,n[0])&&t.data.attributes[n[0]]===i)){if(this.isCheckable()&&(n.find(o=>o==="width"||o==="FillColor"||o==="StrokeColor")||n[0]==="MK"&&n[1]==="CA")){let o=t.data.attributes,s=o.rect.right-o.rect.left,c=o.rect.top-o.rect.bottom,u=(n[0]==="MK"&&n[1]==="CA"?i:o.MK?.CA)||(A.isRadioWidget(t.data,this.acroFormService.acroFields)?"l":"4"),C=n[0]==="FillColor"?i:o.MK?.backgroundColor,x=n[0]==="StrokeColor"?i:o.MK?.borderColor,N=n[0]==="width"?i:o.width;$a(ws.imageToDataURI(Us[this.getIsCheckBox()?"Cb":"Rb"][u],s,c,C,x,N),ws.imageToDataURI(Us[this.getIsCheckBox()?"Cb":"Rb"].unchecked,s,c,C,x,N)).subscribe({next:D=>{let X=[{data:D[1].replace("data:image/png;base64,",""),format:"png",state:"Off",type:"image",scaleType:"stretch"},{data:D[0].replace("data:image/png;base64,",""),format:"png",state:o.appearance?.find(Q=>Q.state!=="Off")?.state,type:"image",scaleType:"stretch"}];e(t.data,["appearance"],X)}})}e(t.data,n,i)}})}isSameValueArray(n,i){return Array.isArray(n)&&Array.isArray(i)&&n.length===i.length&&n.every((e,t)=>e!==i[t])}restoreOptionalAttributeAndParent(n){let i=T.deepClone(n);return A.isWidget(i)&&i.attributes.Parent&&typeof i.attributes.Parent=="number"&&this.acroFormService.getAcroField(i.attributes.Parent)&&(i.attributes.Parent=this.acroFormService.getAcroField(i.attributes.Parent)),T.isDefined(n.IT)&&Se.hasKey(this.optionalAttributeMap,n.IT)?i.attributes=(0,Hs.default)(this.optionalAttributeMap[n.IT],i.attributes,{arrayMerge:(e,t)=>t}):Se.hasKey(this.optionalAttributeMap,n.type)&&(i.attributes=(0,Hs.default)(this.optionalAttributeMap[n.type],i.attributes,{arrayMerge:(e,t)=>t})),A.isSignatureWidget(i,this.acroFormService.acroFields)&&(i.attributes.Parent.Ff=i.attributes.Ff),i}findAllCommonAttribute(){this.commonAttributes={};let n=this.selectedComps[0],i=this.selectedComps.slice(1),e=this.restoreOptionalAttributeAndParent(n.data);for(let t of Se.keys(e.attributes)){let o=i.map(s=>this.restoreOptionalAttributeAndParent(s.data));this.findCommonValue(e.type,[],t,e.attributes,o)}this.annotTitleFormControl.setValue(this.annotTitle),this.opacityAsPercentageFormControl.setValue(this.opacityAsPercentage),this.stringStrokeWidthFormControl.setValue(this.commonAttributes.width??null),this.actionTriggerFormControl.setValue(this.actionOptions[0]),this.overlayTextFormControl.setValue(this.overlayText),this.overlayText||this.overlayTextFormControl.disable(),this.commonAttributes.Parent?.Opt&&this.annotPropertyOptionFormControl.setValue(this.commonAttributes.Parent.Opt,{emitEvent:!1}),this.someAnnotsLocked()||!this.isAlignable()||this.isSelectedNothing?(this.annotPositionXFormControl.disable({emitEvent:!1}),this.annotPositionYFormControl.disable({emitEvent:!1})):(this.annotPositionXFormControl.enable({emitEvent:!1}),this.annotPositionYFormControl.enable({emitEvent:!1})),this.someAnnotsLocked()||!this.isAdjustable()||this.isSelectedNothing?(this.annotWidthFormControl.disable({emitEvent:!1}),this.annotHeightFormControl.disable({emitEvent:!1})):(this.annotWidthFormControl.enable({emitEvent:!1}),this.annotHeightFormControl.enable({emitEvent:!1})),this.someAnnotsLocked()?(this.annotTitleFormControl.disable(),this.opacityAsPercentageFormControl.disable(),this.stringStrokeWidthFormControl.disable(),this.actionTriggerFormControl.disable(),this.annotPropertyOptionFormControl.disable({emitEvent:!1}),this.measureLengthFormControl.disable(),this.measureExtendFormControl.disable(),this.overlayTextFormControl.disable()):(this.annotTitleFormControl.enable(),this.opacityAsPercentageFormControl.enable(),this.stringStrokeWidthFormControl.enable(),this.actionTriggerFormControl.enable(),this.annotPropertyOptionFormControl.enable({emitEvent:!1}),this.measureLengthFormControl.enable({emitEvent:!1}),this.measureExtendFormControl.enable({emitEvent:!1}))}findCommonValue(n,i,e,t,o){if(Se.hasKey(t,e)&&typeof t[e]=="object"&&t[e]!==null&&!Array.isArray(t[e]))for(let s of Se.keys(t[e]))this.findCommonValue(n,i.concat(e),s,t[e],o);else{if(!Se.hasKey(t,e))throw new Mt(`Cannot find "${e}" in AnnotAttributes.`);let s=t[e],c=i.concat(e),u=this.attributeProxyMapper?.getFlattenedKey(n,c),C=o.map(D=>this.checkAttribute(u||c,s,D)),x=C.every(D=>D.has),N=C.every(D=>D.same);if(x){let D=this.commonAttributes;u===null&&i.forEach(Q=>{D[Q]||(D[Q]={}),D=D[Q]});let X=u===null?e:u;N?typeof s=="object"?D[X]=T.deepClone(s):D[X]=s:D[X]=void 0}}}checkAttribute(n,i,e){let t=n;if(typeof t=="string"&&(t=this.attributeProxyMapper?.getUnflattenedKey(e.type,t),t===null))return console.debug(`Fail to unflatten key. (Type: ${e.type}, Key: ${n})`),{has:!1,same:!1};let o=e.attributes,s=!!t?.every(c=>Se.hasKey(o,c)?(o=o[c],!0):!1);return{has:s,same:s&&typeof i==typeof o&&(Array.isArray(i)?this.isSameValueArray(i,o):i===o)}}correctBitMaskAttribute(){if(this.commonAttributes.hasOwnProperty("F")&&(this.commonAttributes.F=this.selectedComps[0].data.attributes.F,this.selectedComps.slice(1).forEach(n=>{this.commonAttributes.F=this.commonAttributes.F&n.data.attributes.F})),this.commonAttributes.Parent?.hasOwnProperty("Ff")){let n=this.selectedComps.map(i=>this.restoreOptionalAttributeAndParent(i.data));this.commonAttributes.Parent.Ff=n[0].attributes.Parent.Ff,n.slice(1).forEach(i=>{this.commonAttributes.Parent.Ff&=i.attributes.Parent.Ff})}}updateFontSizeOptions(){let n=F.fontsizeOptions.findIndex(e=>e.value===0),i=this.selectedComps.every(e=>A.isTextField(e.data,this.acroFormService.acroFields));i&&n<0?F.fontsizeOptions.unshift({label:"Auto",value:0}):!i&&n>-1&&F.fontsizeOptions.splice(n,1)}initAcroFieldList(){this.acroFieldList.splice(0);let{acroFields:n}=this.acroFormService;for(let i in n)Number.isNaN(Number(i))||this.acroFieldList.push({T:n[i].T,checked:!1})}determineCalculationCategory(){this.customScript=T.EMPTY_STRING;let n=this.additionalActionCalculate;if(n===null){this._calculationCategory="none";return}else if(!n||n.S!=="JavaScript"){this._calculationCategory=n.S===null?"none":void 0;return}if(this.predefinedCalculationOptions.some(e=>{let o=new RegExp(`\\s*AFSimple_Calculate\\("${e.value}",\\s*new\\s+Array\\s*\\(([^;]*)\\)\\);\\s*`).exec(n.JS);return o?(o[1].split(",").map(c=>c.replace(/^\s*"(.*)"\s*$/,"$1")).forEach(c=>{this.acroFieldList.some(u=>u.T===c?(u.checked=!0,!0):!1)}),this.currentPredefinedCalculation=e.value,!0):!1})){this._calculationCategory="predefined";return}this.customScript=n.JS,this._calculationCategory="custom"}validateActivatedTab(){this.isAvailableTab(this.activatedTabKey)||(this.activatedTabKey="GENERAL")}initAction(){this.actionTriggerMap=new Map,this.isFormField()&&(this.actionTriggerMap.set("U",this.commonAttributes.JS?[this.commonAttributes.JS]:[]),this.commonAttributes.AA)}initVariable(){this.selectedColorTabColor=null,this.selectedFontTabColor=null,this.measureInputRatio=1,this.measureOutputRatio=1,this.selectedActionTrigger=null,this.selectedActionIndex=null}resizeLeaderLine(n,i){if(this.isDefaultProperty){let e=this.selectedComps[0].data;if(!A.isLineDimension(e))return;e.attributes[n]=i,this.defaultAnnotService.saveChange(e.type,[n],i),this.annotService.dispatchModify(e);return}this.selectedComps.forEach(e=>{if(!A.isLineDimension(e.data))return;e.data.attributes[n]=i,e.fitBox&&e.fitBox();let t=e.data.attributes.rect,o=this.pdfPages[e.data.attributes.pageIdx].bbox;o.x<t.left&&t.right<o.w+o.x&&o.y<t.bottom&&t.top<o.h+o.y&&(this.commonAttributes[n]=T.deepClone(i)),this.annotService.modifyAttribute(e.data,[n],this.commonAttributes[n])})}toggleRedactionPreview(){this.redactionService.publishRedactionPreview(!this.isPreviewRedaction)}toggleSelectedAnnotToolUseDefaultConfig(n){if(!T.isDefined(this.firstSelectedAnnot))return;let i=this.firstSelectedAnnot.type;if(n){this.modalService.createCommonModal({type:Cn.BASIC,width:400,icon:"papycon papycon-questionmark",title:this.translatePipe.transform("SET_CURRENT_AS_DEFAULT_MODAL_TITLE"),content:this.translatePipe.transform("SET_CURRENT_AS_DEFAULT_MODAL_CONTENT"),confirmButton:!0,cancelButton:!0}).addOnDisposeListener(e=>{if(!e){this.useDefaultProperties[i]=!1,this.changeDetectorRef.markForCheck();return}this.changeUseDefaultProperties(i,n),this.saveAllDefaultAnnot()});return}this.changeUseDefaultProperties(i,n)}saveDefaultAnnot(n,i){if(!T.isDefined(this.firstSelectedAnnot)){this.loggingService.common("debug",le.NOT_EXIST,"firstSelectedAnnot");return}let e=U.getAnnotID(this.firstSelectedAnnot),t=this.firstSelectedAnnot.type,o=this.attributeProxyMapper?.getUnflattenedKey(t,n[0])??n;this.defaultAnnotService.saveChange(e,o,i)}canSaveAnnotProperties(n){return this.savableDefaultProperties.some(i=>i[0]===n[0])}saveAllDefaultAnnot(){this.savableDefaultProperties.forEach(n=>{if(this.isCommonAnnotAttribute(n)){if(!Se.hasKey(this.commonAttributes,n[0]))throw new Mt(`Cannot find "${n[0]}" in CommonAttributes.`);this.saveDefaultAnnot(n,this.commonAttributes[n[0]])}})}changeUseDefaultProperties(n,i){this.useDefaultProperties[n]=i,this.localStorageService.set("SD_AnnotUseDefaultProperties",JSON.stringify(this.useDefaultProperties)),this.changeDetectorRef.markForCheck()}getTabLabel(n){return this.tabLabels[n]}};v(Xn,"\u0275fac",function(i){return new(i||Xn)(m(ge),m(Y),m(Lt),m(Re),m(kt),m(vi),m(bt),m(Oi),m(P),m(Zt),m(xe),m(oe),m(Ji),m(Mc),m(kr),m(Rc),m(De))}),v(Xn,"\u0275cmp",j({type:Xn,selectors:[["sd-annot-property-view"]],standalone:!1,features:[$([P])],decls:16,vars:17,consts:[["colorContentRef",""],["lineContentRef",""],["textContentRef",""],["measureContentRef",""],["optionContentRef",""],["calculateContentRef",""],["actionContentRef",""],[1,"header"],["tabindex","0"],[1,"ep-button",3,"click","title"],[1,"papycon","papycon-cross"],[1,"scrollbar-container"],["class","redaction-preview",4,"ngIf"],["class","position-and-size",4,"ngIf"],["class","empty-message",4,"ngIf"],["class","tabs",4,"ngIf"],[4,"ngIf"],["class","default-properties",4,"ngIf"],[1,"redaction-preview"],[3,"ngModelChange","ngModel","isDarkMode"],[1,"position-and-size"],[3,"mousedown","width","puInputStep","suffix","formControl","ariaLabel"],[3,"puStepApply","width","puInputStep","suffix","formControl","ariaLabel"],[1,"empty-message"],[1,"tabs"],[1,"horizontal-container"],["class","tab",3,"active","click",4,"ngFor","ngForOf"],[1,"bottom-border"],["class","border",3,"ngClass","width",4,"ngFor","ngForOf"],[1,"tab",3,"click"],["tabindex","0",1,"tab-name"],[1,"top-border"],[1,"middle-border",3,"ngClass"],[1,"border",3,"ngClass"],[1,"default-attributes"],["class","property-title","tabindex","0",3,"disabled",4,"ngIf"],[3,"size","formControl","placeholder","ariaLabel","blur","keydown.enter",4,"ngIf"],[1,"flag-attributes"],[3,"disableFocus","disabled","label","ngModel","ngModelChange",4,"ngIf"],[3,"disableFocus","label","ngModel","ngModelChange",4,"ngIf"],[3,"contentTemplate","selected","header","borderHidden",4,"ngIf"],["tabindex","0",1,"property-title"],[3,"blur","keydown.enter","size","formControl","placeholder","ariaLabel"],[3,"ngModelChange","disableFocus","disabled","label","ngModel"],[3,"ngModelChange","disableFocus","label","ngModel"],[3,"contentTemplate","selected","header","borderHidden"],[1,"flex","column"],[1,"flex","color-property-container"],["class","flex column",3,"order",4,"ngIf"],[3,"nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel","ngModelChange",4,"ngIf"],[1,"flex","space-between"],[1,"property-title"],[1,"slider-value"],[1,"flex","align-center","space-between",3,"ngSubmit"],["tabindex","0","name","opacity",3,"ngModelChange","puStepApply","min","max","step","puInputStep","disabled","puStep","puAlterStep","ngModel"],["size","tiny",1,"slider-input",3,"blur","formControl","ariaLabel"],[1,"color-picker-container"],["tabindex","0",1,"color-rect",3,"click"],[3,"ngModelChange","nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel"],["name","strokeWidth","tabindex","0",3,"ngModelChange","puStepApply","puInputStep","disabled","max","min","ngModel"],[3,"ngModelChange","mousedown","disabled","isImageLabel","options","expandAriaLabel","size","ngModel"],[3,"ngModelChange","mousedown","disabled","isImageLabel","options","size","ngModel"],["class","overlay-text",4,"ngIf"],["class","flex",4,"ngIf"],[1,"overlay-text"],[3,"ngModelChange","label","disabled","ngModel"],[3,"placeholder","formControl"],[1,"flex"],[1,"flex","column","font-property"],[1,"font-dropdown",3,"ngModelChange","disabled","size","options","expandAriaLabel","boxWidth","ngModel"],[1,"font-size-dropdown",3,"ngModelChange","disabled","editable","expandAriaLabel","size","options","ngModel"],[3,"customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel","ngModelChange",4,"ngIf"],[3,"ngModelChange","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel"],[1,"flex","text-align-buttons"],[1,"ep-text-button",3,"click","disabled"],[1,"papycon","papycon-text-align-left"],[1,"papycon","papycon-text-align-center"],[1,"papycon","papycon-text-align-right"],[1,"flex","align-center"],[1,"no-margin",3,"ngModelChange","autoResize","disabled","size","ariaLabel","ngModel"],[1,"measure-unit-dropdown","no-margin",3,"ngModelChange","disabled","options","size","ngModel"],[1,"equal-sign"],["class","flex column measure-property",4,"ngIf"],[1,"flex","column","measure-property"],[1,"no-margin",3,"puStepApply","mousedown","width","formControl","puInputStep","puStepDisabled","height","min","ariaLabel"],[1,"property-sub-title"],[1,"no-margin",3,"puStepApply","mousedown","width","formControl","puInputStep","puStepDisabled","height","ariaLabel"],[1,"no-border","no-margin"],[3,"borderHidden","contentTemplate","header","selected",4,"ngIf"],[1,"checkable-image-preview-container"],[1,"checkable-image-preview",3,"ngStyle"],[3,"ngModelChange","disabled","options","ngModel"],[3,"ngModelChange","ariaLabel","ngModel"],[3,"ngModelChange","disabled","disableFocus","label","ngModel"],[3,"ngModelChange","disabled","size","ariaLabel","ngModel"],[3,"selectedIndexChange","formControl"],[3,"borderHidden","contentTemplate","header","selected"],[1,"flex","column","calculate-tab"],["value","none",3,"ngModelChange","disabled","label","ngModel"],[1,"row","align-center"],["value","predefined",3,"ngModelChange","disabled","label","ngModel"],[1,"no-margin","calculation-dropdown",3,"ngModelChange","disabled","options","size","expandAriaLabel","ngModel"],[1,"property-sub-title","no-margin"],[1,"field-select"],["size","small",1,"input",3,"ngModelChange","placeholder","useClearButton","disabled","ariaLabel","ngModel"],[1,"select-all-checkbox-container"],[3,"ngModelChange","label","disableFocus","disabled","ngModel"],[1,"field-list"],["class","field",4,"ngFor","ngForOf"],[3,"click"],[1,"papycon",3,"ngClass"],[1,"select"],["color","grey",1,"ep-button",3,"click","disabled"],["value","custom",3,"ngModelChange","disabled","label","ngModel"],[1,"script-container"],[1,"edit"],[1,"field"],[3,"ngModelChange","disabled","label","disableFocus","ngModel"],[1,"flex","column","action-tab"],["tabindex","0",3,"actionTriggerChange","actionIndexChange","actionTriggerMap","actionTrigger","actionIndex"],[1,"widget-action-control"],["color","grey","size","tiny",1,"ep-button",3,"click","disabled"],[1,"papycon","papycon-pencil"],[1,"papycon","papycon-trash-can"],[3,"expandAriaLabel","formControl","options"],[1,"add"],["color","primary",1,"ep-button",3,"click"],[1,"default-properties"],[1,"ep-text-button",3,"click"],[1,"papycon"]],template:function(i,e){i&1&&(h(0,"div",7)(1,"div",8),M(2),E(3,"translate"),_(),h(4,"button",9),E(5,"translate"),E(6,"translate"),O("click",function(){return e.onCloseButtonClick()}),I(7,"i",10),_()(),h(8,"section",11),R(9,vd,5,5,"section",12)(10,Od,23,38,"section",13)(11,bd,4,3,"section",14)(12,Ad,5,2,"nav",15)(13,ou,13,20,"ng-container",16)(14,gu,5,6,"ng-container",16)(15,Cu,6,7,"section",17),_()),i&2&&(l(2),k(S(3,11,e.selectedAnnotToolName)),l(2),p("title",S(5,13,"CLOSE")),G("color",e.isDarkMode?"dark":"white")("aria-label",S(6,15,"CLOSE")),l(5),p("ngIf",!e.isSelectedNothing&&e.isRedact),l(),p("ngIf",!e.isSelectedNothing&&!e.isDefaultProperty),l(),p("ngIf",e.isSelectedNothing),l(),p("ngIf",!e.isSelectedNothing&&!e.isDefaultProperty&&e.isAvailableTab("ATTRIBUTES")),l(),p("ngIf",!e.isSelectedNothing&&(e.activatedTabKey==="GENERAL"||e.isSmallWidthScreen)),l(),p("ngIf",e.runtimeEnv.get(e.MergedRuntimeEnvKey.ANNOT_PROPERTY_VIEW_ATTRIBUTES)&&!e.isSelectedNothing&&(e.activatedTabKey==="ATTRIBUTES"||e.isSmallWidthScreen)),l(),p("ngIf",!e.isSelectedNothing&&!e.isDefaultProperty&&e.firstSelectedAnnot))},styles:['[_nghost-%COMP%]{position:relative;display:flex;height:100%;flex-direction:column;overflow:hidden}.header[_ngcontent-%COMP%]{font-size:16px;line-height:26px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);background-color:var(--mono-00);display:flex;align-items:center;justify-content:space-between;flex:0 0 58px;padding:0 12px}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;border:1px solid var(--mono-30)}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:22px}.editor[_ngcontent-%COMP%], .editor-header[_ngcontent-%COMP%], .editor-buttons[_ngcontent-%COMP%], .editor-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex:0 0 40px;padding:0 15px;border-bottom:1px solid var(--mono-30);background:var(--mono-10)}.editor[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .editor-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .editor-buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .editor-footer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70)}.editor.flex-end[_ngcontent-%COMP%], .editor-header.flex-end[_ngcontent-%COMP%], .editor-buttons.flex-end[_ngcontent-%COMP%], .editor-footer.flex-end[_ngcontent-%COMP%]{justify-content:flex-end}.editor-buttons[_ngcontent-%COMP%]{flex:0 0 48px;background:var(--mono-00)}.message[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);background-color:var(--mono-00);width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.message[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:38px}.message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:10px}.loading-footer[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-99);background-color:var(--mono-00);bottom:0;padding:10px 0;width:100%;font-size:12px;text-align:center;border-top:1px solid var(--mono-30)}.flex[_ngcontent-%COMP%]{display:flex}.flex.column[_ngcontent-%COMP%]{flex-direction:column}.flex.align-center[_ngcontent-%COMP%]{align-items:center}.flex.space-between[_ngcontent-%COMP%]{justify-content:space-between}.scrollbar-container[_ngcontent-%COMP%]{position:relative;height:100%;overflow-x:hidden;overflow-y:auto;flex-shrink:1;-webkit-overflow-scrolling:touch}.position-and-size[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:8px 16px;margin:14px 12px 0}.position-and-size[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70)}.position-and-size[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   span.disabled[_ngcontent-%COMP%]{opacity:.5}.position-and-size[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   pu-input-value[_ngcontent-%COMP%]{width:100%;margin:0}.empty-message[_ngcontent-%COMP%]{color:var(--mono-70);width:80%;position:absolute;left:50%;top:50%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;transform:translate(-50%,-50%)}.empty-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;margin-top:16px}.tabs[_ngcontent-%COMP%]{display:flex;width:100%;height:43px;flex-direction:column;align-items:center;margin-top:24px}.tabs[_ngcontent-%COMP%]   .horizontal-container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;width:100%}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{position:relative;flex:1;width:100%;height:39px;background-color:var(--mono-10);cursor:pointer;-webkit-tap-highlight-color:transparent}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]:hover{background-color:var(--mono-30)}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]:active{background-color:var(--mono-50)}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]   .tab-name[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);position:absolute;display:flex;width:100%;height:100%;top:0;left:0;justify-content:center;align-items:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]   .middle-border[_ngcontent-%COMP%]{width:100%;height:35px;box-sizing:border-box}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]{background-color:var(--mono-00)}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]   .tab-name[_ngcontent-%COMP%]{color:var(--primary-70)}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]   .top-border[_ngcontent-%COMP%]{width:100%;height:4px;box-sizing:border-box;border:1px solid var(--mono-30);border-bottom:none;border-top-left-radius:4px;border-top-right-radius:4px}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]   .middle-border.left-tab[_ngcontent-%COMP%]{border-right:1px solid var(--mono-30)}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]   .middle-border.right-tab[_ngcontent-%COMP%]{border-left:1px solid var(--mono-30)}.tabs[_ngcontent-%COMP%]   .bottom-border[_ngcontent-%COMP%]{position:relative;display:flex;width:calc(100% + 2px);height:4px;justify-content:space-between;margin-top:-1px}.tabs[_ngcontent-%COMP%]   .bottom-border[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{height:100%;border-top:1px solid var(--mono-30)}.tabs[_ngcontent-%COMP%]   .bottom-border[_ngcontent-%COMP%]   .border.left[_ngcontent-%COMP%]{border-left:1px solid var(--mono-30);border-radius:4px 0}.tabs[_ngcontent-%COMP%]   .bottom-border[_ngcontent-%COMP%]   .border.right[_ngcontent-%COMP%]{border-right:1px solid var(--mono-30);border-radius:0 4px}.checkable-image-preview-container[_ngcontent-%COMP%]{width:100%;height:50px;border:2px;background-color:var(--mono-10);margin-bottom:12px;display:flex;justify-content:center;align-items:center}.checkable-image-preview-container[_ngcontent-%COMP%]   .checkable-image-preview[_ngcontent-%COMP%]{width:26px;height:26px;background-repeat:no-repeat}.property-title[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;margin-bottom:2px;color:var(--mono-70)}.property-title.disabled[_ngcontent-%COMP%]{opacity:.5;-webkit-user-select:none;user-select:none}.property-sub-title[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);margin:2px 0}.property-sub-title.disabled[_ngcontent-%COMP%]{opacity:.5;-webkit-user-select:none;user-select:none}.property-sub-title.no-margin[_ngcontent-%COMP%]{margin:0}.default-attributes[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:12px 12px 0}.default-attributes[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{margin-bottom:8px}.default-attributes[_ngcontent-%COMP%]   .flag-attributes[_ngcontent-%COMP%]   pu-checkbox[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}.position-and-size[_ngcontent-%COMP%] + .default-attributes[_ngcontent-%COMP%]{margin-top:16px}pu-accordion.show-border[_ngcontent-%COMP%]{border-top:1px solid var(--mono-30);margin-top:12px}pu-accordion[_ngcontent-%COMP%]:last-child{padding-bottom:12px}pu-accordion.no-margin[_ngcontent-%COMP%]{margin:0}pu-accordion.no-border[_ngcontent-%COMP%]{border:none}pu-accordion-tab[_ngcontent-%COMP%]{border-bottom:1px solid var(--mono-30)}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{padding:0 12px}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .add[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-00)}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%], pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-99);background-color:var(--mono-50)}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:disabled, pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:disabled{color:var(--font-disable);background-color:var(--mono-30)}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover, pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{background-color:#9f9f9f}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]:after{content:"";display:block;width:100%;height:12px}pu-accordion-tab[_ngcontent-%COMP%]   .no-border[_ngcontent-%COMP%]{border:none}pu-dropdown[_ngcontent-%COMP%], pu-input[_ngcontent-%COMP%], pu-input-value[_ngcontent-%COMP%], pu-slider[_ngcontent-%COMP%]{margin-bottom:8px}pu-dropdown.no-margin[_ngcontent-%COMP%], pu-input.no-margin[_ngcontent-%COMP%], pu-input-value.no-margin[_ngcontent-%COMP%], pu-slider.no-margin[_ngcontent-%COMP%]{margin-bottom:0}pu-slider[_ngcontent-%COMP%]{flex-shrink:1;width:97%}.slider-value[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-99);display:none}.slider-input[_ngcontent-%COMP%]{width:38px;margin-left:16px;flex-shrink:0}.color-property-container[_ngcontent-%COMP%]{gap:8px}.measure-property[_ngcontent-%COMP%]{margin-left:8px}.measure-property[_ngcontent-%COMP%]:first-child{margin-left:0}.font-property[_ngcontent-%COMP%]{margin-left:12px}.font-property[_ngcontent-%COMP%]:first-child{margin-left:0}.font-property[_ngcontent-%COMP%]   .font-dropdown[_ngcontent-%COMP%]{width:124px}.font-property[_ngcontent-%COMP%]   .font-size-dropdown[_ngcontent-%COMP%]{width:80px}.text-align-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px}.text-align-buttons[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}.text-align-buttons[_ngcontent-%COMP%]   button.dark.active[_ngcontent-%COMP%]{color:var(--mono-00)}.text-align-buttons[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(.active):hover{color:#d7d7d7}.text-align-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:4px}.text-align-buttons[_ngcontent-%COMP%]   button[color=white][_ngcontent-%COMP%]{background-color:var(--primary-50)}.text-align-buttons[_ngcontent-%COMP%]   button[color=white][_ngcontent-%COMP%]:focus{border-color:var(--mono-00)}.equal-sign[_ngcontent-%COMP%]{width:12px;height:10px;box-sizing:border-box;border-top:2px solid var(--mono-50);border-bottom:2px solid var(--mono-50);margin:0 8px}.calculate-tab[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{width:100%;display:flex;white-space:nowrap;align-items:center;justify-content:space-between}.calculate-tab[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]{width:auto;margin:10px 0}.calculate-tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:4px auto 0 0}.calculate-tab[_ngcontent-%COMP%]   .script-container[_ngcontent-%COMP%]{color:var(--mono-70);font-family:Consolas;font-size:12px;width:100%;height:60px;border:1px solid var(--mono-30);padding:6px;box-sizing:border-box;white-space:pre;overflow:auto}.action-tab[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.color-picker-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;cursor:pointer;border:1px solid var(--mono-30);border-radius:2px;box-sizing:border-box;padding:3px;margin-top:2px;width:30px;height:30px}.color-picker-container.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none;-webkit-user-select:none;user-select:none}.color-picker-container.selected[_ngcontent-%COMP%]{background-color:rgba(var(--primary-50),.08);border:1px solid var(--primary-50);box-shadow:0 0 6px 0 var(--primary-50)}.color-picker-container[_ngcontent-%COMP%]   .color-rect[_ngcontent-%COMP%]{width:22px;height:22px;border-radius:2px;background-size:cover}.field-select[_ngcontent-%COMP%]{position:relative;display:flex;width:100%;height:100%;flex-direction:column}.field-select[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{height:17px;border:solid 1px var(--mono-30);background-color:var(--mono-10);font-size:8px;display:flex;justify-content:center;align-items:center;cursor:pointer}.field-select[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:12px}.field-select[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]{margin-top:15px;margin-bottom:0}.field-select[_ngcontent-%COMP%]   .select-all-checkbox-container[_ngcontent-%COMP%]{display:flex;width:100%;height:40px;align-items:center;box-sizing:border-box;border-top:1px solid var(--mono-30);border-bottom:1px solid var(--mono-30);padding:0 16px;margin-top:12px;background-color:var(--mono-10);flex-shrink:0}.field-select[_ngcontent-%COMP%]   .field-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:137px;padding:0 16px;box-sizing:border-box;overflow:auto}.field-select[_ngcontent-%COMP%]   .field-list[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;height:34px;flex-shrink:0}.field-select[_ngcontent-%COMP%]   .field-list[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   pu-checkbox[_ngcontent-%COMP%]{width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.widget-action-control[_ngcontent-%COMP%]{display:flex;margin-top:12px}.widget-action-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;font-size:17px}.widget-action-control[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-99);background-color:var(--mono-50)}.widget-action-control[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:disabled{color:var(--font-disable);background-color:var(--mono-30)}.widget-action-control[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{background-color:#9f9f9f}.widget-action-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:8px}@media screen and (max-width: 577px){.header[_ngcontent-%COMP%]{display:flex;padding-left:16px}.flag-attributes[_ngcontent-%COMP%]{display:flex;flex-direction:column}.align-buttons[_ngcontent-%COMP%], .position-and-size[_ngcontent-%COMP%], .tabs[_ngcontent-%COMP%]{display:none}.default-attributes[_ngcontent-%COMP%]{padding:0 16px}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{padding:0 16px}.property-title[_ngcontent-%COMP%]{font-size:13px;line-height:22px}.slider-value[_ngcontent-%COMP%]{display:inline}.slider-input[_ngcontent-%COMP%]{display:none}}.measure-unit-dropdown[_ngcontent-%COMP%]{width:64px}.calculation-dropdown[_ngcontent-%COMP%]{width:70px}.redaction-preview[_ngcontent-%COMP%]{padding:12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--mono-30)}.redaction-preview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif}.default-properties[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid var(--mono-30)}.default-properties[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70)}.default-properties[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}.default-properties[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.default-properties[_ngcontent-%COMP%]   i.papycon-rounded-square[_ngcontent-%COMP%]{color:var(--mono-50)}.default-properties[_ngcontent-%COMP%]   i.papycon-check-mark4-filled[_ngcontent-%COMP%]{color:var(--primary-50)}.overlay-text[_ngcontent-%COMP%]{display:flex;gap:8px;flex-direction:column}'],data:{animation:[qo("selectFileList",[ks(Ai.OPEN,$i({height:"300px"})),ks(Ai.CLOSE,$i({height:"137px"})),ho(`${Ai.OPEN} <=> ${Ai.CLOSE}`,mo(Ln.timingFunctions.CUBIC_EASE_IN_OUT))])]},changeDetection:0}));var Le=Xn;ee([Qe(J.annotPropertyViewComp.selectedCheckableOption)],Le.prototype,"selectedCheckableOption",null);ee([Qe(J.annotPropertyViewComp.selectedStartLinecap)],Le.prototype,"selectedStartLinecap",null);ee([Qe(J.annotPropertyViewComp.selectedEndLinecap)],Le.prototype,"selectedEndLinecap",null);ee([Qe(J.annotPropertyViewComp.readonly)],Le.prototype,"readOnly",null);ee([Qe(J.annotPropertyViewComp.required)],Le.prototype,"required",null);ee([Qe(J.annotPropertyViewComp.multiline)],Le.prototype,"multiline",null);ee([Qe(J.annotPropertyViewComp.lock)],Le.prototype,"lock",null);ee([Qe(J.annotPropertyViewComp.fillColor)],Le.prototype,"fillColor",null);ee([Qe(J.annotPropertyViewComp.strokeColor)],Le.prototype,"strokeColor",null);ee([Qe(J.annotPropertyViewComp.opacity,1e3)],Le.prototype,"opacity",null);ee([Qe(J.annotPropertyViewComp.selectedBorderStyle)],Le.prototype,"selectedBorderStyle",null);ee([Qe(J.annotPropertyViewComp.strokeWidth,1e3)],Le.prototype,"strokeWidth",null);ee([Qe(J.annotPropertyViewComp.selectedFontSize)],Le.prototype,"selectedFontSize",null);ee([Qe(J.annotPropertyViewComp.selectedFont)],Le.prototype,"selectedFont",null);ee([Qe(J.annotPropertyViewComp.fontColor)],Le.prototype,"fontColor",null);ee([Qe(J.annotPropertyViewComp.measureLength)],Le.prototype,"measureLength",null);ee([Qe(J.annotPropertyViewComp.measureExtend)],Le.prototype,"measureExtend",null);ee([Qe(J.annotPropertyViewComp.changeSize)],Le.prototype,"widthAsLocaleUnit",null);ee([Qe(J.annotPropertyViewComp.changeSize)],Le.prototype,"heightAsLocaleUnit",null);ee([Qe(J.annotPropertyViewComp.changePoint)],Le.prototype,"xAsLocaleUnit",null);ee([Qe(J.annotPropertyViewComp.changePoint)],Le.prototype,"yAsLocaleUnit",null);ee([Qe(J.annotPropertyViewComp.textAlign)],Le.prototype,"textAlign",null);ee([Qe(J.annotPropertyViewComp.AP_N_exportValue,1e3)],Le.prototype,"AP_N_exportValue",null);ee([Qe(J.annotPropertyViewComp.calculationCategory)],Le.prototype,"calculationCategory",null);ee([Ae(J.annotPropertyViewComp.onChangeMeasure,1e3)],Le.prototype,"onChangeMeasure",null);ee([Ae(J.annotPropertyViewComp.updateAnnotTitle)],Le.prototype,"updateAnnotTitle",null);ee([Ae(J.annotPropertyViewComp.modifyAttributesChanges)],Le.prototype,"modifyAttributesChanges",null);var Eu=["labelRef"],Su=r=>({content:r});function xu(r,n){if(r&1&&(h(0,"th",10),M(1),_()),r&2){let i=n.$implicit,e=d(4);p("ngStyle",e.getDefaultHeaderStyles(i.styles)),l(),k(i.title)}}function vu(r,n){if(r&1&&(I(0,"th",8),R(1,xu,2,2,"th",9)),r&2){let i=d(3);l(),p("ngForOf",i.table.headers)}}function Ou(r,n){if(r&1&&I(0,"i",14),r&2){let i=d(2).$implicit;p("tooltip",gt(1,Su,i.errorMessage))}}function bu(r,n){if(r&1&&(h(0,"td",10)(1,"div",12,0),M(3),_(),R(4,Ou,1,3,"i",13),_()),r&2){let i=n.$implicit,e=n.index,t=d().$implicit,o=d(3);p("ngStyle",o.includeErrorDocs?o.stylesWhenError:o.getDefaultHeaderStyles(i.styles)),l(),qe("color",t.errorMessage&&"#E4002B"),l(2),ke(" ",t.contents[e]," "),l(),p("ngIf",t.errorMessage)}}function Iu(r,n){if(r&1){let i=w();h(0,"td")(1,"pu-checkbox",11),O("ngModelChange",function(t){let o=f(i).$implicit,s=d(3);return g(s.setTableRowCheckedState(o,t))}),_()(),R(2,bu,5,5,"td",9)}if(r&2){let i=n.$implicit,e=d(3);l(),p("triState",!0)("disabled",e.isEbookMode)("ngModel",e.getTableRowCheckedState(i)),l(),p("ngForOf",e.table.headers)}}function yu(r,n){if(r&1){let i=w();h(0,"pu-table",5),O("rowSelect",function(t){f(i);let o=d(2);return g(o.onSelectRow(t))}),R(1,vu,2,1,"ng-template",6)(2,Iu,3,4,"ng-template",7),_()}if(r&2){let i=d(2);p("data",i.table.rows)}}function Au(r,n){if(r&1&&(Te(0),I(1,"sd-breadcrumb",3),R(2,yu,3,1,"pu-table",4),Ee()),r&2){let i=d();l(),p("list",i.titles),l(),p("ngIf",i.table)}}function Ru(r,n){if(r&1){let i=w();h(0,"sd-dap-table",15),O("documentSelect",function(t){f(i);let o=d();return g(o.onDocumentSelect(t))}),_()}if(r&2){let i=d();p("table",i.selectedChildTable)("isEbookMode",i.isEbookMode)("titles",i.selectedChildTitles)("dapCategory",i.dapCategory)}}var Hr=(()=>{let n=class n{dapService;renderer;loggingService;table;isEbookMode;dapCategory;toastNotificationSubject;includeErrorDocs;titles;documentSelect=new Ke;labelRef;selectedChildTable=null;selectedChildTitles=[];stylesWhenError={};constructor(e,t,o){this.dapService=e,this.renderer=t,this.loggingService=o}ngAfterViewInit(){this.includeErrorDocs&&(this.renderer.setStyle(this.labelRef.nativeElement,"white-space","nowrap"),this.stylesWhenError={display:"flex","flex-direction":"row","align-items":"center",height:"inherit"})}getDefaultHeaderStyles(e){let t={};for(let o in e)t[o]=e[o];return t}onSelectRow(e){e.child?(this.selectedChildTable=this.dapCategory.tables?.[e.child]??null,this.selectedChildTitles=this.titles.concat(e.child),this.documentSelect.emit({refId:Number(this.selectedChildTable?.rows[0]?.link?.refId)})):T.isDefined(e?.link?.refId)?(this.selectedChildTable=null,this.documentSelect.emit({refId:Number(e.link.refId)})):this.loggingService.common("warn",le.INVALID,"row")}onDocumentSelect(e){this.documentSelect.emit(e)}setTableRowCheckedState(e,t){this.dapService.setTableRowCheckedState(e,t)}getTableRowCheckedState(e){return e.child?this.dapCategory.tables?.[e.child].rows.reduce((t,o)=>{let s=this.getTableRowCheckedState(o);return t===void 0||s===t?s:hi.PARTIAL},hi.FALSE):this.dapService.getStateContainer(e).state}};v(n,"\u0275fac",function(t){return new(t||n)(m(Fr),m(Qt),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-dap-table"]],viewQuery:function(t,o){if(t&1&&se(Eu,5),t&2){let s;ae(s=ce())&&(o.labelRef=s.first)}},inputs:{table:"table",isEbookMode:"isEbookMode",dapCategory:"dapCategory",toastNotificationSubject:"toastNotificationSubject",includeErrorDocs:"includeErrorDocs",titles:"titles"},outputs:{documentSelect:"documentSelect"},standalone:!1,decls:2,vars:2,consts:[["labelRef",""],[4,"ngIf"],[3,"table","isEbookMode","titles","dapCategory","documentSelect",4,"ngIf"],[3,"list"],[3,"data","rowSelect",4,"ngIf"],[3,"rowSelect","data"],["puRowDef","header"],["puRowDef","body"],["width","10%"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"ngStyle"],[1,"checkbox",3,"ngModelChange","triState","disabled","ngModel"],[1,"label"],["class","papycon papycon-questionmark tooltip-icon",3,"tooltip",4,"ngIf"],[1,"papycon","papycon-questionmark","tooltip-icon",3,"tooltip"],[3,"documentSelect","table","isEbookMode","titles","dapCategory"]],template:function(t,o){t&1&&R(0,Au,3,2,"ng-container",1)(1,Ru,1,4,"sd-dap-table",2),t&2&&(p("ngIf",o.table&&o.dapCategory&&o.isEbookMode!==void 0),l(),p("ngIf",o.selectedChildTable))},styles:["pu-table[_ngcontent-%COMP%]{border-bottom:1px solid #DADADA}.checkbox[_ngcontent-%COMP%]{margin-top:5px}.tooltip-icon[_ngcontent-%COMP%]{color:var(--mono-70);margin-left:4px;font-size:18px;line-height:22px;cursor:pointer}.label[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden}"]}));let r=n;return r})();var $s=r=>({content:r}),Pu=r=>[r];function Nu(r,n){if(r&1){let i=w();h(0,"nav",10)(1,"button",11),E(2,"translate"),E(3,"translate"),E(4,"translate"),O("click",function(){f(i);let t=d();return g(t.changeMode(t.DapViewMode.TREE_VIEW))}),I(5,"i",12),_(),h(6,"button",11),E(7,"translate"),E(8,"translate"),E(9,"translate"),O("click",function(){f(i);let t=d();return g(t.changeMode(t.DapViewMode.TABLE_VIEW))}),I(10,"i",13),_()()}if(r&2){let i=d();l(),W("active",i.currentDapViewMode===i.DapViewMode.TREE_VIEW),p("title",S(2,12,"VIEW_AS_TREE"))("tooltip",gt(24,$s,S(3,14,"VIEW_AS_TREE"))),G("color",i.isDarkMode?"white":"dark")("aria-label",S(4,16,"VIEW_AS_TREE")),l(5),W("active",i.currentDapViewMode===i.DapViewMode.TABLE_VIEW),p("title",S(7,18,"VIEW_AS_TABLE"))("tooltip",gt(26,$s,S(8,20,"VIEW_AS_TABLE"))),G("color",i.isDarkMode?"white":"dark")("aria-label",S(9,22,"VIEW_AS_TABLE"))}}function Mu(r,n){if(r&1){let i=w();h(0,"div")(1,"pu-tree",14),O("checkedChange",function(t){f(i);let o=d();return g(o.onTreeCheckedChange(t))})("selectedChange",function(t){f(i);let o=d();return g(o.onTreeSelectedChange(t))}),_()()}if(r&2){let i=d(),e=we(18);l(),p("checkbox",!0)("disableCheckbox",i.isEbookMode)("rootNode",i.categoryRoot)("tooltipTemplate",e)}}function Du(r,n){if(r&1){let i=w();h(0,"div")(1,"sd-dap-table",15),E(2,"translate"),O("documentSelect",function(t){f(i);let o=d();return g(o.onDocumentSelect(t))}),_()()}if(r&2){let i=d();l(),p("table",i.currentTable)("isEbookMode",i.isEbookMode)("dapCategory",i.dapCategory)("includeErrorDocs",i.includeErrorDocs)("titles",gt(7,Pu,S(2,5,"LIST")))}}function wu(r,n){if(r&1&&I(0,"i",16),r&2){let i=n.$implicit;p("tooltip",gt(1,$s,i))}}var Ys=(()=>{let n=class n{changeDetectorRef;contentService;dapService;pageService;subscriptionService;store$;configsService;documentService;translatePipe;loggingService;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get DapViewMode(){return Ii}get viewMode(){return this._viewMode}set viewMode(e){this._viewMode=e}get isEbookMode(){return this.viewMode===4}pdfDoc;currentDapViewMode=Ii.TREE_VIEW;categoryRoot;currentTableName="";allChecked=!1;dapCategory;_viewMode;get currentTable(){return!this.dapCategory||!this.currentTableName?null:this.dapCategory.tables?.[this.currentTableName]??null}pageDescriptions=[];pdfPages=[];includeErrorDocs=!1;documentCount=0;categoryCount=0;isTreeViewVisible=K.get(a.DAP_VIEW_TREE);isTableViewVisible=K.get(a.DAP_VIEW_TABLE);get CountTitle(){return this.categoryCount>0?this.translatePipe.transform("DAP_CATEGORY_COUNT",this.categoryCount):this.translatePipe.transform("DAP_DOCUMENT_COUNT",this.documentCount)}constructor(e,t,o,s,c,u,C,x,N,D){this.changeDetectorRef=e,this.contentService=t,this.dapService=o,this.pageService=s,this.subscriptionService=c,this.store$=u,this.configsService=C,this.documentService=x,this.translatePipe=N,this.loggingService=D}ngOnInit(){this.initializeSetting(),this.subscriptionService.push(this.store$.pipe(Xe("screenTheme")).subscribe({next:e=>{this.screenTheme=e,this.changeDetectorRef.markForCheck()}})),this.dapService.stateChange$.subscribe({next:()=>{this.syncTreeNodeFromRow(),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(_e("viewMode")).subscribe({next:e=>{this.viewMode=e,this.changeDetectorRef.markForCheck()}})}ngOnChanges(){this.initSubscriptions()}changeMode(e){this.currentDapViewMode=e}onClickClose(){this.store$.dispatch(wt.set({key:"rightSideViewVisible",value:!1}))}onTreeSelectedChange(e){let t=e[e.length-1].children;if(t.length>0){this.moveToRef(Number(t[0].data));return}this.moveToRef(Number(e[e.length-1].data))}onTreeCheckedChange(e){if(e.checked===hi.PARTIAL)return;let t=e.node.descendants.filter(o=>o.children.length===0);(t.length>0?t:[e.node]).forEach(o=>{this.dapService.setDisabledState(Number(o.data),e.checked===hi.FALSE),o.data&&(this.dapService.getStateContainer(o.data).state=e.checked)}),this.dapService.publishStateChange({check:e.checked}),this.syncTreeNodeFromRow()}selectAll(){let e=this.allChecked?hi.FALSE:hi.TRUE;this.currentTable&&this.currentDapViewMode===Ii.TABLE_VIEW?this.currentTable.rows.forEach(t=>{this.dapService.setTableRowCheckedState(t,e)}):this.onTreeCheckedChange({node:this.categoryRoot,checked:e})}onDocumentSelect(e){this.moveToRef(e.refId)}computeAllCheckedFlag(){this.allChecked=this.categoryRoot.descendants.every(e=>e.checked===hi.TRUE)}initSubscriptions(){this.subscriptionService.push(po([this.documentService.pageDescriptions$.pipe(L(T.isDefined)),this.documentService.dapCategory$]).subscribe({next:([e,t])=>{this.pageDescriptions=e,this.dapCategory=Object.keys(t).length>0?t:this.dapService.createDefaultDapCategory(this.pageDescriptions);let o={};e.forEach(u=>{let C=u.refId;o[C]||(o[C]=!0)});let s={};Object.keys(this.dapCategory.tables).forEach(u=>{this.dapCategory.tables?.[u].rows.forEach(C=>{let x=C.link?.refId;!T.isDefined(x)||s[x]||(s[x]=!0)})});let c=Object.keys(s).length;if(this.documentCount=Object.keys(o).length,this.categoryCount=Object.keys(this.dapCategory.tables).filter(u=>u!==this.dapCategory.root).length,this.documentCount!==c&&this.loggingService.common("debug",le.INVALID,this.translatePipe.transform("DIFFERENT_DOCUMENT_COUNT_IN_DAP"),{PageDescriptions:this.documentCount,Category:c}),!T.isDefined(this.dapCategory.root)||!T.isDefined(this.dapCategory.tables?.[this.dapCategory.root])){this.loggingService.common("error",le.NOT_EXIST,this.translatePipe.transform("NO_ROOT_TABLE_NAME_IN_LIST"));return}this.processDapInfo(),this.computeAllCheckedFlag(),this.changeDetectorRef.markForCheck()}}),this.pageService.pdfPages$.subscribe({next:e=>this.pdfPages=e}))}moveToRef(e){if(this.dapService.isDisabled(e))return;let t=this.pdfPages.find(s=>this.dapService.getPageRefId(s)===e);if(t===void 0)return;let o=t.i+1;this.contentService.requestViewChange({pageNo:o})}processDapInfo(){let e=this.dapCategory.tables?.[this.dapCategory.root];this.categoryRoot=new Fs,this.processTable(e,this.categoryRoot),this.currentTableName=this.dapCategory.root??T.EMPTY_STRING}processTable(e,t){let o=[];if(!T.isDefined(e))return o;let s=e.rows[0].contents.length-e.headers.length;if(s>0)for(let c=0;c<s;++c)e.headers.push({title:"",styles:{}});return e.rows.forEach(c=>{let u=new Fs;if(u.label=c.contents.join(" "),u.checked=hi.TRUE,c.errorMessage&&(this.includeErrorDocs=!0,u.tooltipMessage=c.errorMessage,u.labelColor="#E4002B"),c.child){let C=this.processTable(this.dapCategory.tables?.[c.child],u);o.push(...C)}else if(c.link?.refId){let C=this.pageDescriptions.map((x,N)=>x.refId===Number(c.link?.refId)?N:null).filter(x=>x);u.data=c.link.refId,o.push(...C),this.dapService.isDisabled(Number(c.link.refId))&&(u.checked=hi.FALSE)}t.push(u)}),o}syncTreeNodeFromRow(){let e=this.categoryRoot.descendants.filter(t=>t.children.length===0);for(let t of e)t.data&&(t.checked=this.dapService.getStateContainer(t.data).state);this.computeAllCheckedFlag()}initializeSetting(){if(!K.get(B.DAP_VIEW)){if(this.pageDescriptions=this.documentService.dapInfo.pageDescriptions,Object.keys(this.dapCategory).length===0&&(this.dapCategory=this.dapService.createDefaultDapCategory(this.pageDescriptions)),!T.isDefined(this.dapCategory.root)||!T.isDefined(this.dapCategory.tables?.[this.dapCategory.root])){this.loggingService.common("error",le.NOT_EXIST,this.translatePipe.transform("NO_ROOT_TABLE_NAME_IN_LIST"));return}this.processDapInfo(),this.computeAllCheckedFlag(),this.changeDetectorRef.markForCheck()}if(this.isTreeViewVisible!==this.isTableViewVisible){this.currentDapViewMode=this.isTreeViewVisible?Ii.TREE_VIEW:Ii.TABLE_VIEW;return}this.configsService.radioConfig[H.DEFAULT_VIEWED_DAP_LIST]?.items.forEach(t=>{K.get(t.key)&&(this.currentDapViewMode=t.value)})}};v(n,"\u0275fac",function(t){return new(t||n)(m(Y),m(ge),m(Fr),m(bt),m(P),m(xe),m(Jt),m(It),m(oe),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-dap-view"]],inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[$([P,{provide:Zo,useValue:new zi(300)}]),Ie],decls:19,vars:19,consts:[["tooltipTemplate",""],[1,"header"],["size","tiny",1,"ep-button",3,"click","title"],[1,"papycon","papycon-cross"],["class","tabs",4,"ngIf"],[1,"editor"],[3,"ngModelChange","label","ngModel","disabled"],[1,"count-title"],[1,"model-container"],[4,"ngIf"],[1,"tabs"],[1,"ep-text-button",3,"click","title","tooltip"],[1,"papycon","papycon-list2"],[1,"papycon","papycon-vertical-split"],[3,"checkedChange","selectedChange","checkbox","disableCheckbox","rootNode","tooltipTemplate"],[3,"documentSelect","table","isEbookMode","dapCategory","includeErrorDocs","titles"],[1,"papycon","papycon-questionmark","tooltip-icon",3,"tooltip"]],template:function(t,o){if(t&1){let s=w();h(0,"div",1)(1,"div"),M(2),E(3,"translate"),_(),h(4,"button",2),E(5,"translate"),E(6,"translate"),O("click",function(){return f(s),g(o.onClickClose())}),I(7,"i",3),_()(),R(8,Nu,11,28,"nav",4),h(9,"nav",5)(10,"pu-checkbox",6),E(11,"translate"),O("ngModelChange",function(){return f(s),g(o.selectAll())}),_(),h(12,"span",7),M(13),_()(),h(14,"div",8),R(15,Mu,2,4,"div",9)(16,Du,3,9,"div",9),_(),R(17,wu,1,3,"ng-template",null,0,He)}t&2&&(l(2),k(S(3,11,"DAP_DOCUMENT")),l(2),p("title",S(5,13,"CLOSE")),G("color",o.isDarkMode?"dark":"white")("aria-label",S(6,15,"CLOSE")),l(4),p("ngIf",o.isTreeViewVisible&&o.isTableViewVisible),l(2),p("label",S(11,17,"SELECT_ALL"))("ngModel",o.allChecked)("disabled",o.isEbookMode),l(3),k(o.CountTitle),l(2),p("ngIf",o.currentDapViewMode===o.DapViewMode.TREE_VIEW),l(),p("ngIf",o.currentDapViewMode===o.DapViewMode.TABLE_VIEW&&o.currentTable&&o.dapCategory))},styles:['[_nghost-%COMP%]{position:relative;display:flex;height:100%;flex-direction:column;overflow:hidden}.header[_ngcontent-%COMP%]{font-size:16px;line-height:26px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);background-color:var(--mono-00);display:flex;align-items:center;justify-content:space-between;flex:0 0 58px;padding:0 12px}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;border:1px solid var(--mono-30)}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:22px}.editor[_ngcontent-%COMP%], .editor-header[_ngcontent-%COMP%], .editor-buttons[_ngcontent-%COMP%], .editor-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex:0 0 40px;padding:0 15px;border-bottom:1px solid var(--mono-30);background:var(--mono-10)}.editor[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .editor-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .editor-buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .editor-footer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70)}.editor.flex-end[_ngcontent-%COMP%], .editor-header.flex-end[_ngcontent-%COMP%], .editor-buttons.flex-end[_ngcontent-%COMP%], .editor-footer.flex-end[_ngcontent-%COMP%]{justify-content:flex-end}.editor-buttons[_ngcontent-%COMP%]{flex:0 0 48px;background:var(--mono-00)}.message[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);background-color:var(--mono-00);width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.message[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:38px}.message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:10px}.loading-footer[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-99);background-color:var(--mono-00);bottom:0;padding:10px 0;width:100%;font-size:12px;text-align:center;border-top:1px solid var(--mono-30)}.tabs[_ngcontent-%COMP%]{display:flex;width:100%;height:50px;align-items:center;justify-content:space-around;box-sizing:border-box;padding:0 16px;border-bottom:1px solid var(--mono-30)}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:relative;display:flex;width:124px;height:100%;align-items:center;justify-content:center}.tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;bottom:1px;width:100%;height:4px;border-radius:2px;background-color:var(--primary-50)}.editor[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding-left:16px;padding-right:12px}.editor[_ngcontent-%COMP%]   .count-title[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70)}.model-container[_ngcontent-%COMP%]{height:calc(100% - 119px);overflow-y:auto;overflow-x:hidden}.tooltip-icon[_ngcontent-%COMP%]{margin-left:4px;font-size:18px;line-height:22px;cursor:pointer;color:var(--mono-90)}'],changeDetection:0}));let r=n;return r})();function Lu(r,n){if(r&1){let i=w();h(0,"div",2),O("mousedown",function(t){f(i);let o=d();return g(o.onResizerDown(t))}),_()}if(r&2){let i=d();W("disabled",i.isAnnotPropertyView())}}function ku(r,n){if(r&1&&I(0,"sd-dap-view",6),r&2){let i=d(2);p("pdfDoc",i.pdfDoc)}}function Fu(r,n){if(r&1&&I(0,"sd-text-search-view",6),r&2){let i=d(2);p("pdfDoc",i.pdfDoc)}}function Vu(r,n){r&1&&I(0,"sd-annot-property-view")}function Uu(r,n){if(r&1&&(h(0,"div",3),R(1,ku,1,1,"sd-dap-view",4)(2,Fu,1,1,"sd-text-search-view",4)(3,Vu,1,0,"sd-annot-property-view",5),_()),r&2){let i=d();l(),p("ngIf",i.rightSideViewMode===i.RightSideViewMode.DAP&&i.isDAP),l(),p("ngIf",i.rightSideViewMode===i.RightSideViewMode.TextSearch&&i.hasSearchTextPermission),l(),p("ngIf",i.rightSideViewMode===i.RightSideViewMode.AnnotProperty)}}var Pl=(()=>{let n=class n{resizerService;changeDetectorRef;documentService;subscriptionService;store$;get RightSideViewMode(){return Tn}pdfDoc;get hostStyleWidth(){return Ve.isSmallWidth()?"100%":F.pixelOf(this.rightSideViewSize)}rightSideViewConf=Fe.rightSideView;resizeable=this.rightSideViewConf.resizeable;rightSideViewMode;rightSideViewSize;lastRightSideViewSize;resizerStartSize;get hasSearchTextPermission(){return this.documentService.checkAuthority(Be.SEARCH_TEXT)}constructor(e,t,o,s,c){this.resizerService=e,this.changeDetectorRef=t,this.documentService=o,this.subscriptionService=s,this.store$=c}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){this.store$.dispatch(wt.storeLastRightSideViewSize({viewMode:this.rightSideViewMode,size:this.rightSideViewSize}))}isAnnotPropertyView(){return this.rightSideViewMode===Tn.AnnotProperty}onResizerDown(e){if(this.isAnnotPropertyView())return;let t=this.resizerService.createResizer(e,o=>this.resize(o,t),"col-resizing");t&&(this.resizerStartSize=Number(this.rightSideViewSize))}get isDAP(){return this.documentService.isDAP}initSubscriptions(){this.subscriptionService.push(this.store$.pipe(_e("rightSideViewSize")).subscribe({next:e=>this.rightSideViewSize=e}),this.store$.pipe(_e("lastRightSideViewSize")).subscribe({next:e=>this.lastRightSideViewSize=e}),this.store$.pipe(_e("rightSideViewMode")).subscribe({next:e=>{this.rightSideViewMode&&this.store$.dispatch(wt.storeLastRightSideViewSize({viewMode:this.rightSideViewMode,size:this.rightSideViewSize})),this.rightSideViewMode=e,this.rightSideViewSize=this.lastRightSideViewSize[this.rightSideViewMode],this.changeDetectorRef.detectChanges()}}))}resize(e,t){if(!T.isDefined(this.resizerStartSize)||!T.isDefined(t))throw new oi("An unexpected variable has not been defined.");let o=F.navWidth,s=F.toggleButtonWidth,c=2,u=F.canSideViewBeDisplayed(!1,!0,0,Fe.rightSideView.maxSize),C=Math.max(Fe.rightSideView.minSize,Math.min(this.resizerStartSize+(t.startPosX-e.clientX),Fe.rightSideView.maxSize));if(this.changeDetectorRef.markForCheck(),!u){this.store$.dispatch(wt.set({key:"rightSideViewSize",value:Math.min(C,Ve.width-(o+s*c+5))}));return}this.store$.dispatch(wt.set({key:"rightSideViewSize",value:C}))}};v(n,"\u0275fac",function(t){return new(t||n)(m(rl),m(Y),m(It),m(P),m(xe))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-right-side-view"]],hostVars:2,hostBindings:function(t,o){t&2&&qe("width",o.hostStyleWidth)},inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[$([P])],decls:3,vars:2,consts:[["class","resizer",3,"disabled","mousedown",4,"ngIf"],["class","side-contents",4,"ngIf"],[1,"resizer",3,"mousedown"],[1,"side-contents"],[3,"pdfDoc",4,"ngIf"],[4,"ngIf"],[3,"pdfDoc"]],template:function(t,o){t&1&&(R(0,Lu,1,2,"div",0),h(1,"section"),R(2,Uu,4,3,"div",1),_()),t&2&&(p("ngIf",o.resizeable),l(2),p("ngIf",o.pdfDoc))},styles:["[_nghost-%COMP%]{height:100%;display:block}.resizer[_ngcontent-%COMP%]{width:12px;height:calc(100% - 20px);top:10px;left:-6px;position:absolute;box-sizing:border-box;margin:0;padding:0;cursor:col-resize;z-index:1}.resizer.disabled[_ngcontent-%COMP%]{cursor:default}section[_ngcontent-%COMP%]{width:100%;height:100%;overflow:hidden;position:relative;border-left:1px solid var(--mono-30)}.side-contents[_ngcontent-%COMP%]{width:100%;height:100%;margin:0;padding:0;display:block;background-color:var(--mono-00)}@media screen and (max-width: 577px){.resizer[_ngcontent-%COMP%]{display:none}}"],changeDetection:0}));let r=n;return r})();var HT=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({imports:[Tl,mt,kn,ai,Ur,or,fc,cr,lr,pr,ar,ur,fr,Cr,Ec,Er,vc,Fn,Fc,nl,ol]}));let r=n;return r})();We(Gr,[vt,ri,_i],[oe]);We(on,[Je,Ue,vt,Ki,_i,go,Co],[oe]);We(Le,[Je,Ue,be,Ce,fo,vt,Ki,ri,_o,xo,nr,ir,rr,sr,To,_i,dr,_r,gr,Tr,gn,il,on],[oe]);We(Hr,[Cl,Ue,be,Ce,vt,ri,rr,Cc,Tc,ji,Hr],[]);We(Ys,[be,vt,ri,rr,xc,ji,Hr],[oe]);We(Pl,[be,tl,Le,Ys],[]);We(Vi,[Je,be,fo,Xi,vt,Ki,ri,_o,_i],[oe]);We(Wr,[Ue,be,vt,ri,_i],[oe]);var ci=(()=>{let n=class n{translatePipe;documentService;emitCustomMenuSrc=new pt;emitCustomMenu$=this.emitCustomMenuSrc.asObservable();contextMenuStatusSrc=new zi(!1);contextMenuStatus$=this.contextMenuStatusSrc.asObservable();contextMenu=[];rightClickAction;menuAuthorityMap={};hidableMenus={};mouseEvent=null;constructor(e,t){this.translatePipe=e,this.documentService=t,this.contextMenu=[{items:K.get(a.CONTEXT_MENU_TOOLS_IN_USE)}],this.rightClickAction=()=>{this.publishContextMenuStatus(!0)}}getExportableFunctions(){return[{name:"openContextMenu",function:()=>(this.contextMenuStatusSrc.next(!0),Hi(void 0))},{name:"defineRightClickAction",hasCallback:!0,function:e=>(this.rightClickAction=e.onclick,Hi(void 0))}]}getExportableEvents(){return[{type:"customContextMenuExecute",subject:this.emitCustomMenu$.pipe(St(e=>({customEventId:e.customEventId,textData:e.textData,menuPosition:e.menuPosition})))}]}publishContextMenuStatus(e){this.contextMenuStatusSrc.next(e)}emitCustomMenuEvent(e){this.emitCustomMenuSrc.next(e)}create(e){return this.menuAuthorityMap={SAVE:this.checkAuthority(Be.SAVE_DOCUMENT),PRINT:this.checkAuthority(Be.PRINT_DOCUMENT),DOWNLOAD:this.checkAuthority(Be.DOWNLOAD_DOCUMENT),HIGHLIGHT:this.checkAuthority(Be.DRAW_ANNOTATION),UNDERLINE:this.checkAuthority(Be.DRAW_ANNOTATION),STRIKEOUT:this.checkAuthority(Be.DRAW_ANNOTATION),SEARCH:this.checkAuthority(Be.SEARCH_TEXT),COPY:this.checkAuthority(Be.COPY_TEXT)},[{items:this.menusOf(e)}]}menusOf(e){return this.contextMenu[0].items.filter(t=>t.id===void 0||!t.data?.isDefaultTool||t.id&&Se.hasKey(this.menuAuthorityMap,t.id)&&this.menuAuthorityMap[t.id]!==!1).map(t=>this.menuOf(e,t))}menuOf(e,t){let o,s;t.data?.eventId||t.type==="category"||t.type==="line"?(o=t.label,s=t.subLabel):(o=this.translatePipe.transform(typeof t.label=="string"?t.label:t.label()),s=typeof t.subLabel=="string"?t.subLabel:t.subLabel?.());let c={id:t.id,type:t.type,icon:t.label==="SLIDESHOW"&&e.isFullScreen?"papycon papycon-collapse":t.icon,label:o,subLabel:s,command:()=>{if(t.data?.eventId)return e.execute("CUSTOM_EVENT",t.data?.eventId);if(t.id)return e.execute(t.id);throw new $e("The menu item must have either an id to execute a command.")}};return t.data?.isTextTool&&!e.textParam&&Object.assign(c,{disabled:!0}),c}checkAuthority(e){return this.documentService.checkAuthority(e)}};v(n,"\u0275fac",function(t){return new(t||n)(Kt(oe),Kt(It))}),v(n,"\u0275prov",Ti({token:n,factory:n.\u0275fac}));let r=n;return r})();var Ml,Dl,wl,Ll,kl,Fl,Vl,Gu=["puMenuComp"],TE=(()=>{let n=class n{contentService;annotService;sdContextMenuService;changeDetectorRef;dialogService;downloadService;changeService;selectTextService;documentService;pageService;elementRef;subscriptionService;viewerService;store$;translatePipe;loggingService;customUIService;isClickOnGrayArea=!1;menuComp;menus=[];styles={transform:"translate(0, 10000px)",width:"155px",visibility:F.STYLE_VISIBILITY_HIDDEN,left:"0",top:"0",maxHeight:"308px",overflow:"auto"};preferences=null;pageCount=0;currentPageNo=0;scale=0;degree=0;isFullScreen=!1;textParam=null;clickedPage=null;commands=new Ri(this);get eventInfo(){return this.sdContextMenuService.mouseEvent}constructor(e,t,o,s,c,u,C,x,N,D,X,Q,ft,di,cn,oo,Wi){this.contentService=e,this.annotService=t,this.sdContextMenuService=o,this.changeDetectorRef=s,this.dialogService=c,this.downloadService=u,this.changeService=C,this.selectTextService=x,this.documentService=N,this.pageService=D,this.elementRef=X,this.subscriptionService=Q,this.viewerService=ft,this.store$=di,this.translatePipe=cn,this.loggingService=oo,this.customUIService=Wi}ngOnInit(){this.subscriptionService.push(Ge(this.elementRef.nativeElement,"wheel",{passive:!0}).subscribe({next:e=>{e.stopPropagation()}}),this.store$.pipe(Xe()).subscribe({next:e=>this.preferences=e}),this.store$.pipe(_e("degree")).subscribe({next:e=>this.degree=e}),this.store$.pipe(_e("pageCount")).subscribe({next:e=>this.pageCount=e}),this.store$.pipe(_e("currentPageNo")).subscribe({next:e=>{this.currentPageNo=e,this.close()}}),this.store$.pipe(_e("scale")).subscribe({next:e=>{this.scale=e,this.changeDetectorRef.detectChanges()}}),this.selectTextService.publishSelectedText$.subscribe({next:e=>{this.textParam=e}}),Ve.fullScreenState$.subscribe({next:e=>{this.isFullScreen=e,this.changeDetectorRef.markForCheck()}}),this.documentService.authorityUpdate$.subscribe({next:()=>{this.buildMenu(),this.changeDetectorRef.markForCheck()}}),this.pageService.clickedPage$.subscribe({next:e=>this.clickedPage=e}),this.store$.pipe(Uc([tn.CONTEXT_MENU_HIGHLIGHT,tn.CONTEXT_MENU_STRIKEOUT,tn.CONTEXT_MENU_UNDERLINE,tn.CONTEXT_MENU_COPY,tn.CONTEXT_MENU_SEARCH,tn.CONTEXT_MENU_CREATE_LINK,tn.CONTEXT_MENU_REDACTION])).subscribe({next:e=>{this.sdContextMenuService.hidableMenus=Oe(Oe({},this.sdContextMenuService.hidableMenus),e),this.buildMenu(),this.changeDetectorRef.markForCheck()}}),this.customUIService.customContextMenuUI$.pipe(je(()=>this.buildMenu())).subscribe({next:e=>{let t=e.filter(s=>s.position==="FIRST").map(s=>this.buildCustomContextMenu(s)),o=e.filter(s=>s.position==="LAST").map(s=>this.buildCustomContextMenu(s));this.menus[0].items=[...t,...this.menus[0].items,...o]}}))}ngAfterViewInit(){Di(0).pipe(L(()=>this.menus[0].items.length>0),je(()=>this.menuComp.openMenu()),Gt(()=>Di(0))).subscribe({next:()=>this.buildStyles()})}onClickCustomMenu(e){let t=this.clickedPage;this.sdContextMenuService.emitCustomMenuEvent({customEventId:e,textData:this.generateExternalTextData(),menuPosition:{pdfPageIndex:t?t.i:null,pdfPageX:t?this.eventInfo.offsetX:null,pdfPageY:t?t.bbox.h-this.eventInfo.offsetY:null,clientX:this.eventInfo.clientX,clientY:this.eventInfo.clientY}}),this.selectTextService.publishSelectedText(null),this.pageService.publishPage(null)}close(e){e&&(e.stopPropagation(),e.target.nodeName==="SD-CONTEXTMENU"&&this.selectTextService.publishSelectedText(null))}generateExternalTextData(){if(!this.textParam)return;let e=this.textParam.textBox,t=this.textParam.comp.data.slice(e.startIndex.li,e.endIndex.li+1).map(o=>({text:o.text,rects:o.rect}));return t.length>0&&(t.length===1?(t[0].text=t[0].text.slice(e.startIndex.ti,e.endIndex.ti+1),t[0].rects=t[0].rects.slice(e.startIndex.ti,e.endIndex.ti+1)):(t[0].text=t[0].text.slice(e.startIndex.ti),t[0].rects=t[0].rects.slice(e.startIndex.ti),t[t.length-1].text=t[t.length-1].text.slice(0,e.endIndex.ti+1),t[t.length-1].rects=t[t.length-1].rects.slice(0,e.endIndex.ti+1))),t}buildMenu(){let e=Object.keys(this.sdContextMenuService.hidableMenus).filter(t=>this.sdContextMenuService.hidableMenus[t]);this.menus=this.sdContextMenuService.create(this.commands),e.length&&e.forEach(t=>{t.includes("CONTEXT_MENU")&&this.menus.forEach(o=>{o.items=o.items.filter(s=>s.id!==t.substring(t.indexOf(".")+1,t.length))})})}buildStyles(){if(!this.textParam&&!this.elementRef.nativeElement.parentElement||this.changeDetectorRef.destroyed)return;let e=this.getAbsolutelyPosition();return this.styles.transform=`translate(${e.x}px, ${e.y}px)`,this.styles.visibility=null,F.bindLayoutOrder(this.styles,F.LayoutOrder.CONTEXT_MENU),this.changeDetectorRef.markForCheck(),this.styles}getAbsolutelyPosition(){let e=Ve.isMobile()&&this.textParam?this.textParam.finishEvt:this.eventInfo,t=this.elementRef.nativeElement.parentElement?.getBoundingClientRect();if(!T.isDefined(t))throw new Nt("Content view parent element is not defined.");let o={x:e.pageX-t.left,y:e.pageY-t.top},s=155,c=30,u=10,C=10,x=o.x+s;x>t.width&&(o.x-=x-t.width+C);let N=this.menus[0].items.length,D=o.y+N*c+u;return D>t.height&&(o.y-=D-t.height+C),o}buildCustomContextMenu(e){return{label:e.label??"",icon:e.icon,command:t=>{if(!e.onclick){this.loggingService.common("warn",le.NOT_EXIST,"onclick property");return}if(!t){this.loggingService.common("warn",le.NOT_EXIST,"event");return}let o=this.getAbsolutelyPosition(),s={pdfPageIndex:this.isClickOnGrayArea||!T.isDefined(this.clickedPage)?null:this.clickedPage.i,pdfPageX:this.isClickOnGrayArea?null:o.x,pdfPageY:this.isClickOnGrayArea?null:o.y,clientX:this.eventInfo.clientX,clientY:this.eventInfo.clientY},c=this.generateExternalTextData();c?e.onclick(Ls.simplifyMouseEvent(t),s,c):e.onclick(Ls.simplifyMouseEvent(t),s),this.selectTextService.publishSelectedText(null)}}}};v(n,"\u0275fac",function(t){return new(t||n)(m(ge),m(Re),m(ci),m(Y),m(zc),m(el),m(Qc),m(bi),m(It),m(bt),m(de),m(P),m(zn),m(xe),m(oe),m(De),m(Jc))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-contextmenu"]],viewQuery:function(t,o){if(t&1&&se(Gu,7),t&2){let s;ae(s=ce())&&(o.menuComp=s.first)}},hostBindings:function(t,o){t&1&&O("click",function(c){return o.close(c)})},inputs:{isClickOnGrayArea:"isClickOnGrayArea"},standalone:!1,features:[$([P])],decls:2,vars:2,consts:[["puMenuComp",""],[3,"menus","ngStyle"]],template:function(t,o){t&1&&I(0,"pu-menu",1,0),t&2&&p("menus",o.menus)("ngStyle",o.styles)},dependencies:[Ce,mr],styles:["[_nghost-%COMP%]{position:absolute;height:100%;left:0;top:0;display:block}pu-menu[_ngcontent-%COMP%]{overscroll-behavior:contain}"],changeDetection:0}));let r=n;return r})(),Ri=class{comp;constructor(n){this.comp=n}get isFullScreen(){return this.comp.isFullScreen}get textParam(){return this.comp.textParam}get annotService(){return this.comp.annotService}get contentService(){return this.comp.contentService}execute(n,i){if(!Se.hasKey(this,n)){this.comp.loggingService.common("warn",le.NOT_EXIST,`context menu command[${n}]`);return}let e=this[n].bind(this);i?e(i):e(),this.comp.selectTextService.publishSelectedText(null)}createAnnot(n){if(!this.textParam)throw new $e("The text parameter is required.");let{startEvt:i,page:e}=this.textParam,t=this.annotService.createAnnot(n,e,{x:i.offsetX,y:i.offsetY}),o=new en(i,this.textParam.comp,!1,!1);o.renderer=new Gn(o,t[0]),o.renderer.clear=()=>{},o.textBox=this.textParam.textBox,o.render(),o.destroy(),U.fitTextMarkupBox(t[0]),t.forEach(c=>{if(!c){this.comp.loggingService.common("warn",le.NOT_EXIST,this.comp.translatePipe.transform("ANNOTATION"));return}this.annotService.putModel(c)});let s={from:"AnnotComponent",sdEventType:fe.CREATE,pageIdx:e.i,annot:t[0]};this.contentService.fireAnnotEvent(s),this.contentService.fireAnnotListEvent(s),this.comp.selectTextService.publishSelectedText(null)}createLink(){if(!this.textParam)throw new $e("The text parameter is required.");let{startEvt:n,page:i}=this.textParam,e=this.annotService.createAnnot(V.LINK,i,{x:n.offsetX,y:n.offsetY}),t=new en(n,this.textParam.comp,!1,!1);t.renderer=new Gn(t,e[0]),t.renderer.clear=()=>{},t.textBox=this.textParam.textBox,t.render(),t.destroy(),U.fitTextMarkupBox(e[0]),this.contentService.publishEnableLinkCreationDialog(e[0]),this.comp.selectTextService.publishSelectedText(null)}CUSTOM_EVENT(n){this.comp.onClickCustomMenu(n)}[Ml="HIGHLIGHT"](){this.createAnnot(V.HIGHLIGHT)}[Dl="STRIKEOUT"](){this.createAnnot(V.STRIKE)}[wl="UNDERLINE"](){this.createAnnot(V.UNDERLINE)}[Ll="CREATE_LINK"](){this.createLink()}[kl="COPY"](){if(!this.textParam)throw new $e("The text parameter is required.");this.textParam.text&&Ve.copyToClipboard(this.textParam.text)}[Fl="SEARCH"](){if(!this.textParam)throw new $e("The text parameter is required.");if(!this.textParam.text)return;let n=this.textParam;this.comp.store$.dispatch(wt.set({key:"rightSideViewVisible",value:!0})),this.comp.store$.dispatch(wt.set({key:"rightSideViewMode",value:Tn.TextSearch})),setTimeout(()=>this.contentService.searchSelectingKeyword(n.text.slice(0,Fe.textSearchLengthLimit)))}[Vl="REDACTION"](){if(!this.textParam)throw new $e("The text parameter is required.");let{startEvt:n,page:i}=this.textParam,e=this.annotService.createAnnot(V.HIGHLIGHT,i,{x:n.offsetX,y:n.offsetY})[0];e.attributes.quadPoints=[];let t=new en(n,this.textParam.comp,!1,!1);t.renderer=new Gn(t,e),t.renderer.clear=()=>{},t.textBox=this.textParam.textBox,t.render(),t.destroy(),e.attributes.quadPoints.forEach(o=>{let s=this.annotService.createAnnot(V.REDACTION,i,{x:n.offsetX,y:n.offsetY})[0];s.attributes.rect={top:Math.max(...o.map(u=>u.y)),right:Math.max(...o.map(u=>u.x)),bottom:Math.min(...o.map(u=>u.y)),left:Math.min(...o.map(u=>u.x))},this.annotService.putModel(s);let c={from:"AnnotComponent",sdEventType:fe.CREATE,pageIdx:i.i,annot:s};this.contentService.fireAnnotEvent(c),this.contentService.fireAnnotListEvent(c)}),this.comp.selectTextService.publishSelectedText(null)}SLIDESHOW(){this.comp.viewerService.setSlideshow()}SAVE(){this.comp.changeService.saveDocument()}GO_TO_FIRST_PAGE(){this.movePage(0)}GO_TO_LAST_PAGE(){this.movePage(this.comp.pageCount)}GO_TO_PREVIOUS_PAGE(){this.movePage(this.comp.currentPageNo-1)}GO_TO_NEXT_PAGE(){this.movePage(this.comp.currentPageNo+1)}ZOOM_IN(){this.setZoom(10,!0)}ZOOM_OUT(){this.setZoom(-10,!0)}MATCH_HEIGHT(){this.contentService.requestViewChange({fitMode:1})}MATCH_WIDTH(){this.contentService.requestViewChange({fitMode:0})}FIT(){this.contentService.requestViewChange({fitMode:3})}FIT_TO_ACTUAL_SIZE(){this.contentService.requestViewChange({fitMode:4})}ROTATE_CW(){this.setDocumentRotation(-90)}ROTATE_CCW(){this.setDocumentRotation(90)}SELECT_ANNOT_TOOL(){this.setDragMode(ye.SELECT_ANNOT)}SELECT_TEXT(){this.setDragMode(ye.SELECT_TEXT)}SCROLL_MODE(){this.setDragMode(ye.MOVE)}PRINT(){this.comp.dialogService.toggleDialogVisibility(Wc.PRINT,!0)}DOWNLOAD(){this.comp.downloadService.downloadDocument()}movePage(n){this.contentService.requestViewChange({pageNo:n})}setZoom(n,i=!1){let e=this.comp.scale+n;typeof e!="number"||!isFinite(e)||isNaN(e)||(this.contentService.requestViewChange({scale:e,checkScale:i}),this.comp.changeDetectorRef.markForCheck())}setDocumentRotation(n){this.contentService.requestViewChange({degree:this.comp.degree-n})}setDragMode(n){this.comp.store$.dispatch(wt.set({key:"dragMode",value:n})),this.comp.store$.dispatch(En.unselectTool()),this.annotService.closeEditor()}};ee([Ae(J.contextMenuComp.highlight)],Ri.prototype,Ml,null);ee([Ae(J.contextMenuComp.strikeout)],Ri.prototype,Dl,null);ee([Ae(J.contextMenuComp.underline)],Ri.prototype,wl,null);ee([Ae(J.contextMenuComp.createLink)],Ri.prototype,Ll,null);ee([Ae(J.contextMenuComp.copy)],Ri.prototype,kl,null);ee([Ae(J.contextMenuComp.search)],Ri.prototype,Fl,null);ee([Ae(J.contextMenuComp.redaction)],Ri.prototype,Vl,null);var AE=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({providers:[ci],imports:[mt,ai,hr]}));let r=n;return r})();var Qs=class{_value;get value(){return this._value}constructor(n=0){this._value=n}next(){return++this._value}},Wu=new Qs,Ui={create:xr("[GuideLine] Create GuideLine",vr()),update:xr("[GuideLine] Update GuideLine",vr()),remove:xr("[GuideLine] Remove GuideLine",vr())},zu=bc({pages:{}},Ir(Ui.create,(r,n)=>{let{pageIndex:i,guideLine:e}=n.payload,t=r.pages[i]??{lines:[],selected:-1},o=rt(Oe({},e),{id:Wu.next()});return rt(Oe({},r),{pages:rt(Oe({},r.pages),{[i]:{lines:rt(Oe({},t.lines),{[o.id]:o}),selected:o.id}})})}),Ir(Ui.update,(r,n)=>{let{pageIndex:i,guideLine:e}=n.payload,t=r.pages[i]??{lines:{},selected:-1};return rt(Oe({},r),{pages:rt(Oe({},r.pages),{[i]:{lines:rt(Oe({},t.lines),{[e.id]:e}),selected:e.id}})})}),Ir(Ui.remove,(r,n)=>{let{pageIndex:i,guideLine:e}=n.payload,t=r.pages[i]??{lines:{},selected:-1},o={lines:rt(Oe({},t.lines),{[e.id]:void 0}),selected:t.selected===e.id?-1:t.selected};return rt(Oe({},r),{pages:rt(Oe({},r.pages),{[i]:o})})}));function Ul(r,n){return zu(r,n)}var Zs="guideLine";function Bl(){return Ho(Or(Oc(Zs)))}function $r(r){return Ho(Bl(),Or(n=>n.pages[r]?.lines??{}))}function Gl(r){return Ho(Bl(),Or(n=>{let i=n.pages[r]??{lines:{},selected:-1};return i.lines[i.selected]??null}))}function Hu(r,n){if(r&1){let i=w();h(0,"div",1),O("mousedown",function(){let t=f(i).$implicit,o=d();return g(o.onMousedown(t))}),_()}if(r&2){let i=n.$implicit,e=d();p("ngStyle",e.getLineStyles(i))}}var HE=(()=>{let n=class n{elementRef;changeDetectorRef;subscriptionService;store$;shortcutService;loggingService;pdfPage;get guideLineArray(){return T.isDefined(this.guideLines)?Object.values(this.guideLines).filter(T.isDefined):[]}guideLines;selectedLine=null;scale;degree;constructor(e,t,o,s,c,u){this.elementRef=e,this.changeDetectorRef=t,this.subscriptionService=o,this.store$=s,this.shortcutService=c,this.loggingService=u}trackByGuideLine=(e,t)=>t.id;ngOnInit(){this.subscriptionService.push(this.store$.pipe($r(this.pdfPage.i)).subscribe({next:e=>{this.guideLines=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Gl(this.pdfPage.i)).subscribe({next:e=>{this.selectedLine=e,this.selectedLine&&this.selectedLine.offset<0&&this.listenGuideLineMove(this.selectedLine)}}),this.store$.pipe(_e("scale")).subscribe({next:e=>this.scale=e}),this.store$.pipe(_e("degree")).subscribe({next:e=>{this.degree=e,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(qt.DELETE_GUIDELINE).pipe(qa(this.store$.pipe(_e("currentPageNo"))),L(([e,t])=>this.pdfPage.i===t-1)).subscribe({next:()=>{if(this.selectedLine===null){this.loggingService.common("warn",le.NOT_EXIST,"selectedLine");return}this.store$.dispatch(Ui.remove({payload:{pageIndex:this.pdfPage.i,guideLine:this.selectedLine}}))}}))}onMousedown(e){this.listenGuideLineMove(e)}getLineStyles(e){let t=F.normalizeDegree(this.degree+this.pdfPage.r+(e.isVertical?90:0)),o=`${Math.max(n.LINE_WIDTH/(this.scale/100),1)}px`,s={backgroundColor:"#FF6100"};return Oe({position:"absolute",display:e.offset<0?"none":"block",top:e.isVertical?"0px":`${e.offset}px`,left:e.isVertical?`${e.offset}px`:"0px",width:e.isVertical?o:`${this.pdfPage.bbox.w}px`,height:e.isVertical?`${this.pdfPage.bbox.h}px`:o,backgroundColor:"#036FFC",backgroundClip:"padding-box",cursor:t===0||t===180?"row-resize":"col-resize",zIndex:String(F.LayoutOrder.GuideLine)},e.id===this.selectedLine?.id?s:{})}listenGuideLineMove(e){let t=this.elementRef.nativeElement.parentElement;if(!T.isDefined(t))throw new Nt("Page element is not defined");let o=F.normalizeDegree(this.degree+this.pdfPage.r+(e.isVertical?90:0)),s=o===0||o===180?"row-resizing":"col-resizing";document.body.classList.add(s),this.selectedLine=e,this.subscriptionService.push(Ge(t,"mousemove",{capture:!0}).pipe(Xo(Xt(Ge(window,"mouseup",{capture:!0}),Ge(t,"mouseleave")))).subscribe({next:c=>{let u=this.getPageOffset(c.target,{offsetX:c.offsetX,offsetY:c.offsetY});if(this.selectedLine===null){this.loggingService.common("warn",le.NOT_EXIST,"selectedLine");return}this.selectedLine=Oe({},this.selectedLine),this.selectedLine.offset=this.selectedLine.isVertical?u.offsetX:u.offsetY,this.guideLines=rt(Oe({},this.guideLines),{[this.selectedLine.id]:this.selectedLine}),this.changeDetectorRef.markForCheck()},complete:()=>{if(this.selectedLine===null){this.loggingService.common("warn",le.NOT_EXIST,"selectedLine");return}this.selectedLine.offset<0?this.store$.dispatch(Ui.remove({payload:{pageIndex:this.pdfPage.i,guideLine:this.selectedLine}})):this.store$.dispatch(Ui.update({payload:{pageIndex:this.pdfPage.i,guideLine:this.selectedLine}})),document.body.classList.remove(s)}}))}getPageOffset(e,t){return e.matches("sd-page")?t:!e.offsetParent||e.offsetWidth===0||e.offsetHeight===0?this.getPageOffset(e.parentNode,t):this.getPageOffset(e.parentNode,{offsetX:t.offsetX+e.offsetLeft,offsetY:t.offsetY+e.offsetTop})}};v(n,"LINE_WIDTH",1),v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Y),m(P),m(xe),m(Un),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-guide-line"]],inputs:{pdfPage:"pdfPage"},standalone:!1,features:[$([P])],decls:1,vars:2,consts:[[3,"ngStyle","mousedown",4,"ngFor","ngForOf","ngForTrackBy"],[3,"mousedown","ngStyle"]],template:function(t,o){t&1&&R(0,Hu,1,1,"div",0),t&2&&p("ngForOf",o.guideLineArray)("ngForTrackBy",o.trackByGuideLine)},dependencies:[Ue,Ce],encapsulation:2}));let r=n;return r})();var Yr=(()=>{let n=class n{scaleWrapperOffsetSrc=new Ds(1);scaleWrapperOffset$=this.scaleWrapperOffsetSrc.asObservable();scrollOffsetSrc=new Ds(1);scrollOffset$=this.scrollOffsetSrc.asObservable();publishContentViewOffset(e){this.scaleWrapperOffsetSrc.next(e)}publishScrollOffset(e){this.scrollOffsetSrc.next(e)}};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275prov",Ti({token:n,factory:n.\u0275fac}));let r=n;return r})();var $u=()=>({isVertical:!1,className:"horizontal"}),Yu=()=>({isVertical:!0,className:"vertical"});function Xu(r,n){r&1&&dn(0)}function Ku(r,n){r&1&&dn(0)}function Qu(r,n){if(r&1&&(ne(),h(0,"text"),M(1),_()),r&2){let i=n.$implicit,e=d(2);G("font-size",e.markerFontSize)("x",i.x)("y",i.y),l(),k(i.content)}}function Zu(r,n){if(r&1){let i=w();h(0,"div",3),O("click",function(t){let o=f(i).isVertical,s=d();return g(s.onRulerClick(o,t))})("mousedown",function(t){let o=f(i).isVertical,s=d();return g(s.onRulerMousedown(o,t))}),ne(),h(1,"svg"),I(2,"path")(3,"path"),R(4,Qu,2,4,"text",4),_()()}if(r&2){let i=n.isVertical,e=n.className,t=d();p("ngClass",e)("ngStyle",t.getRulerStyles(i)),l(),qe("transform",i?"translate(0, "+t.rulerOffset.offsetY+"px)":"translate("+t.rulerOffset.offsetX+"px, 0)"),l(),G("d",t.getPath(e).rendered.d),l(),G("d",t.getPath(e).mouse),l(),p("ngForOf",t.getPath(e).rendered.texts)}}var Kn=class Kn{elementRef;changeDetectorRef;subscriptionService;store$;pageService;guideLineService;unitPipe;markerFontSize=12;get rulerUnit(){return this.unitPipe.transform(this.scale>=250?q.MILLIMETER:q.CENTIMETER)}mousePath={horizontal:"",vertical:""};rulerOffset={offsetX:0,offsetY:0};rendered={horizontal:{d:"",texts:[]},vertical:{d:"",texts:[]}};scale;degree;pdfPage;cornerStyles={width:`${36}px`,height:`${36}px`};constructor(n,i,e,t,o,s,c){this.elementRef=n,this.changeDetectorRef=i,this.subscriptionService=e,this.store$=t,this.pageService=o,this.guideLineService=s,this.unitPipe=c}ngOnInit(){this.initSubscriptions()}getRulerStyles(n){let i={top:"0px",left:"0px"};return i[n?"top":"left"]=`${36}px`,i[n?"width":"height"]=`${36}px`,i[n?"height":"width"]=`calc(100% - ${36}px)`,i}render(n){this.rulerOffset=n;let i=F.normalizeScale(this.scale),e=s=>Ye.convert(q.POINT,this.rulerUnit,s/i),t={offsetX:e(n.offsetX),offsetY:e(n.offsetY),width:e(n.width),height:e(n.height)},o={horizontal:this.fixRange({min:-t.offsetX,max:t.width-t.offsetX}),vertical:this.fixRange({min:-t.offsetY,max:t.height-t.offsetY})};this.rendered.horizontal=this.renderRuler(this.rulerUnit,o.horizontal,i,!1),this.rendered.vertical=this.renderRuler(this.rulerUnit,o.vertical,i,!0),this.changeDetectorRef.markForCheck()}onRulerClick(n,i){let e=(n?i.offsetY:i.offsetX)/F.normalizeScale(this.scale),t=F.normalizeDegree(this.pdfPage.r+this.degree+(n?0:90)),o={isVertical:t===90||t===270,offset:e};e<0||(o.isVertical?this.pdfPage.bbox.w:this.pdfPage.bbox.h)<e||(t===180?o.offset=this.pdfPage.bbox.h-o.offset:t===270&&(o.offset=this.pdfPage.bbox.w-o.offset),this.createGuidelineForStatistics(Ws.DRAW_ADJOINT_LINE_BY_CLICK,o))}onRulerMousedown(n,i){let e=F.normalizeDegree(this.pdfPage.r+this.degree+(n?90:0)),t={offset:-1,isVertical:e===90||e===270};this.subscriptionService.push(Ge(i.currentTarget,"mouseleave").pipe(Xo(Ge(window,"mouseup",{capture:!0})),ii(1)).subscribe({next:()=>this.createGuidelineForStatistics(Ws.DRAW_ADJOINT_LINE_BY_DRAG,t)}))}createGuideline(n){this.store$.dispatch(Ui.create({payload:{guideLine:n,pageIndex:this.pdfPage.i}}))}createGuidelineForStatistics(n,i){this.createGuideline(i)}initSubscriptions(){this.subscriptionService.push(Ge(window,"mousemove",{capture:!0}).subscribe({next:n=>{let i=this.elementRef.nativeElement.getBoundingClientRect(),e=(n.clientX-i.left-36-this.rulerOffset.offsetX).toFixed(3),t=(n.clientY-i.top-36-this.rulerOffset.offsetY).toFixed(3);this.mousePath={horizontal:`M ${e} 0 L ${e} ${36}`,vertical:`M 0 ${t} L ${36} ${t}`},this.changeDetectorRef.markForCheck()}}),po([this.store$.pipe(_e("currentPageNo")),this.pageService.pdfPages$]).pipe(je({next:([n,i])=>this.pdfPage=i[n-1]}),Gt(()=>po([this.guideLineService.scaleWrapperOffset$,this.guideLineService.scrollOffset$])),Ya(1),St(([n,i])=>({offsetX:n.offsetX-i.offsetX,offsetY:n.offsetY-i.offsetY,width:n.width,height:n.height}))).subscribe({next:n=>this.render(n)}),this.store$.pipe(_e("scale")).subscribe({next:n=>this.scale=n}),this.store$.pipe(_e("degree")).subscribe({next:n=>this.degree=n}))}renderRuler(n,i,e,t){let o={d:"",texts:[]};for(let s=i.min;s<=i.max;++s){let c=s%10===0?36:s%5===0?36/2:36/4,u=Number(Ye.convert(n,q.POINT,s*e).toFixed(3)),C=u,x=0,N=u,D=c;if(t&&([C,x]=[x,C],[N,D]=[D,N]),o.d+=`M ${C} ${x} L ${N} ${D}`,s%10===0){let X=u,Q=c;t&&([X,Q]=[Q,X]),X+=3,Q-=3,o.texts.push({x:X,y:Q,content:s})}}return o}fixRange(n){return{min:Math[n.min>0?"ceil":"floor"](n.min),max:Math[n.min>0?"floor":"ceil"](n.max)}}getPath(n){return{mouse:this.mousePath[n],rendered:this.rendered[n]}}};v(Kn,"\u0275fac",function(i){return new(i||Kn)(m(de),m(Y),m(P),m(xe),m(bt),m(Yr),m(Ji))}),v(Kn,"\u0275cmp",j({type:Kn,selectors:[["sd-ruler"]],standalone:!1,features:[$([P])],decls:5,vars:7,consts:[["svgTemplateRef",""],[1,"corner",3,"ngStyle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ruler-container",3,"click","mousedown","ngClass","ngStyle"],[4,"ngFor","ngForOf"]],template:function(i,e){if(i&1&&(I(0,"div",1),R(1,Xu,1,0,"ng-container",2)(2,Ku,1,0,"ng-container",2)(3,Zu,5,7,"ng-template",null,0,He)),i&2){let t=we(4);p("ngStyle",e.cornerStyles),l(),p("ngTemplateOutlet",t)("ngTemplateOutletContext",pe(5,$u)),l(),p("ngTemplateOutlet",t)("ngTemplateOutletContext",pe(6,Yu))}},dependencies:[Je,Ue,sc,Ce],styles:["div.corner[_ngcontent-%COMP%]{position:absolute;top:0;left:0;z-index:2;box-sizing:border-box;border-right:1px solid var(--mono-30);border-bottom:1px solid var(--mono-30);background-color:var(--mono-00)}.ruler-container[_ngcontent-%COMP%]{position:absolute;box-sizing:border-box;background-color:var(--mono-00)}.ruler-container.horizontal[_ngcontent-%COMP%]{z-index:1;border-bottom:1px solid var(--mono-30)}.ruler-container.vertical[_ngcontent-%COMP%]{border-right:1px solid var(--mono-30)}svg[_ngcontent-%COMP%]{width:100%;height:100%;overflow:visible}svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:var(--mono-99);stroke-width:1;fill:transparent}svg[_ngcontent-%COMP%]   text[_ngcontent-%COMP%]{stroke:var(--mono-99)}"],changeDetection:0}));var Xr=Kn;ee([Ae(J.rulerComp.ngOnInit)],Xr.prototype,"ngOnInit",null);ee([Ae(J.rulerComp.createGuidelineForStatistics)],Xr.prototype,"createGuidelineForStatistics",null);var mS=(()=>{let n=class n{static forRoot(){return{ngModule:n,providers:[Yr]}}};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({imports:[mt,br.forFeature(Zs,Ul)]}));let r=n;return r})();var Kr=new Ja("sd-instant-data"),xn=class{_componentInstance;_onEvent=new pt;_beforeClosed=new pt;_afterClosed=new pt;beforeClosed(){return this._beforeClosed.asObservable().pipe(ii(1))}afterClosed(){return this._afterClosed.asObservable().pipe(ii(1))}onEvent(){return this._onEvent.asObservable()}emit(n){this._onEvent.next(n)}close(n){this._componentInstance.onDestroy(()=>{this._afterClosed.next(n),this._afterClosed.unsubscribe(),this._beforeClosed.unsubscribe(),this._onEvent.unsubscribe()}),this._beforeClosed.next(n),this._componentInstance.destroy()}};var Qr=(()=>{let n=class n{injector;constructor(e){this.injector=e}instant(e,t,o){let s=new xn,c=Ko.create({parent:this.injector,providers:[{provide:Kr,useValue:o},{provide:xn,useValue:s}]}),u=e.createComponent(t,{injector:c});return s._componentInstance=u,u.changeDetectorRef.detectChanges(),s}};v(n,"\u0275fac",function(t){return new(t||n)(Kt(Ko))}),v(n,"\u0275prov",Ti({token:n,factory:n.\u0275fac}));let r=n;return r})();var sn=function(r){return r.CREATE="create",r.EDIT="edit",r}(sn||{}),Zr=(()=>{let n=class n{regexModalParam;modalService;portalRef;subscriptionService;formBuilder;elementRef;regexForm;get RegexModalType(){return sn}get type(){return this.regexModalParam.type}constructor(e,t,o,s,c,u){this.regexModalParam=e,this.modalService=t,this.portalRef=o,this.subscriptionService=s,this.formBuilder=c,this.elementRef=u,this.regexForm=this.formBuilder.group({id:this.formBuilder.nonNullable.control(""),title:this.formBuilder.nonNullable.control(""),content:this.formBuilder.nonNullable.control("")})}ngOnInit(){this.type===sn.EDIT&&(this.regexForm.controls.id.setValue(this.regexModalParam.name),this.regexForm.controls.title.setValue(this.regexModalParam.name),this.regexForm.controls.content.setValue(this.regexModalParam.description)),this.subscriptionService.push(Ge(window,"keydown",{capture:!0}).pipe(L(e=>e.key==="Escape"),L(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.onButtonClick(!1)})),this.elementRef.nativeElement.parentElement.style.minWidth="460px"}onButtonClick(e){this.portalRef.dispose(e?this.regexForm.value:void 0)}};v(n,"\u0275fac",function(t){return new(t||n)(m(Dn),m(Zt),m(Si),m(P),m(Qi),m(de))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-regex-modal"]],standalone:!1,features:[$([P])],decls:24,vars:22,consts:[[1,"papycon","papycon-cross",3,"click"],[1,"container",3,"formGroup"],[1,"input-container"],["formControlName","title",3,"placeholder"],["formControlName","content",3,"placeholder"],["size","small","color","white",1,"ep-button",3,"click"],["size","small","color","primary",1,"ep-button",3,"click"]],template:function(t,o){t&1&&(h(0,"h3"),M(1),E(2,"translate"),h(3,"i",0),O("click",function(){return o.onButtonClick(!1)}),_()(),h(4,"main",1)(5,"div",2)(6,"span"),M(7),E(8,"translate"),_(),I(9,"pu-input",3),E(10,"translate"),_(),h(11,"div",2)(12,"span"),M(13),E(14,"translate"),_(),I(15,"textarea",4),E(16,"translate"),_()(),h(17,"footer")(18,"button",5),O("click",function(){return o.onButtonClick(!1)}),M(19),E(20,"translate"),_(),h(21,"button",6),O("click",function(){return o.onButtonClick(!0)}),M(22),E(23,"translate"),_()()),t&2&&(l(),ke(" ",S(2,8,o.type===o.RegexModalType.CREATE?"ADD_USER_DEFINED_REGEX":"EDIT_REGEX_HEADER")," "),l(3),p("formGroup",o.regexForm),l(3),k(S(8,10,"TITLE")),l(2),p("placeholder",S(10,12,"NEW_TEMPLATE")),l(4),k(S(14,14,"REGEX_HEADER")),l(2),p("placeholder",S(16,16,"REGEX_HEADER_TEXTAREA_PLACEHOLDER")),l(4),k(S(20,18,"CANCEL")),l(3),k(S(23,20,"OK")))},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:#1e1e1e;display:flex;margin:8px 0;justify-content:space-between;align-items:flex-start}h3[_ngcontent-%COMP%]   .papycon-cross[_ngcontent-%COMP%]{font-size:13px;line-height:22px;cursor:pointer;width:22px;height:22px;text-align:center;color:#6c6c6c;margin-right:0}main[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:#6c6c6c;white-space:pre-wrap;display:block;flex-direction:column;align-items:center}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:NotoSans-Medium;font-size:13px;letter-spacing:-.5px;color:#6c6c6c}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{height:40px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]  input{padding:0 8px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border-radius:2px;border:solid 1.2px #DADADA;background-color:#fff;padding:8px;font-family:NotoSans-Regular;font-size:14px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:first-child{margin-top:16px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:last-child{margin-top:11px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:last-child   textarea[_ngcontent-%COMP%]{height:260px}footer[_ngcontent-%COMP%]{text-align:right;margin-top:20px}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));let r=n;return r})();var qu=["configItem"],Ju=["puDropdown"],em=["puRadioButton"],tm=r=>({marginRight:r}),Hl=r=>({fontSize:r}),im=r=>({content:r,className:"with-icon"}),nm=r=>({"background-color":r}),om=()=>({color:"#6C6C6C"});function rm(r,n){if(r&1&&(h(0,"div",20),I(1,"i",21),_()),r&2){let i=n.$implicit,e=n.index,t=d(2);p("ngStyle",gt(3,tm,e===(t.item.data.icons==null?null:t.item.data.icons.length)-1?"8px":"")),l(),p("ngClass","papycon-"+i)("ngStyle",gt(5,Hl,t.item.data.iconSize))}}function sm(r,n){if(r&1){let i=w();h(0,"i",22),O("click",function(t){f(i);let o=d(2);return t.stopPropagation(),g(o.onNestedItemClick(o.item))}),_()}if(r&2){let i=d(2);p("@chevron",i.item.expanded)}}function am(r,n){if(r&1){let i=w();h(0,"pu-radio-button",23,2),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.radioConfig[o.item.parent.data.key].value,t)||(o.radioConfig[o.item.parent.data.key].value=t),g(t)}),O("ngModelChange",function(){f(i);let t=d(2);return g(t.radioModelChange())}),_()}if(r&2){let i=d(2);p("disabled",i.item.data.disable||i.isDisabled())("label",S(2,4,i.item.data.name))("value",i.item.data.key),me("ngModel",i.radioConfig[i.item.parent.data.key].value)}}function cm(r,n){if(r&1&&(h(0,"span",24),M(1),E(2,"translate"),_()),r&2){let i=d(2);l(),k(S(2,1,i.item.data.name))}}function lm(r,n){if(r&1&&(I(0,"i",25),E(1,"translate")),r&2){let i=d(2);p("tooltip",gt(3,im,S(1,1,i.item.data.tooltip)))}}function pm(r,n){if(r&1){let i=w();h(0,"div",26)(1,"i",27),O("click",function(){f(i);let t=d(2);return g(t.openRegexModal(t.RegexModalType.EDIT))}),_(),h(2,"i",28),O("click",function(){f(i);let t=d(2);return g(t.deleteRegexItem())}),_()()}}function dm(r,n){if(r&1&&(h(0,"span",29),M(1),E(2,"translate"),_()),r&2){let i=d(2);W("disabled",i.isDisabled()),l(),k(S(2,3,(i.configDescriptions[i.radioConfig[i.item.data.key].value]==null?null:i.configDescriptions[i.radioConfig[i.item.data.key].value].name)||""))}}function um(r,n){if(r&1){let i=w();h(0,"pu-toggle-button",30),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.item.data.value,t)||(o.item.data.value=t),g(t)}),O("click",function(t){return f(i),g(t.stopPropagation())})("ngModelChange",function(){f(i);let t=d(2);return g(t.toggle())}),_()}if(r&2){let i=d(2);W("disabled",i.item.data.disable||i.isDisabled()),me("ngModel",i.item.data.value)}}function mm(r,n){r&1&&I(0,"i",36)}function hm(r,n){if(r&1){let i=w();h(0,"div",37)(1,"pu-color-picker",38),O("cancel",function(){f(i);let t=d(3);return g(t.colorPickerOpened=!1)})("confirm",function(t){f(i);let o=d(3);return g(o.onColorChange(t))}),_()()}if(r&2){let i=d(3);l(),p("inputColor",i.item.data.value)}}function _m(r,n){if(r&1){let i=w();h(0,"div",31)(1,"div",32),O("click",function(){f(i);let t=d(2);return g(t.colorPickerOpened=!0)}),R(2,mm,1,0,"i",33),_(),h(3,"pu-input",34),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.item.data.value,t)||(o.item.data.value=t),g(t)}),O("focus",function(){f(i);let t=d(2);return g(t.colorPickerOpened=!1)})("ngModelChange",function(t){f(i);let o=d(2);return g(o.onColorChange(t))}),_(),R(4,hm,2,1,"div",35),_()}if(r&2){let i=d(2);W("disabled",i.item.data.disable||i.isDisabled()),l(),p("ngStyle",gt(9,nm,i.item.data.value)),l(),p("ngIf",!i.validateColor(i.item.data.value)),l(),p("inputStyle",pe(11,om))("maxLength",7)("placeholder",i.getDefaultRuntimeEnv(i.item.data.key)),me("ngModel",i.item.data.value),l(),p("ngIf",i.colorPickerOpened)}}function fm(r,n){if(r&1){let i=w();h(0,"pu-dropdown",39,3),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.item.data.value,t)||(o.item.data.value=t),g(t)}),O("ngModelChange",function(t){f(i);let o=d(2);return g(o.onDropDownChange(t))}),_()}if(r&2){let i=d(2);p("disabled",i.item.data.disable||i.isDisabled())("options",i.item.data.options),me("ngModel",i.item.data.value)}}function gm(r,n){if(r&1){let i=w();h(0,"pu-input",40),he("ngModelChange",function(t){f(i);let o=d(2);return ue(o.item.data.value,t)||(o.item.data.value=t),g(t)}),O("ngModelChange",function(t){f(i);let o=d(2);return g(o.onTextChange(t))}),_()}if(r&2){let i=d(2);p("disabled",i.item.data.disable),me("ngModel",i.item.data.value)}}function Cm(r,n){if(r&1&&(R(0,rm,2,7,"div",7)(1,sm,1,1,"i",8),h(2,"div",9),R(3,am,3,6,"pu-radio-button",10)(4,cm,3,3,"span",11)(5,lm,2,5,"i",12),h(6,"div",13),M(7),E(8,"translate"),_(),R(9,pm,3,0,"div",14),_(),R(10,dm,3,5,"span",15)(11,um,1,3,"pu-toggle-button",16)(12,_m,5,12,"div",17)(13,fm,2,3,"pu-dropdown",18)(14,gm,1,2,"pu-input",19)),r&2){let i=d();p("ngForOf",i.item.data.icons),l(),p("ngIf",i.hasChildren),l(),W("editable",i.item.data.editable),l(),p("ngIf",i.item.parent&&i.radioConfig[i.item.parent.data.key]&&i.item.data.isRadio),l(),p("ngIf",!i.item.data.isRadio||i.radioConfig[i.item.data.key]),l(),p("ngIf",i.item.data.tooltip),l(2),k(S(8,14,i.item.data.description||"")),l(2),p("ngIf",i.item.data.editable),l(),p("ngIf",i.radioConfig[i.item.data.key]),l(),p("ngIf",i.visibleToggleButton),l(),p("ngIf",i.item.data.isColorPicker),l(),p("ngIf",i.item.data.isDropDown),l(),p("ngIf",i.item.data.isText)}}function Tm(r,n){if(r&1){let i=w();h(0,"button",41),O("click",function(){f(i);let t=d();return g(t.openRegexModal(t.RegexModalType.CREATE))}),I(1,"i",21),h(2,"span"),M(3),E(4,"translate"),_()()}if(r&2){let i=d();l(),p("ngClass","papycon-"+((i.item.data.icons==null?null:i.item.data.icons[0])||""))("ngStyle",gt(5,Hl,i.item.data.iconSize)),l(2),k(S(4,3,"ADD_USER_DEFINED_REGEX"))}}function Em(r,n){r&1&&I(0,"div",42)}var qs=(()=>{let n=class n{ngControl;changeDetectorRef;configsService;modalService;translatePipe;item;onRegexDialogConfirm=new Ke;onRegexDelete=new Ke;onToggle=new Ke;onRadioModelChange=new Ke;onColorModelChange=new Ke;onDropDownModelChange=new Ke;onTextModelChange=new Ke;configItemRef;puDropdown;puRadioButton;get setDuration(){return{value:"",params:{duration:this.item.data.depth?400:0}}}get RegexModalType(){return sn}get configDescriptions(){return Vr}get IgnoredKey(){return H}get radioConfig(){return this.configsService.radioConfig}get RuntimeEnvKey(){return a}get hasChildren(){return this.item.children.length>0&&this.item.data.depth!==void 0&&this.item.data.depth>=0}get visibleToggleButton(){return!this.item.data.isRadio&&!this.item.data.isColorPicker&&!this.item.data.isDropDown&&!this.item.data.isText&&!this.item.data.isDummy}colorPickerOpened=!1;isShownWarningModal=!1;constructor(e,t,o,s,c){this.ngControl=e,this.changeDetectorRef=t,this.configsService=o,this.modalService=s,this.translatePipe=c,e&&(this.ngControl.valueAccessor=this)}ngAfterViewInit(){Ge(this.configItemRef.nativeElement,"click",{capture:!0}).subscribe({next:e=>this.onHasWarningItemClick(e)})}getDefaultRuntimeEnv(e){return y(e)}validateColor(e){return!!hn.parseRgbString(e)}isDisabled(){return this.item.data.deps!==void 0&&this.item.data.deps.some(e=>!K.get(e))}onNestedItemClick(e){e.children.length!==0&&(e.expanded=!e.expanded)}openRegexModal(e){let t={type:sn.CREATE};e===sn.EDIT&&(t.type=sn.EDIT,t.name=this.item.data.name,t.description=this.item.data.description),this.modalService.createModal(Zr,t).addOnDisposeListener(o=>{T.isDefined(o)&&this.onRegexDialogConfirm.emit({type:t.type,values:o})})}showWarningModal(e,t){this.configsService.fireOpenWarningModal({content:e,onDispose:t})}onHasWarningItemClick(e){let t=this.item.data.warning,o=e.target,s=u=>u.tagName==="INPUT"||this.item.data.isRadio&&this.puRadioButton?.element.nativeElement.contains(u)||this.item.data.isDropDown&&this.puDropdown?.element.nativeElement.contains(u),c=()=>xt.isObject(t?.triggerValue)?JSON.stringify(t?.triggerValue)!==JSON.stringify(this.item.data.value):t?.triggerValue!==this.item.data.value;!t||this.isShownWarningModal||!(o instanceof HTMLElement)||!s(o)||!c()||(e.preventDefault(),e.stopPropagation(),this.isShownWarningModal=!0,this.showWarningModal(this.translatePipe.transform(t.message),u=>{u&&o.click()}))}toggle(){this.onToggle.emit()}onColorChange(e){this.item.data.value=e,this.onColorModelChange.emit(this.item),this.colorPickerOpened=!1}onDropDownChange(e){this.onDropDownModelChange.emit(e)}onTextChange(e){this.onTextModelChange.emit(e)}radioModelChange(){this.onRadioModelChange.emit()}deleteRegexItem(){this.onRegexDelete.emit()}registerOnChange(e){this.avcChanger(e)}registerOnTouched(){}writeValue(e){this.avcChanger(e),this.item.data.value=e,this.changeDetectorRef.markForCheck()}hasTopBorder(){return this.hasFullWidthBorder(this.item)||this.hasPartialWidthBorder(this.item)&&!this.hasBorder(this.findAdjacentTopNode())&&T.isDefined(this.item.data.depth)&&this.item.data.depth<3}hasBottomBorder(){return this.hasFullWidthBorder(this.item)&&this.item.expanded||this.hasPartialWidthBorder(this.item)&&this.findAdjacentBottomNode()!==this.item&&!this.hasFullWidthBorder(this.findAdjacentBottomNode())&&(this.item.data.depth!==2||!this.item.expanded)}hasFullWidthBorder(e){return e.data.depth===0}hasPartialWidthBorder(e){return T.isDefined(e.data.depth)&&(e.data.depth>0&&e.children.length>0||e.data.depth===3&&!!e.isLast)}hasBorder(e){return T.isDefined(e)&&(this.hasFullWidthBorder(e)||this.hasPartialWidthBorder(e))}findAdjacentTopNode(){if(this.item.data.depth===-1)return this.item;let e=this.item.parent?.children.indexOf(this.item);if(T.isDefined(e)&&e>0){let t=this.item.parent.children[e-1];for(;t.children.length>0&&t.expanded;)t=t.children[t.children.length-1];return t}return this.item.parent}findAdjacentBottomNode(){let e=this.item;if(e.expanded&&e.children.length>0)return e.children[0];for(;T.isDefined(e.data.depth)&&e.data.depth>-1;){let t=e.parent?.children.indexOf(e);if(T.isDefined(t)&&t<e.parent.children.length-1)return e.parent.children[t+1];e=e.parent}return this.item}avcChanger=e=>e};v(n,"\u0275fac",function(t){return new(t||n)(m(tr,10),m(Y),m(Jt),m(Zt),m(oe))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-configs-item"]],viewQuery:function(t,o){if(t&1&&(se(qu,5),se(Ju,5,Ei),se(em,5,Ei)),t&2){let s;ae(s=ce())&&(o.configItemRef=s.first),ae(s=ce())&&(o.puDropdown=s.first),ae(s=ce())&&(o.puRadioButton=s.first)}},hostVars:1,hostBindings:function(t,o){t&2&&tc("@children",o.setDuration)},inputs:{item:"item"},outputs:{onRegexDialogConfirm:"onRegexDialogConfirm",onRegexDelete:"onRegexDelete",onToggle:"onToggle",onRadioModelChange:"onRadioModelChange",onColorModelChange:"onColorModelChange",onDropDownModelChange:"onDropDownModelChange",onTextModelChange:"onTextModelChange"},standalone:!1,decls:6,vars:20,consts:[["configItem",""],["notRegexButton",""],["puRadioButton",""],["puDropdown",""],[1,"item",3,"click","ngClass"],["class","ep-button","size","small","color","white",3,"click",4,"ngIf","ngIfElse"],["class","divider",4,"ngIf"],["class","icon-box",3,"ngStyle",4,"ngFor","ngForOf"],["class","papycon papycon-chevron2-right chevron",3,"click",4,"ngIf"],[1,"container"],[3,"disabled","label","value","ngModel","ngModelChange",4,"ngIf"],["class","name",4,"ngIf"],["class","papycon papycon-questionmark",3,"tooltip",4,"ngIf"],[1,"description"],["class","editor-tool",4,"ngIf"],["class","current-config",3,"disabled",4,"ngIf"],[3,"disabled","ngModel","ngModelChange","click",4,"ngIf"],["class","color-picker-container",3,"disabled",4,"ngIf"],["size","tiny",3,"disabled","options","ngModel","ngModelChange",4,"ngIf"],["class","text","spellcheck","false",3,"disabled","ngModel","ngModelChange",4,"ngIf"],[1,"icon-box",3,"ngStyle"],[1,"papycon",3,"ngClass","ngStyle"],[1,"papycon","papycon-chevron2-right","chevron",3,"click"],[3,"ngModelChange","disabled","label","value","ngModel"],[1,"name"],[1,"papycon","papycon-questionmark",3,"tooltip"],[1,"editor-tool"],[1,"papycon","papycon-pen",3,"click"],[1,"papycon","papycon-trash-can",3,"click"],[1,"current-config"],[3,"ngModelChange","click","ngModel"],[1,"color-picker-container"],[1,"color",3,"click","ngStyle"],["class","papycon papycon-exclamation-mark",4,"ngIf"],[1,"color-input",3,"ngModelChange","focus","inputStyle","maxLength","placeholder","ngModel"],["class","color-picker",4,"ngIf"],[1,"papycon","papycon-exclamation-mark"],[1,"color-picker"],["name","color-picker",3,"cancel","confirm","inputColor"],["size","tiny",3,"ngModelChange","disabled","options","ngModel"],["spellcheck","false",1,"text",3,"ngModelChange","disabled","ngModel"],["size","small","color","white",1,"ep-button",3,"click"],[1,"divider"]],template:function(t,o){if(t&1){let s=w();h(0,"div",4,0),O("click",function(){return f(s),g(o.onNestedItemClick(o.item))}),R(2,Cm,15,16,"ng-template",null,1,He)(4,Tm,5,7,"button",5),_(),R(5,Em,1,0,"div",6)}if(t&2){let s=we(3);W("expanded",o.item.expanded&&o.item.children.length>0)("single",o.item.children.length===0)("leaf",o.item.children.length>0)("leaf-first",o.item.isFirst)("leaf-last",o.item.isLast)("button",o.item.data.key===o.IgnoredKey.REGEX_BUTTON)("top-border",o.hasTopBorder())("bottom-border",o.hasBottomBorder()),p("ngClass","depth-"+o.item.data.depth),l(4),p("ngIf",o.item.data.key===o.IgnoredKey.REGEX_BUTTON)("ngIfElse",s),l(),p("ngIf",o.item.data.division)}},styles:["[_nghost-%COMP%]{display:block}i.papycon-questionmark[_ngcontent-%COMP%]{font-size:20px;margin-left:4px}.item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 30px;box-sizing:border-box}.item.top-border[_ngcontent-%COMP%]{border-top:1px solid #DADADA}.item.bottom-border[_ngcontent-%COMP%]{border-bottom:1px solid #DADADA}.item[_ngcontent-%COMP%]:not(.single){cursor:pointer}.item[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{font-size:11px}.item[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.item[_ngcontent-%COMP%]   .container.editable[_ngcontent-%COMP%]{max-width:422px}.item[_ngcontent-%COMP%]   .container.editable[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{flex:0 1 auto;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.item[_ngcontent-%COMP%]   .container.editable[_ngcontent-%COMP%]   .editor-tool[_ngcontent-%COMP%]{display:flex}.item[_ngcontent-%COMP%]   .container.editable[_ngcontent-%COMP%]   .editor-tool[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:7px;flex:0 0 auto;display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;font-size:24px}.item.button[_ngcontent-%COMP%]{padding:10px 0 20px}.item.button[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{vertical-align:middle}.item.button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:26px;margin-right:6px}.item.depth-0[_ngcontent-%COMP%]{min-height:70px}.item.depth-0[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{margin-right:8px;margin-bottom:24px}.item.depth-0[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{display:block}.item.depth-0[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{margin-top:5px}.item.depth-0.single[_ngcontent-%COMP%]{padding-left:50px}.item.depth-1[_ngcontent-%COMP%]{margin-left:90px;padding-left:0}.item.depth-1[_ngcontent-%COMP%]:not(.single)   .container[_ngcontent-%COMP%]{padding-left:12px}.item.depth-2[_ngcontent-%COMP%]{margin-left:90px;padding-left:48px;background-color:#f4f4f4}.item.depth-2[_ngcontent-%COMP%]:not(.single)   .container[_ngcontent-%COMP%]{padding-left:12px}.item.depth-2[_ngcontent-%COMP%]:not(.single){padding-left:24px}.item.depth-3[_ngcontent-%COMP%]{margin-left:90px;padding-left:48px;background-color:#f4f4f4}.item[_ngcontent-%COMP%]:not(.depth-0)   .container[_ngcontent-%COMP%]{padding:11px 0;box-sizing:border-box}.item[_ngcontent-%COMP%]:not(.depth-0)   .icon-box[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-items:center;justify-content:center}.item[_ngcontent-%COMP%]:not(.depth-0)   .icon-box[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:24px}.item[_ngcontent-%COMP%]:not(.depth-0)   .name[_ngcontent-%COMP%]{font-size:14px;width:auto}.item[_ngcontent-%COMP%]:not(.depth-0)   .description[_ngcontent-%COMP%]{margin-left:12px}.item[_ngcontent-%COMP%]:not(.depth-0)   i.papycon-questionmark[_ngcontent-%COMP%] + .description[_ngcontent-%COMP%]{margin-left:8px}.item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;color:#1e1e1e;font-size:16px}.item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{color:#6c6c6c;cursor:pointer}.item[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;font-size:14px;font-weight:400;letter-spacing:-.5px;color:#6c6c6c;flex:0 1 auto;white-space:pre}.item[_ngcontent-%COMP%]   .current-config[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;margin-left:auto;font-size:14px;font-weight:500;color:#ff6100}.item[_ngcontent-%COMP%]   .current-config.disabled[_ngcontent-%COMP%]{color:#c8c8c8}.item[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]{width:auto}.item[_ngcontent-%COMP%]   pu-toggle-button[_ngcontent-%COMP%]{margin-left:auto}.item[_ngcontent-%COMP%]   pu-toggle-button.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.item[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]{position:relative;display:flex;margin-left:auto}.item[_ngcontent-%COMP%]   .color-picker-container.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.item[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;cursor:pointer}.item[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]:hover{opacity:.5}.item[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]   .color-input[_ngcontent-%COMP%]{width:80px;height:30px;margin-left:6px}.item[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]   .color-picker[_ngcontent-%COMP%]{position:absolute;z-index:1;left:calc(100% + 3px);padding:12px;width:216px;box-sizing:border-box;border:1.2px solid #DADADA;border-radius:2px;background-color:#fff}.item[_ngcontent-%COMP%]   pu-dropdown[_ngcontent-%COMP%]{margin-left:auto;width:77px}.item[_ngcontent-%COMP%]   pu-input.text[_ngcontent-%COMP%]{margin-left:auto;width:200px;height:40px}.item[_ngcontent-%COMP%]   pu-input.text[_ngcontent-%COMP%]  input{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.divider[_ngcontent-%COMP%]{height:1px;background-color:#dadada;margin:8px 0 8px 86px;padding-left:0}"],data:{animation:[Ln.rotate("chevron","90"),qo("children",[ho(":enter",[$i({height:"0",marginTop:"0",paddingTop:"0",paddingBottom:"0",overflow:"hidden"}),mo("{{ duration }}ms cubic-bezier(0.86, 0, 0.07, 1)",$i({height:"*",marginTop:"*",paddingTop:"*",paddingBottom:"*",overflow:"hidden"}))]),ho(":leave",[$i({height:"*",marginTop:"*",paddingTop:"*",paddingBottom:"*",overflow:"hidden"}),mo("{{ duration }}ms cubic-bezier(0.86, 0, 0.07, 1)",$i({height:"0",marginTop:"0",paddingTop:"0",paddingBottom:"0",overflow:"hidden"}))])])]}}));let r=n;return r})();var Sm=["*"];function xm(r,n){if(r&1){let i=w();h(0,"div",1),O("click",function(){let t=f(i).$implicit,o=d();return o.selectedTab=t,g(o.selectedTabChange.emit(t))}),M(1),E(2,"translate"),_()}if(r&2){let i=n.$implicit,e=d();W("active",i===e.selectedTab),l(),ke(" ",S(2,3,i)," ")}}var qr=(()=>{let n=class n{tabItems;selectedTab;selectedTabChange=new Ke};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275cmp",j({type:n,selectors:[["e-tab-panel"]],inputs:{tabItems:"tabItems",selectedTab:"selectedTab"},outputs:{selectedTabChange:"selectedTabChange"},standalone:!1,ngContentSelectors:Sm,decls:3,vars:1,consts:[["class","tab-item",3,"active","click",4,"ngFor","ngForOf"],[1,"tab-item",3,"click"]],template:function(t,o){t&1&&(ic(),h(0,"header"),R(1,xm,3,5,"div",0),_(),nc(2)),t&2&&(l(),p("ngForOf",o.tabItems))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1;border-top:1px solid #DADADA;margin-top:10px}header[_ngcontent-%COMP%]{height:60px;box-sizing:border-box;background-color:#fff;border-top:1px solid #DADADA;border-left:1px solid #DADADA;border-right:1px solid #DADADA;border-top-left-radius:4px;border-top-right-radius:4px;display:flex;z-index:1}.tab-item[_ngcontent-%COMP%]{cursor:pointer;padding:16px 14px;font-family:NotoSans-Regular;font-size:14px;line-height:14px;letter-spacing:-.5px;color:#6c6c6c}.tab-item.active[_ngcontent-%COMP%]{font-family:NotoSans-Medium;border-top:3px solid #1E1E1E;padding-top:13px}"],changeDetection:0}));let r=n;return r})();var jl=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({imports:[mt,ai]}));let r=n;return r})();We(qr,[Ue],[oe]);var Om=()=>["textRect"],$l=()=>["opacity"],Yl=()=>["FillColor"],Js=()=>["StrokeColor"],bm=()=>["width"],Xl=()=>["FontSize"],Kl=()=>["FontColor"],Im=()=>["FT"],ym=()=>["borderStyle","style"],Am=()=>["LE"];function Rm(r,n){if(r&1){let i=w();h(0,"button",21),O("click",function(){f(i);let t=d(2).$implicit,o=d();return g(o.onExpanderClicked(t))}),I(1,"i",22),_()}}function Pm(r,n){if(r&1&&I(0,"div",23),r&2){let i=d(2).$implicit,e=d();W("no-subtool",!e.isNestedMenuItem(i))}}function Nm(r,n){if(r&1){let i=w();h(0,"button",27),O("click",function(){f(i);let t=d(),o=t.$implicit,s=t.index,c=d(3).$implicit,u=d();return c.lastUsed=s,g(u.activateTool(o.tool))}),I(1,"i",17),_()}if(r&2){let i=d().$implicit,e=d(4);W("selected",e.isSelected(i))("dirty",e.isDirty(i)),p("title",i.alt),l(),p("ngClass",i.iconClass)}}function Mm(r,n){if(r&1&&(Te(0),R(1,Nm,2,6,"button",26),Ee()),r&2){let i=n.$implicit;l(),p("ngIf",i.use)}}function Dm(r,n){if(r&1&&(h(0,"div",24)(1,"div",25),R(2,Mm,2,1,"ng-container",9),_()()),r&2){let i=d(2).$implicit;p("@menuState",i.menuState),l(2),p("ngForOf",i.subtools)}}function wm(r,n){if(r&1){let i=w();Te(0),h(1,"div",15)(2,"button",16),O("click",function(){f(i);let t=d().$implicit,o=d();return g(o.activateTool(o.isNestedMenuItem(t)?t.lastTool.tool:t.tool))}),I(3,"i",17),M(4),_(),R(5,Rm,2,0,"button",18)(6,Pm,1,2,"div",19)(7,Dm,3,2,"div",20),_(),Ee()}if(r&2){let i=d().$implicit,e=d();l(2),W("ep-text-button",!i.text)("ep-button",i.text)("expandable",e.isExpandable(i))("dirty",!e.isNestedMenuItem(i)&&e.isDirty(i)),p("title",i.alt),G("color",i.text?"white":"dark")("size",i.text?"tiny":null),l(),p("ngClass",i.iconClass),l(),ke(" ",i.text||""," "),l(),p("ngIf",e.isExpandable(i)),l(),p("ngIf",e.isActive(i)),l(),p("ngIf",e.isExpandable(i))}}function Lm(r,n){if(r&1&&(Te(0),R(1,wm,8,16,"ng-container",14),Ee()),r&2){let i=n.$implicit;l(),p("ngIf",i.use)}}function km(r,n){r&1&&dn(0)}function Fm(r,n){r&1&&(h(0,"div",28),I(1,"i",29),h(2,"span"),M(3),E(4,"translate"),_()()),r&2&&(l(3),k(S(4,1,"PLEASE_CHOOSE_ANNOT")))}function Vm(r,n){if(r&1){let i=w();h(0,"section",32),Te(1),h(2,"div")(3,"span",33),M(4),E(5,"translate"),_(),h(6,"form")(7,"pu-input-value",34),O("mousedown",function(t){f(i);let o=d(3);return g(o.preventDragging(t))}),_()()(),h(8,"div")(9,"span",33),M(10),E(11,"translate"),_(),h(12,"pu-input-value",34),O("mousedown",function(t){f(i);let o=d(3);return g(o.preventDragging(t))}),_()(),Ee(),_()}if(r&2){let i=d(3);l(4),k(S(5,10,"WIDTH")),l(3),p("width",90)("max",113)("suffix",i.convertedUnit)("formControl",i.textBoxWidthFormControl),l(3),k(S(11,12,"HEIGHT")),l(2),p("width",90)("max",180)("suffix",i.convertedUnit)("formControl",i.textBoxHeightFormControl)}}function Um(r,n){if(r&1&&(h(0,"pu-accordion-tab",31),E(1,"translate"),R(2,Vm,13,14,"ng-template",null,2,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"TEXT_BOX_SIZE"))("borderHidden",!0)}}function Bm(r,n){if(r&1){let i=w();Te(0),h(1,"div",39)(2,"span",33),M(3),E(4,"translate"),_(),h(5,"span",40),M(6),_()(),h(7,"form",41),O("ngSubmit",function(){f(i);let t=d(4);return g(t.opacityAsPercentage=t.opacityAsPercentageFormControl.value)}),h(8,"pu-slider",42),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.opacity,t)||(o.opacity=t),g(t)}),O("puStepApply",function(t){f(i);let o=d(4);return g(o.opacityAsPercentage=((o.opacity+t)*100).toFixed(0))}),_(),h(9,"pu-input",43),O("blur",function(){f(i);let t=d(4);return g(t.opacityAsPercentage=t.opacityAsPercentageFormControl.value)}),_()(),Ee()}if(r&2){let i=d(4);l(3),k(S(4,11,"OPACITY")),l(3),ke("",i.opacityAsPercentage," %"),l(2),p("min",0)("max",1)("step",.01)("name","opacity")("puInputStep","all")("puStep",.01)("puAlterStep",.1),me("ngModel",i.opacity),l(),p("formControl",i.opacityAsPercentageFormControl)}}function Gm(r,n){if(r&1){let i=w();h(0,"div",44)(1,"span",33),M(2),E(3,"translate"),_(),h(4,"div",45)(5,"div",46),O("click",function(){f(i);let t=d(4);return g(t.onColorTabColorClick(t.ColorTabColor.FILL_COLOR))}),_()()()}if(r&2){let i=d(4);l(2),k(S(3,5,"FILL")),l(2),W("selected",i.selectedColorTabColor===i.ColorTabColor.FILL_COLOR),l(),qe("background",i.fillColor===null?i.transparentBackground:i.fillColor)}}function Wm(r,n){if(r&1){let i=w();h(0,"div",44)(1,"span",33),M(2),E(3,"translate"),_(),h(4,"div",45)(5,"div",46),O("click",function(){f(i);let t=d(4);return g(t.onColorTabColorClick(t.ColorTabColor.STROKE_COLOR))}),_()()()}if(r&2){let i=d(4);l(2),k(S(3,5,"STROKE")),l(2),W("selected",i.selectedColorTabColor===i.ColorTabColor.STROKE_COLOR),l(),qe("background",i.strokeColor===null?i.transparentBackground:i.strokeColor)}}function zm(r,n){if(r&1){let i=w();h(0,"pu-color-palette",47),E(1,"translate"),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.activatedColorTabColor,t)||(o.activatedColorTabColor=t),g(t)}),_()}if(r&2){let i=d(4);p("nullable",i.selectedColorTabColor===i.ColorTabColor.STROKE_COLOR?i.isCommonFieldAttribute(pe(9,Im)):i.isCommonAnnotAttribute(pe(10,Js)))("customColorLabel",S(1,5,"CUSTOM_COLOR"))("defaultColorLabel",S(2,7,"DEFAULT_COLOR"))("defaultColorPanelExpandedd",!0),me("ngModel",i.activatedColorTabColor)}}function Hm(r,n){if(r&1&&(h(0,"section",35),R(1,Bm,10,13,"ng-container",14),h(2,"div",36),R(3,Gm,6,7,"div",37)(4,Wm,6,7,"div",37),_(),R(5,zm,3,11,"pu-color-palette",38),_()),r&2){let i=d(3);l(),p("ngIf",i.hasAttributes(pe(4,$l))),l(2),p("ngIf",i.hasAttributes(pe(5,Yl))),l(),p("ngIf",i.hasAttributes(pe(6,Js))),l(),p("ngIf",i.selectedColorTabColor!==null)}}function jm(r,n){if(r&1&&(h(0,"pu-accordion-tab",31),E(1,"translate"),R(2,Hm,6,7,"ng-template",null,3,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"COLOR"))("borderHidden",!0)}}function $m(r,n){if(r&1){let i=w();Te(0),h(1,"span",33),M(2),E(3,"translate"),_(),h(4,"pu-dropdown",49),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedBorderStyle,t)||(o.selectedBorderStyle=t),g(t)}),_(),Ee()}if(r&2){let i=d(4);l(2),k(S(3,5,"STYLE")),l(2),p("isImageLabel",!0)("options",i.borderStyleOptions)("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedBorderStyle)}}function Ym(r,n){if(r&1){let i=w();Te(0),h(1,"span",33),M(2),E(3,"translate"),_(),h(4,"pu-dropdown",50),he("ngModelChange",function(t){f(i);let o=d(5);return ue(o.selectedEndLinecap,t)||(o.selectedEndLinecap=t),g(t)}),O("mousedown",function(t){f(i);let o=d(5);return g(o.preventDragging(t))}),_(),Ee()}if(r&2){let i=d(5);l(2),k(S(3,5,"END")),l(2),p("isImageLabel",!0)("options",i.endLinecapOptions)("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedEndLinecap)}}function Xm(r,n){if(r&1){let i=w();Te(0),h(1,"span",33),M(2),E(3,"translate"),_(),h(4,"pu-dropdown",50),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedStartLinecap,t)||(o.selectedStartLinecap=t),g(t)}),O("mousedown",function(t){f(i);let o=d(4);return g(o.preventDragging(t))}),_(),R(5,Ym,5,7,"ng-container",14),Ee()}if(r&2){let i=d(4);l(2),k(S(3,6,"START")),l(2),p("isImageLabel",!0)("options",i.startLinecapOptions)("size",i.isSmallWidthScreen?"small":"tiny"),me("ngModel",i.selectedStartLinecap),l(),p("ngIf",!i.isFreeTextCallout())}}function Km(r,n){if(r&1){let i=w();h(0,"section",35)(1,"div",39)(2,"span",33),M(3),E(4,"translate"),_(),h(5,"span",40),M(6),_()(),h(7,"form",41),O("ngSubmit",function(){f(i);let t=d(3);return g(t.stringStrokeWidth=t.strokeWidthFormControl.value)}),h(8,"pu-slider",48),he("ngModelChange",function(t){f(i);let o=d(3);return ue(o.width,t)||(o.width=t),g(t)}),O("puStepApply",function(t){f(i);let o=d(3);return g(o.stringStrokeWidth=o.width+(t>0?1:-1)+"")}),_(),h(9,"pu-input",43),O("blur",function(){f(i);let t=d(3);return g(t.stringStrokeWidth=t.strokeWidthFormControl.value)}),_()(),R(10,$m,5,7,"ng-container",14)(11,Xm,6,8,"ng-container",14),_()}if(r&2){let i=d(3);l(3),k(S(4,9,"THICKNESS")),l(3),ke("",i.stringStrokeWidth," pt"),l(2),p("puInputStep","all")("max",i.MaximumStrokeWidth)("min",i.MinimumStrokeWidth),me("ngModel",i.width),l(),p("formControl",i.strokeWidthFormControl),l(),p("ngIf",i.hasAttributes(pe(11,ym))),l(),p("ngIf",i.hasAttributes(pe(12,Am)))}}function Qm(r,n){if(r&1&&(h(0,"pu-accordion-tab",31),E(1,"translate"),R(2,Km,12,13,"ng-template",null,4,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"LINE"))("borderHidden",!0)}}function Zm(r,n){if(r&1){let i=w();h(0,"div",36)(1,"div",52)(2,"span",33),M(3),E(4,"translate"),_(),h(5,"pu-dropdown",53),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedFont,t)||(o.selectedFont=t),g(t)}),_()(),h(6,"div",52)(7,"span",33),M(8),E(9,"translate"),_(),h(10,"pu-dropdown",54),he("ngModelChange",function(t){f(i);let o=d(4);return ue(o.selectedFontSize,t)||(o.selectedFontSize=t),g(t)}),_()()()}if(r&2){let i=d(4);l(3),k(S(4,9,"STYLE")),l(2),p("size",i.isSmallWidthScreen?"small":"tiny")("options",i.fontOptions),me("ngModel",i.selectedFont),l(3),k(S(9,11,"SIZE")),l(2),p("editable",!0)("size",i.isSmallWidthScreen?"small":"tiny")("options",i.fontsizeOptions),me("ngModel",i.selectedFontSize)}}function qm(r,n){if(r&1){let i=w();h(0,"pu-color-palette",56),E(1,"translate"),E(2,"translate"),he("ngModelChange",function(t){f(i);let o=d(5);return ue(o.activatedFontTabColor,t)||(o.activatedFontTabColor=t),g(t)}),_()}if(r&2){let i=d(5);p("customColorLabel",S(1,4,"CUSTOM_COLOR"))("defaultColorLabel",S(2,6,"DEFAULT_COLOR"))("defaultColorPanelExpandedd",!0),me("ngModel",i.activatedFontTabColor)}}function Jm(r,n){if(r&1){let i=w();Te(0),h(1,"span",33),M(2),E(3,"translate"),_(),h(4,"div",45)(5,"div",46),O("click",function(){f(i);let t=d(4);return g(t.onFontTabColorClick(t.FontTabColor.FONT_COLOR))}),_()(),R(6,qm,3,8,"pu-color-palette",55),Ee()}if(r&2){let i=d(4);l(2),k(S(3,6,"COLOR")),l(2),W("selected",i.selectedFontTabColor===i.FontTabColor.FONT_COLOR),l(),qe("background",i.fontColor===null?i.transparentBackground:i.fontColor),l(),p("ngIf",i.selectedFontTabColor!==null)}}function eh(r,n){if(r&1&&(h(0,"section",35),R(1,Zm,11,13,"div",51)(2,Jm,7,8,"ng-container",14),_()),r&2){let i=d(3);l(),p("ngIf",i.hasAttributes(pe(2,Xl))),l(),p("ngIf",i.hasAttributes(pe(3,Kl)))}}function th(r,n){if(r&1&&(h(0,"pu-accordion-tab",31),E(1,"translate"),R(2,eh,3,4,"ng-template",null,5,He),_()),r&2){let i=we(3);p("contentTemplate",i)("selected",!0)("header",S(1,4,"TEXT_PROP"))("borderHidden",!0)}}function ih(r,n){if(r&1&&(h(0,"pu-accordion"),R(1,Um,4,6,"pu-accordion-tab",30)(2,jm,4,6,"pu-accordion-tab",30)(3,Qm,4,6,"pu-accordion-tab",30)(4,th,4,6,"pu-accordion-tab",30),_()),r&2){let i=d();l(),p("ngIf",i.hasAttributes(pe(4,Om))),l(),p("ngIf",i.hasAttributes(pe(5,$l))||i.hasAttributes(pe(6,Yl))||i.hasAttributes(pe(7,Js))),l(),p("ngIf",i.hasAttributes(pe(8,bm))&&i.width>0),l(),p("ngIf",i.hasAttributes(pe(9,Xl))||i.hasAttributes(pe(10,Kl)))}}var ea=(()=>{let n=class n{translatePipe;changeDetectorRef;annotService;subs;contentService;configsService;store$;unitPipe;get fontsizeOptions(){return F.fontsizeOptions}get activeTool(){return this._activeTool}set activeTool(e){this._activeTool=e,this.activeAttributes=T.deepClone(this.activeTool?.attributes),this.setProperties()}paperSize={height:"536px",width:"378px"};MinimumStrokeWidth=1;MaximumStrokeWidth=12;borderStyleOptions=[{label:"assets/images/dropdown-image/line/Basic.svg",value:{style:"solid"}}];opacityAsPercentageFormControl=new tt;strokeWidthFormControl=new tt;textBoxWidthFormControl=new tt;textBoxHeightFormControl=new tt;isSmallWidthScreen=Ve.isSmallWidth();selectedFontTabColor=null;attributeProxyMapper=null;customFontSizeOption=null;attributeKeyToSetterMap={opacity:"opacity",width:"width",FontSize:"fontSize",FontName:"fontName",FontColor:"fontColor",FillColor:"fillColor",StrokeColor:"strokeColor",borderStyle:"borderStyle",LE:["startLinecap","endLinecap"],textRect:"textRect"};get borderStyle(){return this.activeAttributes.borderStyle??={style:"solid",dashPattern:[]},this.activeAttributes.borderStyle}set borderStyle(e){this.activeAttributes.borderStyle===void 0&&(this.activeAttributes.borderStyle={style:"solid",dashPattern:[]}),this.activeAttributes.borderStyle.style=e.style,this.activeAttributes.borderStyle.dashPattern=e.dashPattern,this.modifyAttribute(this.activeTool,["borderStyle"],this.activeAttributes.borderStyle)}get selectedBorderStyle(){return this.borderStyleOptions.find(e=>{let t=e.value.style===this.borderStyle.style,o=e.value.dashPattern,s=this.borderStyle.dashPattern;if(t){if(Array.isArray(o)&&Array.isArray(s))return o.every((c,u)=>c===s[u]);if(!Array.isArray(o)&&!Array.isArray(s))return!0}return!1})}set selectedBorderStyle(e){this.borderStyle=e.value}get stringStrokeWidth(){return`${this.activeAttributes.width}`}set stringStrokeWidth(e){let t=parseInt(e);if(Number.isNaN(t)){this.strokeWidthFormControl.setValue(this.width);return}this.width=Math.min(Math.max(t,this.MinimumStrokeWidth),this.MaximumStrokeWidth)}get AnnotTool(){return V}get activatedColorTabColor(){switch(this.selectedColorTabColor){case Dt.FILL_COLOR:return this.fillColor;case Dt.STROKE_COLOR:return this.strokeColor;default:return null}}set activatedColorTabColor(e){switch(this.selectedColorTabColor){case Dt.FILL_COLOR:this.fillColor=e;break;case Dt.STROKE_COLOR:this.strokeColor=e;break;default:break}}get width(){return this.activeAttributes.width??null}set width(e){this.activeAttributes.width=e??void 0,this.modifyAttribute(this.activeTool,["width"],e),this.strokeWidthFormControl.setValue(this.activeAttributes.width)}get strokeColor(){return this.activeAttributes.StrokeColor??="#FFFFFF",this.activeAttributes.StrokeColor}set strokeColor(e){e===null?this.width=null:T.isDefined(this.width)&&this.width<=0&&(this.width=1),this.activeAttributes.StrokeColor=e,this.modifyAttribute(this.activeTool,["StrokeColor"],e)}get fillColor(){return this.activeAttributes.FillColor===void 0&&(this.activeAttributes.FillColor="#FFFFFF"),this.activeAttributes.FillColor}set fillColor(e){this.activeAttributes.FillColor=e,this.modifyAttribute(this.activeTool,["FillColor"],e)}get ColorTabColor(){return Dt}get FontTabColor(){return Yi}get opacityAsPercentage(){return`${this.opacity&&Math.floor(this.opacity*100)}`}set opacityAsPercentage(e){let t=Number.parseInt(e);Number.isNaN(t)&&this.opacityAsPercentageFormControl.setValue(this.opacityAsPercentage),this.opacity=Math.min(Math.max(t/100,0),1)}get opacity(){return this.activeAttributes.opacity}set opacity(e){this.activeAttributes.opacity=e,this.opacityAsPercentageFormControl.setValue(this.opacityAsPercentage),this.modifyAttribute(this.activeTool,["opacity"],e)}get selectedStartLinecap(){return this.startLinecapOptions.find(e=>e.value===this.startLinecap)}set selectedStartLinecap(e){this.startLinecap=e.value}get startLinecap(){return this.activeAttributes.LE??=[],this.activeAttributes.LE[0]}set startLinecap(e){this.activeAttributes.LE===void 0&&(this.activeAttributes.LE=[]),this.activeAttributes.LE[0]=e,this.modifyAttribute(this.activeTool,["LE"],this.activeAttributes.LE)}get selectedEndLinecap(){return this.endLinecapOptions.find(e=>e.value===this.endLinecap)}set selectedEndLinecap(e){this.endLinecap=e.value}get fontSize(){return this.activeAttributes.fontSize===void 0?null:this.activeAttributes.fontSize}set fontSize(e){this.activeAttributes.fontSize=e,this.modifyAttribute(this.activeTool,["FontSize"],this.activeAttributes.fontSize)}get selectedFontSize(){let e=F.fontsizeOptions.find(t=>t.value===this.fontSize);return T.isDefined(e)?e:T.isDefined(this.customFontSizeOption)&&this.customFontSizeOption.value===this.fontSize?this.customFontSizeOption:T.isDefined(this.fontSize)?(this.customFontSizeOption={label:this.fontSize.toString(),value:this.fontSize},this.customFontSizeOption):null}set selectedFontSize(e){let t=Number(e.value);Number.isNaN(t)||(this.fontSize=t)}get endLinecap(){return this.activeAttributes.LE??=[],this.activeAttributes.LE[1]}set endLinecap(e){this.activeAttributes.LE===void 0&&(this.activeAttributes.LE=[]),this.activeAttributes.LE[1]=e,this.modifyAttribute(this.activeTool,["LE"],this.activeAttributes.LE)}get fontName(){return this.activeAttributes.fontName===void 0?null:this.activeAttributes.fontName}set fontName(e){this.activeAttributes.fontName=e,this.modifyAttribute(this.activeTool,["FontName"],this.activeAttributes.fontName)}get selectedFont(){return this.fontOptions.find(e=>e.value===this.fontName)??this.fontOptions[0]}set selectedFont(e){this.fontName=e.value}get fontColor(){return this.activeAttributes.FontColor??="#FFFFFF",this.activeAttributes.FontColor}set fontColor(e){this.activeAttributes.FontColor=e,this.modifyAttribute(this.activeTool,["FontColor"],this.activeAttributes.FontColor)}get activatedFontTabColor(){switch(this.selectedFontTabColor){case Yi.FONT_COLOR:return this.fontColor;default:return null}}set activatedFontTabColor(e){this.selectedFontTabColor===Yi.FONT_COLOR&&(this.fontColor=e)}get textBoxWidthAsLocalUnit(){let e=this.activeAttributes.textRect?this.activeAttributes.textRect.right-this.activeAttributes.textRect.left:void 0;if(this.isCommonSize(e,void 0))return this.convertUnitAsLocalized("mmToPoint",e)}set textBoxWidthAsLocalUnit(e){let t=this.convertUnitAsLocalized("pointToMm",e);this.resizeTextRect(t,void 0),this.modifyAttribute(this.activeTool,["textRect"],this.activeAttributes.textRect)}get textBoxHeightAsLocaleUnit(){let e=this.activeAttributes.textRect?this.activeAttributes.textRect.top-this.activeAttributes.textRect.bottom:void 0;if(this.isCommonSize(void 0,e))return this.convertUnitAsLocalized("mmToPoint",e)}set textBoxHeightAsLocaleUnit(e){let t=this.convertUnitAsLocalized("pointToMm",e);this.resizeTextRect(void 0,t),this.modifyAttribute(this.activeTool,["textRect"],this.activeAttributes.textRect)}get transparentBackground(){return F.getTransparentBackground()}tools=[];skipNoninteractiveChanges=!0;dirtyAnnots=[];toolMenuItems=[];fontOptions=[];language="ko";startLinecapOptions=[{label:"assets/images/dropdown-image/endline/Basic.svg",value:"None"}];endLinecapOptions=[{label:"assets/images/dropdown-image/endline/Basic.svg",value:"None"}];_activeTool=null;activeAttributes={};status=Z.RENDER;selectedColorTabColor=null;constructor(e,t,o,s,c,u,C,x){this.translatePipe=e,this.changeDetectorRef=t,this.annotService=o,this.subs=s,this.contentService=c,this.configsService=u,this.store$=C,this.unitPipe=x,this.attributeProxyMapper=new Dr,this.toolMenuItems=[{lastUsed:0,menuState:"off",menuStyle:{},subtools:[{tool:V.INK,alt:this.translatePipe.transform("INK_TOOL"),iconClass:"papycon-pencil",use:!0},{tool:V.LINE,alt:this.translatePipe.transform("LINE_TOOL"),iconClass:"papycon-line",use:!0},{tool:V.SQUARE,alt:this.translatePipe.transform("SQUARE_TOOL"),iconClass:"papycon-square",use:!0},{tool:V.CIRCLE,alt:this.translatePipe.transform("CIRCLE_TOOL"),iconClass:"papycon-circle",use:!0},{tool:V.POLYGON,alt:this.translatePipe.transform("POLYGON_TOOL"),iconClass:"papycon-polygon",use:!0,id:U.getAnnotID(ki[V.POLYGON])},{tool:V.POLYLINE,alt:this.translatePipe.transform("POLYLINE_TOOL"),iconClass:"papycon-polyline",use:!0,id:U.getAnnotID(ki[V.POLYLINE])},{tool:V.CLOUD,alt:this.translatePipe.transform("POLYGON_CLOUD_TOOL"),iconClass:"papycon-revisioncloud",use:!0,id:U.getAnnotID(ki[V.CLOUD])}].filter(N=>N.use),get lastTool(){return this.subtools[this.lastUsed]},get tool(){return this.lastTool?.tool},get iconClass(){return this.lastTool?.iconClass},get alt(){return this.lastTool?.alt},priority:1,use:!0},{lastUsed:0,menuState:"off",menuStyle:{},subtools:[{tool:V.TEXT_FREE,alt:this.translatePipe.transform("FREE_TEXT_TOOL"),iconClass:"papycon-textbox",use:!0},{tool:V.TEXT_CALLOUT,alt:this.translatePipe.transform("FREE_TEXT_CALLOUT_TOOL"),iconClass:"papycon-callout2",use:!0,id:U.getAnnotID(ki[V.TEXT_CALLOUT])}].filter(N=>N.use),get lastTool(){return this.subtools[this.lastUsed]},get tool(){return this.lastTool?.tool},get iconClass(){return this.lastTool?.iconClass},get alt(){return this.lastTool?.alt},priority:1,use:!0},{tool:V.TEXT_POPUP,alt:this.translatePipe.transform("TEXT_TOOL"),iconClass:"papycon-memo3",use:!0,priority:2},{tool:V.STAMP,alt:this.translatePipe.transform("STAMP_TOOL"),iconClass:"papycon-stamp2",use:!0,priority:3},{lastUsed:0,menuState:"off",menuStyle:{},subtools:[{tool:V.HIGHLIGHT,alt:this.translatePipe.transform("HIGHLIGHT"),iconClass:"papycon-text-highlight",use:!0},{tool:V.STRIKE,alt:this.translatePipe.transform("STRIKEOUT"),iconClass:"papycon-text-strikeout",use:!0},{tool:V.UNDERLINE,alt:this.translatePipe.transform("UNDERLINE"),iconClass:"papycon-text-underline",use:!0}].filter(N=>N.use),get lastTool(){return this.subtools[this.lastUsed]},get tool(){return this.lastTool?.tool},get iconClass(){return this.lastTool?.iconClass},get alt(){return this.lastTool?.alt},priority:4,use:!0}]}ngOnInit(){this.getStampImage(),this.initTools(),this.initDropdownOptions(),this.initSubscriptions()}initVariables(){this.selectedColorTabColor=null,this.selectedFontTabColor=null,this.isFreeTextCallout()&&!this.dirtyAnnots.includes("FreeTextCallout")&&(this.textBoxWidthFormControl.setValue(this.textBoxWidthAsLocalUnit),this.textBoxHeightFormControl.setValue(this.textBoxHeightAsLocaleUnit))}getStampImage(){this.configsService.getStampImage()}initTools(){this.tools=K.get(a.ANNOT_PROPERTIES),this.skipNoninteractiveChanges=!1}ngOnDestroy(){this.attributeProxyMapper=null}initSubscriptions(){this.subs.push(Ve.windowResize$.subscribe({next:()=>{this.isSmallWidthScreen=Ve.isSmallWidth(),this.changeDetectorRef.markForCheck()}}),Ve.windowMouseUp$.subscribe({next:()=>this.closeSubMenuItems()}),this.contentService.fontsResponse$.subscribe({next:e=>{this.fontOptions.splice(0),e.fontList.forEach(t=>{this.fontOptions.push({label:t.label[F.LANGUAGE_ID_MAP[this.language]]||t.label[0]||t.name,value:t.name,available:!0})}),this.fontOptions=this.fontOptions.slice().filter(t=>t.available),F.generateUnavailableFontOption(this.fontOptions,this.fontName,this.translatePipe),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Xe("language")).subscribe({next:e=>{this.language=e}}),this.annotService.annotAttributeChange$.subscribe({next:()=>{K.set(a.ANNOT_PROPERTIES,this.tools),this.initVariables()}}),this.configsService.configSaved$.subscribe({next:()=>{this.dirtyAnnots=[],this.changeDetectorRef.markForCheck()}}),this.textBoxWidthFormControl.valueChanges.pipe(Bt()).subscribe({next:e=>{this.textBoxWidthAsLocalUnit=e}}),this.textBoxHeightFormControl.valueChanges.pipe(Bt()).subscribe({next:e=>{this.textBoxHeightAsLocaleUnit=e}}))}closeSubMenuItems(){this.toolMenuItems.forEach(e=>{e.menuState="off"}),this.changeDetectorRef.markForCheck()}isFreeTextCallout(){return T.isDefined(this.activeTool)&&A.isFreeTextCallout(this.activeTool)}isActive(e){return this.activeTool?.type===this.getPresetAnnots(e.tool)?.type}isSelected(e){return this.activeTool?(e.id??this.getPresetAnnots(e.tool)?.type)===U.getAnnotID(this.activeTool):!1}initDropdownOptions(){Wt.linecapList.forEach(e=>{[this.startLinecapOptions,this.endLinecapOptions].forEach(t=>{t.push({label:e.label,value:e.value})})}),Wt.borderStyleList.forEach(e=>{this.borderStyleOptions.push({label:e.label,value:e.value})})}isNestedMenuItem(e){return"subtools"in e}isExpandable(e){return this.isNestedMenuItem(e)&&e.subtools.filter(t=>t.use).length>1}isDirty(e){let t=e.id??this.getPresetAnnots(e.tool)?.type;return T.isDefined(t)&&this.dirtyAnnots.includes(t)}isPolygonGroup(e){return A.isPolygon(e)||A.isPolygonCloud(e)||A.isPolyLine(e)}isFreeTextGroup(e){return A.isFreeText(e)||A.isFreeTextCallout(e)}modifyAttribute(e,t,o){e&&(this.annotService.modifyAttribute(e,t,o),this.markAnnotDirtyStatus(e))}markAnnotDirtyStatus(e){let t=this.isPolygonGroup(e)||this.isFreeTextGroup(e)?U.getAnnotID(e):e.type;this.skipNoninteractiveChanges||this.dirtyAnnots.includes(t)||this.dirtyAnnots.push(t)}preventDragging(e){e.stopPropagation()}onFontTabColorClick(e){this.selectedFontTabColor=this.selectedFontTabColor===e?null:e}activateTool(e){this.skipNoninteractiveChanges=!0,this.closeSubMenuItems(),this.activeTool=this.tools.find(t=>t.annot.oid===this.getPresetAnnots(e)?.oid)?.annot??null,this.skipNoninteractiveChanges=!1}onExpanderClicked(e){e.menuState=e.menuState==="off"?"on":"off",this.toolMenuItems.forEach(t=>{!t.hasOwnProperty("subtools")||t===e||(t.menuState="off")})}hasAttributes(e){let t=this.activeTool,o=this.activeAttributes;return!T.isDefined(t)||!T.isDefined(o)?!1:e.every(s=>{let c=this.attributeProxyMapper?.getUnflattenedKey(t.type,s)??e,u=c[c.length-1];if(c.length>1){let C=o;for(let x=0;x<c.length-1;x++){let N=c[x];if(Se.hasKey(C,N)){if(Se.hasKey(C[N],u))return!0;C=C[N]}}}else if(o.hasOwnProperty(u))return!0;return!1})}setProperties(){let e=this,t=(s,c)=>{let u=e.attributeKeyToSetterMap[s];Array.isArray(u)?u.forEach((C,x)=>{e[C]=c[x]}):e[u]=c};Se.keys(this.attributeKeyToSetterMap).forEach(s=>{let c=this.activeTool,u=this.activeAttributes;if(!T.isDefined(c))return!1;let C=this.attributeProxyMapper?.getUnflattenedKey(c.type,s)??[s],x=C[C.length-1];if(C.length>1){let N=u;for(let D of C){if(!Se.hasKey(N,D))throw new Mt(`Cannot find "${D}" in AnnotAttributes.`);if(Se.hasKey(N[D],x)){let X=s==="borderStyle"?N[D]:N[D][x];return t(s,X),!0}N=N[D]}}else if(Se.hasKey(u,x))return t(s,u[x]),!0;return!1})}onColorTabColorClick(e){this.selectedColorTabColor=this.selectedColorTabColor===e?null:e}get convertedUnit(){return this.unitPipe.transform(q.MILLIMETER)}isCommonSize(e,t){return(e&&this.activeAttributes.textRect?(this.activeAttributes.textRect.right-this.activeAttributes.textRect.left).toFixed(3)===e.toFixed(3):!0)&&(t&&this.activeAttributes.textRect?(this.activeAttributes.textRect.top-this.activeAttributes.textRect.bottom).toFixed(3)===t.toFixed(3):!0)}convertUnitAsLocalized(e,t){switch(e){case"mmToPoint":return this.unitPipe.isRegionUS()?this.unitPipe.convertToImperial(q.POINT,t??0):Ye.convert(q.POINT,q.MILLIMETER,t??0);case"pointToMm":return this.unitPipe.isRegionUS()?Ye.convert(fn[q.MILLIMETER],q.POINT,t??0):Ye.convert(q.MILLIMETER,q.POINT,t??0);default:return}}resizeTextRect(e,t){if(!T.isDefined(this.activeAttributes.textRect))throw new Mt('Cannot find "textRect" in AnnotAttributes.');if(T.isDefined(e)){let o=e;o<Fe.annotation.resizeLimit.width&&(o=Fe.annotation.resizeLimit.width),this.activeAttributes.textRect.right=this.activeAttributes.textRect.left+o}if(T.isDefined(t)){let o=t;o<Fe.annotation.resizeLimit.height&&(o=Fe.annotation.resizeLimit.height);let s=this.activeAttributes.textRect.top-(this.activeAttributes.textRect.top-this.activeAttributes.textRect.bottom)/2;this.activeAttributes.textRect.top=s+o/2,this.activeAttributes.textRect.bottom=s-o/2}}isCommonFieldAttribute(e){let t=["Parent"];return this.isCommonAnnotAttribute(t.concat(e))}isCommonAnnotAttribute(e){let t=this.activeAttributes;return e.every(o=>Se.hasKey(t,o)?(t=t[o],!0):!1)}getPresetAnnots(e){return Se.hasKey(ki,e)?ki[e]:void 0}};v(n,"\u0275fac",function(t){return new(t||n)(m(oe),m(Y),m(Re),m(P),m(ge),m(Jt),m(xe),m(Ji))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-annot-property-config"]],standalone:!1,features:[$([P])],decls:12,vars:6,consts:[["emptyAnnotRef",""],["propertiesRef",""],["sizeContentRef",""],["colorContentRef",""],["lineContentRef",""],["textContentRef",""],[1,"container"],[1,"tool-panel"],[1,"tool-box"],[4,"ngFor","ngForOf"],[1,"preview-paper-panel"],[3,"ngStyle","annot"],[1,"property-panel"],[4,"ngIf","ngIfThen","ngIfElse"],[4,"ngIf"],[1,"tool-container"],[1,"tool-button",3,"click","title"],[1,"papycon",3,"ngClass"],["class","ep-text-button expand-button","color","dark",3,"click",4,"ngIf"],["class","active-indicator",3,"no-subtool",4,"ngIf"],["class","subtool-menu",4,"ngIf"],["color","dark",1,"ep-text-button","expand-button",3,"click"],[1,"papycon","papycon-chevron3-down"],[1,"active-indicator"],[1,"subtool-menu"],[1,"menu-container"],["class","ep-text-button","color","dark",3,"selected","dirty","title","click",4,"ngIf"],["color","dark",1,"ep-text-button",3,"click","title"],[1,"empty"],[1,"papycon","papycon-memo3"],[3,"contentTemplate","selected","header","borderHidden",4,"ngIf"],[3,"contentTemplate","selected","header","borderHidden"],[1,"flex","wrap","space-between","size"],[1,"property-title"],[3,"mousedown","width","max","puInputStep","suffix","formControl"],[1,"flex","column"],[1,"flex"],["class","flex column color-property",4,"ngIf"],[3,"nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel","ngModelChange",4,"ngIf"],[1,"flex","space-between"],[1,"slider-value"],[1,"flex","align-center",3,"ngSubmit"],["tabindex","0",3,"ngModelChange","puStepApply","min","max","step","name","puInputStep","puStep","puAlterStep","ngModel"],["size","tiny",1,"slider-input",3,"blur","formControl"],[1,"flex","column","color-property"],[1,"color-picker-container"],[1,"color-rect",3,"click"],[3,"ngModelChange","nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel"],["name","strokeWidth","tabindex","0",3,"ngModelChange","puStepApply","puInputStep","max","min","ngModel"],[3,"ngModelChange","isImageLabel","options","size","ngModel"],[3,"ngModelChange","mousedown","isImageLabel","options","size","ngModel"],["class","flex",4,"ngIf"],[1,"flex","column","font-property"],[1,"font-dropdown",3,"ngModelChange","size","options","ngModel"],[1,"font-size-dropdown",3,"ngModelChange","editable","size","options","ngModel"],[3,"customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel","ngModelChange",4,"ngIf"],[3,"ngModelChange","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel"]],template:function(t,o){if(t&1&&(h(0,"div",6)(1,"div",7)(2,"section",8),R(3,Lm,2,1,"ng-container",9),_()(),h(4,"div",10),I(5,"sd-preview-paper",11),_(),h(6,"div",12),R(7,km,1,0,"ng-container",13)(8,Fm,5,3,"ng-template",null,0,He)(10,ih,5,11,"ng-template",null,1,He),_()()),t&2){let s=we(9),c=we(11);l(3),p("ngForOf",o.toolMenuItems),l(2),p("ngStyle",o.paperSize)("annot",o.activeTool),l(2),p("ngIf",o.activeTool)("ngIfThen",c)("ngIfElse",s)}},styles:['[_nghost-%COMP%]{height:600px;padding:0 36px 40px}.container[_ngcontent-%COMP%]{display:flex;height:100%;border:1px solid #DADADA;border-radius:2px}.tool-panel[_ngcontent-%COMP%]{flex:0 0 60px;height:100%;border-right:1px solid #DADADA}.tool-panel[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%]{margin:10px}.tool-panel[_ngcontent-%COMP%]   .tool-button.dirty[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:after{content:"";position:absolute;left:100%;top:0;width:4px;height:4px;border-radius:4px;background-color:#f79f1a}.tool-panel[_ngcontent-%COMP%]   .tool-button.ep-text-button[_ngcontent-%COMP%]{width:24px;height:24px;border-width:0;outline-offset:-2px}.tool-panel[_ngcontent-%COMP%]   .tool-button.expandable[_ngcontent-%COMP%]{margin-right:0}.ep-text-button.dirty[_ngcontent-%COMP%]{position:relative}.ep-text-button.dirty[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:after{content:"";position:absolute;right:0;top:0;width:4px;height:4px;border-radius:4px;background-color:#f79f1a}.subtool-menu[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;position:absolute;display:flex;height:44px;top:100%;left:-7px;align-items:center;box-sizing:border-box;padding:6px 12px;margin-top:5px;border:1px solid #DADADA;border-radius:2px;background-color:#fff;white-space:nowrap;z-index:3}.subtool-menu[_ngcontent-%COMP%]   .menu-container[_ngcontent-%COMP%]{display:flex;min-width:100%}.subtool-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:30px;height:30px}.subtool-menu[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{color:#fff;background-color:#f79f1a}.subtool-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}section.tool-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 0}section.tool-box[_ngcontent-%COMP%]   .tool-container[_ngcontent-%COMP%]{position:relative;height:34px;display:flex;align-items:center}section.tool-box[_ngcontent-%COMP%]   .tool-container[_ngcontent-%COMP%]:not(:last-child){margin-bottom:20px}section.tool-box[_ngcontent-%COMP%]   .expand-button[_ngcontent-%COMP%]{border-width:0;outline-offset:-2px}section.tool-box[_ngcontent-%COMP%]   .expand-button[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + section.tool-box[_ngcontent-%COMP%]   .expand-button[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}section.tool-box[_ngcontent-%COMP%]   .expand-button[_ngcontent-%COMP%]   .papycon.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}section.tool-box[_ngcontent-%COMP%]   .active-indicator[_ngcontent-%COMP%]{position:absolute;left:10px;bottom:0;width:calc(100% - 20px);height:3px;background-color:#f79f1a;border-radius:2px}section.tool-box[_ngcontent-%COMP%]   .active-indicator.no-subtool[_ngcontent-%COMP%]{width:25px}.preview-paper-panel[_ngcontent-%COMP%]{width:540px;height:100%;background-color:#f4f4f4;display:flex;justify-content:center;align-items:center;position:relative}.property-panel[_ngcontent-%COMP%]{overflow:auto;width:252px;max-width:252px;height:100%;border-left:1px solid #DADADA}.empty[_ngcontent-%COMP%]{color:#6c6c6c;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}.empty[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:38px;margin-bottom:5px}.empty[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;line-height:22px}pu-accordion[_ngcontent-%COMP%]:last-child{padding-bottom:12px}pu-accordion.no-margin[_ngcontent-%COMP%]{margin:0}pu-accordion.no-border[_ngcontent-%COMP%]{border:none}.flex[_ngcontent-%COMP%]{display:flex}.flex.column[_ngcontent-%COMP%]{flex-direction:column}.flex.align-center[_ngcontent-%COMP%]{align-items:center}.flex.space-between[_ngcontent-%COMP%]{justify-content:space-between}.flex.wrap[_ngcontent-%COMP%]{flex-wrap:wrap}.property-title[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:#6c6c6c;margin-top:4px;margin-bottom:2px}.property-title.disabled[_ngcontent-%COMP%]{opacity:.5;-webkit-user-select:none;user-select:none}pu-accordion-tab[_ngcontent-%COMP%]{border-bottom:1px solid #DADADA}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{padding:0 12px}pu-accordion-tab[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]:after{content:"";display:block;width:100%;height:12px}pu-dropdown[_ngcontent-%COMP%], pu-input[_ngcontent-%COMP%], pu-slider[_ngcontent-%COMP%]{margin-bottom:8px}pu-dropdown.no-margin[_ngcontent-%COMP%], pu-input.no-margin[_ngcontent-%COMP%], pu-slider.no-margin[_ngcontent-%COMP%]{margin-bottom:0}pu-slider[_ngcontent-%COMP%]{flex-shrink:1}.slider-value[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:#1e1e1e;display:none}.slider-input[_ngcontent-%COMP%]{width:38px;margin-left:8px;flex-shrink:0}.color-picker-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border:1px solid #DADADA;border-radius:2px;box-sizing:border-box;padding:3px;margin-top:2px;width:30px;height:30px}.color-picker-container.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none;-webkit-user-select:none;user-select:none}.color-picker-container.selected[_ngcontent-%COMP%]{background-color:#f79f1a14;border:1px solid #F79F1A;box-shadow:0 0 6px #f79f1a}.color-picker-container[_ngcontent-%COMP%]   .color-rect[_ngcontent-%COMP%]{width:22px;height:22px;border-radius:2px;background-size:cover}.color-property[_ngcontent-%COMP%]{margin-left:8px}.color-property[_ngcontent-%COMP%]:first-child{margin-left:0}.font-property[_ngcontent-%COMP%]{margin-left:12px}.font-property[_ngcontent-%COMP%]:first-child{margin-left:0}.font-property[_ngcontent-%COMP%]   .font-dropdown[_ngcontent-%COMP%]{width:124px}.font-property[_ngcontent-%COMP%]   .font-size-dropdown[_ngcontent-%COMP%]{width:80px}.size[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-right:12px;margin-top:8px}'],data:{animation:[Ln.expandSubTool()]},changeDetection:0}));let r=n;return r})();function nh(r,n){r&1&&dn(0)}function oh(r,n){r&1&&(h(0,"div",7)(1,"span"),M(2),E(3,"translate"),_(),I(4,"pu-input",8),E(5,"translate"),_(),h(6,"div",7)(7,"span"),M(8),E(9,"translate"),_(),I(10,"pu-input",9),E(11,"translate"),_()),r&2&&(l(2),k(S(3,4,"TOOL_NAME")),l(2),p("placeholder",S(5,6,"TOOL_NAME_PLACEHOLDER")),l(4),k(S(9,8,"TOOL_EVENT_NAME")),l(2),p("placeholder",S(11,10,"TOOL_EVENT_NAME_PLACEHOLDER")))}function rh(r,n){r&1&&(h(0,"div",7)(1,"span"),M(2),E(3,"translate"),_(),I(4,"pu-input",8),E(5,"translate"),_()),r&2&&(l(2),k(S(3,2,"GROUP_NAME")),l(2),p("placeholder",S(5,4,"GROUP_NAME_PLACEHOLDER")))}var nt=function(r){return r.CREATE_TOOL="createTool",r.EDIT_TOOL="editTool",r.CREATE_CATEGORY="createCategory",r.EDIT_CATEGORY="editCategory",r}(nt||{}),Qn=function(r){return r[r.TOOL=0]="TOOL",r[r.CATEGORY=1]="CATEGORY",r}(Qn||{}),Jr=(()=>{let n=class n{contextMenuModalParam;translatePipe;modalService;portalRef;subscriptionService;formBuilder;loggingService;form;get TemplateType(){return Qn}get modalType(){return this.contextMenuModalParam.modalType}get templateType(){return this.modalType===nt.CREATE_TOOL||this.modalType===nt.EDIT_TOOL?Qn.TOOL:Qn.CATEGORY}get isConfirmButtonActive(){let{type:e,id:t,label:o,eventId:s}=this.form.getRawValue();switch(this.templateType){case Qn.TOOL:return T.isDefined(e&&t&&o&&s);case Qn.CATEGORY:return T.isDefined(e&&t&&o)}}get title(){switch(this.modalType){case nt.CREATE_TOOL:return this.translatePipe.transform("ADD_CUSTOM_CONTEXT_MENU_ITEM");case nt.EDIT_TOOL:return this.translatePipe.transform("EDIT_CUSTOM_CONTEXT_MENU_ITEM");case nt.CREATE_CATEGORY:return this.translatePipe.transform("ADD_CUSTOM_CONTEXT_MENU_CATEGORY");case nt.EDIT_CATEGORY:return this.translatePipe.transform("EDIT_CUSTOM_CONTEXT_MENU_CATEGORY")}}constructor(e,t,o,s,c,u,C){this.contextMenuModalParam=e,this.translatePipe=t,this.modalService=o,this.portalRef=s,this.subscriptionService=c,this.formBuilder=u,this.loggingService=C,this.form=this.formBuilder.group({type:this.formBuilder.nonNullable.control(""),id:this.formBuilder.nonNullable.control(yr()),label:this.formBuilder.nonNullable.control(""),eventId:this.formBuilder.nonNullable.control("")})}ngOnInit(){this.initFields(),this.initSubscription()}initFields(){let{type:e,id:t,label:o,data:s}=this.contextMenuModalParam.tool;switch(this.modalType){case nt.EDIT_CATEGORY:case nt.EDIT_TOOL:this.form.controls.type.setValue(e),this.form.controls.id.setValue(t),this.form.controls.label.setValue(o),this.form.controls.eventId.setValue(s?.eventId);break;case nt.CREATE_TOOL:this.form.controls.type.setValue(si.ITEM);break;case nt.CREATE_CATEGORY:this.form.controls.type.setValue(si.CATEGORY);break;default:this.loggingService.common("error",le.INVALID,'"modalType"',this.contextMenuModalParam);break}}initSubscription(){this.subscriptionService.push(Ve.windowKeyDown$.pipe(L(e=>e.key==="Escape"),L(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.closeModal()}))}closeModal(){this.portalRef.dispose()}onConfirmButtonClick(){let{type:e,id:t,label:o,eventId:s}=this.form.value;this.portalRef.dispose({contextMenu:{type:e,id:t,label:o,data:{eventId:s}},modalType:this.modalType})}};v(n,"\u0275fac",function(t){return new(t||n)(m(Dn),m(oe),m(Zt),m(Si),m(P),m(Qi),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-context-menu-modal"]],standalone:!1,features:[$([P])],decls:16,vars:14,consts:[["tool",""],["category",""],[1,"papycon","papycon-cross",3,"click"],[1,"container",3,"formGroup"],[4,"ngIf","ngIfThen","ngIfElse"],["size","small","color","white",1,"ep-button",3,"click"],["size","small","color","primary",1,"ep-button",3,"click","disabled"],[1,"input-container"],["formControlName","label","size","small",3,"placeholder"],["formControlName","eventId","size","small",3,"placeholder"]],template:function(t,o){if(t&1){let s=w();h(0,"h3"),M(1),h(2,"i",2),O("click",function(){return f(s),g(o.closeModal())}),_()(),h(3,"main",3),R(4,nh,1,0,"ng-container",4)(5,oh,12,12,"ng-template",null,0,He)(7,rh,6,6,"ng-template",null,1,He),_(),h(9,"footer")(10,"button",5),O("click",function(){return f(s),g(o.closeModal())}),M(11),E(12,"translate"),_(),h(13,"button",6),O("click",function(){return f(s),g(o.onConfirmButtonClick())}),M(14),E(15,"translate"),_()()}if(t&2){let s=we(6),c=we(8);l(),ke(" ",o.title," "),l(2),W("category",o.templateType===o.TemplateType.CATEGORY),p("formGroup",o.form),l(),p("ngIf",o.templateType===o.TemplateType.TOOL)("ngIfThen",s)("ngIfElse",c),l(7),k(S(12,10,"CANCEL")),l(2),p("disabled",!o.isConfirmButtonActive),l(),k(S(15,12,"OK"))}},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:#1e1e1e;display:flex;margin:8px 0;justify-content:space-between;align-items:flex-start}h3[_ngcontent-%COMP%]   .papycon-cross[_ngcontent-%COMP%]{font-size:13px;line-height:22px;cursor:pointer;width:22px;height:22px;text-align:center;color:#6c6c6c;margin-right:0}main[_ngcontent-%COMP%]{width:412px;height:140px}main.category[_ngcontent-%COMP%]{height:57px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:NotoSans-Medium;font-size:13px;letter-spacing:-.5px;color:#6c6c6c}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{height:40px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]  input{padding:0 8px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border-radius:2px;border:solid 1.2px #DADADA;background-color:#fff;padding:8px;font-family:NotoSans-Regular;font-size:14px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:first-child{margin-top:16px}main[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:last-child{margin-top:20px}footer[_ngcontent-%COMP%]{text-align:right;margin-top:20px}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));let r=n;return r})();var sh=["puMenu"],ah=["leftPanel"],Ql=r=>({content:r,className:"with-icon"}),ch=r=>[r],lh=()=>[];function ph(r,n){if(r&1&&I(0,"i"),r&2){let i=d().$implicit;Nn(i.icon)}}function dh(r,n){if(r&1&&(h(0,"span"),M(1),E(2,"translate"),_()),r&2){let i=d().$implicit;l(),k(S(2,1,i.label))}}function uh(r,n){if(r&1){let i=w();h(0,"div",32),O("click",function(){let t=f(i).$implicit,o=d();return g(o.onToolClick(t))}),R(1,ph,1,2,"i",33)(2,dh,3,3,"span",34),_()}if(r&2){let i=n.$implicit,e=d();W("active",e.selectedLeftTool&&e.selectedLeftTool.id===i.id),l(),p("ngIf",i.icon),l(),p("ngIf",e.isString(i.label))}}var Pi=function(r){return r.LEFT="left",r.RIGHT="right",r.UP="up",r.DOWN="down",r}(Pi||{}),ta=(()=>{let n=class n{modalService;changeDetectorRef;configsService;productService;translatePipe;subscriptionService;puMenuRef;leftPanelRef;_tools=[];get tools(){return this._tools}set tools(e){if(!e)return;let t=e.filter(s=>s.data?.isDefaultTool),o=e.filter(s=>!s.data?.isDefaultTool);this._tools=[...this.sortDefaultTools(t),...o],K.set(a.AVAILABLE_CONTEXT_MENU_TOOLS,o)}_toolsInUse=[];get toolsInUse(){return this._toolsInUse}set toolsInUse(e){e&&(this._toolsInUse=e,K.set(a.CONTEXT_MENU_TOOLS_IN_USE,this.toolsInUse),this.setPUMenus(this.toolsInUse))}menus=[];defaultTools=[];clickedButton=null;toolNumIncreased=!1;selectedRightTool=null;selectedLeftTool=null;additionalRightToolMenus=[];get shouldLeftButtonDisabled(){return this.selectedRightTool===null||this.selectedRightTool.type!==si.ITEM}get ContextMenuModalType(){return nt}get noEditableItemOnRight(){return this.selectedRightTool===null||this.selectedRightTool.type===si.LINE||!!this.selectedRightTool.data?.isDefaultTool}constructor(e,t,o,s,c,u){this.modalService=e,this.changeDetectorRef=t,this.configsService=o,this.productService=s,this.translatePipe=c,this.subscriptionService=u,this.defaultTools=T.deepClone(Pc).filter(C=>{let x=["REDACTION","SELECT_ANNOT_TOOL"].map(N=>N.toString());return!this.productService.isStreamDocsVu||xi.hasDefinedProp(C,"id")&&!x.includes(C.id)}),this.additionalRightToolMenus=[{label:"",items:[{label:this.translatePipe.transform("ADD_DIVISION_LINE"),command:()=>{let C={id:yr(),type:si.LINE,label:""};this.toolsInUse=[...this.toolsInUse,C],this.resetSelectedTools(),this.selectedRightTool=C,this.toolNumIncreased=!0}},{label:this.translatePipe.transform("ADD_CUSTOM_CONTEXT_MENU_CATEGORY"),command:()=>{this.showModal(nt.CREATE_CATEGORY)}}]}]}ngOnInit(){this.tools=K.get(a.AVAILABLE_CONTEXT_MENU_TOOLS),this.toolsInUse=K.get(a.CONTEXT_MENU_TOOLS_IN_USE),this.setDefaultTools(),this.initSubscriptions()}onChildrenChanged(){let e;this.clickedButton===Pi.LEFT?e=this.leftPanelScrollTarget:e=this.rightPanelScrollTarget,ve.runAsync(()=>this.setScrollTop(e))}initSubscriptions(){this.subscriptionService.push(this.configsService.resetClick$.subscribe({next:()=>{this.tools=this.defaultTools.filter(e=>!e.data?.isTextTool),this.toolsInUse=this.defaultTools.filter(e=>e.data?.isTextTool),this.changeDetectorRef.markForCheck()}}),this.configsService.cancelClick$.subscribe({next:()=>{this.changeDetectorRef.markForCheck()}}))}setDefaultTools(){let e=this.defaultTools.filter(t=>this.toolsInUse.every(o=>o.id!==t.id));this.tools=[...e,...this.tools]}sortDefaultTools(e){return e.sort((t,o)=>{let s=t.data?.index??Number.MAX_SAFE_INTEGER,c=o.data?.index??Number.MAX_SAFE_INTEGER;return s-c})}onToolClick(e){this.resetSelectedTools(),this.selectedLeftTool=e}setPUMenus(e){let t=e.map(o=>o.command?o:rt(Oe({},o),{label:o.type===si.LINE||o.type===si.CATEGORY?o.label:this.translatePipe.transform(o.label.toString()),command:(s,c)=>{this.resetSelectedTools();let u=this.toolsInUse.find(C=>C.id===c.id);u!==void 0&&(this.selectedRightTool=u)}}));this.menus=[{items:t}],this.toolsInUse.length===0||this.selectedRightTool}get leftPanelScrollTarget(){return this.leftPanelRef.element.nativeElement}get rightPanelScrollTarget(){return this.puMenuRef.element.nativeElement.firstChild}setScrollTop(e){let o=Number(e?.offsetHeight),s=Number(e?.scrollTop),c=s+o,u=this.getActiveElement(e.children);if(!u)return;let C=u.offsetTop,x=C+u.offsetHeight,N=u.offsetHeight,D=c-12<=x,X=C<=s;D&&this.clickedButton===Pi.UP&&(e.scrollTop=x-o),D&&this.clickedButton===Pi.DOWN&&(e.scrollTop=x-o),D&&this.toolNumIncreased&&(e.scrollTop=x-o+N),X&&this.clickedButton===Pi.UP&&(e.scrollTop=C-12),X&&this.clickedButton===Pi.DOWN&&(e.scrollTop=C-12),X&&this.toolNumIncreased&&(e.scrollTop=C-N-12),this.toolNumIncreased=!1,this.clickedButton=null}getActiveElement(e){let t=Array.from(e).findIndex(o=>Array.from(o.classList).includes("active"));return t===-1?null:e[t]}makeModalParams(e,t){let o={modalType:e,tool:{}};if(!t)return o;let{type:s,id:c,label:u,data:C}=t;switch(e){case nt.CREATE_TOOL:break;case nt.EDIT_TOOL:o.tool={type:s,id:c,label:u,data:{eventId:C?.eventId}};break;case nt.CREATE_CATEGORY:break;case nt.EDIT_CATEGORY:o.tool={type:s,id:c,label:u};break}return o}showModal(e,t){this.modalService.createModal(Jr,this.makeModalParams(e,t)).addOnDisposeListener(o=>{if(!o||!T.isDefined(o.contextMenu))return;let s=(c,u)=>c.map(C=>C.id===u.id?u:C);switch(o.modalType){case nt.CREATE_TOOL:this.tools=[...this.tools,o.contextMenu],this.selectedLeftTool=o.contextMenu,this.toolNumIncreased=!0,ve.runAsync(()=>this.setScrollTop(this.leftPanelScrollTarget));break;case nt.EDIT_TOOL:this.tools=s(this.tools,o.contextMenu),this.toolsInUse=s(this.toolsInUse,o.contextMenu);break;case nt.CREATE_CATEGORY:this.toolsInUse=[...this.toolsInUse,o.contextMenu],this.resetSelectedTools(),this.selectedRightTool=o.contextMenu,this.toolNumIncreased=!0;break;case nt.EDIT_CATEGORY:this.toolsInUse=s(this.toolsInUse,o.contextMenu);break}this.changeDetectorRef.markForCheck()})}changeToolIndex(e,t){this.toolsInUse.splice(t,0,...this.toolsInUse.splice(e,1)),this.toolsInUse=[...this.toolsInUse]}onLeftButtonClick(){if(this.selectedRightTool===null)return;let e=this.selectedRightTool,t=this.toolsInUse.indexOf(e);this.tools=[...this.tools,e],this.toolsInUse.splice(t,1),this.toolsInUse=[...this.toolsInUse],this.resetSelectedTools(),this.selectedLeftTool=e,this.toolNumIncreased=!0,this.clickedButton=Pi.LEFT}onRightButtonClick(){if(this.selectedLeftTool===null)return;let e=this.selectedLeftTool,t=this.tools.indexOf(e);this.toolsInUse=[...this.toolsInUse,e],this.tools.splice(t,1),this.tools=[...this.tools],this.resetSelectedTools(),this.selectedRightTool=e,this.toolNumIncreased=!0,this.clickedButton=Pi.RIGHT}onUpButtonClick(){if(this.selectedRightTool===null)return;this.clickedButton=Pi.UP;let e=this.toolsInUse.indexOf(this.selectedRightTool),t=e===0?this.toolsInUse.length-1:e-1;this.changeToolIndex(e,t)}onDownButtonClick(){if(this.selectedRightTool===null)return;this.clickedButton=Pi.DOWN;let e=this.toolsInUse.indexOf(this.selectedRightTool),t=e===this.toolsInUse.length-1?0:e+1;this.changeToolIndex(e,t)}onPenClick(e){e?.type===si.CATEGORY&&this.showModal(this.ContextMenuModalType.EDIT_CATEGORY,e),e?.type===si.ITEM&&this.showModal(this.ContextMenuModalType.EDIT_TOOL,e)}onLeftMinusClick(e){this.modalService.createCommonModal({type:Cn.BASIC,icon:"papycon papycon-questionmark",title:this.translatePipe.transform("DELETE_WARNING"),content:`${e.label}`,confirmButton:!0,cancelButton:!0}).addOnDisposeListener(t=>{if(!t)return;let o=this.tools.indexOf(e);this.tools.splice(o,1),this.resetSelectedTools(),this.changeDetectorRef.markForCheck()})}onRightMinusClick(e){let t=o=>{let s=this.toolsInUse.indexOf(e);this.toolsInUse.splice(s,1),this.toolsInUse=[...this.toolsInUse],this.resetSelectedTools()};if(e.type!==si.ITEM){t(e);return}this.modalService.createCommonModal({type:Cn.BASIC,icon:"papycon papycon-questionmark",title:this.translatePipe.transform("DELETE_WARNING"),content:`${e.label}`,confirmButton:!0,cancelButton:!0}).addOnDisposeListener(o=>{o&&(t(e),this.changeDetectorRef.markForCheck())})}resetSelectedTools(){this.selectedLeftTool=null,this.selectedRightTool=null}isString(e){return typeof e=="string"}};v(n,"\u0275fac",function(t){return new(t||n)(m(Zt),m(Y),m(Jt),m(Vn),m(oe),m(P))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-context-menu-config"]],viewQuery:function(t,o){if(t&1&&(se(sh,7,Ei),se(ah,7,Ei)),t&2){let s;ae(s=ce())&&(o.puMenuRef=s.first),ae(s=ce())&&(o.leftPanelRef=s.first)}},standalone:!1,features:[$([P])],decls:53,vars:33,consts:[["leftPanel",""],["puMenuleftPanel",""],["additionalRightToolMenuRef",""],[1,"context-menu-container"],[1,"left","box"],[1,"header"],[1,"label"],[1,"papycon","papycon-questionmark",3,"tooltip"],[1,"available-tools","panel"],[1,"tools"],["class","tool",3,"active","click",4,"ngFor","ngForOf"],["size","tiny",1,"ep-text-button",3,"click"],[1,"papycon","papycon-plus2"],["size","tiny",1,"ep-text-button",3,"click","disabled"],[1,"papycon","papycon-minus"],[1,"papycon","papycon-pen"],[1,"buttons","between-panels"],[1,"button-container"],["size","small","color","white",1,"ep-button",3,"click","disabled"],[1,"papycon","papycon-previous-symbol2"],[1,"papycon","papycon-next-symbol2"],[1,"right","box"],[1,"papycon","papycon-questionmark","tooltip-icon",3,"tooltip"],[1,"tools-in-use","panel"],[1,"menu-container"],[3,"childrenChanged","menus","selectedItem","isStatic","editable"],[1,"buttons","in-right-panel"],["color","white",1,"ep-button",3,"click","disabled"],[1,"papycon","papycon-up-symbol"],[1,"papycon","papycon-down-symbol"],[3,"menus"],["size","tiny",1,"ep-text-button","right-plus",3,"click"],[1,"tool",3,"click"],[3,"class",4,"ngIf"],[4,"ngIf"]],template:function(t,o){if(t&1){let s=w();h(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),M(4),E(5,"translate"),_(),I(6,"i",7),E(7,"translate"),_(),h(8,"div",8)(9,"div",9,0),R(11,uh,3,4,"div",10),_(),h(12,"footer")(13,"button",11),O("click",function(){return f(s),g(o.showModal(o.ContextMenuModalType.CREATE_TOOL))}),I(14,"i",12),_(),h(15,"button",13),O("click",function(){return f(s),g(o.onLeftMinusClick(o.selectedLeftTool))}),I(16,"i",14),_(),h(17,"button",13),O("click",function(){return f(s),g(o.onPenClick(o.selectedLeftTool))}),I(18,"i",15),_()()()(),h(19,"div",16)(20,"div",17)(21,"button",18),O("click",function(){return f(s),g(o.onLeftButtonClick())}),I(22,"i",19),_()(),h(23,"div",17)(24,"button",18),O("click",function(){return f(s),g(o.onRightButtonClick())}),I(25,"i",20),_()()(),h(26,"div",21)(27,"div",5)(28,"span",6),M(29),E(30,"translate"),_(),I(31,"i",22),E(32,"translate"),_(),h(33,"div",23)(34,"div",24)(35,"pu-menu",25,1),O("childrenChanged",function(){return f(s),g(o.onChildrenChanged())}),_(),h(37,"div",26)(38,"div",17)(39,"button",27),O("click",function(){return f(s),g(o.onUpButtonClick())}),I(40,"i",28),_()(),h(41,"div",17)(42,"button",27),O("click",function(){return f(s),g(o.onDownButtonClick())}),I(43,"i",29),_()()()(),h(44,"footer"),I(45,"pu-menu",30,2),h(47,"button",31),O("click",function(){f(s);let u=we(46);return g(u.toggleMenu())}),I(48,"i",12),_(),h(49,"button",13),O("click",function(){return f(s),g(o.onRightMinusClick(o.selectedRightTool))}),I(50,"i",14),_(),h(51,"button",13),O("click",function(){return f(s),g(o.onPenClick(o.selectedRightTool))}),I(52,"i",15),_()()()()()}t&2&&(l(4),k(S(5,18,"TOOL_LIST")),l(2),p("tooltip",gt(26,Ql,S(7,20,"EDIT_TOOL_LIST_TOOLTIP"))),l(5),p("ngForOf",o.tools),l(4),p("disabled",!o.selectedLeftTool||(o.selectedLeftTool.data==null?null:o.selectedLeftTool.data.isDefaultTool)),l(2),p("disabled",!o.selectedLeftTool||(o.selectedLeftTool.data==null?null:o.selectedLeftTool.data.isDefaultTool)),l(4),p("disabled",o.shouldLeftButtonDisabled),l(3),p("disabled",!o.selectedLeftTool),l(5),k(S(30,22,"CUSTOM_TOOL_LIST")),l(2),p("tooltip",gt(28,Ql,S(32,24,"EDIT_CUSTOM_TOOL_LIST_TOOLTIP"))),l(4),p("menus",o.menus)("selectedItem",o.selectedRightTool?gt(30,ch,o.selectedRightTool):pe(32,lh))("isStatic",!0)("editable",!0),l(4),p("disabled",o.selectedRightTool===null),l(3),p("disabled",o.selectedRightTool===null),l(3),p("menus",o.additionalRightToolMenus),l(4),p("disabled",o.selectedRightTool===null||(o.selectedRightTool.data==null?null:o.selectedRightTool.data.isDefaultTool)),l(2),p("disabled",o.noEditableItemOnRight))},styles:[".context-menu-container[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;margin:5px 50px 70px}.context-menu-container[_ngcontent-%COMP%]   .tooltip[_ngcontent-%COMP%]{font-size:12px;line-height:20px;color:#fff;font-family:NotoSans-Regular,sans-serif;background-color:#363636;position:fixed;z-index:1;padding:14px 20px;border-radius:5px;white-space:pre}.context-menu-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .context-menu-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;flex-direction:column}.context-menu-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%], .context-menu-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{height:18px;display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}.context-menu-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%], .context-menu-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:#1e1e1e}.context-menu-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%], .context-menu-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{color:#6c6c6c;cursor:pointer}.context-menu-container[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{box-sizing:border-box;height:387px;border:1px solid #DADADA;border-radius:2px;display:flex;flex-direction:column}.context-menu-container[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]{box-sizing:border-box;flex:0 0 42px;display:flex;align-items:center;position:relative;width:100%;padding:0 8px;border-top:1px solid #DADADA;background-color:#fff}.context-menu-container[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{bottom:35px;left:20px}.context-menu-container[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]   .ep-text-button[_ngcontent-%COMP%]{width:30px;height:30px;display:flex;align-items:center;justify-content:center}.context-menu-container[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]   .ep-text-button[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:22px}.context-menu-container[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]   .ep-text-button[_ngcontent-%COMP%]:last-child{margin-left:auto}.context-menu-container[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]   .ep-text-button.right-plus[_ngcontent-%COMP%]{position:relative}.context-menu-container[_ngcontent-%COMP%]   .available-tools[_ngcontent-%COMP%]{padding-top:4px;width:238px}.context-menu-container[_ngcontent-%COMP%]   .tools-in-use[_ngcontent-%COMP%]{width:280px;background-color:#f4f4f4}.context-menu-container[_ngcontent-%COMP%]   .tools-in-use[_ngcontent-%COMP%]   .menu-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:relative;height:100%}.context-menu-container[_ngcontent-%COMP%]   .tools-in-use[_ngcontent-%COMP%]   .menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{position:relative;margin-right:25px;width:186px;min-height:218px;overflow:auto;max-height:308px}.context-menu-container[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{flex-wrap:wrap;display:flex;align-self:center}.context-menu-container[_ngcontent-%COMP%]   .buttons.between-panels[_ngcontent-%COMP%]{flex:1}.context-menu-container[_ngcontent-%COMP%]   .buttons.between-panels[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]{flex:1 0 100%}.context-menu-container[_ngcontent-%COMP%]   .buttons.between-panels[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:46px;height:44px}.context-menu-container[_ngcontent-%COMP%]   .buttons.between-panels[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:28px}.context-menu-container[_ngcontent-%COMP%]   .buttons.in-right-panel[_ngcontent-%COMP%]{flex-direction:column;flex-wrap:nowrap;position:absolute;width:60px;right:0;top:128px}.context-menu-container[_ngcontent-%COMP%]   .buttons.in-right-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:30px;height:30px}.context-menu-container[_ngcontent-%COMP%]   .buttons.in-right-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:12px}.context-menu-container[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]{display:flex;justify-content:center}.context-menu-container[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.context-menu-container[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;flex:0 0 338px;overflow:auto}.context-menu-container[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{padding:0 12px;display:flex;box-sizing:border-box;width:100%;min-height:30px;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none}.context-menu-container[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.active[_ngcontent-%COMP%]{border:1px solid #F79F1A;background-color:#f79f1a14}.context-menu-container[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;margin-right:7px}.context-menu-container[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif}"],changeDetection:0}));let r=n;return r})();function mh(r,n){if(r&1&&I(0,"sd-free-text",8),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function hh(r,n){if(r&1&&I(0,"sd-ink",9),r&2){let i=d(2);p("annotInk",i.annot)("status",i.status)}}function _h(r,n){if(r&1&&I(0,"sd-line",10),r&2){let i=d(2);p("annotLine",i.annot)("status",i.status)}}function fh(r,n){if(r&1&&I(0,"sd-poly-shape",8),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function gh(r,n){if(r&1&&I(0,"sd-rect",8),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function Ch(r,n){if(r&1&&I(0,"sd-stamp",11),r&2){let i=d(2);p("data",i.annot)("pdfData",i.pdfPage)("status",i.status)}}function Th(r,n){if(r&1&&I(0,"sd-text",12),r&2){let i=d(2);p("annotText",i.annot)("status",i.status)("pdfPage",i.pdfPage)}}function Eh(r,n){if(r&1&&I(0,"sd-text-markup",8),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function Sh(r,n){if(r&1&&I(0,"sd-redaction",8),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function xh(r,n){if(r&1&&I(0,"sd-link",8),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function vh(r,n){if(r&1&&(Te(0),R(1,mh,1,2,"sd-free-text",3)(2,hh,1,2,"sd-ink",4)(3,_h,1,2,"sd-line",5)(4,fh,1,2,"sd-poly-shape",3)(5,gh,1,2,"sd-rect",3)(6,Ch,1,3,"sd-stamp",6)(7,Th,1,3,"sd-text",7)(8,Eh,1,2,"sd-text-markup",3)(9,Sh,1,2,"sd-redaction",3)(10,xh,1,2,"sd-link",3),Ee()),r&2){let i=d();l(),p("ngSwitchCase","FreeText"),l(),p("ngSwitchCase","Ink"),l(),p("ngSwitchCase","Line"),l(),p("ngSwitchCase",i.caseOf("PolyShape",i.annot==null?null:i.annot.type)),l(),p("ngSwitchCase",i.caseOf("Rect",i.annot==null?null:i.annot.type)),l(),p("ngSwitchCase","Stamp"),l(),p("ngSwitchCase","Text"),l(),p("ngSwitchCase",i.caseOf("TextMarkup",i.annot==null?null:i.annot.type)),l(),p("ngSwitchCase","Redact"),l(),p("ngSwitchCase","Link")}}var Oh={PolyShape:{Polygon:!0,PolyLine:!0},TextMarkup:{Highlight:!0,StrikeOut:!0,Underline:!0},Rect:{Circle:!0,Square:!0}},es=(()=>{let n=class n{changeDetectorRef;annotService;subs;annot;containerStyleMap=new Map;status=Z.RENDER;pdfPage={bbox:{x:0,y:0,w:595,h:842},annot:!0,i:0,originalIndex:0,r:0,originalR:0,ref:0,isDuplicated:!1,thumbnail:""};constructor(e,t,o){this.changeDetectorRef=e,this.annotService=t,this.subs=o}caseOf(e,t){return t&&Oh[e][t]?t:null}ngOnInit(){this.subs.push(this.annotService.annotAttributeChange$.subscribe({next:()=>{this.changeDetectorRef.markForCheck()}}))}containerStylesOf(e){if(!e)return{};let t=this.containerStyleMap.get(e.oid);return t=Oe(Oe({},t||{}),U.elementStyleOf(e)),delete t.left,delete t.bottom,t.opacity=(e.attributes.opacity||e.attributes.opacity===0)&&e.attributes.opacity>=0&&e.attributes.opacity!==1?e.attributes.opacity:null,t.transform=null,this.containerStyleMap.set(e.oid,t),t}};v(n,"\u0275fac",function(t){return new(t||n)(m(Y),m(Re),m(P))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-preview-paper"]],inputs:{annot:"annot"},standalone:!1,features:[$([P])],decls:3,vars:3,consts:[[1,"paper"],[1,"preset-annots-container",3,"ngSwitch","ngStyle"],[4,"ngIf"],[3,"data","status",4,"ngSwitchCase"],[3,"annotInk","status",4,"ngSwitchCase"],[3,"annotLine","status",4,"ngSwitchCase"],[3,"data","pdfData","status",4,"ngSwitchCase"],[3,"annotText","status","pdfPage",4,"ngSwitchCase"],[3,"data","status"],[3,"annotInk","status"],[3,"annotLine","status"],[3,"data","pdfData","status"],[3,"annotText","status","pdfPage"]],template:function(t,o){t&1&&(h(0,"div",0)(1,"div",1),R(2,vh,11,10,"ng-container",2),_()()),t&2&&(l(),p("ngSwitch",o.annot.type)("ngStyle",o.containerStylesOf(o.annot)),l(),p("ngIf",o.annot))},styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center}.paper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:var(--mono-00);width:100%;height:100%}.preset-annots-container[_ngcontent-%COMP%]{position:relative}.preset-annots-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]  svg{overflow:visible}sd-free-text[_ngcontent-%COMP%]{position:relative}"],changeDetection:0}));let r=n;return r})();var hv=(()=>{let n=class n{static forRoot(){return{ngModule:n,providers:[Jt,hl]}}};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({imports:[Zl,Ac,mt,kn,ai,Ur,or,cr,lr,pr,ar,ur,hr,fr,Cr,Sc,Er,Fn,lc,jl,fl]}));let r=n;return r})();We(ea,[es,Je,Ue,be,Ce,fo,vt,Ki,ri,_o,xo,nr,ir,sr,To,_i,dr,gr,gn],[oe]);We(ml,[yc,be,un,mn,uo,vt,gn,qr,_l,ea,qs,ta],[oe]);We(qs,[Je,Ue,be,Ce,vt,ri,gc,To,_i,_r,Tr,ji],[oe]);We(ta,[Ue,be,mr,ji],[oe]);We(Jr,[be,vt,Ki,_i,go,Co],[oe]);We(Zr,[Xi,vt,Ki,_i,go,Co],[oe]);var yh=["annotView"],Ah=["gestureSection"];function Rh(r,n){if(r&1&&(h(0,"section",9,0),E(2,"translate"),M(3),_()),r&2){let i=d();p("title",S(2,3,"UNDEFINED_ANNOTATION"))("ngStyle",i.boxStyles),l(3),ke(" NOT YET IMPLEMENTED or UNSUPPORTED. Undefined gesture of annotation tool[",i.annotTool,`].
`)}}function Ph(r,n){if(r&1&&I(0,"sd-stamp",14),r&2){let i=d(2);p("data",i.previewAnnot)("ngStyle",i.previewStyle)("status",i.previewStatus)("pdfData",i.page)}}function Nh(r,n){if(r&1&&I(0,"sd-widget",15),r&2){let i=d(2);p("data",i.previewAnnot)("ngStyle",i.previewStyle)("status",i.previewStatus)}}function Mh(r,n){if(r&1&&(h(0,"section",10,0),R(2,Ph,1,4,"sd-stamp",11)(3,Nh,1,3,"sd-widget",12),I(4,"div",13),_()),r&2){let i=d();p("ngStyle",i.boxStyles),l(2),p("ngIf",i.annotTool===i.AnnotTool.STAMP),l(),p("ngIf",i.annotTool===i.AnnotTool.RADIO_BUTTON),l(),qe("border-width",i.previewCursorWidth,"px")("width",i.previewSize.width,"px")("height",i.previewSize.height,"px"),p("ngStyle",i.previewStyle)}}function Dh(r,n){if(r&1&&I(0,"sd-line",20,1),r&2){let i=d(2);p("annotLine",i.annot)("status",i.status)}}function wh(r,n){if(r&1&&I(0,"sd-rect",21,1),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function Lh(r,n){if(r&1&&I(0,"sd-stamp",22,1),r&2){let i=d(2);p("data",i.annot)("status",i.status)("pdfData",i.page)}}function kh(r,n){if(r&1&&I(0,"sd-free-text",21,1),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function Fh(r,n){if(r&1&&I(0,"sd-widget",21,1),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function Vh(r,n){if(r&1&&I(0,"sd-link",21,1),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function Uh(r,n){if(r&1){let i=w();h(0,"section",16,0),E(2,"translate"),O("mousedown",function(t){f(i);let o=d();return g(o.create(t))})("mousemove",function(t){f(i);let o=d();return g(o.pvOnMove(t))})("mouseenter",function(t){f(i);let o=d();return g(o.onMouseEnter(t))})("mouseleave",function(t){f(i);let o=d();return g(o.annot?o.clear(t):o.onMouseLeave())})("mouseup",function(t){f(i);let o=d();return g(o.clear(t))})("touchstart",function(t){f(i);let o=d();return g(o.create(o.touchToMouse(t)))})("touchmove",function(t){f(i);let o=d();return g(o.pvOnMove(o.touchToMouse(t)))})("touchend",function(t){f(i);let o=d();return g(o.clear(o.touchToMouse(t)))})("pointerdown",function(t){return f(i),g(t.stopPropagation())})("pointermove",function(t){return f(i),g(t.stopPropagation())})("pointerleave",function(t){return f(i),g(t.stopPropagation())})("pointerup",function(t){return f(i),g(t.stopPropagation())}),R(3,Dh,2,2,"sd-line",17)(4,wh,2,2,"sd-rect",18)(5,Lh,2,3,"sd-stamp",19)(6,kh,2,2,"sd-free-text",18)(7,Fh,2,2,"sd-widget",18)(8,Vh,2,2,"sd-link",18),_()}if(r&2){let i=d();p("title",S(2,8,"DRAG_TO_DRAW"))("ngStyle",i.boxStyles),l(3),p("ngIf",i.isLineTool()),l(),p("ngIf",i.isRectTool()),l(),p("ngIf",i.annotTool===i.AnnotTool.STAMP&&i.annot),l(),p("ngIf",i.annotTool===i.AnnotTool.TEXT_CALLOUT&&i.annot),l(),p("ngIf",(i.annotTool===i.AnnotTool.SIGNATURE||i.annotTool===i.AnnotTool.TEXT_FIELD||i.annotTool===i.AnnotTool.CHECK_BUTTON||i.annotTool===i.AnnotTool.RADIO_BUTTON||i.annotTool===i.AnnotTool.LIST_BOX||i.annotTool===i.AnnotTool.COMBO_BOX||i.annotTool===i.AnnotTool.INSTANT_SIGNATURE||i.annotTool===i.AnnotTool.BUTTON)&&i.annot),l(),p("ngIf",i.isLinkTool())}}function Bh(r,n){if(r&1&&I(0,"sd-ink",26,1),r&2){let i=d(3);p("annotInk",i.annot)("status",i.status)}}function Gh(r,n){if(r&1&&(h(0,"div"),R(1,Bh,2,2,"sd-ink",25),_()),r&2){let i=d(2);l(),p("ngIf",i.annot)}}function Wh(r,n){if(r&1){let i=w();h(0,"section",23,0),E(2,"translate"),O("click",function(t){return f(i),g(t.stopPropagation())})("mousedown",function(t){f(i);let o=d();return g(o.create(t))})("mousemove",function(t){f(i);let o=d();return g(o.pvOnMove(t))})("mouseleave",function(){f(i);let t=d();return g(t.annot?t.initOutsidePageSub():void 0)})("mouseenter",function(){f(i);let t=d();return g(t.annot?t.destroyOutsidePageSub():void 0)})("mouseup",function(t){f(i);let o=d();return g(o.pvOnRelease(t))})("touchstart",function(t){f(i);let o=d();return g(o.create(o.touchToMouse(t)))})("touchmove",function(t){f(i);let o=d();return g(o.pvOnMove(o.touchToMouse(t)))})("touchend",function(t){f(i);let o=d();return g(o.pvOnRelease(o.touchToMouse(t)))})("pointerdown",function(t){return f(i),g(t.stopPropagation())})("pointermove",function(t){return f(i),g(t.stopPropagation())})("pointerleave",function(t){return f(i),g(t.stopPropagation())})("pointerup",function(t){return f(i),g(t.stopPropagation())}),R(3,Gh,2,1,"div",24),_()}if(r&2){let i=d();p("title",S(2,4,"DRAG_AND_CLICK_TO_DRAW"))("ngStyle",i.boxStyles)("ngSwitch",i.annotTool),l(3),p("ngSwitchCase",i.AnnotTool.INK)}}function zh(r,n){if(r&1&&I(0,"sd-poly-shape",21,1),r&2){let i=d(3);p("data",i.annot)("status",i.status)}}function Hh(r,n){if(r&1&&(h(0,"div"),R(1,zh,2,2,"sd-poly-shape",18),_()),r&2){let i=d(2);l(),p("ngIf",i.annot)}}function jh(r,n){if(r&1){let i=w();h(0,"span",29),O("click",function(t){f(i);let o=d(2);return g(o.clear(t))})("mousemove",function(t){return f(i),g(t.stopPropagation())})("mouseover",function(t){f(i);let o=d(2);return g(o.pvOnOver(t))})("mouseleave",function(t){return f(i),g(t.stopPropagation())})("mouseup",function(t){return f(i),g(t.stopPropagation())})("touchstart",function(t){return f(i),g(t.stopPropagation())})("touchmove",function(t){return f(i),g(t.stopPropagation())})("touchend",function(t){return f(i),g(t.stopPropagation())})("pointerdown",function(t){return f(i),g(t.stopPropagation())})("pointermove",function(t){return f(i),g(t.stopPropagation())})("pointerleave",function(t){return f(i),g(t.stopPropagation())})("pointerup",function(t){return f(i),g(t.stopPropagation())}),_()}if(r&2){let i=d(2);p("ngStyle",i.finishBtn==null?null:i.finishBtn.styles)}}function $h(r,n){if(r&1){let i=w();h(0,"section",27,0),E(2,"translate"),O("click",function(t){return f(i),g(t.stopPropagation())})("mousedown",function(t){return f(i),g(t.stopPropagation())})("mousemove",function(t){f(i);let o=d();return g(o.pvOnMove(t))})("mouseup",function(t){f(i);let o=d();return o.create(t),g(o.pvOnRelease(t))})("touchstart",function(t){return f(i),t.preventDefault(),g(t.stopPropagation())})("touchmove",function(t){f(i);let o=d();return g(o.pvOnMove(o.touchToMouse(t)))})("touchend",function(t){f(i);let o=d();return o.create(o.touchToMouse(t)),g(o.pvOnRelease(o.touchToMouse(t)))})("pointerdown",function(t){return f(i),g(t.stopPropagation())})("pointermove",function(t){return f(i),g(t.stopPropagation())})("pointerup",function(t){return f(i),g(t.stopPropagation())}),R(3,Hh,2,1,"div",24)(4,jh,1,1,"span",28),_()}if(r&2){let i=d();p("title",S(2,5,"CLICK_AND_MOVE_TO_DRAW"))("ngStyle",i.boxStyles)("ngSwitch",i.annotTool),l(3),p("ngSwitchCase",i.casePolyTool(i.annotTool)),l(),p("ngIf",i.showFinishBtn)}}function Yh(r,n){if(r&1&&I(0,"sd-text-markup",21,1),r&2){let i=d(2);p("data",i.annot)("status",i.status)}}function Xh(r,n){if(r&1){let i=w();h(0,"section",30,0),O("mousedown",function(t){f(i);let o=d();return g(o.create(t))})("mousemove",function(t){f(i);let o=d();return g(o.pvOnMove(t))})("mouseup",function(t){f(i);let o=d();return g(o.clear(t))})("touchstart",function(t){f(i);let o=d();return g(o.create(o.touchToMouse(t)))})("touchmove",function(t){f(i);let o=d();return g(o.pvOnMove(o.touchToMouse(t)))})("touchend",function(t){f(i);let o=d();return g(o.clear(o.touchToMouse(t)))}),I(2,"sd-select-text",31),R(3,Yh,2,2,"sd-text-markup",18),_()}if(r&2){let i=d();p("ngStyle",i.boxStyles),l(2),p("pdfPage",i.page)("documentId",i.documentId)("status",i.status)("annot",i.annot),l(),p("ngIf",i.annot)}}function Kh(r,n){if(r&1&&I(0,"sd-stamp",22,1),r&2){let i=d(2);p("data",i.annot)("status",i.status)("pdfData",i.page)}}function Qh(r,n){if(r&1){let i=w();h(0,"section",32,0),E(2,"translate"),O("pointerenter",function(t){f(i);let o=d();return g(o.onMouseEnter(t))})("pointerdown",function(t){f(i);let o=d();return g(o.create(t))})("pointermove",function(t){f(i);let o=d();return g(o.pvOnMove(t))})("pointerleave",function(){f(i);let t=d();return g(t.onMouseLeave())})("pointerup",function(t){f(i);let o=d();return g(o.clear(t))}),R(3,Kh,2,3,"sd-stamp",19),_()}if(r&2){let i=d();p("title",S(2,3,"CLICK_TO_DRAW"))("ngStyle",i.boxStyles),l(3),p("ngIf",i.annotTool===i.AnnotTool.STAMP&&i.annot)}}var ts=(()=>{let n=class n{instanceOptions;ref;annotService;annotSelectedService;contentService;acroFormService;changeDetectorRef;sdContextMenuService;configsService;subscriptionService;store$;loggingService;translatePipe;page;documentId;annotView;gestureSectionElementRef;PREVIEW_CURSOR_WIDTH=2;scale;degree;annotContext;annotTool;annotDrawing=!0;status=Z.CREATE;previewStatus=Z.PREVIEW;boxStyles={};finishBtnStyles={};get finishBtn(){return this._finishBtn&&(this._finishBtn.styles.transform=`scale(${1.25/F.normalizeScale(this.scale)}) rotate(${-(this.page.r+this.degree)}deg)`),this._finishBtn}set finishBtn(e){this._finishBtn=e}get showFinishBtn(){return!!this.finishBtn&&!this.annotDrawing}annot=null;previewAnnot;popup;previewStyle;previewCursorWidth=this.PREVIEW_CURSOR_WIDTH;get AnnotTool(){return V}get Gesture(){return Zi}get activeGesture(){let e=wc[this.annotTool];if(this.annotTool===V.STAMP){let t=this.configsService.radioConfig[H.STAMP_DRAWING_GESTURE];if(!T.isDefined(t))throw new Mt("Radio configuration for stamp drawing gesture is not defined");let o=t.items.find(s=>K.get(s.key));T.isDefined(o)&&(e=o.value)}return this.annotService.annotGesture??e}get previewSize(){if(!T.isDefined(this.annotContext))throw new Nt("Annotation context is not defined");switch(this.annotTool){case V.STAMP:if(!T.isDefined(this.annotContext.stamp))throw new Mt("Stamp context is not defined");return{width:this.annotContext.stamp.width,height:this.annotContext.stamp.height};case V.RADIO_BUTTON:if(!T.isDefined(this.annotContext.widget))throw new Mt("Widget context is not defined");return{width:this.annotContext.widget.width,height:this.annotContext.widget.height};default:return{width:0,height:0}}}_finishBtn;lastEvent=null;gestureStrategy;continueWriting=!1;inkDraw$=new pt;outsidePageSub=null;isMouseEnter=!1;isContextMenuOpened=!1;constructor(e,t,o,s,c,u,C,x,N,D,X,Q,ft){this.instanceOptions=e,this.ref=t,this.annotService=o,this.annotSelectedService=s,this.contentService=c,this.acroFormService=u,this.changeDetectorRef=C,this.sdContextMenuService=x,this.configsService=N,this.subscriptionService=D,this.store$=X,this.loggingService=Q,this.translatePipe=ft,this.page=this.instanceOptions.data.page,this.documentId=this.instanceOptions.data.documentId}getButton=e=>e.buttons;casePolyTool(e){return e===V.POLYGON||e===V.POLYGON_DIMENSION||e===V.CLOUD||e===V.POLYLINE||e===V.POLYLINE_DIMENSION?e:null}ngOnInit(){this.initSubscriptions(),F.bindLayoutOrder(this.boxStyles,F.LayoutOrder.AnnotCreate),this.boxStyles.width=`${this.page.bbox.w+this.page.bbox.x}px`,this.boxStyles.height=`${this.page.bbox.h+this.page.bbox.y}px`,F.bindLayoutOrder(this.finishBtnStyles,F.LayoutOrder.AnnotCreateFinish)}ngOnDestroy(){ve.destroy(this)}isPreviewVisible(){return this.isMouseEnter&&!this.annot&&this.satisfyPreviewAnnotInfo()&&!!this.previewAnnot}onMouseEnter(e){if(!this.previewAnnot&&this.satisfyPreviewAnnotInfo()){let t=this.annotService.createAnnot(this.annotTool,this.page,{x:e.offsetX,y:e.offsetY})[0];t.attributes.rect.bottom=0,t.attributes.rect.left=0,t.attributes.rect.right=this.previewSize.width,t.attributes.rect.top=this.previewSize.height,this.previewAnnot=t,this.previewStyle={transform:`translate(${e.offsetX}px,${e.offsetY}px)`}}this.isMouseEnter=!0}onMouseLeave(){this.isMouseEnter=!1}touchToMouse(e){return T.touchToMouseEvt(e,this.degree,this.scale,this.page,this.gestureSectionElementRef.nativeElement)}createFinishBtn(e){this._finishBtn=new kc(e,this.finishBtnStyles)}createAnnot(e){let t=this.annotService.createAnnot(this.annotTool,this.page,e);this.annot=t[0],(A.isLineDimension(this.annot)||A.isPolyLineDimension(this.annot))&&this.contentService.fireMeasureIndicatorEvent({action:"create",annot:this.annot}),A.isFreeText(this.annot)&&this.degree+this.page.r!==0&&(this.annot.attributes.Rotate=this.degree+this.page.r),t[1]&&(this.popup=t[1])}isLineTool(){let e=this.annotTool;return!!this.annot&&(e===V.LINE||e===V.LINE_DIMENSION)}isRectTool(){let e=this.annotTool;return!!this.annot&&(e===V.CIRCLE||e===V.SQUARE||V.TEXT_FREE===e||V.REDACTION===e)}isLinkTool(){return!!this.annot&&this.annotTool===V.LINK}create(e){return e.button===2||!xt.isEventInPage(e,this.page)&&!this.isPreviewVisible()||(this.isContextMenuOpened&&this.sdContextMenuService.publishContextMenuStatus(!1),document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e.preventDefault(),e.stopPropagation(),this.annotDrawing=!0,this.gestureStrategy?.create(e),this.lastEvent=e,this.changeDetectorRef.destroyed||(this.changeDetectorRef.markForCheck(),this.popup&&this.changeDetectorRef.detectChanges())),!1}pvOnMove(e){return this.previewStyle&&(this.previewStyle.transform=`translate(${e.offsetX}px,${e.offsetY}px)`),this.boxStyles.cursor=this.getAnnotationCursor(e),!this.annot||this.activeGesture!==Zi.CLICK_MOVE&&this.getButton(e)>1?!0:(e.preventDefault(),e.stopPropagation(),this.lastEvent?.offsetX===e.offsetX&&this.lastEvent?.offsetY===e.offsetY||!xt.isEventInPage(e,this.page)||(this.annotView?.pvOnMove&&this.annotView.pvOnMove(e),this.lastEvent=e),!1)}pvOnRelease(e){return this.annot?(e.preventDefault(),e.stopPropagation(),this.destroyOutsidePageSub(),this.annotDrawing=!1,A.isInk(this.annot)&&this.inkDraw$.next(e),this.gestureStrategy.pvOnRelease(e),!1):!0}pvOnOver(e){return this.annot?(e.preventDefault(),e.stopPropagation(),this.annotView?.pvOnOver&&this.annotView.pvOnOver(),!1):!0}clear(e,t=!0){if(!this.annot||!this.acroFormService.isAcroFieldsInitialized())return this.clearStatus(),!0;if(typeof e?.stopPropagation=="function"&&e.stopPropagation(),typeof e?.preventDefault=="function"&&e.preventDefault(),!Lc.isValid(this.annot))if(A.isStamp(this.annot)&&this.activeGesture===Zi.CLICK_ONLY){let{width:o,height:s}=this.annot.attributes.appearance;this.modifyAnnotRect(o,s,!1)}else if(A.isRadioWidget(this.annot,this.acroFormService.acroFields)&&this.annotContext.widget){let{width:o,height:s}=this.annotContext.widget;this.modifyAnnotRect(o,s,!1)}else return this.loggingService.common("debug",le.INVALID,this.translatePipe.transform("ANNOTATION"),this.annot),this.clearStatus(),!1;if(this.annotView?.postCreate&&this.annotView.postCreate(this.page),A.isLink(this.annot)){this.contentService.publishEnableLinkCreationDialog(this.annot),this.clearStatus();return}if(this.annotTool===V.SIGNATURE){this.ref.emit(this.annot),this.annotService.putModel(this.annot),this.annotService.normalizeWidget(this.annot,this.acroFormService.acroFields),this.clearStatus();return}if(this.annotTool===V.INSTANT_SIGNATURE){this.ref.emit(this.annot),this.clearStatus();return}if(this.popup&&(this.ref.emit(this.popup),this.annotService.putModel(this.popup)),this.annotService.putModel(this.annot),A.isWidget(this.annot)&&this.annotService.normalizeWidget(this.annot,this.acroFormService.acroFields),A.isFreeText(this.annot)){let o=document.createElement("div");o.contentEditable="true",document.body.appendChild(o),o.focus(),o.click(),T.isDefined(o.parentElement)&&o.parentElement.removeChild(o)}return this.ref.emit(this.annot),this.continueWriting||this.unselectAll(),this.clearStatus(t),!1}clearStatus(e=!0){this.annot=null,this.lastEvent=null,this.continueWriting?(this.annotDrawing=!0,this.changeDetectorRef.markForCheck()):e&&this.store$.dispatch(En.unselectTool())}initOutsidePageSub(){this.annotDrawing&&(this.outsidePageSub=Ge(document.documentElement,"mouseup").subscribe({next:e=>this.pvOnRelease(e)}))}destroyOutsidePageSub(){this.annotDrawing&&(T.isDefined(this.outsidePageSub)&&ve.unsubscribe(this.outsidePageSub),this.outsidePageSub=null)}initSubscriptions(){this.subscriptionService.push(this.store$.pipe(_e("scale")).subscribe({next:e=>this.scale=e}),this.store$.pipe(_e("degree")).subscribe({next:e=>this.degree=e}),this.store$.pipe(Xe("annot","continueWriting")).subscribe({next:e=>{this.continueWriting=e}}),this.store$.pipe(_e("scale")).subscribe({next:()=>{this.applyScale()}}),this.store$.pipe(_e("degree")).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.inkDraw$.pipe(ui(500),L(()=>!this.annotDrawing)).subscribe({next:e=>{this.clear(e)}}),this.store$.pipe(Rr()).subscribe({next:e=>{this.annotContext=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Bn(),L(T.isDefined)).subscribe({next:e=>{this.annotTool=e,this.initGestureStrategy(),this.boxStyles.cursor=this.annotTool===V.TEXT_POPUP?"url(assets/images/cursor-memo.cur), auto":null,this.changeDetectorRef.markForCheck()}}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:e=>this.isContextMenuOpened=e}))}unselectAll(){this.annotSelectedService.unselectAll()}satisfyPreviewAnnotInfo(){switch(this.annotTool){case V.STAMP:return!!this.annotContext.stamp&&this.activeGesture===Zi.CLICK_ONLY;case V.RADIO_BUTTON:return!!this.annotContext.widget;default:return!1}}modifyAnnotRect(e,t,o){if(!T.isDefined(this.annot))throw new Nt("Annotation is not defined");let{rect:s}=this.annot.attributes;o?(s.left-=e/2,s.right+=e/2,s.top-=t/2,s.bottom+=t/2):(s.right+=e,s.bottom+=t),this.validateAndFixAnnotRect()}validateAndFixAnnotRect(){if(!T.isDefined(this.annot))throw new Nt("Annotation is not defined");let{rect:e}=this.annot.attributes;if(e.right>this.page.bbox.x+this.page.bbox.w){let t=e.right-(this.page.bbox.x+this.page.bbox.w);e.right-=t,e.left-=t}if(e.left<this.page.bbox.x&&(e.right-=e.left-this.page.bbox.x,e.left=this.page.bbox.x),e.bottom>this.page.bbox.h){let t=e.bottom-this.page.bbox.h;e.bottom-=t,e.top-=t}e.top<0&&(e.bottom-=e.top,e.top=0)}applyScale(){this.previewCursorWidth=Number((this.PREVIEW_CURSOR_WIDTH*100/this.scale).toFixed(1)),this.changeDetectorRef.markForCheck()}initGestureStrategy(){let e=T.isDefined(this.activeGesture)&&T.isDefined(Vs[this.activeGesture])?Vs[this.activeGesture]:void 0;if(!e){this.subscriptionService.push(ve.runAsync(()=>this.clearStatus()));return}this.gestureStrategy=new e(this)}getAnnotationCursor(e){if(!xt.isEventInPage(e,this.page))return"inherit";switch(this.annotTool){case V.HIGHLIGHT:case V.UNDERLINE:case V.STRIKE:return"text";case V.TEXT_POPUP:return"url(assets/images/cursor-memo.cur), auto"}return"crosshair"}};v(n,"\u0275fac",function(t){return new(t||n)(m(Kr),m(xn),m(Re),m(kt),m(ge),m(Lt),m(Y),m(ci),m(Jt),m(P),m(xe),m(De),m(oe))}),v(n,"\u0275cmp",j({type:n,selectors:[["ng-component"]],viewQuery:function(t,o){if(t&1&&(se(yh,5),se(Ah,5)),t&2){let s;ae(s=ce())&&(o.annotView=s.first),ae(s=ce())&&(o.gestureSectionElementRef=s.first)}},standalone:!1,features:[$([P])],decls:7,vars:7,consts:[["gestureSection",""],["annotView",""],[3,"title","ngStyle",4,"ngIf"],["class","preview-annot",3,"ngStyle",4,"ngIf"],[3,"title","ngStyle","mousedown","mousemove","mouseenter","mouseleave","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerleave","pointerup",4,"ngIf"],[3,"title","ngStyle","ngSwitch","click","mousedown","mousemove","mouseleave","mouseenter","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerleave","pointerup",4,"ngIf"],[3,"title","ngStyle","ngSwitch","click","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerup",4,"ngIf"],["class","blend",3,"ngStyle","mousedown","mousemove","mouseup","touchstart","touchmove","touchend",4,"ngIf"],[3,"title","ngStyle","pointerenter","pointerdown","pointermove","pointerleave","pointerup",4,"ngIf"],[3,"title","ngStyle"],[1,"preview-annot",3,"ngStyle"],[3,"data","ngStyle","status","pdfData",4,"ngIf"],[3,"data","ngStyle","status",4,"ngIf"],[1,"cursor",3,"ngStyle"],[3,"data","ngStyle","status","pdfData"],[3,"data","ngStyle","status"],[3,"mousedown","mousemove","mouseenter","mouseleave","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerleave","pointerup","title","ngStyle"],[3,"annotLine","status",4,"ngIf"],[3,"data","status",4,"ngIf"],[3,"data","status","pdfData",4,"ngIf"],[3,"annotLine","status"],[3,"data","status"],[3,"data","status","pdfData"],[3,"click","mousedown","mousemove","mouseleave","mouseenter","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerleave","pointerup","title","ngStyle","ngSwitch"],[4,"ngSwitchCase"],[3,"annotInk","status",4,"ngIf"],[3,"annotInk","status"],[3,"click","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerup","title","ngStyle","ngSwitch"],["class","papycon papycon-check-mark2",3,"ngStyle","click","mousemove","mouseover","mouseleave","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerleave","pointerup",4,"ngIf"],[1,"papycon","papycon-check-mark2",3,"click","mousemove","mouseover","mouseleave","mouseup","touchstart","touchmove","touchend","pointerdown","pointermove","pointerleave","pointerup","ngStyle"],[1,"blend",3,"mousedown","mousemove","mouseup","touchstart","touchmove","touchend","ngStyle"],[3,"pdfPage","documentId","status","annot"],[3,"pointerenter","pointerdown","pointermove","pointerleave","pointerup","title","ngStyle"]],template:function(t,o){t&1&&R(0,Rh,4,5,"section",2)(1,Mh,5,10,"section",3)(2,Uh,9,10,"section",4)(3,Wh,4,6,"section",5)(4,$h,5,7,"section",6)(5,Xh,4,6,"section",7)(6,Qh,4,5,"section",8),t&2&&(p("ngIf",!o.activeGesture),l(),p("ngIf",o.isPreviewVisible()),l(),p("ngIf",o.activeGesture===o.Gesture.DRAG),l(),p("ngIf",o.activeGesture===o.Gesture.DRAG_CLICK),l(),p("ngIf",o.activeGesture===o.Gesture.CLICK_MOVE),l(),p("ngIf",o.activeGesture===o.Gesture.SELECT_TEXT),l(),p("ngIf",o.activeGesture===o.Gesture.CLICK_ONLY))},styles:["section[_ngcontent-%COMP%]{position:absolute;right:0;top:0;cursor:crosshair}div[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%}span[_ngcontent-%COMP%]{position:absolute;padding:0;width:20px;height:20px;color:#1e1e1e;background:#fff;border-radius:10px;outline:none;font-size:20px}span[_ngcontent-%COMP%]:hover{color:#62ad46}input[type=button][_ngcontent-%COMP%]:hover{background-color:#0000ff80}.preview-annot[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:.5}.preview-annot[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]{border-style:solid;border-color:var(--primary-50);box-sizing:border-box;background-color:rgba(var(--primary-50),.08);opacity:1}.blend[_ngcontent-%COMP%]{mix-blend-mode:multiply}"],changeDetection:0}));let r=n;return r})();var Zh=r=>Number(r.toFixed(1)),lt=function(r){return r.M="M",r.L="L",r.T="T",r.Q="Q",r.C="C",r.a="a",r.COMMA=",",r}(lt||{}),ei=class r{hidden=!1;prefix;ratioX=1;ratioY=1;_values;get values(){return this.ratioX===1&&this.ratioY===1?this._values:this._values.map((n,i)=>i%2===0?n*this.ratioX:n*this.ratioY)}set values(n){this._values=n}constructor(n,i,...e){this.hidden=i,this.prefix=n,this._values=e}clone(){return new r(this.prefix,this.hidden,...this.values)}toString(){return`${this.prefix} ${this.values.map(n=>Zh(n)).join(" ")}`}},is=class{parent;$element=document.createElementNS("http://www.w3.org/2000/svg","path");_partials=[];_options={translate:{x:0,y:0},ratio:{w:1,h:1}};get partials(){return this._partials}set partials(n){this._partials=n,this.render()}get options(){return this._options}set options(n){this.$element.setAttribute("stroke",`${n?.strokeColor||"black"}`),this.$element.setAttribute("stroke-width",`${n?.strokeWidth||1}`),this.$element.setAttribute("fill",n?.fill||"none"),xi.hasDefinedProp(n,"translate")&&(n.translate.x!==this.options.translate?.x||n.translate.y!==this.options.translate.y)&&this.$element.setAttribute("transform",`translate(${n.translate.x}, ${n.translate.y})`),xi.hasDefinedProp(n,"ratio")&&(n.ratio.w!==this.options.ratio?.w||n.ratio.h!==this.options.ratio.h)&&(this.partials.forEach(i=>{i.ratioX=n.ratio.w,i.ratioY=n.ratio.h}),this.render()),Object.assign(this._options,n)}constructor(n,i){this.parent=n,this.options=i,this.parent.element.appendChild(this.$element)}append(...n){this.partials=[...this.partials,...n]}remove(...n){let i=this.partials.slice();n.forEach(e=>{let t=i.indexOf(e);t!==-1&&i.splice(t,1)}),i.length!==this.partials.length&&(this.partials=i)}toString(){return this.partials.map(n=>n.toString()).join(" ")}destroy(){this.$element.parentElement?.removeChild(this.$element)}render(){let n=this.toString();this.$element.getAttribute("d")!==n&&this.$element.setAttribute("d",n)}};var ns=class{renderer;options;_finished=!1;trackingElement=document.createElementNS("http://www.w3.org/2000/svg","path");trackingPoints=[];_lastLinearized;_lastRequested;cd=0;_lastPath;_lastPathD;get finished(){return this._finished}get lastLinearized(){if(!T.isDefined(this._lastLinearized))throw new oi("lastLinearized is not initialized. Call start() first.");return this._lastLinearized}get lastRequested(){if(!T.isDefined(this._lastRequested))throw new oi("lastRequested is not initialized. Call start() first.");return this._lastRequested}constructor(n,i){this.renderer=n,this.options=Oe({realtimeLinearizeMinDistance:6,useRealtimeBezier:!0},i)}start(n){if(this._finished)throw new Error("Already finished reference");let i=this.renderer.getDrawablePath(),e=new ei(lt.M,!1,n.x,n.y);i.append(e),this._lastPath=i,this._lastPathD=this.options.useRealtimeBezier?new ei(lt.Q,!1,n.x,n.y,n.x,n.y):new ei(lt.L,!1,n.x,n.y),i.append(this._lastPathD),this._lastLinearized=n,this._lastRequested=n,this.trackingElement.setAttribute("stroke",this.options?.strokeColor||"black"),this.trackingElement.setAttribute("stroke-width",`${this.options?.strokeWidth||1}`),this.trackingElement.setAttribute("fill","none"),this.renderer.element.appendChild(this.trackingElement)}forward(n){let i=ht.from(this.lastLinearized).distance(ht.from(n)),e=this.options.realtimeLinearizeMinDistance;if(this.options.useRealTimeLinearize)if(e&&this.cd+i>e){let t=e-this.cd,o=ht.from(this.lastRequested).lerp(ht.from(n),t/i),s=i-t;for(;s>e;)s-=e;this.cd=s,this._lastLinearized=o,this.linearized(o),this.trackingPoints.splice(0)}else this.cd+=i;else this.linearized(n),this.trackingPoints.splice(0);this.options.useTrackingPoint&&this.track(n),this._lastRequested=n}finish(){if(this.lastRequested!==this.lastLinearized&&this.linearized(this.lastRequested),this.trackingElement.parentElement?.removeChild(this.trackingElement),this._finished)throw new pc("Already finished draw reference");if(!T.isDefined(this._lastPath)||!T.isDefined(this._lastPathD))throw new $e("Last path is not defined");if(this._lastPathD.prefix===lt.L&&this.options.useRealtimeBezier){let n=this._lastPath.partials[this._lastPath.partials.length-2];n.values=[...n.values.slice(0,2),...this._lastPathD.values],this._lastPath.remove(this._lastPathD),this._lastPath.render()}this._finished=!0}track(n){this.trackingPoints.push(n),this.trackingElement.setAttribute("d",this.trackingPoints.reduce((i,e,t,o)=>{let s=i;if(t===0&&(s+=`M ${e.x} ${e.y}`),o[t+1]&&o[o.length-1]!==e){let c=o[t+1];s+=` Q ${e.x} ${e.y} ${(e.x+c.x)/2} ${(e.y+c.y)/2}`}return s},""))}linearized({x:n,y:i}){if(this._finished)throw new Error("Already finished reference");let e=this.renderer.getDrawablePath();if(this._lastPathD?.prefix===lt.L&&this.options.useRealtimeBezier){let[o,s]=this._lastPathD.values;this._lastPathD.prefix=lt.Q,this._lastPathD.values.push((n+o)/2,(i+s)/2),T.isDefined(this._lastPath)&&e!==this._lastPath&&this._lastPath.render()}if(e.partials.length===0){let o=this._lastPathD?this._lastPathD.values.slice(this._lastPathD.values.length-2):[n,i],s=new ei(lt.M,!0,...o);e.append(s)}let t=new ei(lt.L,!1,n,i);this._lastPath=e,this._lastPathD=t,e.append(t)}};var os=class{element;paths=[];_points=[];_options={renderingMode:"origin",useRealtimeBezier:!0};get options(){return this._options}set options(n){Object.assign(this._options,n),this.paths.forEach(i=>i.options=this.options)}get points(){return this._points.map(n=>n.map(i=>({x:i.x*(this.options?.ratio?.w||1),y:i.y*(this.options?.ratio?.h||1)})))}set points(n){this._points=n,this.render()}constructor(n,i){this.element=n,this.options=i}getDrawablePath(){let n=this.getLastPath();if(!this.options?.maxVertexCountPerPath&&n||n!==void 0&&this.options.maxVertexCountPerPath&&n.partials.length<this.options.maxVertexCountPerPath)return this.paths[this.paths.length-1];{let i=new is(this,this.options);return this.paths.push(i),i}}getFreeDrawRef(){return new ns(this,this.options)}render(){let n=[];this.options.renderingMode==="optimize"?this.points.map(i=>{let e=i.map(t=>ht.from(t));return this.options.optimizationLinearizeMinDistance!==void 0&&(e=jc(i.map(t=>ht.from(t)),this.options.optimizationLinearizeMinDistance,!1,!0)),e}).map(i=>$c(i)).map(i=>new Hc(i).fit(this.options.optimizationMaxCurveFittingErrorCount||1)).forEach(i=>{i.forEach((e,t)=>{if(t===0){let s=new ei(lt.M,!1,e.p0.x,e.p1.y);n.push(s)}let o=new ei(lt.C,!1,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.p3.x,e.p3.y);n.push(o)})}):this.points.forEach(i=>i.forEach((e,t,o)=>{let{x:s,y:c}=e;if(t===0){let u=new ei(lt.M,!1,s,c),C=new ei(lt.Q,!1,s,c,s,c);n.push(u,C)}else{let u=o[t-1],C=t===o.length-1,x=new ei(lt.Q,!1,u.x,u.y,C?s:(u.x+s)/2,C?c:(u.y+c)/2);n.push(x)}})),this.apply(...n)}extractPoints(){return this.getMergedPathD().reduce((n,i,e,t)=>{i.prefix===lt.M&&n.push([]);let o=n[n.length-1],s=t[e-1];if(s&&s.prefix===lt.M){let[c,u]=i.values;return o.push({x:c,y:u}),n}switch(i.prefix){case lt.Q:case lt.L:let[c,u]=i.values;if(o.push({x:c,y:u}),e===t.length-1||t[e+1]&&t[e+1].prefix===lt.M){let[C,x]=i.values.slice(2);o.push({x:C,y:x})}break}return n},[])}getMergedPathD(n=!1){return this.paths.reduce((i,e)=>(i.push(...n?e.partials:e.partials.filter(t=>!t.hidden)),i),[])}apply(...n){this.paths.splice(1);let[i]=this.paths;i||(i=this.getDrawablePath()),i.partials=n}getLastPath(){return this.paths[this.paths.length-1]}};var qh=["svgElement"],Jh={indexMap:["all","x","all","y","all","x","all","y"],all(r,n,i,e){r.x=i.x+(Math.abs(i.w)-e*2)*n.x+e,r.y=i.y+(Math.abs(i.h)-e*2)*n.y+e},x(r,n,i,e){r.x=i.x+(Math.abs(i.w)-e*2)*n.x+e},y(r,n,i,e){r.y=i.y+(Math.abs(i.h)-e*2)*n.y+e},moverOf(r){let n=this.indexMap[r];return Se.hasKey(this,n)?this[n]:null}},Zn=(()=>{let n=class n{elementRef;annotService;editService;contentService;subscriptionService;pageService;$svg;pathRenderer;freeDrawRef;annotInk;status=Z.RENDER;viewClasses={create:!1,debug:!1,remove:!1};srcRect;srcInks;srcBbox;get data(){return this.annotInk}constructor(e,t,o,s,c,u){this.elementRef=e,this.annotService=t,this.editService=o,this.contentService=s,this.subscriptionService=c,this.pageService=u}isCreate(){return this.status===Z.CREATE}ngOnChanges(e){e.status&&this.annotService.bindCursorClass(this.viewClasses,this.status),e.annotInk&&(this.pathRenderer&&(this.pathRenderer.points=this.getTransformedPoints(),this.pathRenderer.options={strokeColor:this.annotInk.attributes.color,strokeWidth:this.annotInk.attributes.width}),this.preserveSource())}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(()=>!this.isCreate()),L(e=>e?.annot.oid===this.annotInk.oid)).subscribe({next:()=>{this.fitBox(),this.pathRenderer&&(this.pathRenderer.points=this.getTransformedPoints(),this.pathRenderer.options={strokeColor:this.annotInk.attributes.color,strokeWidth:this.annotInk.attributes.width})}}))}ngAfterViewInit(){this.pathRenderer=new os(this.$svg.nativeElement,{maxVertexCountPerPath:30,useRealtimeBezier:!0,useRealTimeLinearize:!0,realtimeLinearizeMinDistance:3,useTrackingPoint:!0,strokeColor:this.annotInk.attributes.color,strokeWidth:this.annotInk.attributes.width,renderingMode:"origin",optimizationLinearizeMinDistance:1,optimizationMaxCurveFittingErrorCount:1}),this.isCreate()?(this.freeDrawRef=this.pathRenderer.getFreeDrawRef(),this.freeDrawRef.start({x:this.annotInk.attributes.inkList[0][0].x,y:this.annotInk.attributes.inkList[0][0].y})):this.pathRenderer.points=this.getTransformedPoints()}ngOnDestroy(){T.removeElement(this.elementRef.nativeElement),Array.isArray(this.srcInks)&&this.srcInks.splice(0),ve.destroy(this)}pvOnRepress(e){this.freeDrawRef&&!this.freeDrawRef.finished&&this.freeDrawRef.finish(),this.freeDrawRef=this.pathRenderer.getFreeDrawRef(),this.freeDrawRef.start({x:e.offsetX,y:e.offsetY})}pvOnMove(e){this.freeDrawRef&&!this.freeDrawRef.finished&&this.freeDrawRef.forward({x:e.offsetX,y:e.offsetY})}pvOnRelease(e){this.freeDrawRef&&!this.freeDrawRef.finished&&this.freeDrawRef.finish()}postCreate(e){this.annotInk.attributes.inkList=this.pathRenderer.extractPoints(),this.fitBox(void 0,!0)}verticesOf(e,t,o){return this.editService.createRectVertices(t,o)}postEdit(e,t){this.annotInk.attributes.inkList.forEach(s=>{U.applyVertexDelta(t,...s)}),U.validateRect(this.data.attributes.rect),this.fitBox(),this.preserveSource(),this.pathRenderer.options={translate:{x:0,y:0}}}pvOnVertexMove(e,t,o){if(!this.editService.resizeByRectVertex(this.data,t,o))return;let s=Jh.moverOf(t);if(!s)return;let{inkList:c,rect:u,width:C}=this.data.attributes,x=U.bboxOf(u);this.srcInks.forEach((X,Q)=>X.forEach((ft,di)=>s(c[Q][di],ft,x,C+2)));let N={x:x.x-this.srcRect.left,y:this.srcRect.top-u.top||this.srcRect.bottom-u.bottom},D=this.srcBbox.h+x.h;this.srcRect.top!==u.top?N.y=x.h>0?N.y:D:N.y=x.h>0?0:D+N.y,N.x=x.w>0||this.srcRect.left===u.left?N.x:this.srcBbox.w,this.pathRenderer.points=this.getTransformedPoints(),this.pathRenderer.options={translate:N}}isTouched(e){let t=this.data.attributes.inkList,o=t[0][0],s=o;for(let c of t)for(let u of c){o||(o=u),s=u;let C=new ht(s.x-o.x,s.y-o.y),x=new ht(e.x-o.x,e.y-o.y),N=8+this.data.attributes.width*Fe.hitTestToleranceConst,D=_n.innerProduct(C,x),X=C.norm()*C.norm(),Q=x.orthogonalTo(C).norm();if(0<D&&D<X&&Q<N)return!0;o=u}return!1}fitBox(e,t=!1){if(!T.isDefined(this.pageService.pdfPages))return;let o=this.pageService.pdfPages[this.annotInk.attributes.pageIdx],{inkList:s,rect:c,width:u}=this.data.attributes,C=s.map(N=>N.map(D=>({x:D.x,y:t?o.bbox.h+o.bbox.y-D.y:D.y}))),x=C.reduce((N,D)=>N.concat(D),[]);U.fitBox(e||c,u+2,...x),Object.assign(s,C),Object.assign(e||this.srcRect,c)}preserveSource(){let{inkList:e,rect:t}=this.data.attributes,o={left:Math.min(...e.map(s=>Math.min(...s.map(c=>c.x)))),right:Math.max(...e.map(s=>Math.max(...s.map(c=>c.x)))),bottom:Math.min(...e.map(s=>Math.min(...s.map(c=>c.y)))),top:Math.max(...e.map(s=>Math.max(...s.map(c=>c.y))))};this.srcRect=T.deepClone(t),this.srcBbox={x:0,y:0,w:Math.abs(this.srcRect.right-this.srcRect.left),h:Math.abs(this.srcRect.top-this.srcRect.bottom)},this.srcInks=e.map(s=>s.map(c=>({x:(c.x-o.left)/(o.right-o.left),y:(c.y-o.bottom)/(o.top-o.bottom)})))}getTransformedPoints(){let e=this.annotInk.attributes.rect;return this.annotInk.attributes.inkList.map(t=>t.map(o=>U.transformPoint(o,e)))}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Re),m(_t),m(ge),m(P),m(bt))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-ink"]],viewQuery:function(t,o){if(t&1&&se(qh,5),t&2){let s;ae(s=ce())&&(o.$svg=s.first)}},inputs:{annotInk:"annotInk",status:"status"},standalone:!1,features:[$([P]),Ie],decls:2,vars:1,consts:[["svgElement",""],["stroke-linecap","round","stroke-linejoin","round",3,"ngClass"]],template:function(t,o){t&1&&(ne(),I(0,"svg",1,0)),t&2&&p("ngClass",o.viewClasses)},dependencies:[Je],encapsulation:2,changeDetection:0}));let r=n;return r})();var ia=class{d;opacity},na={highlight:.5,underline:1,strikeout:.8},ql={render(r,n,i){if(!Se.hasKey(this,r.type))return console.warn(`Undrawable TextMarkup oid=${r.oid}, type=${r.type}`),null;let e=this[r.type];return n.opacity=r.attributes.opacity??Se.getEnumValueByKey(na,r.type.toLowerCase(),1),n.d=(r.attributes.quadPoints||[]).reduce((t,o)=>{let s=e(o,r.attributes,i);return t.concat(`M${s[0].x.toFixed(3)} ${s[0].y.toFixed(3)} `).concat(`L${s[1].x.toFixed(3)} ${s[1].y.toFixed(3)} `).concat(`L${s[2].x.toFixed(3)} ${s[2].y.toFixed(3)} `).concat(`L${s[3].x.toFixed(3)} ${s[3].y.toFixed(3)} Z `)},T.EMPTY_STRING),n},Highlight(r,{rect:n},i){let{left:e,bottom:t}=n,o=n.top-n.bottom+i.y;return[{x:r[0].x-e,y:o+t-r[0].y},{x:r[1].x-e,y:o+t-r[1].y},{x:r[3].x-e,y:o+t-r[3].y},{x:r[2].x-e,y:o+t-r[2].y}]},Underline(r,{rect:n},i){let{left:e,bottom:t}=n,o=n.top-n.bottom+i.y,s=.06,c=[];return c[2]={x:r[3].x-e,y:o+t-r[3].y},c[3]={x:r[2].x-e,y:o+t-r[2].y},c[0]={x:c[3].x+(r[0].x-e-c[3].x)*s,y:c[3].y+(o+t-r[0].y-c[3].y)*s},c[1]={x:c[2].x+(r[1].x-e-c[2].x)*s,y:c[2].y+(o+t-r[1].y-c[2].y)*s},c},StrikeOut(r,{rect:n},i){let{left:e,bottom:t}=n,o=n.top-n.bottom+i.y,c=(1-.12)/2;return[{x:(r[0].x-e)*(1-c)+c*(r[2].x-e),y:(o+t-r[0].y)*(1-c)+c*(o+t-r[2].y)},{x:(r[1].x-e)*(1-c)+c*(r[3].x-e),y:(o+t-r[1].y)*(1-c)+c*(o+t-r[3].y)},{x:(1-c)*(r[3].x-e)+(r[1].x-e)*c,y:(1-c)*(o+t-r[3].y)+(o+t-r[1].y)*c},{x:(1-c)*(r[2].x-e)+(r[0].x-e)*c,y:(1-c)*(o+t-r[2].y)+(o+t-r[0].y)*c}]}},rs=(()=>{let n=class n{annotService;contentService;changeDetectorRef;subscriptionService;elementRef;pageService;data;status=Z.RENDER;viewClasses={};path=new ia;constructor(e,t,o,s,c,u){this.annotService=e,this.contentService=t,this.changeDetectorRef=o,this.subscriptionService=s,this.elementRef=c,this.pageService=u}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(e=>e===null?!1:e.annot.oid===this.data.oid)).subscribe({next:()=>this.detectChange()}))}ngOnDestroy(){T.removeElement(this.elementRef.nativeElement),ve.destroy(this)}ngOnChanges(){this.render(),this.changeCursor()}pvOnMove(e){this.detectChange()}postCreate(e){U.fitTextMarkupBox(this.data)}renderFillColor(){return this.data.attributes.color===null?"transparent":this.data.attributes.color}detectChange(){this.render(),this.changeDetectorRef.markForCheck()}render(){let e=this.pageService.pdfPages?.[this.data.attributes.pageIdx]?.bbox??{x:0,y:0,w:0,h:0};this.status===Z.RENDER?ql.render(this.data,this.path,{x:0,y:0,w:e.w,h:e.h}):this.status===Z.CREATE&&ql.render(this.data,this.path,e)}changeCursor(){this.annotService.bindCursorClass(this.viewClasses,this.status)}};v(n,"\u0275fac",function(t){return new(t||n)(m(Re),m(ge),m(Y),m(P),m(de),m(bt))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-text-markup"]],inputs:{data:"data",status:"status"},standalone:!1,features:[$([P]),Ie],decls:2,vars:5,consts:[[3,"ngClass","ngStyle"]],template:function(t,o){t&1&&(ne(),h(0,"svg",0),I(1,"path"),_()),t&2&&(p("ngClass",o.viewClasses)("ngStyle",o.viewClasses),l(),G("d",o.path.d)("fill-opacity",o.path.opacity)("fill",o.renderFillColor()))},dependencies:[Je,Ce],encapsulation:2,changeDetection:0}));let r=n;return r})();var e_=["dragSelect"],t_=["annotElementContainer"],i_=["annotCreatePortal"],n_=["editableComp"];function o_(r,n){if(r&1&&I(0,"sd-widget",20,3),r&2){let i=d().$implicit;p("data",i)}}function r_(r,n){if(r&1&&I(0,"sd-free-text",21,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("data",i)("status",e.annotStatus)}}function s_(r,n){if(r&1&&I(0,"sd-ink",22,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("annotInk",i)("status",e.annotStatus)}}function a_(r,n){if(r&1&&I(0,"sd-line",23,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("annotLine",i)("status",e.annotStatus)}}function c_(r,n){if(r&1&&I(0,"sd-poly-shape",21,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("data",i)("status",e.annotStatus)}}function l_(r,n){if(r&1&&I(0,"sd-rect",21,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("data",i)("status",e.annotStatus)}}function p_(r,n){if(r&1&&I(0,"sd-stamp",24,3),r&2){let i=d().$implicit,e=d(2);p("data",i)("pdfData",e.pdfPage)}}function d_(r,n){if(r&1&&I(0,"sd-text",25,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("annotText",i)("status",e.annotStatus)("pdfPage",e.pdfPage)}}function u_(r,n){if(r&1&&I(0,"sd-text-markup",21,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("data",i)("status",e.annotStatus)}}function m_(r,n){if(r&1&&I(0,"sd-redaction",26,3),r&2){let i=d().$implicit,e=d(2);p("data",i)("status",e.annotStatus)}}function h_(r,n){if(r&1&&I(0,"sd-link",21,3),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.annotationStyle(i))("data",i)("status",e.annotStatus)}}function __(r,n){if(r&1&&I(0,"div",27),r&2){let i=d().$implicit,e=d(2);p("ngStyle",e.appearanceStyle(i))}}function f_(r,n){if(r&1&&(h(0,"p"),M(1),E(2,"json"),_()),r&2){let i=d().$implicit;l(),ke("TODO::",S(2,1,i),"")}}function g_(r,n){if(r&1){let i=w();h(0,"li",10,2),O("mousedown",function(t){let o=f(i).$implicit,s=d(2);return g(s.onAnnotMousedown(t,o))})("touchstart",function(t){let o=f(i).$implicit,s=d(2);return g(s.onAnnotTouchstart(t,o))})("mousemove",function(t){let o=f(i).$implicit,s=we(1),c=d(2);return g(c.mouseMoveOnAnnot(o,s,t))}),R(2,o_,2,1,"sd-widget",11)(3,r_,2,3,"sd-free-text",12)(4,s_,2,3,"sd-ink",13)(5,a_,2,3,"sd-line",14)(6,c_,2,3,"sd-poly-shape",12)(7,l_,2,3,"sd-rect",12)(8,p_,2,2,"sd-stamp",15)(9,d_,2,4,"sd-text",16)(10,u_,2,3,"sd-text-markup",12)(11,m_,2,2,"sd-redaction",17)(12,h_,2,3,"sd-link",12)(13,__,1,1,"div",18)(14,f_,3,3,"p",19),_()}if(r&2){let i=n.$implicit,e=d(2);W("blend",e.isBlend(i)),p("ngSwitch",i.type)("ngClass",e.classes)("ngStyle",e.containerStylesOf(i)),l(2),p("ngSwitchCase","Widget"),l(),p("ngSwitchCase","FreeText"),l(),p("ngSwitchCase","Ink"),l(),p("ngSwitchCase","Line"),l(),p("ngSwitchCase",e.caseOf("PolyShape",i.type)),l(),p("ngSwitchCase",e.caseOf("Rect",i.type)),l(),p("ngSwitchCase","Stamp"),l(),p("ngSwitchCase","Text"),l(),p("ngSwitchCase",e.caseOf("TextMarkup",i.type)),l(),p("ngSwitchCase","Redact"),l(),p("ngSwitchCase","Link"),l(),p("ngIf",e.shouldRemoveAppearance(i))}}function C_(r,n){if(r&1){let i=w();h(0,"ul",8,1),O("mousemove",function(t){f(i);let o=d();return g(o.onMousemove(t))}),R(2,g_,15,17,"li",9),_()}if(r&2){let i=d();p("ngStyle",i.styles),l(2),p("ngForOf",i.visibleAnnots)("ngForTrackBy",i.trackById)}}function T_(r,n){}function E_(r,n){if(r&1){let i=w();h(0,"sd-annot-edit",28),O("select",function(t){f(i);let o=d();return g(o.postSelect(t))})("edit",function(t){f(i);let o=d();return g(o.renderModel(t))})("postEdit",function(t){f(i);let o=d();return g(o.finishEdit(t.isValid))}),_()}if(r&2){let i=d();p("pdfPage",i.pdfPage)("comps",i.filteredEditableComps)("acroFields",i.acroFormService.acroFields)}}function S_(r,n){if(r&1){let i=w();h(0,"sd-drag-select",29,4),O("select",function(t){f(i);let o=d();return g(o.postSelect(t))})("clickEvent",function(t){f(i);let o=d();return g(o.selectByPriority(t[0],t[1],!1))}),_()}if(r&2){let i=d();p("comps",i.filteredEditableComps)("page",i.pdfPage)}}var x_={[V.ERASER]:!0},v_={PolyShape:{Polygon:!0,PolyLine:!0},TextMarkup:{Highlight:!0,StrikeOut:!0,Underline:!0},Rect:{Circle:!0,Square:!0}},qn=class qn{annotService;autoSaveService;annotSelectedService;contentService;popupService;pageService;elementRef;changeDetectorRef;documentService;acroFormService;toastService;shortcutService;subscriptionService;scriptService;store$;translatePipe;instanceService;signatureService;selectTextService;sdContextMenuService;renderer;loggingService;pdfPage;documentId;selectText;dragSelect;annotElementContainer;editableComps;annotCreatePortal;get hostTabIndex(){return this.isEditing()?0:-1}dragMode;scale;degree;annotTool=null;preferences=null;oidToStyleMap=new Map;data=[];hasSignedSignature;isContextMenuOpened=!1;isAnnotLoading=!1;continueWriting=!1;isTextHover=!1;visibleAnnots=[];get styles(){return this._styles||(this._styles={height:`${this.pdfPage.bbox.y+this.pdfPage.bbox.h}${F.UNIT}`,width:`${this.pdfPage.bbox.x+this.pdfPage.bbox.w}${F.UNIT}`}),F.bindLayoutOrder(this._styles,this.isActiveEraser?F.LayoutOrder.AnnotCreate:null)}get classes(){return{debug:this.debug}}get annotStatus(){return this.isActiveEraser?Z.REMOVE:Z.RENDER}get isDeletable(){return K.get(a.DELETE_FORM)||K.get(a.DELETE_ANNOTATION)}get isActiveEraser(){return this.annotTool===V.ERASER}get filteredEditableComps(){return T.isDefined(this.editableComps)?this.editableComps.filter(n=>n.data).filter(n=>!this.annotService.isReadonly(n.data.oid)):[]}get isEditable(){return!this.hasSignedSignature||this.documentService.checkAuthority(Be.EDIT_ANNOTATION)}get oidToZIndexMap(){let n={};for(let i of this.oidToStyleMap.keys()){let e=this.oidToStyleMap.get(i);n[i]=Number(e?.[F.SK_Z_INDEX])}return n}get shouldRemoveAppearance(){return U.shouldRemoveAppearance}_styles;debug=!1;afterViewJob=null;focusedAnnot=null;fontsResponse={fontList:[]};annotOrder=[];annotZIndexPriority=[];annotContext;visibleAnnotationOids;annotCreateRef;constructor(n,i,e,t,o,s,c,u,C,x,N,D,X,Q,ft,di,cn,oo,Wi,yt,ln,ro){this.annotService=n,this.autoSaveService=i,this.annotSelectedService=e,this.contentService=t,this.popupService=o,this.pageService=s,this.elementRef=c,this.changeDetectorRef=u,this.documentService=C,this.acroFormService=x,this.toastService=N,this.shortcutService=D,this.subscriptionService=X,this.scriptService=Q,this.store$=ft,this.translatePipe=di,this.instanceService=cn,this.signatureService=oo,this.selectTextService=Wi,this.sdContextMenuService=yt,this.renderer=ln,this.loggingService=ro}ngOnChanges(n){n.documentId&&this.delayFetch()}ngOnInit(){this.subscriptionService.push(this.store$.pipe(_e("dragMode")).subscribe({next:n=>{this.dragMode=n,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(_e("scale")).subscribe({next:n=>this.scale=n}),this.store$.pipe(_e("degree")).subscribe({next:n=>this.degree=n}),this.store$.pipe(Xe("annot","continueWriting")).subscribe({next:n=>{this.continueWriting=n}}),this.annotService.popup$.pipe(L(n=>A.hasPopup(n)&&this.pdfPage.ref===n.attributes.pageIdx)).subscribe({next:n=>this.togglePopup(n)}),this.store$.pipe(Bn()).subscribe({next:n=>{if(this.annotTool=n,this.annotCreateRef){let i=this.annotCreateRef._componentInstance.instance,e=i.annotView;i.annot&&e instanceof Zn&&e.data.attributes.inkList.length&&i.clear(void 0,!1),this.annotCreateRef.close(),this.annotCreateRef=void 0}!this.annotTool||Se.hasKey(x_,this.annotTool)||(this.annotCreateRef=this.instanceService.instant(this.annotCreatePortal,ts,{data:{page:this.pdfPage,documentId:this.documentId}}),this.annotCreateRef.onEvent().pipe(Gt(i=>n===V.INSTANT_SIGNATURE?(this.signatureService.toggleOverlay(!0),this.signatureService.openSignatureDrawDialog(this.documentId,i).pipe(jo(e=>{throw this.signatureService.toggleOverlay(!1),e}),Gt(e=>{if(!e)throw new dc("User cancelled a drawing signature.");return this.signatureService.module$.pipe(Gt(t=>t?this.signatureService.injectSignature(e,"create",this.annotContext.signature?.serverSide?this.annotContext.signature.certificate||null:void 0,this.annotContext.signature?.identificationNumber).pipe(L(()=>!1)):Hi(e).pipe(je(()=>this.signatureService.toggleOverlay(!1)))))}),je(e=>{this.annotService.putModel(e),this.annotService.normalizeWidget(e,this.acroFormService.acroFields)}))):Hi(i))).subscribe({next:i=>{T.isDefined(i)&&(this.pushAnnot(i),this.changeDetectorRef.markForCheck())}}),this.annotCreateRef.afterClosed().subscribe({next:()=>this.changeDetectorRef.detectChanges()}))}}),this.annotService.editor$.subscribe({next:()=>{this.closeEditor()}}),this.contentService.annotEvent$.pipe(L(T.isDefined),L(n=>n.annot.attributes.pageIdx===this.pdfPage.ref),L(n=>n.sdEventType!==fe.FOCUSED&&n.sdEventType!==fe.UNFOCUSED)).subscribe({next:n=>this.updateModel(n)}),this.contentService.annotEvent$.pipe(L(T.isDefined),L(n=>n.annot.attributes.pageIdx===this.pdfPage.ref),L(n=>n.sdEventType===fe.FOCUSED||n.sdEventType===fe.UNFOCUSED)).subscribe({next:n=>{this.focusedAnnot=n.sdEventType===fe.FOCUSED?n.annot:null,this.oidToStyleMap.set(n.annot.oid,null),this.changeDetectorRef.markForCheck()}}),this.contentService.annotEvent$.pipe(L(T.isDefined),L(n=>n.annot.attributes.pageIdx===this.pdfPage.ref),L(n=>n.sdEventType===fe.UPDATE)).subscribe({next:n=>this.updateModel(n)}),this.contentService.annotListEvent$.pipe(L(()=>!this.continueWriting),L(n=>n.pageIdx===this.pdfPage.ref),L(n=>n.from==="AnnotComponent"&&n.sdEventType===fe.CREATE),St(n=>n.annot),L(T.isDefined)).subscribe({next:n=>this.selectAnnot(n,U.AnnotViewEvt,!0,!0)}),this.store$.pipe(Xe()).subscribe({next:n=>{this.preferences=n,this.data&&this.synchronize(this.data)}}),this.contentService.reload$.pipe(L(n=>Mr.type(n,Nr.Annot))).subscribe({next:n=>{this.isAnnotLoading=!0,this.closeEditor(),this.changeDetectorRef.markForCheck(),n.types?.length===1?this.delayFetch(0):this.delayFetch()}}),this.pageService.pageArrangeEvt$.pipe(L(n=>this.pageService.arrangeAffectedChecker(this.pdfPage.originalIndex,n))).subscribe({next:()=>this.delayFetch()}),this.acroFormService.acroFields$.pipe(L(n=>!!n)).subscribe({next:()=>{this.data&&(this.normalizeWidgets(this.data),this.changeDetectorRef.markForCheck())}}),this.contentService.fontsResponse$.subscribe({next:n=>this.fontsResponse=n}),this.annotSelectedService.selectionInfoChange$.pipe(L(()=>this.annotSelectedService.pageIndex===this.pdfPage.ref)).subscribe({next:()=>{this.updateSelectedAnnotations(!0),this.annotSelectedService.selectedComponents.forEach(n=>{if(!T.isDefined(n.elementRef)){this.loggingService.common("warn",le.NOT_EXIST,this.translatePipe.joinedTransform("ANNOTATION","ELEMENT"));return}this.renderer.setStyle(n.elementRef.nativeElement.parentElement,"opacity",n.data.attributes.opacity)})}}),this.annotService.annotOrder$.subscribe({next:n=>{this.annotOrder=n[this.pdfPage.ref]??[],[this.data,this.visibleAnnots].forEach(i=>{i.sort((e,t)=>this.annotOrder.indexOf(e.oid)-this.annotOrder.indexOf(t.oid))}),this.changeDetectorRef.markForCheck()}}),Xt(this.shortcutService.getShortcutEvent(qt.TAB_KEY),this.shortcutService.getShortcutEvent(qt.SHIFT_TAB_KEY)).pipe(L(()=>this.elementRef.nativeElement.contains(document.activeElement)),L(()=>this.isEditing())).subscribe({next:n=>{let i=this.annotSelectedService.selectedComponents,e=i[0].data,t=i[i.length-1].data;if(n.shiftKey&&!A.isWidget(e)||!n.shiftKey&&!A.isWidget(t))return;n.preventDefault(),n.stopPropagation();let o;n.shiftKey?o=this.findPreviousSelectionField(e):o=this.findNextSelectionField(t),o.length>0&&(this.annotSelectedService.unselectAll(),this.annotSelectedService.pageIndex=this.pdfPage.ref,this.annotSelectedService.trigger=n.type,this.annotSelectedService.isFirstSelection=!1,o.forEach(s=>this.annotSelectedService.add(s)),this.annotSelectedService.dispatchSelectionInfoChange())}}),this.acroFormService.hasSignedSignature$.subscribe({next:n=>this.hasSignedSignature=n}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:n=>this.isContextMenuOpened=n}),this.store$.pipe(Rr()).subscribe({next:n=>this.annotContext=n}),this.annotService.annotVisibleEvent$.subscribe({next:n=>{this.visibleAnnots=this.data,this.visibleAnnotationOids=n,this.applyHideAnnotation(),this.changeDetectorRef.markForCheck()}}),this.selectTextService.isTextHover$.subscribe({next:n=>{this.isTextHover=n,this.changeDetectorRef.markForCheck()}}))}ngOnDestroy(){this.annotSelectedService.removeNullComp(),this.oidToStyleMap.clear(),T.removeElement(this.elementRef.nativeElement),ve.destroy(this)}caseOf(n,i){return v_[n][i]?i:null}touchToMouse(n){return T.touchToMouseEvt(n,this.degree,this.scale,this.pdfPage)}isFetched(){return this.data?.length>0}isEditing(){return!this.annotTool&&this.annotSelectedService.getSelectedInfo()&&this.annotSelectedService.pageIndex===this.pdfPage.ref&&this.annotSelectedService.selectedComponents&&this.annotSelectedService.length>0&&this.annotSelectedService.selectedComponents.every(n=>n.data.oid!==null)}trackById(n,i){return i.oid}containerStylesOf(n){let i=this.oidToStyleMap.get(n.oid);if(i)return i;i=Oe(Oe({},i||{}),U.elementStyleOf(n));let e;A.isRedact(n)?e=this.focusedAnnot===n?F.LayoutOrder.BlackMarking+1:F.LayoutOrder.BlackMarking:e=this.focusedAnnot===n?F.LayoutOrder.AnnotRender+1:F.LayoutOrder.AnnotRender,F.bindLayoutOrder(i,e),i.opacity=(n.attributes.opacity||n.attributes.opacity===0)&&n.attributes.opacity>=0&&n.attributes.opacity!==1&&!U.shouldRemoveAppearance(n)?n.attributes.opacity:null,i.transform=null,this.oidToStyleMap.set(n.oid,i);let t=this.annotZIndexPriority.indexOf(n.oid);return t>-1&&(i[F.SK_Z_INDEX]=(parseInt(i[F.SK_Z_INDEX],10)+t+1).toString(10)),A.isWidget(n)&&(i[F.SK_Z_INDEX]=(parseInt(i[F.SK_Z_INDEX],10)+this.annotZIndexPriority.length+1).toString(10)),i}remove(n,i){if(A.isRedact(n)){if(!this.documentService.checkAuthority(Be.EDIT_REDACTION))return}else if(!this.documentService.checkAuthority(Be.EDIT_ANNOTATION)||st.get(n.attributes.F??-1,7))return;if(!n||Kc[n.type]&&this.dragMode!==ye.SELECT_ANNOT)return!0;let e=this.editableComps?.find(t=>t.data?.oid===n.oid);if(!e){if(A.isPopup(n))this._remove(n.oid,i);else{let t=n;this.loggingService.common("warn",le.INVALID,this.translatePipe.transform("ANNOTATION"),`oid[${t.oid}], type[${t.type}]`)}return!1}if(i.type.indexOf("annotViewEvt")<0){let t=i.type.indexOf("touch")<0?i:this.touchToMouse(i),o={x:e.data.attributes.rect.left+t.offsetX,y:e.data.attributes.rect.top-t.offsetY};if(e.isTouched&&!e.isTouched(o))return}i.stopPropagation(),i.preventDefault(),this._remove(n.oid,i)}mouseMoveOnAnnot(n,i,e){let t=this.editableComps?.find(c=>c.data?.oid===n.oid);if(t?.data&&A.isWidget(t.data)){this.isActiveEraser&&!K.get(a.DELETE_FORM)?i.style.cursor="not-allowed":i.style.cursor="inherit";return}let o=e.type.indexOf("touch")<0?e:this.touchToMouse(e),s={x:t.data.attributes.rect.left+o.offsetX,y:t.data.attributes.rect.top-o.offsetY};if(!this.isActiveEraser&&t?.isTouched&&!t.isTouched(s)){i.style.cursor="default",this.dragMode===ye.MOVE?i.style.cursor="grab":this.dragMode===ye.SELECT_TEXT&&(i.style.cursor="text");return}!this.isActiveEraser&&!this.annotService.isReadonly(n.oid)?i.style.cursor="pointer":!A.isWidget(n)&&!K.get(a.DELETE_ANNOTATION)?i.style.cursor="not-allowed":i.style.cursor="inherit"}isAnnotSelectMode(){let n=this.dragMode!==ye.AUTO?!1:T.isDefined(this.dragSelect)?this.dragSelect.created?!0:!this.isTextHover:!this.isTextHover;return this.dragMode===ye.SELECT_ANNOT||n}selectAnnot(n,i,e,t){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog())return this.toastService.create({toastStyle:Ot.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")}),!1;if(this.isAnnotLoading)return!1;let o=this.checkEditable(n,i);if(!o.editable)return!!o.returnValue;let s=this.editableComps?.find(c=>c.data?.oid===n.oid);if(!s)return this.loggingService.common("warn",le.INVALID,this.translatePipe.transform("ANNOTATION"),`oid[${n.oid}], type[${n.type}]`),!1;if(i.type.indexOf("annotViewEvt")<0){let c=i.type.indexOf("touch")<0?i:this.touchToMouse(i),u={x:s.data.attributes.rect.left+c.offsetX,y:s.data.attributes.rect.top-c.offsetY};if(s.isTouched&&!s.isTouched(u))return this.selectByPriority(u,c,t)===void 0?!!this.useDrag(i):(i.isDummy||this.reorderComp(),!0);this.reorderComp(n)}if(i.stopPropagation(),this.isEditing()||this.loggingService.common("debug",le.OPENED,this.translatePipe.transform("ANNOTATION_FLOATING_MENU"),`[oid[${n.oid}], type[${n.type}], page[${this.pdfPage.ref+1}]]`),A.isText(s.data)&&this.dragMode!==ye.SELECT_ANNOT&&this.dragMode!==ye.AUTO&&this.togglePopup(s.data),e)this.annotSelectedService.unselectAll();else if(this.annotSelectedService.selectedComponents.some(c=>c.data.oid===n.oid))return!1;return this.annotSelectedService.pageIndex=this.pdfPage.ref,this.annotSelectedService.add(s),this.annotSelectedService.trigger=i.type,this.selectTextService.publishSelectedText(null),this.changeDetectorRef.markForCheck(),t&&(this.annotSelectedService.isFirstSelection=!1),!0}selectByPriority(n,i,e){for(let t=this.visibleAnnots.length-1;t>=0;t--){let o=this.visibleAnnots[t];if(o.attributes.rect.left<=n.x&&n.x<=o.attributes.rect.right&&o.attributes.rect.bottom<=n.y&&n.y<=o.attributes.rect.top)return this.visibleAnnots.splice(this.visibleAnnots.indexOf(o),1),this.selectAnnot(o,{offsetX:n.x-o.attributes.rect.left,offsetY:o.attributes.rect.top-n.y,clientX:i.clientX,clientY:i.clientY,type:i.type,stopPropagation:()=>i.stopPropagation(),preventDefault:()=>i.preventDefault(),isDummy:!0},!0,e),this.visibleAnnots.push(o),o}}useDrag(n){if(this.dragMode===ye.MOVE)return!0;if(this.dragMode===ye.SELECT_TEXT)return this.selectText?.selectedElementRef?.nativeElement&&this.selectText.selectedElementRef.nativeElement.dispatchEvent(new MouseEvent(n.type,n)),!1}postSelect(n){if(!n||!n.selectedComps||n.selectedComps.length===0){this.annotSelectedService.unselectAll(),this.closeEditor();return}let i=n.selectedComps[0].data;this.loggingService.common("debug",le.SELECTED,this.translatePipe.transform("ANNOTATION"),i),this.reorderComp(i),this.notifyToAnnotList(i,n.trigger)}finishEdit(n=!0,i=!0){this.annotSelectedService.pageIndex===this.pdfPage.ref&&this.annotSelectedService.selectedComponents.forEach(e=>{this.rerenderModel(e.data),n&&(this.annotService.putModel(e.data,"modify",qi.DEFAULT,i),this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:fe.UPDATE,pageIdx:this.pdfPage.ref,annot:e.data}))})}pushAnnot(n){if(!A.isPopup(n)){if(A.isWidget(n)){let i=n.attributes;i.MK===void 0&&(i.MK={}),i.MK.R=F.normalizeDegree(this.pdfPage.r+this.degree),(A.isTextField(n,this.acroFormService.acroFields)||A.isListBox(n,this.acroFormService.acroFields)||A.isComboBox(n,this.acroFormService.acroFields))&&this.fontsResponse.fontList.length===0&&this.toastService.create({toastStyle:Ot.FAILURE,header:this.translatePipe.transform("ERROR"),content:`${this.translatePipe.transform("AVAILABLE_FONT_NOT_EXISTS")}`})}this.visibleAnnots.push(n),this.reorderComp(n),setTimeout(()=>{this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:fe.CREATE,pageIdx:this.pdfPage.ref,annot:n})})}}rerenderModel(n){this.oidToStyleMap.set(n.oid,null)}renderModel(n){n.preAction&&this[n.preAction]&&this[n.preAction](n.model),Object.assign(this.containerStylesOf(n.model),n.transform)}prevent(n){this.isActiveEraser||(n.preventDefault(),n.stopPropagation())}onAnnotMousedown(n,i){if(!this.annotService.isReadonly(i.oid)){if(n.button===2){this.selectTextService.publishSelectedText(null);return}this.isContextMenuOpened&&this.sdContextMenuService.publishContextMenuStatus(!1),this.isActiveEraser&&this.isDeletableAnnotation(i)?this.remove(i,n):this.selectAnnot(i,n,!0,!1)}}isDeletableAnnotation(n){return A.isWidget(n)&&K.get(a.DELETE_FORM)||!A.isWidget(n)&&K.get(a.DELETE_ANNOTATION)}onAnnotTouchstart(n,i){this.onAnnotMousedown(this.touchToMouse(n),i)}closeEditor(){this.annotSelectedService.pageIndex===this.pdfPage.ref&&(this.annotSelectedService.unselectAll(),this.loggingService.common("debug",le.CLOSED,this.translatePipe.transform("ANNOTATION_FLOATING_MENU"),`[page-${this.pdfPage.i+1}]`),this.changeDetectorRef.markForCheck())}updateModel(n){switch(n.sdEventType){case fe.DELETE:this._remove(n.annot.oid,U.AnnotViewEvt,n.emitEvent);break;case fe.SELECTED:case fe.MULTI_SELECTED:if(this.editableComps){let i=n.sdEventType===fe.SELECTED;this.selectAnnot(n.annot,U.AnnotViewEvt,i,!0)}else this.afterViewJob=()=>this.selectAnnot(n.annot,U.AnnotViewEvt,!0,!0);break;case fe.UPDATE:n.from==="AnnotationViewComponent"||n.from==="EditMenuComponent"||n.from==="AnnotService"?(this.synchronize(this.data),this.updateFromUI(n.annot,n.emitEvent)):n.from==="AcroFormService"?this.updateFromData(n):this.updateFromUI(n.annot);break;case fe.CREATE:this.synchronize(this.data),this.reorderComp(n.annot);break}this.contentService.fireAnnotEvent(null),this.changeDetectorRef.detectChanges()}updateFromData(n){let i=this.data.findIndex(({oid:e})=>e===n.annot.oid);this.data[i]=n.annot,n.annot.visible&&(i=this.visibleAnnots.findIndex(({oid:e})=>e===n.annot.oid),this.visibleAnnots[i]=n.annot)}normalizeWidgets(n){this.acroFormService.isAcroFieldsInitialized()&&n.forEach(i=>{this.annotService.normalizeWidget(i,this.acroFormService.acroFields,qi.IGNORE)&&(this.annotService.putModel(i,"modify",qi.IGNORE),this.contentService.fireAnnotEvent({annot:i}))})}synchronize(n){this.data=n,this.visibleAnnots.splice(0);let i=[];this.data.forEach(e=>{!e.visible||A.isPopup(e)||!this.preferences||this.documentService.checkAuthority(Be.ANNOTATION)&&!this.documentService.checkAuthority(Be.FORM)&&A.isWidget(e)||this.documentService.checkAuthority(Be.FORM)&&!this.documentService.checkAuthority(Be.ANNOTATION)&&!A.isWidget(e)||i.push(e)}),i.forEach(e=>{(e.oid===e.IRT||i.findIndex(t=>e.IRT===t.oid)<0)&&this.visibleAnnots.push(e)}),this.oidToStyleMap.clear(),this.applyHideAnnotation(),this.changeDetectorRef.markForCheck()}applyHideAnnotation(){this.visibleAnnotationOids&&(this.visibleAnnots=this.visibleAnnots.filter(n=>A.isWidget(n)||this.visibleAnnotationOids?.includes(n.oid)))}doAfterPagedLoaded(){setTimeout(()=>{this.updateSelectedAnnotations(!1),typeof this.afterViewJob=="function"&&this.afterViewJob(),this.afterViewJob=null})}fetch(){if(this.pdfPage.isDuplicated){this.synchronize([]);return}this.subscriptionService.set("dataSub",this.annotService.getAnnotations(this.pdfPage.ref).pipe(Ka(()=>this.isAnnotLoading=!1)).subscribe({next:n=>{this.annotService.publishAnnotOrder(n.map(i=>i.oid),this.pdfPage.ref),this.synchronize(n),this.normalizeWidgets(n),this.doAfterPagedLoaded()},error:n=>{throw this.synchronize([]),n}}))}delayFetch(n=F.TaskPriority.ANNOT){this.subscriptionService.set("delayedFetchSub",Di(n).subscribe({next:()=>this.fetch()}))}togglePopup(n,i=!1,e){if(!A.hasPopup(n)||!i&&this.isActiveEraser)return;let t=this.data.find(o=>o.oid===n.Popup);if(!t){this.loggingService.common("warn",le.INVALID,this.translatePipe.transform("POPUP"),`[${n.Popup}] of model[${n.oid}]`);return}this.popupService.togglePopup({src:n,popup:t,pdfPage:this.pdfPage,open:e})}_remove(n,i,e=!0){let t=this.visibleAnnots.findIndex(C=>C.oid===n);if(t>=0){if(this.isEditing()){let C=this.annotSelectedService.selectedComponents.findIndex(x=>x.data.oid===n);C>-1&&(this.annotSelectedService.selectedComponents.splice(C,1),this.annotSelectedService.dispatchSelectionInfoChange())}this.visibleAnnots.splice(t,1)}let o=[].concat(...this.annotService.getActionLog().map(C=>C.annots)),s=o.find(C=>C.oid===n&&C.action==="remove"),c=this.data.findIndex(C=>C.oid===n);if(c<0)return!s&&o.length>0&&this.loggingService.common("warn",le.NOT_EXIST,this.translatePipe.transform("ANNOTATION"),`oid[${n}]`),!1;let u=this.data.splice(c,1)[0];return A.isWidget(u)?(this.acroFormService.unlinkWidget(u),this.scriptService.executeAll(this.acroFormService.acroFields)):A.isPopup(u)&&(this.popupService.togglePopup({src:null,popup:u,pdfPage:this.pdfPage,open:!1}),this.removePopupLink(u,e)),this.annotService.putModel(u,"remove",qi.MERGE_WITH_PREVIOUS,e),this.togglePopup(u,!0,!1),A.hasPopup(u)&&this.remove(this.data.find(C=>A.isPopup(C)&&C.oid===u.Popup),i),this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:fe.DELETE,pageIdx:this.pdfPage.ref,annot:u}),this.data.filter(C=>C.IRT===u.oid).forEach(C=>this.remove(C,i)),!1}checkEditable(n,i){return A.isLink(n)&&this.dragMode!==ye.SELECT_ANNOT||A.isWidget(n)&&this.dragMode!==ye.SELECT_ANNOT||A.isWidget(n)&&!this.isEditable?{editable:!1,returnValue:!0}:i.type===U.AnnotViewEvt.type?{editable:!0}:Xc[n.type]?(this.togglePopup(n),{editable:!1,returnValue:!1}):{editable:!0}}reorderComp(n){if(!n)return;let i=this.annotZIndexPriority.indexOf(n.oid);i>-1&&this.annotZIndexPriority.splice(i,1),this.annotZIndexPriority.push(n.oid),this.annotZIndexPriority.forEach(e=>this.oidToStyleMap.set(e,null)),A.isRedact(n)||this.visibleAnnots.filter(e=>A.isWidget(e)).forEach(e=>this.rerenderModel(e))}notifyToAnnotList(n,i){i!==U.AnnotViewEvt.type&&this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:fe.SELECTED,pageIdx:this.pdfPage.ref,annot:n})}updateFromUI(n,i=!0){this.visibleAnnots.findIndex(e=>e.oid===n.oid)<0||(this.finishEdit(!0,i),this.changeDetectorRef.markForCheck())}updateSelectedAnnotations(n){this.editableComps&&(this.annotSelectedService.selectedComponents.forEach((i,e)=>{if(!this.annotSelectedService.selectedComponents[e].elementRef){let t=this.editableComps?.find(o=>o.data.oid===i.data.oid);t&&(this.annotSelectedService.selectedComponents[e]=t,n||this.annotSelectedService.dispatchSelectionInfoChange())}}),this.changeDetectorRef.markForCheck())}removePopupLink(n,i){let e=this.data.find(t=>t.Popup===n.oid);e&&(e.Popup=null,this.annotService.putModel(e,"modify",qi.DEFAULT,i))}findNextSelectionField(n){let i=[],e=Array.from(this.editableComps??[]).filter(o=>A.isWidget(o.data)),t=e.findIndex(o=>o.data?.oid===n.oid);if(t>=e.length-1)return i;if(A.isRadioWidget(n,this.acroFormService.acroFields)){let o=this.acroFormService.acroFields[n.attributes.Parent].Kids;if(o?.every(c=>this.annotSelectedService.selectedComponents.findIndex(u=>u.data?.oid===c.oid)>-1)&&T.isDefined(o)&&o.length>1){let c=e.find(u=>u.data?.attributes.Parent===n.attributes.Parent);i.push(c)}else i.push(e[t+1])}else{let o=e[t+1];A.isRadioWidget(o.data,this.acroFormService.acroFields)?i.push(...e.filter(s=>s.data?.attributes.Parent===o.data.attributes.Parent)):i.push(e[t+1])}return i}findPreviousSelectionField(n){let i=[],e=Array.from(this.editableComps??[]).filter(o=>A.isWidget(o.data)),t=e.findIndex(o=>o.data?.oid===n.oid);if(t<1)return i;if(A.isRadioWidget(n,this.acroFormService.acroFields)){let o=this.acroFormService.acroFields[n.attributes.Parent].Kids;if(o?.every(c=>this.annotSelectedService.selectedComponents.findIndex(u=>u.data?.oid===c.oid)>-1)||T.isDefined(o)&&o.length===1)i.push(e[t-1]);else{let c=o?.filter(C=>C.i===this.pdfPage.ref),u=c?.findIndex(C=>C.oid===n.oid);u===0?i.push(...e.filter(C=>C.data?.attributes.Parent===n.attributes.Parent)):i.push(e.find(C=>C.data?.oid===c?.[u-1].oid))}}else i.push(e[t-1]);return i}appearanceStyle(n){let i=U.appearanceStyle(n.attributes);if(A.isTextMarkup(n)){let e=n.attributes.opacity??Se.getEnumValueByKey(na,n.type.toLowerCase(),1);return Object.assign(i,{opacity:e})}return i}annotationStyle(n){return U.annotationStyle(n.attributes)}onMousemove(n){if(!xt.isEventInPage(n,this.pdfPage)&&n.target===this.annotElementContainer.nativeElement){this.renderer.setStyle(this.annotElementContainer.nativeElement,"cursor","inherit");return}if(this.isActiveEraser&&this.isDeletable){this.renderer.setStyle(this.annotElementContainer.nativeElement,"cursor","url(assets/images/cursor-eraser.cur), auto");return}this.renderer.setStyle(this.annotElementContainer.nativeElement,"cursor","inherit")}isBlend(n){return A.isTextMarkup(n)}};v(qn,"\u0275fac",function(i){return new(i||qn)(m(Re),m(qc),m(kt),m(ge),m(Yc),m(bt),m(de),m(Y),m(It),m(Lt),m(vi),m(Un),m(P),m(Oi),m(xe),m(oe),m(Qr),m(Wn),m(bi),m(ci),m(Qt),m(De))}),v(qn,"\u0275cmp",j({type:qn,selectors:[["sd-annot"]],viewQuery:function(i,e){if(i&1&&(se(e_,5),se(t_,5),se(i_,7,Ei),se(n_,5)),i&2){let t;ae(t=ce())&&(e.dragSelect=t.first),ae(t=ce())&&(e.annotElementContainer=t.first),ae(t=ce())&&(e.annotCreatePortal=t.first),ae(t=ce())&&(e.editableComps=t)}},hostVars:1,hostBindings:function(i,e){i&1&&O("click",function(o){return e.prevent(o)}),i&2&&G("tabIndex",e.hostTabIndex)},inputs:{pdfPage:"pdfPage",documentId:"documentId",selectText:"selectText"},standalone:!1,features:[$([P,Qr]),Ie],decls:5,vars:3,consts:[["annotCreatePortal",""],["annotElementContainer",""],["annotElement",""],["editableComp",""],["dragSelect",""],[3,"ngStyle","mousemove",4,"ngIf"],[3,"pdfPage","comps","acroFields","select","edit","postEdit",4,"ngIf"],[3,"comps","page","select","clickEvent",4,"ngIf"],[3,"mousemove","ngStyle"],[3,"ngSwitch","ngClass","blend","ngStyle","mousedown","touchstart","mousemove",4,"ngFor","ngForOf","ngForTrackBy"],[3,"mousedown","touchstart","mousemove","ngSwitch","ngClass","ngStyle"],[3,"data",4,"ngSwitchCase"],[3,"ngStyle","data","status",4,"ngSwitchCase"],[3,"ngStyle","annotInk","status",4,"ngSwitchCase"],[3,"ngStyle","annotLine","status",4,"ngSwitchCase"],[3,"data","pdfData",4,"ngSwitchCase"],[3,"ngStyle","annotText","status","pdfPage",4,"ngSwitchCase"],[3,"data","status",4,"ngSwitchCase"],["class","annotation-appearance",3,"ngStyle",4,"ngIf"],[4,"ngSwitchDefault"],[3,"data"],[3,"ngStyle","data","status"],[3,"ngStyle","annotInk","status"],[3,"ngStyle","annotLine","status"],[3,"data","pdfData"],[3,"ngStyle","annotText","status","pdfPage"],[3,"data","status"],[1,"annotation-appearance",3,"ngStyle"],[3,"select","edit","postEdit","pdfPage","comps","acroFields"],[3,"select","clickEvent","comps","page"]],template:function(i,e){i&1&&R(0,C_,3,3,"ul",5)(1,T_,0,0,"ng-template",null,0,He)(3,E_,1,3,"sd-annot-edit",6)(4,S_,2,2,"sd-drag-select",7),i&2&&(p("ngIf",e.isFetched()),l(3),p("ngIf",e.isEditing()),l(),p("ngIf",e.isAnnotSelectMode()))},styles:["ul[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;padding:0;margin:0;right:0;top:0;list-style-type:none}li[_ngcontent-%COMP%]{position:absolute}li[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}p[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;color:#00000080}.blend[_ngcontent-%COMP%]{mix-blend-mode:multiply}"],changeDetection:0}));var Jn=qn;ee([Ae(J.annotComp.pushAnnot),Eo(J.annotComp.pushAnnotWidget)],Jn.prototype,"pushAnnot",null);ee([Ae(J.annotComp.onAnnotMouseDown)],Jn.prototype,"onAnnotMousedown",null);var O_=["bboxComp"],b_=["arrowComp"],I_=["textView"];function y_(r,n){if(r&1&&I(0,"sd-poly-shape",5,2),r&2){let i=d();p("data",i.data)("status",i.status)}}var A_={90:{x:"0",y:"-100%"},180:{x:"-100%",y:"-100%"},270:{x:"-100%",y:"0"},get(r,n,i){if(![90,170,270].includes(r))throw new $e(`Invalid degree. ${r}`);let e=this[r];return n||i?`translate(${this.calcOf(n,e.x)}, ${this.calcOf(i,e.y)})`:`translate(${e.x}, ${e.y})`},calcOf(r,n){return r==="0"&&n==="0"?"0":`calc(${n} + ${r})`}},Bi=(()=>{let n=class n{elementRef;annotService;contentService;editService;annotSelectedService;documentService;subscriptionService;loggingService;translatePipe;data;get status(){return this._status}set status(e){this._status=e}bboxComp;arrowComp;textView;containerStyles={};textStyles={};isTextareaEdited=!1;srcRect;srcTextRect;_status=Z.RENDER;viewClasses={create:!1,remove:!1};isTextFocus=!1;get isCallout(){return A.isFreeTextCallout(this.data)}get oid(){return this.data?.oid}get translateMap(){return A_}_textSrc;get textSrc(){return this._textSrc?this._textSrc:(this._textSrc=new pt,this.subscriptionService.push(this._textSrc.pipe(Yo(this.data.attributes.contentsRichtext.text),ui(400)).subscribe({next:e=>this.updateText(e)})),this._textSrc)}get renderAppearance(){return U.hasAppearance(this.data.attributes.appearance)&&A.isFreeTextCallout(this.data)}constructor(e,t,o,s,c,u,C,x,N){this.elementRef=e,this.annotService=t,this.contentService=o,this.editService=s,this.annotSelectedService=c,this.documentService=u,this.subscriptionService=C,this.loggingService=x,this.translatePipe=N}ngOnChanges(){this.srcRect=T.deepClone(this.data.attributes.rect),this.srcTextRect=T.deepClone(this.data.attributes.textRect),this.viewClasses.create=Z.CREATE===this.status,this.viewClasses.remove=Z.REMOVE===this.status}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(e=>e?.sdEventType===fe.UPDATE&&e.annot.oid===this.data.oid)).subscribe({next:()=>{this.srcRect=T.deepClone(this.data.attributes.rect),this.isCallout&&(this.srcTextRect=T.deepClone(this.data.attributes.textRect),et.applyRect(this.data)),this.detectChange()}}),this.annotSelectedService.selectionInfoChange$.pipe(L(()=>this.annotSelectedService.selectedComponents[0]?.data!==this.data)).subscribe({next:()=>{this.isTextareaEdited||this.restoreTextBox(),this.textView.nativeElement.blur(),this.isTextFocus=!1}}))}ngOnDestroy(){T.removeElement(this.textView.nativeElement),ve.destroy(this)}ngAfterViewInit(){typeof this.data.IT<"u"||this.data.action!=="create"||this.data.attributes.contentsRichtext.text.length>0||this.textView.nativeElement.focus()}isCloud(){return this.data.attributes.borderEffect?.style==="C"}isReadonly(){return!this.documentService.checkAuthority(Be.EDIT_ANNOTATION)||st.get(this.data.attributes.F??-1,7)}onTextareaFocus(){this.autoResizeTextbox(),this.isTextFocus=!0}onTextareaInput(){this.autoResizeTextbox(),this.isTextareaEdited=!0}onTextareaBlur(){this.textView.nativeElement.scrollTop=0}render(){let{contentsRichtext:e,rect:t}=this.data.attributes,o=this.data.attributes.textRect||t,s=Math.abs(o.right-o.left),c=Math.abs(o.top-o.bottom),u=e.fontSize/10,C=Math.min(this.data.attributes.width*2*2,Math.min(s,c))/2/u;if(this.textStyles.margin=`${C}px`,this.textStyles.fontSize="10px",this.textStyles.lineHeight="10px",this.textStyles.width=`calc(${100/u}% - ${C*2}px)`,this.textStyles.height=`calc(${100/u}% - ${C*2}px)`,this.renderAppearance)return{width:`${s}px`,height:`${c}px`,opacity:"0"};let x=this.isCloud()&&T.isDefined(this.data.attributes.borderEffect?.intensity)?this.data.attributes.borderEffect.intensity*5+this.data.attributes.width*2:0,N=this.isCloud()&&T.isDefined(this.data.attributes.borderEffect?.intensity)?this.data.attributes.borderEffect.intensity*5+this.data.attributes.width*2:0;return this.containerStyles.background=this.buildBackground()||"none",this.containerStyles.left=`${F.fixedOf(o.left-t.left,3)+x}px`,this.containerStyles.top=`${F.fixedOf(t.top-o.top,3)+N}px`,this.textStyles.fontFamily=e.fontName,this.textStyles.fontFamily=JSON.stringify(this.textStyles.fontFamily),this.textStyles.color=e.fontColor,this.textStyles.textAlign=e.textAlign,this.textStyles.transform=`scale(${u})`,this.textStyles.transformOrigin=`${-C}px ${-C}px`,this.renderRotation(this.containerStyles,o)}verticesOf(e,t,o){let s=this.data.attributes,c=s.textRect||s.rect;if(!this.isCallout)return this.editService.createRectVertices(t,o);let u=[{x:c.left,y:c.top},{x:c.left,y:(c.top+c.bottom)/2},{x:c.left,y:c.bottom},{x:(c.left+c.right)/2,y:c.bottom},{x:c.right,y:c.bottom},{x:c.right,y:(c.top+c.bottom)/2},{x:c.right,y:c.top},{x:(c.left+c.right)/2,y:c.top}];return this.isCallout&&s.vertices&&u.push(s.vertices[0]),this.editService.createPathVertices(e,o,...u)}postEdit(e,t){this.isTextareaEdited||this.restoreTextBox(),this.isTextFocus=!1,this.bboxComp.postEdit(e,t),U.validateRect(this.data.attributes.rect),this.containerStyles.transform=null,this.ngOnChanges(),this.bboxComp.renderer.status=Z.RENDER,this.detectChange(),this.isTextareaEdited=!1}pvOnMove(e){this.isCallout&&(this.bboxComp.pvOnMove&&this.bboxComp.pvOnMove(e),et.applyVertices(this.data),et.applyRect(this.data),this.detectChange())}postCreate(e){this.isCallout&&([this.bboxComp,this.arrowComp].forEach(t=>{t?.postCreate&&t.postCreate(e)}),et.applyVertices(this.data),et.applyRect(this.data))}pvOnVertexMove(e,t,o){this.isTextareaEdited=!0;let s=this.data.attributes,c=s.vertices||[];t===8&&c[0]&&U.applyVertexDelta(o,c[0]);let u={oid:null,type:null,visible:null,attributes:{rect:s.textRect||s.rect,width:s.width}};if(!this.editService.resizeByRectVertex(u,t,o)){this.detectChange();return}if(this.bboxComp.renderer.status=Z.EDIT,!this.isCallout){let C=s.rect;this.containerStyles.transform=`translate(${C.left-this.srcRect.left}px, ${this.srcRect.top-Math.max(C.top,C.bottom)}px)`}this.detectChange()}setText(e){this.textSrc.next(e)}renderRotation(e,t){let o=(360+-(this.data.attributes.Rotate||0)%360)%360,s=Math.abs(t.right-t.left),c=Math.abs(t.top-t.bottom);if(o!==0&&!(o%90)&&o%180&&([s,c]=[c,s]),Object.assign(e||{},{width:`${s}px`,height:`${c}px`,"transform-origin":null}),!o)return e;let u="";return this.containerStyles.transform&&(u=this.containerStyles.transform),rt(Oe({},e||{}),{transform:`${u&&!u.includes("rotate")?`${u} `:""}rotate(${o}deg) ${this.translateMap.get(o,0,0)}`,"transform-origin":"0 0"})}buildBackground(){if(!this.data.attributes.color||this.status===Z.CREATE)return;let e=/#([0-9a-f]{1,2})([0-9a-f]{1,2})([0-9a-f]{1,2})/i.exec(this.data.attributes.color);if(!e||e.length<4){this.loggingService.common("warn",le.INVALID,this.translatePipe.transform("COLOR_CODE"),`oid=${this.data.oid}, color=${this.data.attributes.color}`);return}return e.shift(),`${e.reduce((t,o)=>`${t}${Number.parseInt(o,16)}, `,"rgba(")}1)`}detectChange(){this.bboxComp&&this.bboxComp.detectChange(),this.arrowComp&&this.arrowComp.detectChange()}updateText(e){this.data.attributes.contentsRichtext.text=e??"",this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotListEvent({from:"FreeTextComponent",sdEventType:fe.UPDATE,annot:this.data}),this.detectChange()}autoResizeTextbox(){let e=this.textView.nativeElement;if(e.clientHeight>=e.scrollHeight)return;let{contentsRichtext:t,rect:o}=this.data.attributes,s=t.fontSize/10,c=Math.round(e.scrollHeight/parseFloat(e.style.lineHeight)),u=(parseInt(e.style.fontSize)*c+parseFloat(e.style.margin)*2)*s;if(!this.isCallout)o.bottom=o.top-u;else{let{textRect:C}=this.data.attributes;C.bottom=C.top-u,et.applyVertices(this.data),et.applyRect(this.data)}this.contentService.fireAnnotEvent({annot:this.data,from:"FreeTextComponent"}),this.detectChange()}restoreTextBox(){if(this.isCallout){let{textRect:e}=this.data.attributes;e.bottom=e.top-(this.srcTextRect.top-this.srcTextRect.bottom),et.applyVertices(this.data),et.applyRect(this.data)}else{let{rect:e}=this.data.attributes;e.bottom=e.top-(this.srcRect.top-this.srcRect.bottom)}this.detectChange()}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Re),m(ge),m(_t),m(kt),m(It),m(P),m(De),m(oe))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-free-text"]],viewQuery:function(t,o){if(t&1&&(se(O_,7),se(b_,5),se(I_,5)),t&2){let s;ae(s=ce())&&(o.bboxComp=s.first),ae(s=ce())&&(o.arrowComp=s.first),ae(s=ce())&&(o.textView=s.first)}},inputs:{data:"data",status:"status"},standalone:!1,features:[$([{provide:_c,useValue:!1},P]),Ie],decls:6,vars:9,consts:[["textView",""],["bboxComp",""],["arrowComp",""],[3,"ngClass","ngStyle"],["spellcheck","false",3,"ngModelChange","focus","input","blur","paste","id","ngStyle","ngModel","readonly"],[3,"data","status"],[3,"data","status",4,"ngIf"]],template:function(t,o){if(t&1){let s=w();h(0,"div",3)(1,"textarea",4,0),O("ngModelChange",function(u){return f(s),g(o.setText(u))})("focus",function(){return f(s),g(o.onTextareaFocus())})("input",function(){return f(s),g(o.onTextareaInput())})("blur",function(){return f(s),g(o.onTextareaBlur())})("paste",function(u){return f(s),g(u.stopPropagation())}),_()(),I(3,"sd-rect",5,1),R(5,y_,2,2,"sd-poly-shape",6)}t&2&&(p("ngClass",o.viewClasses)("ngStyle",o.render()),l(),p("id",o.oid)("ngStyle",o.textStyles)("ngModel",o.data.attributes.contentsRichtext.text)("readonly",o.isReadonly()),l(2),p("data",o.data)("status",o.status),l(2),p("ngIf",o.isCallout))},styles:["div[_ngcontent-%COMP%]{position:absolute;padding:0;margin:0}textarea[_ngcontent-%COMP%]{border:none;padding:0;margin:0;resize:none;outline:none;overflow:hidden;background:none;box-sizing:border-box}"],changeDetection:0}));let r=n;return r})();var zt=9,Oo=class{prevEvt;editorComp;vertexIdx;moved=!1;delta={x:0,y:0};srcRect={};forBbox={};page;vertex={};srcVertex={};bboxStyle;vertexStyle;constructor(n,i,e){this.prevEvt=n,this.editorComp=i,this.vertexIdx=e,i.annotSelectedService.selectedComponents.forEach(t=>{Object.assign(this.getSrcRect(t.data),T.deepClone(t.data.attributes.rect)),Object.assign(this.getForBbox(t.data),T.deepClone(t.data.attributes.rect));let o=i.getVertexCoords(t.data)[e];this.setVertex(t.data,o),Object.assign(this.getSrcVertex(t.data),T.deepClone(o))}),this.page=i.pdfPage,this.bboxStyle=i.style.bbox,this.vertexStyle={width:String(i.vertex.styles),height:String(i.vertex.styles)}}getSrcRect(n){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);return this.srcRect[n.oid]||(this.srcRect[n.oid]={top:0,right:0,bottom:0,left:0}),this.srcRect[n.oid]}getForBbox(n){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);return this.forBbox[n.oid]||(this.forBbox[n.oid]={top:0,right:0,bottom:0,left:0}),this.forBbox[n.oid]}setVertex(n,i){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);this.vertex[n.oid]=i}getVertex(n){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);return this.vertex[n.oid]||(this.vertex[n.oid]={x:0,y:0}),this.vertex[n.oid]}getSrcVertex(n){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);return this.srcVertex[n.oid]||(this.srcVertex[n.oid]={x:0,y:0}),this.srcVertex[n.oid]}move(n,i,e,t){let o={x:n.offsetX-this.prevEvt.offsetX,y:n.offsetY-this.prevEvt.offsetY};this.prevEvt=n;let s=this.getVertex(i.data);this.cursor=this.isInvalidateDelta(this.page.bbox,s)?"not-allowed":"pointer",this.moveVertexOfEditor(s,o),i.pvOnVertexMove&&i.pvOnVertexMove(this.page,this.vertexIdx,o)}renderBbox(n){n.fitBox?(n.fitBox(this.getForBbox(n.data)),this.editorComp.renderBbox(n,this.getForBbox(n.data))):this.editorComp.renderBbox(n)}postMove(...n){return n.length>1&&console.warn("Editing multiple vertex is not implemented yet. It may malfunction."),setTimeout(()=>this.cursor=null),n.some(e=>{let t=this.getVertex(e.data);return this.isInvalidateDelta(this.page.bbox,t)})?(n.forEach(e=>{let t=this.getVertex(e.data),o=this.getSrcVertex(e.data),s={x:o.x-t.x,y:o.y-t.y};this.moveVertexOfEditor(t,s),e.pvOnVertexMove&&e.pvOnVertexMove(this.page,this.vertexIdx,s)}),!1):(n.forEach(e=>{e.postEdit&&e.postEdit(this.page,this.delta)}),!0)}set cursor(n){this.bboxStyle&&(this.bboxStyle.cursor=n),this.vertexStyle&&(this.vertexStyle.cursor=n)}moveVertexOfEditor(n,i){n.x+=i.x,n.y+=i.y}isInvalidateDelta(n,i){return this.delta.x+i.x<n.x||this.delta.x+i.x+this.editorComp.vertex.size>n.w+n.x||i.y-this.delta.y<0||i.y-this.delta.y+this.editorComp.vertex.size>n.h}};ee([Ae(J.annotEditTool.vertexMover.move,1e3),Eo(J.annotEditTool.vertexMover.moveWidget,1e3)],Oo.prototype,"move",null);var eo=class{prevEvt;editorComp;moved=!1;delta={x:0,y:0};srcRect={};page;cdelta;cursorStyle;transformStyle;useSnapIn=!1;constructor(n,i){this.prevEvt=n,this.editorComp=i,this.cursorStyle=i.style.bbox,this.transformStyle=i.editorTransform,this.page=i.pdfPage,i.annotSelectedService.selectedComponents.forEach(e=>{Object.assign(this.getSrcRect(e.data),T.deepClone(e.data.attributes.rect))})}getSrcRect(n){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);return this.srcRect[n.oid]||(this.srcRect[n.oid]={top:0,right:0,bottom:0,left:0}),this.srcRect[n.oid]}move(n,i,e,t){let o=this.calcDelta(n,e,t);!o.x&&!o.y||(this.delta.x=o.x,this.delta.y=o.y,this.editorComp.rulerActive&&(this.stickToGuideLine(i.data.attributes.rect,e),this.useSnapIn=o.x!==this.delta.x||o.y!==this.delta.y),this.transform=`translate(${this.delta.x}px, ${this.delta.y}px)`,this.cursor=this.editorComp.annotSelectedService.selectedComponents.some(s=>this.isInvalidateDelta(this.page.bbox,s.data.attributes.rect))?"not-allowed":null,this.editorComp.annotSelectedService.selectedComponents.forEach(s=>{this.editorComp.edit.emit({model:s.data,transform:this.editorComp.editorTransform}),s.pvOnAnnotMove&&s.pvOnAnnotMove(this.editorComp.pdfPage,o,this.delta)}))}stickToGuideLine(n,i){let e=[];this.editorComp.store$.pipe($r(this.editorComp.pdfPage.i),ii(1)).subscribe({next:s=>{e=Se.keys(s).map(c=>s[c]).filter(c=>c!=null)}});let t=(s,c)=>Math.abs(c-s)*i<15,o=(s,c,u)=>t(c,s+u)?c-s:u;e.forEach(s=>{let c=s.isVertical?s.offset:this.page.bbox.h-s.offset;s.isVertical?(this.delta.x=o(n.left,c,this.delta.x),this.delta.x=o(n.right,c,this.delta.x)):(this.delta.y=-o(n.top,c,-this.delta.y),this.delta.y=-o(n.bottom,c,-this.delta.y))}),this.transform=`translate(${this.delta.x}px, ${this.delta.y}px)`,this.cursor=this.editorComp.annotSelectedService.selectedComponents.some(s=>this.isInvalidateDelta(this.page.bbox,s.data.attributes.rect))?"not-allowed":null,this.emitAnnotChanges(this.editorComp.annotSelectedService.selectedComponents)}emitAnnotChanges(n){if(!T.isDefined(this.cdelta))throw new oi("cdelta is not defined. Call move() first.");n.forEach(i=>{this.editorComp.edit.emit({model:i.data,transform:this.editorComp.editorTransform}),i.pvOnAnnotMove&&i.pvOnAnnotMove(this.editorComp.pdfPage,this.cdelta,this.delta)})}postMove(...n){return this.transform="translate(0, 0)",setTimeout(()=>this.cursor=null),n.some(e=>this.isInvalidateDelta(this.page.bbox,e.data.attributes.rect))?!1:(n.forEach(e=>{let t=e.data.attributes.rect;if(t.left+=this.delta.x,t.right+=this.delta.x,t.bottom-=this.delta.y,t.top-=this.delta.y,A.isFreeTextCallout(e.data)){let o=e.data.attributes.textRect;if(!T.isDefined(o))throw new Nt("Text rectangle is not defined");o.left+=this.delta.x,o.right+=this.delta.x,o.bottom-=this.delta.y,o.top-=this.delta.y,e.pvOnVertexMove&&e.pvOnVertexMove(this.page,8,this.delta),et.applyVertices(e.data),et.applyRect(e.data)}e.postEdit&&e.postEdit(this.page,this.delta)}),!0)}renderBbox(n){this.editorComp.renderBbox(n)}calcDelta(n,i,e){this.cdelta={x:this.prevEvt.clientX-n.clientX,y:this.prevEvt.clientY-n.clientY};let t=i,o=i,s=e===90,c=e===270;return e===0?(t=-t,o=-o):s?o=-o:c&&(t=-t),this.cdelta.x/=t,this.cdelta.y/=o,(s||c)&&([this.cdelta.x,this.cdelta.y]=[this.cdelta.y,this.cdelta.x]),this.cdelta}set cursor(n){this.cursorStyle&&(this.cursorStyle.cursor=n)}set transform(n){this.transformStyle&&(this.transformStyle.transform=n)}isInvalidateDelta(n,i){return this.delta.x+i.left<n.x||this.delta.x+i.right>n.w+n.x||i.bottom-this.delta.y<n.y||i.top-this.delta.y>n.h+n.y}};ee([Ae(J.annotEditTool.annotMover.move)],eo.prototype,"move",null);ee([Ae(J.annotEditTool.annotMover.emitAnnotChanges,1e3),Eo(J.annotEditTool.annotMover.emitAnnotChangesWidget,1e3)],eo.prototype,"emitAnnotChanges",null);var ss=class extends eo{srcTextRect={};srcVertices={};offSet={x:this.prevEvt.offsetX,y:this.prevEvt.offsetY};constructor(n,i){super(n,i),i.annotSelectedService.selectedComponents.forEach(e=>{A.isFreeText(e.data)&&(Object.assign(this.getSrcTextRect(e.data),T.deepClone(e.data.attributes.textRect)),Object.assign(this.getSrcVertices(e.data),T.deepClone(e.data.attributes.vertices)))})}getSrcTextRect(n){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);return this.srcTextRect[n.oid]||(this.srcTextRect[n.oid]={top:0,right:0,bottom:0,left:0}),this.srcTextRect[n.oid]}getSrcVertices(n){if(!n||!n.oid)throw new $e(`Invalid Annotation. ${n}`);return this.srcVertices[n.oid]||(this.srcVertices[n.oid]=[]),this.srcVertices[n.oid]}move(n,i,e,t){let o=this.calcDelta(n,e,t);if(!(!o.x&&!o.y)){if(this.delta.x=o.x,this.delta.y=o.y,this.applyTextRect(i.data,o),!this.isTextBoxClicked(n,i.data)){let s={x:n.offsetX-this.offSet.x,y:n.offsetY-this.offSet.y};this.offSet={x:n.offsetX,y:n.offsetY},i.pvOnVertexMove&&i.pvOnVertexMove(this.page,8,s)}et.applyVertices(i.data),et.applyRect(i.data),this.cursor=this.isInvalidateDelta(this.page.bbox,i.data.attributes.rect)||et.isInvalidatePoint(i.data)?"not-allowed":null,this.editorComp.edit.emit({model:i.data,transform:null,preAction:"rerenderModel"}),i.detectChange()}}postMove(...n){return n.length>1&&console.warn("Editing multiple callout is not implemented yet. It may malfunction."),setTimeout(()=>this.cursor=null),n.some(e=>this.isInvalidateDelta(this.page.bbox,e.data.attributes.rect)||et.isInvalidatePoint(e.data))?(n.forEach(e=>{let t=e.data.attributes.rect,o=e.data.attributes.textRect,s=e.data.attributes.vertices;if(!T.isDefined(o))throw new Nt("Text rectangle is not defined");if(!T.isDefined(s))throw new Nt("Vertices are not defined");Object.assign(t,this.getSrcRect(e.data)),Object.assign(o,this.getSrcTextRect(e.data)),Object.assign(s,this.getSrcVertices(e.data)),e.detectChange()}),!1):(n.forEach(e=>{e.postEdit&&e.postEdit(this.page,this.delta)}),!0)}isInvalidateDelta(n,i){return i.left<n.x||i.right>n.w+n.x||i.bottom<n.y||i.top>n.h+n.y}isTextBoxClicked(n,i){let e=i.attributes.textRect,t={x:n.offsetX,y:this.page.bbox.h-n.offsetY};return T.isDefined(e)&&t.x>e.left&&t.x<e.right&&t.y>e.bottom&&t.y<e.top}applyTextRect(n,i){let e=n.attributes.textRect,t=this.getSrcTextRect(n);if(!T.isDefined(e))throw new Nt("Text rectangle is not defined");e.left=t.left+i.x,e.right=t.right+i.x,e.bottom=t.bottom-i.y,e.top=t.top-i.y}};ee([Ae(J.annotEditTool.annotCalloutMover.move,1e3)],ss.prototype,"move",null);var as=class extends Oo{move(n,i,e,t){super.move(n,i,e,t),et.applyVertices(i.data),et.applyRect(i.data),this.cursor=this.isInvalidateDelta(this.page.bbox,this.getVertex(i.data))||et.isInvalidatePoint(i.data)?"not-allowed":null,this.editorComp.edit.emit({model:i.data,transform:null,preAction:"rerenderModel"}),i.detectChange()}postMove(...n){n.length>1&&console.warn("Editing multiple callout vertex is not implemented yet. It may malfunction.");let i=super.postMove(...n);return n.some(t=>et.isInvalidatePoint(t.data))&&(n.forEach(t=>{let o=this.getVertex(t.data),s=this.getSrcVertex(t.data),c={x:s.x-o.x,y:s.y-o.y};this.moveVertexOfEditor(o,c),t.pvOnVertexMove&&t.pvOnVertexMove(this.page,this.vertexIdx,c)}),i=!1),n.forEach(t=>{et.applyVertices(t.data),et.applyRect(t.data),t.postEdit&&t.postEdit(this.page,this.delta),t.detectChange()}),i}};ee([Ae(J.annotEditTool.vertexCalloutMover.move,1e3)],as.prototype,"move",null);var cs=class{domEl;editorComp;renderer;page;mover=null;_isPointerDown=!1;draggingEventRemover=null;panningEventRemover=null;pendedPanningEvt=null;editingComp;constructor(n,i,e,t){this.domEl=n,this.editorComp=i,this.renderer=e,this.page=t}get isMoving(){return!!this.mover}get isPointerDown(){return this._isPointerDown}set isPointerDown(n){this._isPointerDown=n}getButton=n=>n.buttons;renderBbox(n){let i=this.mover||this.editorComp;i?.renderBbox&&i.renderBbox(n)}touchToMouse(n){return T.touchToMouseEvt(n,this.editorComp.degree,this.editorComp.scale,this.page,this.domEl)}createMover(n,i,e){if(this.mover)return;let t=i?.type?i.type.substring(0,5):"",o=t==="touch"?this.touchToMouse(i):i;if(this.getButton(o)>1)return;let s=A.isFreeTextCallout(n.data)&&this.editorComp.annotSelectedService.selectedComponents.length===1,c;if(e!==void 0?c=s?as:Oo:c=s?ss:eo,this.mover=new c(o,this.editorComp,e),!!this.mover)switch(this.editingComp=n,t){case"touch":this.addPanningListener();break;default:this.addDraggingListener();break}}finalizeMover(n){if(this.removeDraggingListener(),this.removePanningListener(),!this.mover||!this.mover.moved)return this.mover=null;n&&(n.preventDefault(),n.stopPropagation());let i=this.mover;return this.mover=null,i}performMove(n){if(!this.mover||!this.draggingEventRemover&&!this.panningEventRemover)return;n.preventDefault(),n.stopPropagation();let i=this.editorComp.scale,e=this.page.r+this.editorComp.degree;this.mover.move(n,this.editingComp,F.normalizeScale(i),F.normalizeDegree(e)),this.mover.moved=!0,this.editorComp.detectChange()}addDraggingListener(){this.removeDraggingListener(),this.draggingEventRemover=this.renderer.listen(this.domEl,"mousemove",n=>this.performMove(n))}pendPanningListener(n){if(n.stopPropagation(),n.preventDefault(),!this.pendedPanningEvt){this.pendedPanningEvt={clientX:n.changedTouches[0].clientX,clientY:n.changedTouches[0].clientY};return}let i=this.pendedPanningEvt,e=n.changedTouches[0];Math.pow(e.clientX-i.clientX,2)+Math.pow(e.clientY-i.clientY,2)<30||(this.removePanningListener(),this.panningEventRemover=this.renderer.listen(this.domEl,"touchmove",t=>this.performMove(this.touchToMouse(t))))}addPanningListener(){this.removePanningListener(),this.pendedPanningEvt=null,this.panningEventRemover=this.renderer.listen(this.domEl,"touchmove",n=>this.pendPanningListener(n))}removeDraggingListener(){T.isDefined(this.draggingEventRemover)&&this.draggingEventRemover(),this.draggingEventRemover=null}removePanningListener(){T.isDefined(this.panningEventRemover)&&this.panningEventRemover(),this.panningEventRemover=null}},bo=class{editorComp;annotTree;comps=null;evt=null;page;constructor(n){this.editorComp=n}destroy(){this.clearTree(),ve.destroy(this)}build(n){n&&(this.page=n,this.annotTree=new wn(this.editorComp.pdfPage),this.editorComp.comps!==void 0&&this.editorComp.comps.forEach(i=>this.addTree(i)))}findNextAnnotComp(n,i){let e=!this.evt||!this.comps||this.evt.offsetX!==n.offsetX||this.evt.offsetY!==n.offsetY?this.search(n):this.comps;if(this.evt=n,i!==ye.SELECT_ANNOT&&e.filter&&(e=e.filter(u=>u.data.type!=="Widget"&&u.data.type!=="Link")),!e.length)return null;let t={x:n.offsetX,y:this.page.bbox.h-n.offsetY},o=this.editorComp.annotSelectedService.selectedComponents[this.editorComp.annotSelectedService.selectedComponents.length-1],s=e.findIndex(u=>u===o);if(s!==-1&&o instanceof Bi)if(o.isTextFocus)o.textView.nativeElement.blur(),o.isTextFocus=!1;else return o.textView.nativeElement.focus(),o.isTextFocus=!0,o;this.comps=s<0?e:e.splice(s+1).concat(e);let c=this.comps.shift();if(!T.isDefined(c))throw new Nt("Result component is not defined");return this.comps.push(c),c.isTouched&&!c.isTouched(t)?null:(!n.ctrlKey&&!n.metaKey&&!this.editorComp.annotSelectedService.selectedComponents.includes(c)&&(this.editorComp.annotSelectedService.selectedComponents.splice(0),this.editorComp.annotSelectedService.add(c),this.editorComp.annotSelectedService.trigger=n.type,this.editorComp.select.emit(this.editorComp.annotSelectedService.getSelectedInfo())),c)}rebuild(n,i){this.annotTree?.remove(n,i),this.annotTree?.insert(i.data.attributes.rect,i),this.reset()}search(n){return this.annotTree?.searchByPoint(n)??[]}addTree(n){this.annotTree?.insert(n.data.attributes.rect,n)}clearTree(){this.annotTree&&this.annotTree.clear()}reset(){this.evt=null,this.comps=null}};var Io=class{annot;selector;constructor(n,i,e,t){this.annot=n,this.selector=new en({offsetX:i.x+3,offsetY:i.y+3},t,!1,!1),this.selector.renderer=new Gn(this.selector,n,!0),this.selector.select({offsetX:e.x-3,offsetY:e.y-3})}select(n,i){this.selector.select(n,!1,i),this.selector.render(),U.fitTextMarkupBox(this.annot)}updatePoint(n,i){this.selector.select({offsetX:n.x+3,offsetY:n.y+3},!1,"start"),this.selector.select({offsetX:i.x-3,offsetY:i.y-3},!1,"end")}};ee([Ae(J.textMarkUpEditor.select,1e3)],Io.prototype,"select",null);var R_=["containerEl"];function P_(r,n){if(r&1&&(ne(),I(0,"rect",10)),r&2){let i=d(2).$implicit,e=d();p("ngStyle",e.style.bbox),G("x",e.getBbox(i.data).x)("y",e.getBbox(i.data).y)("rx",e.getEditBoxRadius(i.data))("ry",e.getEditBoxRadius(i.data))("width",e.getBbox(i.data).w)("height",e.getBbox(i.data).h)("stroke-width",e.strokeWidth)}}function N_(r,n){if(r&1){let i=w();ne(),h(0,"rect",11,1),O("mousemove",function(){let t=f(i).index,o=we(1),s=d(2).$implicit,c=d();return g(c.ChangeCursorStyle(o,t,s.data))})("mousedown",function(t){let o=f(i).index,s=d(2).$implicit,c=d();return g(c.createMover(s,t,o))})("touchstart",function(t){let o=f(i).index,s=d(2).$implicit,c=d();return g(c.createMover(s,t,o))}),_()}if(r&2){let i=n.$implicit,e=n.index,t=d(2).$implicit,o=d();qe("cursor",o.cursorStyle(e,t.data)),p("ngStyle",o.vertex.styles),G("x",i.x)("y",i.y)("rx",o.vertex.styles.width/2)("ry",o.vertex.styles.height/2)("width",o.vertex.styles.width)("height",o.vertex.styles.height)("stroke-width",o.strokeWidth)}}function M_(r,n){if(r&1){let i=w();ne(),h(0,"g",7),O("mousedown",function(t){f(i);let o=d().$implicit,s=d();return g(s.createMover(o,t))})("touchstart",function(t){f(i);let o=d().$implicit,s=d();return g(s.createMover(o,t))}),R(1,P_,1,8,"rect",8)(2,N_,2,10,"rect",9),_()}if(r&2){let i=d().$implicit,e=d();G("transform",e.getTransform()),l(),p("ngIf",e.getBbox(i.data).w&&e.getBbox(i.data).h),l(),p("ngForOf",e.getVertexCoords(i.data))}}function D_(r,n){if(r&1&&(ne(),I(0,"path")),r&2){let i=d(2).$implicit,e=d();G("d",e.mergedQuadPointsPath[i.data.oid])("stroke-width",e.strokeWidth)("fill","transparent")}}function w_(r,n){if(r&1&&(ne(),h(0,"g"),R(1,D_,1,3,"path",6),_()),r&2){let i=d().$implicit,e=d();l(),p("ngIf",e.mergedQuadPointsPath[i.data.oid])}}function L_(r,n){if(r&1&&(ne(),h(0,"g"),I(1,"ellipse")(2,"ellipse"),_()),r&2){let i=d(2);l(),G("cx",i.textMarkupStartPoint.x)("cy",i.textMarkupStartPoint.y)("rx",i.textMarkupHandleRadius)("ry",i.textMarkupHandleRadius)("stroke-width",i.strokeWidth),l(),G("cx",i.textMarkupEndPoint.x)("cy",i.textMarkupEndPoint.y)("rx",i.textMarkupHandleRadius)("ry",i.textMarkupHandleRadius)("stroke-width",i.strokeWidth)}}function k_(r,n){if(r&1&&(ne(),h(0,"g"),R(1,M_,3,3,"g",5)(2,w_,2,1,"g",6)(3,L_,3,10,"g",6),_()),r&2){let i=n.$implicit,e=d();l(),p("ngIf",e.isEditableAnnot(i.data)&&e.canBeEdited(i.data)),l(),p("ngIf",!e.isEditableAnnot(i.data)&&e.documentService.checkAuthority(e.DocumentAction.EDIT_ANNOTATION)),l(),p("ngIf",e.editor&&e.textMarkupStartPoint&&e.textMarkupEndPoint)}}function F_(r,n){if(r&1&&I(0,"sd-edit-menu",12),r&2){let i=d();p("scale",i.scale)("degree",i.degree)("page",i.pdfPage)("bbox",i.mergedBbox)("acroFields",i.acroFields)}}var Gi=function(r){return r[r.OFF=0]="OFF",r[r.START_POINT_EDIT=1]="START_POINT_EDIT",r[r.END_POINT_EDIT=2]="END_POINT_EDIT",r}(Gi||{}),oa=(()=>{let n=class n{annotService;contentService;renderer;changeDetectorRef;annotSelectedService;documentService;subscriptionService;shortcutService;acroFormService;unitPipe;translatePipe;store$;textService;loggingService;get DocumentAction(){return Be}get MergedRuntimeEnvKey(){return B}get runtimeEnv(){return K}get isEditable(){return!this.hasSignedSignature||this.documentService.checkAuthority(Be.EDIT_ANNOTATION)}pdfPage;comps;acroFields;postEdit=new Ke;edit=new Ke;select=new Ke;containerElementRef;scale;degree;dragMode;textAnnotStrokeWidth=2;strokeWidth=2;textMarkupHandleRadius=zt/2;vertex={size:zt,styles:{width:zt,height:zt},coords:{}};bbox={};style={bbox:{},layout:{width:null,height:null}};editorTransform={transform:null};mergedBbox;moverService;menuVisibility=!1;renderedAndSelectedComponents=[];mergedQuadPointsPath={};charTree;data=[];editor;textMarkupStartPoint;textMarkupEndPoint;textMarkupEditingStatus=Gi.OFF;hasSignedSignature=!1;selector;rulerActive=!1;annotEl=null;constructor(e,t,o,s,c,u,C,x,N,D,X,Q,ft,di){this.annotService=e,this.contentService=t,this.renderer=o,this.changeDetectorRef=s,this.annotSelectedService=c,this.documentService=u,this.subscriptionService=C,this.shortcutService=x,this.acroFormService=N,this.unitPipe=D,this.translatePipe=X,this.store$=Q,this.textService=ft,this.loggingService=di,this.renderedAndSelectedComponents=this.annotSelectedService.selectedComponents}ngAfterViewInit(){this.moverService=new cs(this.containerElementRef.nativeElement,this,this.renderer,this.pdfPage),this.moverService.isPointerDown=!0}ngOnChanges(e){e.pdfPage&&(this.style.layout.width=String(this.pdfPage.bbox.w+this.pdfPage.bbox.x),this.style.layout.height=String(this.pdfPage.bbox.h+this.pdfPage.bbox.y),e.pdfPage.isFirstChange()||this.detectChange()),this.selector||(this.selector=new bo(this)),e.pdfPage&&this.selector.build(e.pdfPage.currentValue),e.trigger?.isFirstChange()&&this.annotSelectedService.trigger===U.AnnotViewEvt.type&&(this.annotSelectedService.isFirstSelection=!1),e.renderComp&&!e.renderComp.isFirstChange()&&(this.moverService.finalizeMover(),this.ngAfterViewInit(),this.detectChange()),this.determineCursor()}ngOnInit(){if(this.annotEl=this.containerElementRef.nativeElement.closest("sd-annot"),this.renderedAndSelectedComponents.some(e=>!this.canBeEdited(e.data))){this.close();return}this.renderedAndSelectedComponents.length===1&&A.isTextMarkup(this.renderedAndSelectedComponents[0].data)&&this.fetchTextData(this.renderedAndSelectedComponents[0].data),this.subscriptionService.push(this.acroFormService.hasSignedSignature$.subscribe({next:e=>this.hasSignedSignature=e}),this.store$.pipe(_e("scale")).subscribe({next:e=>{this.scale=e,this.detectChange()}}),this.store$.pipe(_e("degree")).subscribe({next:e=>{this.degree=e,this.detectChange()}}),this.store$.pipe(_e("dragMode")).subscribe({next:e=>this.dragMode=e}),this.store$.pipe(_e("rulerActive")).subscribe({next:e=>this.rulerActive=e}),this.contentService.annotEvent$.pipe(L(T.isDefined),L(e=>e.from==="AnnotService"||e.from==="FreeTextComponent")).subscribe({next:e=>{if(e.annot){let t=this.renderedAndSelectedComponents.findIndex(o=>o.data.oid===e.annot.oid);if(t>-1){let o=this.renderedAndSelectedComponents[t];this.contentService.publishPostAnnotEdit({annotOid:o.data.oid}),this.selector.destroy(),this.selector=new bo(this),this.selector.build(this.pdfPage)}}this.detectChange()}}),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>{if(this.renderedAndSelectedComponents=this.annotSelectedService.selectedComponents,this.renderedAndSelectedComponents.some(e=>e.data.oid===null)){this.close();return}this.subscriptionService.get("textDataFetchSubscription")?.unsubscribe(),this.renderedAndSelectedComponents.length===1&&A.isTextMarkup(this.renderedAndSelectedComponents[0].data)&&this.fetchTextData(this.renderedAndSelectedComponents[0].data),this.detectChange()}}),Xt(this.shortcutService.getShortcutEvent(qt.MOVE_TOP),this.shortcutService.getShortcutEvent(qt.MOVE_BOTTOM),this.shortcutService.getShortcutEvent(qt.MOVE_RIGHT),this.shortcutService.getShortcutEvent(qt.MOVE_LEFT),this.shortcutService.getShortcutEvent(qt.MOVE_MORE_TOP),this.shortcutService.getShortcutEvent(qt.MOVE_MORE_BOTTOM),this.shortcutService.getShortcutEvent(qt.MOVE_MORE_RIGHT),this.shortcutService.getShortcutEvent(qt.MOVE_MORE_LEFT)).pipe(L(e=>this.renderedAndSelectedComponents.length>0&&e.target instanceof Element&&e.target.tagName!=="INPUT"&&e.target.tagName!=="TEXTAREA"),L(()=>this.renderedAndSelectedComponents.every(e=>!this.isLockedAnnot(e.data)&&(A.isWidget(e.data)||A.isMovableAnnot(e.data))))).subscribe({next:e=>{if(this.renderedAndSelectedComponents.length===1&&A.isFreeText(this.renderedAndSelectedComponents[0].data)&&this.dragMode===ye.SELECT_TEXT)return;e.preventDefault();let t=this.renderedAndSelectedComponents.filter(s=>A.isMovableAnnot(s.data)),o=this.renderedAndSelectedComponents.map(s=>s.data).filter(A.isWidget);this.shortcutMoveAnnots(e,t,o)}}),Xt(Ge(this.containerElementRef.nativeElement,"mouseenter"),Ge(this.containerElementRef.nativeElement,"mousemove"),Ge(this.containerElementRef.nativeElement,"mouseleave")).pipe(Bt((e,t)=>e.offsetX===t.offsetX&&e.offsetY===t.offsetY),St(e=>e.type==="mouseleave"?[]:this.selector.search(e)),St(e=>e.find(t=>t.data.type==="Widget")?.elementRef?.nativeElement),Yo(void 0),$o(),L(([e,t])=>e!==t)).subscribe({next:([e,t])=>{e&&this.removeHover(e),t&&this.addHover(t)}})),this.determineMenuVisibility(),F.bindLayoutOrder(this.style.layout,F.LayoutOrder.AnnotCreate)}ngOnDestroy(){this.removeAllHover(),this.moverService.finalizeMover(),this.selector.destroy(),ve.destroy(this)}getBbox(e){if(!e||!e.oid)throw new $e(`Invalid Annotation. ${e}`);return this.bbox[e.oid]?this.bbox[e.oid]:this.bbox[e.oid]={x:0,y:0,w:0,h:0}}getVertexCoords(e){if(!e||!e.oid)throw new $e(`Invalid Annotation. ${e}`);return this.vertex.coords[e.oid]||(this.vertex.coords[e.oid]=[]),this.vertex.coords[e.oid]}renderMergedBbox(){let e=1/0,t=0,o=1/0,s=0;this.renderedAndSelectedComponents.forEach(c=>{let u=this.getBbox(c.data);u.x<e&&(e=u.x),u.x+u.w>t&&(t=u.x+u.w),u.y<o&&(o=u.y),u.y+u.h>s&&(s=u.y+u.h)}),this.mergedBbox={x:e,y:o,w:t-e,h:s-o}}isEditableAnnot(e){return A.isEditableAnnot(e)&&!e.attributes.quadPoints}isTextAnnot(e){return A.isText(e)}canBeEdited(e){return A.isRedact(e)?this.documentService.checkAuthority(Be.EDIT_REDACTION):A.isWidget(e)&&!this.isEditable||A.isSignedSignature2(e)?!1:this.documentService.checkAuthority(Be.EDIT_ANNOTATION)}allCanBeEdited(){return this.renderedAndSelectedComponents.every(e=>this.canBeEdited(e.data))}cursorStyle(e,t){let o=(this.pdfPage.r+this.degree+360)%360;return U.resizeCursorOf(A.isSizeableAnnot(t),e,o)}detectChange(){this.determineMenuVisibility(),this.applyScale(),this.render(),this.changeDetectorRef.markForCheck()}renderBbox(e,t){if(!e)return;let o=e.data,s=t||o.attributes.rect,c=this.getBbox(o);c.x=Math.min(s.left,s.right),c.y=this.pdfPage.bbox.h+this.pdfPage.bbox.y-Math.max(s.top,s.bottom),c.w=Math.abs(s.right-s.left),c.h=Math.abs(s.top-s.bottom),this.isTextAnnot(o)&&(c.x-=this.textAnnotStrokeWidth,c.y-=this.textAnnotStrokeWidth,c.w=25,c.h+=this.textAnnotStrokeWidth*2),this.style.bbox.fill="rgba(var(--primary-50-rgb), 0.08)",e instanceof Bi&&e.isTextFocus&&(this.style.bbox.fill="transparent"),this.bbox[o.oid]=c}touchToMouse(e){return T.touchToMouseEvt(e,this.degree,this.scale,this.pdfPage,this.containerElementRef.nativeElement)}onMousedown(e){this.moverService.isPointerDown=!0,e.stopPropagation(),!(!this.textMarkupStartPoint||!this.textMarkupEndPoint)&&(this.textMarkupStartPoint.x-zt*1.5<e.offsetX&&e.offsetX<this.textMarkupStartPoint.x+zt*1.5&&this.textMarkupStartPoint.y-zt*1.5<e.offsetY&&e.offsetY<this.textMarkupStartPoint.y+zt*1.5&&(this.textMarkupEditingStatus=Gi.START_POINT_EDIT),this.textMarkupEndPoint.x-zt*1.5<e.offsetX&&e.offsetX<this.textMarkupEndPoint.x+zt*1.5&&this.textMarkupEndPoint.y-zt*1.5<e.offsetY&&e.offsetY<this.textMarkupEndPoint.y+zt*1.5&&(this.textMarkupEditingStatus=Gi.END_POINT_EDIT),this.determineMenuVisibility())}onMousemove(e){if(e.stopPropagation(),this.textMarkupEditingStatus===Gi.OFF){this.comps.some(t=>{let o=t.data.attributes.rect,s=this.pdfPage.bbox,c={x:s.x+e.offsetX,y:s.y+s.h-e.offsetY};if(t.isTouched&&t.isTouched(c)||["FreeText","Stamp","Text","Link"].includes(t.data.type)&&xt.isPointInRect(o,c))return this.containerElementRef.nativeElement.style.cursor="pointer",!0;if(this.dragMode===ye.SELECT_ANNOT&&t.acroField?.FT&&["Rb","Btn","Tx"].includes(t.acroField.FT)&&xt.isPointInRect(o,c))return this.containerElementRef.nativeElement.style.cursor="default",!0;if(this.dragMode===ye.SELECT_TEXT||this.dragMode===ye.MOVE){if(t.acroField?.FT&&["Cb","Rb","Btn"].includes(t.acroField.FT)&&xt.isPointInRect(o,c))return this.containerElementRef.nativeElement.style.cursor="pointer",!0;if(t.acroField?.FT&&["Tx"].includes(t.acroField.FT)&&xt.isPointInRect(o,c))return this.containerElementRef.nativeElement.style.cursor="text",!0}return this.containerElementRef.nativeElement.style.cursor="inherit",!1});return}e.preventDefault(),this.editor?.select(e,this.textMarkupEditingStatus===Gi.START_POINT_EDIT?"start":"end"),this.render(),this.contentService.fireAnnotEvent({annot:this.annotSelectedService.selectedComponents[0].data,pageIdx:this.pdfPage.i,sdEventType:fe.UPDATE}),this.changeDetectorRef.markForCheck()}onSelect(e){if(!this.moverService.isPointerDown){this.finishMove(e);return}let t=this.finishMove(e);if(this.textMarkupEditingStatus!==Gi.OFF){this.textMarkupEditingStatus=Gi.OFF,this.determineMenuVisibility(),this.editor&&this.editor.updatePoint(this.textMarkupStartPoint,this.textMarkupEndPoint);return}t||this.selectNormal(e)}createMover(e,t,o){A.isWidget(e.data)&&o===void 0&&!K.get(a.FORM_MOVE)||!A.isWidget(e.data)&&o===void 0&&!K.get(a.MOVE_ANNOTATION)||A.isWidget(e.data)&&o!==void 0&&!K.get(a.FORM_RESIZE)||!A.isWidget(e.data)&&o!==void 0&&!K.get(a.RESIZE_ANNOTATION)||this.renderedAndSelectedComponents.some(s=>st.get(s.data.attributes.F??-1,7)||A.isTextMarkup(s.data))||(U.shouldRemoveAppearance(e.data)&&(e.data.attributes.appearance=void 0),this.moverService.createMover(e,t,o),this.detectChange())}finishMove(e){this.moverService.isPointerDown&&(this.moverService.isPointerDown=!1);let t=this.moverService.finalizeMover(e);if(!t||!t.moved)return!1;let o=t.postMove(...this.renderedAndSelectedComponents);return this.postEdit.emit({isValid:o}),this.renderedAndSelectedComponents.forEach(s=>{this.contentService.publishPostAnnotEdit({annotOid:s.data.oid}),this.selector.rebuild(t.getSrcRect(s.data),s)}),this.detectChange(),t.moved}getTransform(){return(this.editorTransform.transform||T.EMPTY_STRING).replace(",",T.EMPTY_STRING).replace(/px/g,T.EMPTY_STRING)}getEditBoxRadius(e){return A.isFreeText(e)||A.isInk(e)||A.isCircle(e)||A.isSquare(e)||A.isStamp(e)||A.isRedact(e)||A.isWidget(e)?"0":"5px"}ChangeCursorStyle(e,t,o){if(A.isWidget(o)&&!K.get(a.FORM_RESIZE)){e.style.cursor="not-allowed";return}if(!A.isWidget(o)&&!K.get(a.RESIZE_ANNOTATION)){e.style.cursor="not-allowed";return}e.style.cursor=this.cursorStyle(t,o)}removeHover(e){e.classList.remove("hover")}addHover(e){e.classList.contains("hover")||e.classList.add("hover")}removeAllHover(){if(!T.isDefined(this.annotEl)){this.loggingService.common("warn",le.NOT_EXIST,this.translatePipe.joinedTransform("ANNOTATION","ELEMENT"));return}this.annotEl.querySelectorAll("sd-widget.hover").forEach(e=>this.removeHover(e))}determineMenuVisibility(){this.menuVisibility=this.textMarkupEditingStatus===Gi.OFF&&(this.renderedAndSelectedComponents.every(e=>!this.isTextAnnot(e.data))||this.dragMode===ye.SELECT_ANNOT||this.dragMode===ye.AUTO)}applyScale(){this.vertex.size=Number((zt*100/this.scale).toFixed(1)),this.vertex.styles.height=this.vertex.size,this.vertex.styles.width=this.vertex.styles.height,this.strokeWidth=Number((2*100/this.scale).toFixed(1)),this.textMarkupHandleRadius=Number((zt/2*100/this.scale).toFixed(1))}render(){this.renderedAndSelectedComponents.forEach(e=>{this.moverService?this.moverService.renderBbox(e):this.renderBbox(e),this.isEditableAnnot(e.data)?this.renderPoints(e):this.renderMergedQuadPoints(e.data)}),this.renderMergedBbox()}renderMergedQuadPoints(e){this.mergedQuadPointsPath[e.oid]="";let c=[],u=e.attributes.quadPoints;u?.forEach((x,N)=>{let D=Math.min(x[0].x,x[1].x,x[2].x,x[3].x),X=Math.max(x[0].x,x[1].x,x[2].x,x[3].x),Q=this.pdfPage.bbox.h+this.pdfPage.bbox.y-Math.max(x[0].y,x[1].y,x[2].y,x[3].y),ft=this.pdfPage.bbox.h+this.pdfPage.bbox.y-Math.min(x[0].y,x[1].y,x[2].y,x[3].y);D===X||Q===ft||(N===0&&(this.textMarkupStartPoint={x:D,y:Q}),T.isDefined(u)&&N===u.length-1&&(this.textMarkupEndPoint={x:X,y:ft}),c.push({left:D,right:X,top:Q,bottom:ft}))}),c.sort((x,N)=>x.left-N.left);let C=[];for(;c.length!==0;){let x=c.shift(),N=[];if(x===void 0)throw new oi("Unexpected undefined criteriaRect.");for(let D=0;D<c.length;++D)(Math.abs(c[D].top-x.top)<3||Math.abs(c[D].bottom-x.bottom)<3)&&(c[D].left-x.right<8&&c[D].right>x.left||x.left-c[D].right<8&&c[D].left<x.right)&&(N.unshift(D),x.left=Math.min(x.left,c[D].left),x.right=Math.max(x.right,c[D].right),x.top=Math.min(x.top,c[D].top),x.bottom=Math.max(x.bottom,c[D].bottom));N.forEach(D=>c.splice(D,1)),C.push(x)}for(C.sort((x,N)=>x.top-N.top);C.length!==0;){let x=C.shift();if(x===void 0)throw new oi("Unexpected undefined criteriaRect.");let N=[],D=[{x:x.left,y:x.top},{x:x.left,y:x.bottom}],X=[{x:x.right,y:x.top},{x:x.right,y:x.bottom}];for(let Q=0;Q<C.length;++Q)Math.abs(C[Q].top-x.bottom)<8&&C[Q].left<x.right&&x.left<C[Q].right&&(N.unshift(Q),C[Q].left<x.left?(D[D.length-1].y=C[Q].top,D.push({x:C[Q].left,y:C[Q].top})):D.push({x:C[Q].left,y:D[D.length-1].y}),D.push({x:C[Q].left,y:C[Q].bottom}),C[Q].right<x.right?X.push({x:C[Q].right,y:X[X.length-1].y}):(X[X.length-1].y=C[Q].top,X.push({x:C[Q].right,y:C[Q].top})),X.push({x:C[Q].right,y:C[Q].bottom}),x=C[Q]);N.forEach(Q=>C.splice(Q,1)),this.mergedQuadPointsPath[e.oid]+=`M ${D[0].x} ${D[0].y} `,X.forEach(Q=>this.mergedQuadPointsPath[e.oid]+=`L ${Q.x} ${Q.y} `),D.reverse().forEach(Q=>this.mergedQuadPointsPath[e.oid]+=`L ${Q.x} ${Q.y} `),this.mergedQuadPointsPath[e.oid]+="Z"}}renderPoints(e){if(st.get(e.data.attributes.F??-1,7)||this.renderedAndSelectedComponents.length>1||A.isSignatureWidget(e.data,this.acroFields)&&U.hasAppearance(e.data.attributes.appearance)||!K.get(a.RESIZE_ANNOTATION)){this.getVertexCoords(e.data).splice(0);return}if(!e.verticesOf){this.loggingService.common("warn",le.NOT_EXIST,"verticesOf");return}let t=e.verticesOf(this.pdfPage,this.getBbox(e.data),this.vertex.size),o=this.getVertexCoords(e.data);o.splice(t.length),t.forEach((s,c)=>{o[c]?Object.keys(s).forEach(u=>o[c][u]=s[u]):o[c]=s})}selectNormal(e){if(this.annotSelectedService.isFirstSelection){this.annotSelectedService.isFirstSelection=!1;return}e.preventDefault();let t=this.selector.findNextAnnotComp(e,this.dragMode);if(t){A.isText(t.data)&&this.dragMode!==ye.SELECT_ANNOT&&this.dragMode!==ye.AUTO&&this.annotService.togglePopup(t.data);let o=this.renderedAndSelectedComponents.indexOf(t);o===-1?this.annotSelectedService.add(t):(e.ctrlKey===!0||e.metaKey===!0)&&this.renderedAndSelectedComponents.length>1&&this.renderedAndSelectedComponents.splice(o,1),this.determineCursor()}else{this.annotSelectedService.isFirstSelection=!0,this.select.emit(null);return}this.annotSelectedService.dispatchSelectionInfoChange(),this.detectChange()}determineCursor(){if(this.renderedAndSelectedComponents.some(e=>A.isWidget(e.data))&&!K.get(a.FORM_MOVE)){this.style.bbox.cursor="not-allowed";return}if(this.renderedAndSelectedComponents.some(e=>!A.isWidget(e.data))&&!K.get(a.MOVE_ANNOTATION)){this.style.bbox.cursor="not-allowed";return}this.style.bbox.cursor=this.renderedAndSelectedComponents.some(e=>st.get(e.data.attributes.F??-1,7))?"pointer":"move"}close(){this.annotService.closeEditor()}fetchTextData(e){if(!T.isDefined(this.documentService.openedDocument)){this.loggingService.common("warn",le.NOT_EXIST,this.translatePipe.joinedTransform("DOCUMENT","OBJECT"));return}this.subscriptionService.set("textDataFetchSubscription",this.textService.fetchPdfPageText(this.documentService.openedDocument.streamdocsId,this.pdfPage.ref).subscribe({next:t=>{this.data=t,this.charTree=Jo.buildTextBoxTree(t,this.pdfPage),this.initSelector(e)}}))}initSelector(e){if(!this.textMarkupStartPoint||!this.textMarkupEndPoint){let t=e.attributes.quadPoints,o=t[0],s=t[t.length-1];this.textMarkupStartPoint={x:Math.min(o[0].x,o[1].x,o[2].x,o[3].x),y:this.pdfPage.bbox.h+this.pdfPage.bbox.y-Math.max(o[0].y,o[1].y,o[2].y,o[3].y)},this.textMarkupEndPoint={x:Math.max(s[0].x,s[1].x,s[2].x,s[3].x),y:this.pdfPage.bbox.h+this.pdfPage.bbox.y-Math.min(s[0].y,s[1].y,s[2].y,s[3].y)}}this.editor=new Io(e,this.textMarkupStartPoint,this.textMarkupEndPoint,this)}isLockedAnnot(e){return st.get(e.attributes.F??-1,7)}shortcutMoveAnnots(e,t,o){let s=this.unitPipe.isRegionUS()?q.INCH:q.MILLIMETER,c=this.unitPipe.isRegionUS()?Fe.shortcutMoveAnnot.inch:Fe.shortcutMoveAnnot.milliMeter;e.shiftKey?(this.moveWidgets(o,Ye.convert(s,q.POINT,c*10),e.code),this.moveAnnots(t,Ye.convert(s,q.POINT,c*10),e.code)):(this.moveWidgets(o,Ye.convert(s,q.POINT,c),e.code),this.moveAnnots(t,Ye.convert(s,q.POINT,c),e.code))}moveAnnots(e,t,o){e.forEach(s=>{let c=s.data.attributes.rect,u=c.left,C=c.bottom;switch(o){case"ArrowUp":C+=t;break;case"ArrowDown":C-=t;break;case"ArrowLeft":u-=t;break;case"ArrowRight":u+=t;break;default:return}this.annotService.moveAnnotRectAbsolutely(s,u,C,this.pdfPage.i),this.changeDetectorRef.detectChanges(),this.annotService.dispatchModify(s.data)})}moveWidgets(e,t,o){e.forEach(s=>{let c=s.attributes.rect;switch(o){case"ArrowUp":c.top+=t,c.bottom+=t;break;case"ArrowDown":c.top-=t,c.bottom-=t;break;case"ArrowLeft":c.left-=t,c.right-=t;break;case"ArrowRight":c.left+=t,c.right+=t;break;default:return}this.validateMovePosition(c),this.render(),this.contentService.fireAnnotEvent({annot:s,sdEventType:fe.UPDATE,pageIdx:this.pdfPage.i})}),this.changeDetectorRef.detectChanges()}validateMovePosition(e){let t=this.pdfPage.bbox,o=e.top-e.bottom,s=e.right-e.left;e.left<0?(e.left=0,e.right=s):e.right>t.w-t.x?(e.left=t.w-t.x-s,e.right=t.w-t.x):e.bottom<0?(e.bottom=0,e.top=o):e.top>t.h-t.y&&(e.bottom=t.h-t.y-o,e.top=t.h-t.y)}};v(n,"\u0275fac",function(t){return new(t||n)(m(Re),m(ge),m(Qt),m(Y),m(kt),m(It),m(P),m(Un),m(Lt),m(Ji),m(oe),m(xe),m(Lr),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-annot-edit"]],viewQuery:function(t,o){if(t&1&&se(R_,7),t&2){let s;ae(s=ce())&&(o.containerElementRef=s.first)}},inputs:{pdfPage:"pdfPage",comps:"comps",acroFields:"acroFields"},outputs:{postEdit:"postEdit",edit:"edit",select:"select"},standalone:!1,features:[$([P]),Ie],decls:4,vars:3,consts:[["containerEl",""],["vertexElement",""],[3,"click","mousedown","mousemove","touchstart","touchmove","mouseup","touchend","mouseleave","pointerdown","pointermove","pointerup","ngStyle"],[4,"ngFor","ngForOf"],[3,"scale","degree","page","bbox","acroFields",4,"ngIf"],[3,"mousedown","touchstart",4,"ngIf"],[4,"ngIf"],[3,"mousedown","touchstart"],["class","bbox",3,"ngStyle",4,"ngIf"],["class","vertex",3,"cursor","ngStyle","mousemove","mousedown","touchstart",4,"ngFor","ngForOf"],[1,"bbox",3,"ngStyle"],[1,"vertex",3,"mousemove","mousedown","touchstart","ngStyle"],[3,"scale","degree","page","bbox","acroFields"]],template:function(t,o){if(t&1){let s=w();ne(),h(0,"svg",2,0),O("click",function(u){return f(s),g(u.stopPropagation())})("mousedown",function(u){return f(s),g(o.onMousedown(u))})("mousemove",function(u){return f(s),g(o.onMousemove(u))})("touchstart",function(u){return f(s),g(o.onMousedown(o.touchToMouse(u)))})("touchmove",function(u){return f(s),g(o.onMousemove(o.touchToMouse(u)))})("mouseup",function(u){return f(s),g(o.onSelect(u))})("touchend",function(u){return f(s),g(o.onSelect(o.touchToMouse(u)))})("mouseleave",function(u){return f(s),g(o.finishMove(u))})("pointerdown",function(u){return f(s),g(u.stopPropagation())})("pointermove",function(u){return f(s),g(u.stopPropagation())})("pointerup",function(u){return f(s),g(u.stopPropagation())}),R(2,k_,4,3,"g",3),_(),R(3,F_,1,5,"sd-edit-menu",4)}t&2&&(p("ngStyle",o.style.layout),l(2),p("ngForOf",o.renderedAndSelectedComponents),l(),p("ngIf",o.runtimeEnv.get(o.MergedRuntimeEnvKey.ANNOTATION_FLOATING_MENU)&&(!o.moverService||!o.moverService.isMoving)&&o.mergedBbox&&o.menuVisibility&&o.allCanBeEdited()))},styles:["svg[_ngcontent-%COMP%]{position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none;width:100%;height:100%;cursor:default}rect.bbox[_ngcontent-%COMP%]{fill:rgba(var(--primary-50-rgb),.08);stroke:var(--primary-50);cursor:move}rect.vertex[_ngcontent-%COMP%]{fill:#fff;stroke:var(--primary-50);-webkit-user-select:none;user-select:none;font-size:12px}path[_ngcontent-%COMP%], ellipse[_ngcontent-%COMP%]{stroke:var(--primary-50);pointer-events:none}ellipse[_ngcontent-%COMP%]{fill:#fff}"],changeDetection:0}));let r=n;return r})();var V_=["selEl"],U_=["selPathEl"],B_=["indEl"],G_=["startIndicator"],W_=["endIndicator"];function z_(r,n){if(r&1&&(ne(),I(0,"rect",13)),r&2){let i=d().$implicit,e=d(2);G("x",i.searchBox.x)("y",e.pdfPage.bbox.h-i.searchBox.y-i.searchBox.h)("width",i.searchBox.w)("height",i.searchBox.h)}}function H_(r,n){if(r&1&&(ne(),I(0,"rect",14)),r&2){let i=d().$implicit,e=d(2);G("x",i.points.start.x-5)("y",e.pdfPage.bbox.h-i.points.start.y-5)}}function j_(r,n){if(r&1&&(ne(),I(0,"rect",14)),r&2){let i=d().$implicit,e=d(2);G("x",i.points.end.x-5)("y",e.pdfPage.bbox.h-i.points.end.y-5)}}function $_(r,n){if(r&1&&(ne(),Te(0),R(1,z_,1,4,"rect",11)(2,H_,1,2,"rect",12)(3,j_,1,2,"rect",12),Ee()),r&2){let i=n.$implicit;l(),p("ngIf",i==null?null:i.searchBox),l(),p("ngIf",i==null?null:i.points),l(),p("ngIf",i==null?null:i.points)}}function Y_(r,n){if(r&1&&(ne(),h(0,"svg",10),R(1,$_,4,3,"ng-container",6),_()),r&2){let i=d();l(),p("ngForOf",i.selectors)}}function X_(r,n){if(r&1&&I(0,"div",16,2),r&2){let i=d().$implicit,e=d();W("debug",e.debug),p("ngStyle",i.indStyle)}}function K_(r,n){if(r&1&&(Te(0),R(1,X_,2,3,"div",15),Ee()),r&2){let i=n.$implicit;l(),p("ngIf",i==null?null:i.indStyle)}}function Q_(r,n){if(r&1){let i=w();ne(),h(0,"svg",17,3),O("click",function(t){return f(i),g(t.stopPropagation())})("mousemove",function(t){f(i);let o=d();return g(o.onMousemove(t))}),I(2,"path",null,4),_()}if(r&2){let i=d();p("ngStyle",i.stStyles),G("aria-label",i.svgAriaLabel)("width",i.width)("height",i.height)}}var Jl=(()=>{let n=class n{changeDetectorRef;renderer;contentService;sdContextMenuService;selectTextService;accessibilityService;subscriptionService;store$;textService;translatePipe;debug=!1;pdfPage;documentId;status;annot;isScreenReaderActive;textFetched=new Ke;selectedElementRef;selectedPathElementRef;indicatorElementRef;startIndicatorElementRef;endIndicatorElementRef;data=[];scale;degree;width;height;charTree;stStyles={};gestureSelectors=[];pageScript="";pageAriaLabels=[];get selectors(){return this.gestureSelectors.map(e=>e.selector).filter(T.isDefined)}get indicatorStyle(){return{display:this.selectors.some(e=>e?.textBox)?"inline":"none"}}get svgAriaLabel(){return this.pageAriaLabels[this.pdfPage.i]?this.pageAriaLabels[this.pdfPage.i]:this.isScreenReaderActive&&this.pageScript.trim().length===0?this.translatePipe.transform("NO_CONTENT"):`${this.pdfPage.i+1} ${this.translatePipe.transform("PAGE")}`}constructor(e,t,o,s,c,u,C,x,N,D){this.changeDetectorRef=e,this.renderer=t,this.contentService=o,this.sdContextMenuService=s,this.selectTextService=c,this.accessibilityService=u,this.subscriptionService=C,this.store$=x,this.textService=N,this.translatePipe=D}ngOnChanges(e){if(this.delayFetch(),e.pdfPage){let{bbox:t}=this.pdfPage;this.width=t.w+t.x,this.height=t.h+t.y}}ngOnInit(){this.subscriptionService.push(this.selectTextService.publishSelectedText$.pipe(L(e=>!e)).subscribe({next:()=>this.clearGestureSelector(!0)}),this.selectTextService.publishFakeSelect$.pipe(L(e=>this.pdfPage.i===e.pageIdx)).subscribe({next:e=>{let t=C=>({x:C.left+(C.right-C.left)/2,y:this.pdfPage.bbox.h-(C.top-(C.top-C.bottom)/2)}),o=(C,x)=>new MouseEvent(C,{clientX:x.x,clientY:x.y}),s=e.words[0].rects.map(C=>t(C)).sort((C,x)=>Math.abs(C.y-x.y)>2?x.y-C.y:C.x-x.x),c=o("mousedown",s[0]),u=new en(c,this);s.forEach(C=>{let x=o("mousemove",C);u.select(x),u.render()}),this.selectTextService.publishSelectedText({comp:this,page:this.pdfPage,startEvt:c,finishEvt:o("mouseup",s[s.length-1]),text:u.text,textBox:u.textBox,model:null})}}),this.contentService.reload$.pipe(L(e=>Mr.typeAndPage(e,this.pdfPage.i,Nr.TextSelection))).subscribe({next:()=>this.delayFetch()}),Xt(this.store$.pipe(_e("scale")).pipe(je(e=>this.scale=e)),this.store$.pipe(_e("degree")).pipe(je(e=>this.degree=e))).pipe(Za(2)).subscribe({next:()=>this.selectTextService.publishSelectedText(null)}),this.accessibilityService.pageAriaLabel$.subscribe({next:e=>{this.pageAriaLabels=e,this.changeDetectorRef.markForCheck()}}),Xt(Ge(Ve.nativeWindow,"keydown"),Ge(Ve.nativeWindow,"keyup")).pipe(L(()=>!this.gestureSelectors.some(e=>e.isDragging)),L(e=>e.key==="Shift")).subscribe({next:e=>{e.type==="keydown"?F.bindLayoutOrder(this.stStyles,F.LayoutOrder.SelectText):e.type==="keyup"&&F.defaultLayoutOrder(this.stStyles),this.changeDetectorRef.markForCheck()}}))}ngOnDestroy(){this.destroySelector(),ve.destroy(this)}isAnnotCreate(){return this.status===Z.CREATE}markForCheck(){this.changeDetectorRef.markForCheck()}fetch(){this.subscriptionService.set("dataSub",this.textService.fetchPdfPageText(this.documentId,this.pdfPage.ref).subscribe({next:e=>{this.isScreenReaderActive&&this.extractPageScript(e);let t=Jo.buildTextBoxTree(e,this.pdfPage);this.render({data:e,charTree:t}),this.subscriptionService.push(ve.runAsync(()=>this.gestureSelectors.length===0&&this.buildSelector()))}}))}extractPageScript(e){e.forEach(t=>{this.pageScript+=t.text})}delayFetch(){this.subscriptionService.set("delayedFetchSub",Di(F.TaskPriority.TEXT).subscribe({next:()=>this.fetch()}))}destroySelector(){this.gestureSelectors.forEach(e=>e.destroy()),this.gestureSelectors.splice(0)}buildSelector(){!this.data||!this.data.length||this.gestureSelectors.push(...this.selectTextService.createGesture(this,this.isAnnotCreate()))}clearGestureSelector(e=!1){this.debug&&this.changeDetectorRef.markForCheck(),this.gestureSelectors.forEach(t=>t.clear(e))}render({data:e,charTree:t}){this.data=e,this.textFetched.emit(e),this.charTree=t,this.changeDetectorRef.markForCheck()}onMousemove(e){if(!xt.isEventInPage(e,this.pdfPage)){this.renderer.setStyle(this.selectedElementRef?.nativeElement,"cursor","default");return}this.renderer.setStyle(this.selectedElementRef?.nativeElement,"cursor","text")}publishIsTextHover(e){if(!this.charTree)return;let t=this.charTree.search(wn.createSearchArea(this.pdfPage.bbox,e));this.selectTextService.publishIsTextHover(t.length>0)}};v(n,"\u0275fac",function(t){return new(t||n)(m(Y),m(Qt),m(ge),m(ci),m(bi),m(Zc),m(P),m(xe),m(Lr),m(oe))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-select-text"]],viewQuery:function(t,o){if(t&1&&(se(V_,5),se(U_,5),se(B_,5),se(G_,5),se(W_,5)),t&2){let s;ae(s=ce())&&(o.selectedElementRef=s.first),ae(s=ce())&&(o.selectedPathElementRef=s.first),ae(s=ce())&&(o.indicatorElementRef=s.first),ae(s=ce())&&(o.startIndicatorElementRef=s.first),ae(s=ce())&&(o.endIndicatorElementRef=s.first)}},inputs:{pdfPage:"pdfPage",documentId:"documentId",status:"status",annot:"annot",isScreenReaderActive:"isScreenReaderActive"},outputs:{textFetched:"textFetched"},standalone:!1,features:[$([P]),Ie],decls:11,vars:13,consts:[["startIndicator",""],["endIndicator",""],["indEl",""],["selEl",""],["selPathEl",""],["class","debug",4,"ngIf"],[4,"ngFor","ngForOf"],["width","0","height","0","viewBox","0 0 24 30",1,"indicator",3,"ngStyle"],["stroke","#f79f1a","stroke-width","2","fill","white"],["id","sel-el",3,"ngStyle","click","mousemove",4,"ngIf"],[1,"debug"],["class","searchBox",4,"ngIf"],["class","points","width","10","height","10",4,"ngIf"],[1,"searchBox"],["width","10","height","10",1,"points"],["id","ind",3,"debug","ngStyle",4,"ngIf"],["id","ind",3,"ngStyle"],["id","sel-el",3,"click","mousemove","ngStyle"]],template:function(t,o){t&1&&(R(0,Y_,2,1,"svg",5)(1,K_,2,1,"ng-container",6),ne(),h(2,"svg",7,0)(4,"g",8),I(5,"ellipse"),_()(),h(6,"svg",7,1)(8,"g",8),I(9,"ellipse"),_()(),R(10,Q_,4,4,"svg",9)),t&2&&(p("ngIf",o.debug&&(o.data==null?null:o.data.length)>0&&!o.isAnnotCreate()),l(),p("ngForOf",o.gestureSelectors),l(),p("ngStyle",o.indicatorStyle),l(3),G("cx",12)("cy",15)("rx",5)("ry",5),l(),p("ngStyle",o.indicatorStyle),l(3),G("cx",12)("cy",15)("rx",5)("ry",5),l(),p("ngIf",(o.data==null?null:o.data.length)>0))},dependencies:[Ue,be,Ce],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{--mono-00: #FFFFFF;--mono-10: #F4F4F4;--mono-30: #DADADA;--mono-50: #C8C8C8;--mono-70: #6C6C6C;--mono-90: #363636;--mono-99: #1E1E1E;--mono-00-rgb: 255, 255, 255;--mono-99-rgb: 30, 30, 30;--primary-50: #F79F1A;--primary-50-rgb: 247, 159, 26;--primary-50-hover: #E09119;--primary-50-pressed: #C78016;--primary-70: #FF6100;--primary-70-rgb: 255, 97, 0;--second-50: #0C7489;--exception: #E4002B;--background: #DADADA;--input-background: #FFFFFF;--input-border: #DADADA;--button-background: #FFFFFF;--button-border: #DADADA;--button-pressed: #A3A3A3;--font-disable: #C4C4C4}table.pui-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table.pui-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{word-break:break-all}table.pui-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child, table.pui-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{padding-left:20px}table.pui-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child, table.pui-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-right:20px}table.pui-table[_ngcontent-%COMP%]   tr.pui-thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:400;text-align:left;border-top:1px solid #D1D1D1;border-bottom:1px solid #D1D1D1}*[_ngcontent-%COMP%]{-webkit-text-fill-color:currentcolor;letter-spacing:-.5px}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{letter-spacing:initial}#sel-el[_ngcontent-%COMP%]{position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none}svg.debug[_ngcontent-%COMP%]{right:0;top:0;position:absolute;width:100%;height:100%}svg.indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;transform:scale(0);pointer-events:none}rect.searchBox[_ngcontent-%COMP%]{fill:#00ff0040;stroke-width:1;stroke:#000}rect.points[_ngcontent-%COMP%]{fill:#00000040;stroke-width:1;stroke:#000}#ind[_ngcontent-%COMP%]{right:0;top:0;position:absolute;width:1px;height:1px;transform-origin:100% 0}#ind.debug[_ngcontent-%COMP%]{border:solid 1px #000000}svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{mix-blend-mode:multiply;pointer-events:none;fill:rgba(var(--primary-50-rgb),.15)}"],changeDetection:0}));let r=n;return r})();var ep=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({providers:[bi],imports:[mt,ai]}));let r=n;return r})();var q_=["dragSelectSvg"];function J_(r,n){if(r&1&&(ne(),I(0,"rect",3)),r&2){let i=d();G("x",i.rectRender.x)("y",i.rectRender.y)("width",i.rectRender.w)("height",i.rectRender.h)}}var to=class to{changeDetectorRef;renderer;annotSelectedService;sdContextMenuService;subscriptionService;selectTextService;dragSelectSvgElementRef;page;comps;select=new Ke;clickEvent=new Ke;created=!1;startPoint={x:0,y:0};rectRender={x:0,y:0,w:0,h:0};prevEvent;onMouseMoveListener=null;onMouseUpListener=null;onMouseLeaveListener=null;_annotTree;isContextMenuOpened=!1;styles={};get annotTree(){if(!T.isDefined(this._annotTree))throw new oi("AnnotTree is not initialized. Call build() first.");return this._annotTree}constructor(n,i,e,t,o,s){this.changeDetectorRef=n,this.renderer=i,this.annotSelectedService=e,this.sdContextMenuService=t,this.subscriptionService=o,this.selectTextService=s}ngOnInit(){this.togglePriority(F.LayoutOrder.DragSelect),this.styles.width=`${this.page.bbox.w+this.page.bbox.x}px`,this.styles.height=`${this.page.bbox.h+this.page.bbox.y}px`,this.subscriptionService.push(this.sdContextMenuService.contextMenuStatus$.subscribe({next:n=>this.isContextMenuOpened=n}))}onDown(n){return n.button===2?!1:(this.annotSelectedService.pageIndex!==this.page.i&&(this.annotSelectedService.unselectAll(),this.annotSelectedService.pageIndex=this.page.i),this.selectTextService.publishSelectedText(null),this.togglePriority(F.LayoutOrder.DragSelectActive),this.rectRender.h=0,this.rectRender.w=this.rectRender.h,this.onMouseUpListener=this.renderer.listen(this.dragSelectSvgElementRef.nativeElement,"mouseup",i=>this.onUp(i)),this.onMouseLeaveListener=this.renderer.listen(this.dragSelectSvgElementRef.nativeElement,"mouseleave",i=>this.onUp(i)),this.isContextMenuOpened||n.stopPropagation(),this.prevEvent=n,this.changeDetectorRef.markForCheck(),this.created=!0,this.rectRender.x=n.offsetX,this.startPoint.x=this.rectRender.x,this.rectRender.y=n.offsetY,this.startPoint.y=this.rectRender.y,this.onMouseMoveListener=this.renderer.listen(this.dragSelectSvgElementRef.nativeElement,"mousemove",i=>this.onMove(i)),!0)}onMove(n){return this.created?(n.preventDefault(),n.stopPropagation(),this.prevEvent&&this.prevEvent.offsetX===n.offsetX&&this.prevEvent.offsetY===n.offsetY||(this.rectRender.x=Math.min(this.startPoint.x,n.offsetX),this.rectRender.y=Math.min(this.startPoint.y,n.offsetY),this.rectRender.w=Math.abs(n.offsetX-this.startPoint.x),this.rectRender.h=Math.abs(n.offsetY-this.startPoint.y),this.prevEvent=n,this.changeDetectorRef.markForCheck(),(n.offsetX<this.page.bbox.x||this.page.bbox.h<n.offsetY||this.annotSelectedService.pageIndex!==this.page.i)&&this.onUp(n)),!1):!0}onUp(n){n.preventDefault(),n.stopPropagation(),this.destroyMouseListeners(),this.created=!1,this.build();let i={x:this.rectRender.x,y:this.page.bbox.y+this.page.bbox.h-this.rectRender.y-this.rectRender.h,w:this.rectRender.w,h:this.rectRender.h},e=this.search(i);if(this.annotSelectedService.selectedComponents.splice(0),e.forEach(t=>{(this.rectRender.h>10||this.rectRender.w>10)&&this.annotSelectedService.add(t)}),this.annotSelectedService.trigger=n.type,this.annotSelectedService.isFirstSelection=!1,this.select.emit(this.annotSelectedService.getSelectedInfo()),this.annotTree.clear(),this.changeDetectorRef.markForCheck(),this.togglePriority(F.LayoutOrder.DragSelect),this.annotSelectedService.length===0){let t={x:i.x,y:i.y};this.clickEvent.emit([t,n])}return!1}ngOnDestroy(){this.destroyMouseListeners()}togglePriority(n){return F.bindLayoutOrder(this.styles,n)}search(n){return this.annotTree.search(n)}build(){this._annotTree=new wn(this.page),this.comps.forEach(n=>this.addTree(n))}addTree(n){this.annotTree.insert(n.data.attributes.rect,n)}destroyMouseListeners(){T.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,T.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null,T.isDefined(this.onMouseLeaveListener)&&this.onMouseLeaveListener(),this.onMouseLeaveListener=null}};v(to,"\u0275fac",function(i){return new(i||to)(m(Y),m(Qt),m(kt),m(ci),m(P),m(bi))}),v(to,"\u0275cmp",j({type:to,selectors:[["sd-drag-select"]],viewQuery:function(i,e){if(i&1&&se(q_,7),i&2){let t;ae(t=ce())&&(e.dragSelectSvgElementRef=t.first)}},inputs:{page:"page",comps:"comps"},outputs:{select:"select",clickEvent:"clickEvent"},standalone:!1,features:[$([P])],decls:3,vars:2,consts:[["dragSelectSvg",""],["id","dragSelect",1,"dragSelect",3,"mousedown","ngStyle"],["stroke","#c8c8c8","stroke-width","0.6","fill","#dadada","fill-opacity","0.25",4,"ngIf"],["stroke","#c8c8c8","stroke-width","0.6","fill","#dadada","fill-opacity","0.25"]],template:function(i,e){if(i&1){let t=w();ne(),h(0,"svg",1,0),O("mousedown",function(s){return f(t),g(e.onDown(s))}),R(2,J_,1,4,"rect",2),_()}i&2&&(p("ngStyle",e.styles),l(2),p("ngIf",e.created))},dependencies:[be,Ce],styles:[".dragSelect[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#fff0;position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none}"]}));var yo=to;ee([Ae(J.dragSelectComp.onUp)],yo.prototype,"onUp",null);var tp={[V.HIGHLIGHT]:{label:"HIGHLIGHT",icon:"papycon papycon-text-highlight"},[V.STRIKE]:{label:"STRIKEOUT",icon:"papycon papycon-text-strikeout"},[V.UNDERLINE]:{label:"UNDERLINE",icon:"papycon papycon-text-underline"},[V.SEARCH]:{label:"SEARCH",icon:"papycon papycon-search"},[V.COPY]:{label:"COPY",icon:"papycon papycon-copy"},[V.ERASER]:{label:"REMOVE",icon:"papycon papycon-trash-can"},[V.POPUP]:{label:"TEXT",icon:"papycon papycon-memo2"},[V.EDIT]:{label:"PROPERTIES",icon:"papycon papycon-palette"},[V.RADIO_BUTTON]:{label:"ADD_NEIGHBOR_BUTTON",icon:"papycon papycon-plus"},[V.LINK]:{label:"CREATE_LINK",icon:"papycon papycon-link"},[V.REDACTION]:{label:"MARK_FOR_REDACTION",icon:"papycon papycon-redaction-partial2"}};var ip,np,op,ef=["containerRef"],tf=["bboxEl"],nf=r=>({content:r});function of(r,n){if(r&1){let i=w();h(0,"i",6),E(1,"translate"),E(2,"translate"),O("click",function(){let t=f(i).$implicit,o=d();return g(o.executeCommand(t))})("mousedown",function(t){let o=f(i).index,s=d();return g(s.onMousedown(t,o))})("mouseenter",function(){let t=f(i).index,o=d();return g(o.activeIconIndex=t)})("mouseup",function(t){return f(i),g(t.stopPropagation())}),_()}if(r&2){let i=n.$implicit,e=n.index,t=d();Nn(t.getIcon(i).icon),p("ngClass",t.activeIconIndex===e?t.currentPressedIndex===e?"active":"hover":null)("title",S(1,5,t.getIcon(i).label))("tooltip",gt(9,nf,S(2,7,t.getIcon(i).label)))}}var ra=(()=>{let n=class n{annotService;annotEditService;annotSelectedService;contentService;changeDetectorRef;subscriptionService;store$;scale;page;bbox;degree;acroFields;containerElementRef;bboxElementRef;activeIconIndex;currentPressedIndex;menus=[];_positionStyle={left:"0",top:"0",transform:null,transformOrigin:null,visibility:F.STYLE_VISIBILITY_HIDDEN};get positionStyle(){return this._positionStyle}bboxStyles={transform:null};iconMap=tp;commands=new io(this);realScale;get rotation(){return this.page?.r+this.degree}constructor(e,t,o,s,c,u,C){this.annotService=e,this.annotEditService=t,this.annotSelectedService=o,this.contentService=s,this.changeDetectorRef=c,this.subscriptionService=u,this.store$=C}ngOnChanges(){this.buildMenu(),setTimeout(()=>{this.realScale=1/F.normalizeScale(this.scale),T.isDefined(this.positionStyle)&&(this.positionStyle.transform=`scale(${this.realScale}) ${F.rotationNote(-this.rotation)}`,this.positionStyle.visibility=F.STYLE_VISIBILITY_HIDDEN,this.changeDetectorRef.detectChanges(),this.renderPosition())})}ngAfterViewInit(){this.toggleCustomMenu(),this.subscriptionService.push(this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>this.toggleCustomMenu()}))}ngOnInit(){F.bindLayoutOrder(this.positionStyle,F.LayoutOrder.CONTEXT_MENU)}ngOnDestroy(){ve.destroy(this)}onMousedown(e,t){e.preventDefault(),e.stopPropagation(),this.currentPressedIndex=t,this.subscriptionService.push(Ve.windowMouseUp$.pipe(ii(1)).subscribe({next:()=>this.currentPressedIndex=-1}))}executeCommand(e){this.commands.execute(e)}buildMenu(){this.menus.length&&this.menus.splice(0),!(!this.annotSelectedService.getSelectedInfo||!this.annotSelectedService.selectedComponents||this.annotSelectedService.selectedComponents.length===0)&&(K.get(a.ANNOT_FLOATING_PROPERTY)&&this.menus.push(V.EDIT),K.get(a.ANNOT_FLOATING_POPUP_NOTE)&&this.annotSelectedService.selectedComponents.length===1&&A.canHavePopup(this.annotSelectedService.selectedComponents[0].data)&&!A.isLink(this.annotSelectedService.selectedComponents[0].data)&&this.menus.push(V.POPUP),this.annotSelectedService.selectedComponents.every(e=>!st.get(e.data.attributes.F??-1,7))&&(K.get(a.ANNOT_FLOATING_ADD_RADIO_BUTTON)&&this.annotSelectedService.selectedComponents.length===1&&A.isRadioWidget(this.annotSelectedService.selectedComponents[0].data,this.acroFields)&&!Li.isReadonly(this.acroFields[this.annotSelectedService.selectedComponents[0].data.attributes.Parent].Ff??-1)&&this.menus.push(V.RADIO_BUTTON),K.get(a.ANNOT_FLOATING_DELETE)&&this.annotSelectedService.selectedComponents.every(e=>A.isWidget(e.data)&&K.get(a.DELETE_FORM)||!A.isWidget(e.data)&&K.get(a.DELETE_ANNOTATION))&&this.menus.push(V.ERASER)))}toggleCustomMenu(){if(!this.containerElementRef)return;this.containerElementRef.nativeElement.innerHTML="";let e=this.annotSelectedService.selectedComponents[0].data.type,t=this.annotEditService.getAnnotSelectMenu(e);if(t){let o=document.createElement("div");o.innerHTML=t,this.containerElementRef.nativeElement.appendChild(o)}}renderPosition(){if(!this.bboxElementRef||this.menus.length===0)return;let e=this.bboxElementRef.nativeElement.getBoundingClientRect();this.positionStyle.transformOrigin="50% 50%",this.positionStyle.transform=`${this.translationOf(e,26)} ${this.positionStyle.transform}`,this.positionStyle.visibility=null,setTimeout(()=>{this.changeDetectorRef&&this.changeDetectorRef.markForCheck()})}translationOf({width:e,height:t},o){let s=F.normalizeDegree(-this.rotation),c=this.computeDefaultPosition(e,t,o,s),{x:u,y:C}=this.computeOverflow(c,e,t,s);return`translate(${u}px, ${C}px)`}computeDefaultPosition(e,t,o,s){let c={x:this.bbox.x-(e-this.bbox.w)/2,y:this.bbox.y-(t-this.bbox.h)/2},u=c.x,C=c.y,x=this.bbox.w/2+(t/2+o)*this.realScale,N=this.bbox.h/2+(t/2+o)*this.realScale;switch(s){case 0:C-=N;break;case 90:u+=x;break;case 180:C+=N;break;case 270:u-=x;break;default:break}return{x:u,y:C}}computeOverflow(e,t,o,s){let{x:c,y:u}=e;switch(s){case 0:c=Math.max(c,(t*this.realScale-t)/2),c=Math.min(c,this.page.bbox.w-(t*this.realScale+t)/2),u=Math.max(u,(o*this.realScale-o)/2);break;case 90:c=Math.min(c,this.page.bbox.w-(o*this.realScale+t)/2),u=Math.max(u,(t*this.realScale-o)/2),u=Math.min(u,this.page.bbox.h-(t*this.realScale+o)/2);break;case 180:c=Math.max(c,(t*this.realScale-t)/2),c=Math.min(c,this.page.bbox.w-(t*this.realScale+t)/2),u=Math.min(u,this.page.bbox.h-(o*this.realScale+o)/2);break;case 270:c=Math.max(c,(o*this.realScale-t)/2),u=Math.max(u,(t*this.realScale-o)/2),u=Math.min(u,this.page.bbox.h-(t*this.realScale+o)/2);break;default:break}return{x:c,y:u}}getIcon(e){return this.iconMap[e]}};v(n,"\u0275fac",function(t){return new(t||n)(m(Re),m(_t),m(kt),m(ge),m(Y),m(P),m(xe))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-edit-menu"]],viewQuery:function(t,o){if(t&1&&(se(ef,7),se(tf,7)),t&2){let s;ae(s=ce())&&(o.containerElementRef=s.first),ae(s=ce())&&(o.bboxElementRef=s.first)}},inputs:{scale:"scale",page:"page",bbox:"bbox",degree:"degree",acroFields:"acroFields"},standalone:!1,features:[$([P,{provide:Zo,useValue:new zi(300)}]),Ie],decls:6,vars:3,consts:[["bboxEl",""],["containerRef",""],[1,"position",3,"ngStyle"],[1,"bbox",3,"mouseleave","ngStyle"],[3,"class","ngClass","title","tooltip","click","mousedown","mouseenter","mouseup",4,"ngFor","ngForOf"],[3,"mousedown","mouseup"],[3,"click","mousedown","mouseenter","mouseup","ngClass","title","tooltip"]],template:function(t,o){if(t&1){let s=w();h(0,"div",2)(1,"div",3,0),O("mouseleave",function(){return f(s),g(o.activeIconIndex=-1)}),R(3,of,3,11,"i",4),h(4,"div",5,1),O("mousedown",function(u){return f(s),g(u.stopPropagation())})("mouseup",function(u){return f(s),g(u.stopPropagation())}),_()()()}t&2&&(p("ngStyle",o.positionStyle),l(),p("ngStyle",o.bboxStyles),l(2),p("ngForOf",o.menus))},styles:["div.position[_ngcontent-%COMP%]{position:absolute;left:0;top:0;pointer-events:none}div.bbox[_ngcontent-%COMP%]{background:var(--mono-00);border:1px solid;border-color:var(--mono-50);box-shadow:0 -4px 9px #0000001f;border-radius:4px;transform-origin:50% 100%;pointer-events:auto}.papycon[_ngcontent-%COMP%]{display:inline-block;font-size:24px;line-height:40px;padding:0 8px;height:40px;width:40px;border-radius:8px;color:var(--mono-90);text-align:center;cursor:pointer}.papycon.active[_ngcontent-%COMP%]{color:var(--primary-50)}.papycon.hover[_ngcontent-%COMP%]{color:var(--mono-99)}"],changeDetection:0}));let r=n;return r})(),io=class{comp;constructor(n){this.comp=n}get annotService(){return this.comp.annotService}execute(n){if(!Se.hasKey(this,n)){console.warn("Unsupported",n);return}this[n]()}[ip=V.ERASER](){let n=this.comp.annotSelectedService.selectedComponents;for(let i=n.length-1;i>=0;--i)this.comp.contentService.fireAnnotEvent({sdEventType:fe.DELETE,pageIdx:this.comp.page.i,annot:n[i].data})}buildPopup(n){if(A.hasPopup(n)||!A.canHavePopup(n))return;let i=n.attributes.rect,e=this.annotService.createAnnot(V.POPUP,this.comp.page,{x:i.left/2,y:i.top/2})[0];n.Popup=e.oid,this.annotService.putModel(e),this.annotService.putModel(n,"modify"),this.comp.contentService.fireAnnotEvent({from:"EditMenuComponent",sdEventType:fe.UPDATE,annot:n})}[np=V.POPUP](){let n=this.comp.annotSelectedService.selectedComponents[0].data;this.buildPopup(n),this.comp.annotService.togglePopup(n),this.comp.annotService.closeEditor()}[op=V.EDIT](){this.comp.store$.dispatch(wt.set({key:"rightSideViewMode",value:Tn.AnnotProperty})),this.comp.store$.dispatch(wt.set({key:"rightSideViewVisible",value:!0}))}[V.RADIO_BUTTON](){let n=this.comp.annotSelectedService.selectedComponents[0].data,{rect:i}=n.attributes,e=this.comp.acroFields[n.attributes.Parent],t=e.Kids[e.Kids.length-1].oid;this.comp.annotService.closeEditor(),this.comp.store$.dispatch(En.selectTool({payload:V.RADIO_BUTTON})),this.comp.store$.dispatch(En.updateWidgetContext({payload:{title:e.T,AP_N:`${t>0?t+1:t-1}`,width:i.right-i.left,height:i.top-i.bottom}}))}};ee([Ae(J.editMenuComp.eraser)],io.prototype,ip,null);ee([Ae(J.editMenuComp.popup)],io.prototype,np,null);ee([Ae(J.editMenuComp.edit)],io.prototype,op,null);function rf(r,n){if(r&1&&(h(0,"div",2),Te(1),M(2),Ee(),_()),r&2){let i=d();p("ngStyle",i.annotStyle),l(2),k(i.caption)}}function sf(r,n){if(r&1&&I(0,"div",2),r&2){let i=d();p("ngStyle",i.appearanceStyle)}}var rp=(()=>{let n=class n{changeDetectorRef;subscriptionService;contentService;loggingService;data;get caption(){let e=this.data.attributes.MK?.CA;return T.isDefined(e)?e:(this.loggingService.common("warn",le.NOT_EXIST,"CA"),"")}get renderAppearance(){return U.hasAppearance(this.data.attributes.appearance)}get appearanceStyle(){return U.appearanceStyle(this.data.attributes)}get annotStyle(){return{fontSize:`${this.data.attributes.fontSize}px`,color:this.data.attributes.fontColor,fontFamily:this.data.attributes.fontName}}constructor(e,t,o,s){this.changeDetectorRef=e,this.subscriptionService=t,this.contentService=o,this.loggingService=s}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(T.isDefined),L(e=>e.annot.oid===this.data.oid)).subscribe({next:()=>{this.changeDetectorRef.detectChanges()}}))}};v(n,"\u0275fac",function(t){return new(t||n)(m(Y),m(P),m(ge),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-form-button"]],inputs:{data:"data"},standalone:!1,features:[$([P])],decls:3,vars:2,consts:[["appearance",""],[3,"ngStyle",4,"ngIf","ngIfElse"],[3,"ngStyle"]],template:function(t,o){if(t&1&&R(0,rf,3,2,"div",1)(1,sf,1,1,"ng-template",null,0,He),t&2){let s=we(2);p("ngIf",!o.renderAppearance)("ngIfElse",s)}},dependencies:[be,Ce],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;cursor:pointer;white-space:nowrap}"],changeDetection:0}));let r=n;return r})();var ls=class{view;checkImageUrl;unCheckedImageUrl;constructor(n,i,e){this.view=n,this.checkImageUrl=i,this.unCheckedImageUrl=e}buttonStyle(n){return n?this.checkImageUrl:this.unCheckedImageUrl}buttonAction(n){this.view.widget.value===n?this.view.widget.value="Off":this.view.widget.value=n}},ps=class{view;checkImageUrl;unCheckedImageUrl;constructor(n,i,e){this.view=n,this.checkImageUrl=i,this.unCheckedImageUrl=e}buttonStyle(n){return n?this.checkImageUrl:this.unCheckedImageUrl}buttonAction(n){this.view.data.attributes.AP_N&&(this.view.widget.value=n)}};var af={data:null,status:null,annotService:null,oid:null,width:null,stroke:null,fill:null,dashArray:null,srcRect:null,viewClasses:null,render(){},pvOnMove(r){},postCreate(r){},isCreateStatus(){return!1},isRemoveStatus(){return!1}},ni=class{data;status;annotService;static create(n,i,e){return A.isCircle(n)?new sa(n,i,e):A.isSquare(n)||A.isWidget(n)||A.isLink(n)?new Ao(n,i,e):A.isFreeTextCallout(n)?new aa(n,i,e):A.isFreeText(n)?new ds(n,i,e):A.isRedact(n)?new ca(n,i,e):(console.warn(`Unsupported rect render type[${n.type}] of oid[${n.oid}]`),af)}oid;width;stroke;fill;dashArray=null;srcRect;viewClasses={absolute:!0,create:!1,debug:!1,remove:!1,freeText:!1};constructor(n,i,e){this.data=n,this.status=i,this.annotService=e,this.srcRect=T.deepClone(this.data.attributes.rect)}isCreateStatus(){return Z.CREATE===this.status}isRemoveStatus(){return Z.REMOVE===this.status}pvOnMove(n){let i=this.data.attributes.rect;i.right=n.offsetX,i.top=n.offsetY}postCreate(n){let i=this.data.attributes.rect;i.bottom=n.bbox.h+n.bbox.y-i.bottom,i.top=n.bbox.h+n.bbox.y-i.top}render(){this.annotService.bindCursorClass(this.viewClasses,this.status),this.oid=this.data.oid,this.width=this.data.attributes.width,this.fill=this.data.attributes.InteriorColor||"none",A.isRedact(this.data)?this.stroke=this.data.attributes.OutlineColor:this.stroke=this.data.attributes.color;let n=this.data.attributes.borderStyle;this.dashArray=n?.style==="dashed"?n.dashPattern.map(i=>i.toString()).reduce((i,e)=>(i&&`${i}, `)+e,T.EMPTY_STRING):null}},sa=class extends ni{cx;cy;rx;ry;render(){super.render();let n=this.data.attributes.rect;this.rx=Math.max((Math.abs(n.right-n.left)-this.data.attributes.width)/2,0),this.ry=Math.max((Math.abs(n.top-n.bottom)-this.data.attributes.width)/2,0),this.cx=(n.right+n.left)/2,this.cy=(n.top+n.bottom)/2,Z.CREATE!==this.status&&(this.cx-=n.left-this.width,this.cy-=n.bottom-this.width),Z.EDIT===this.status&&(this.cx+=n.left-this.srcRect.left,this.cy+=this.srcRect.top-n.top)}},Ao=class extends ni{x;y;rectWidth;rectHeight;render(){super.render();let n=this.data.attributes.rect;this.rectWidth=Math.max(F.fixedOf(Math.abs(n.right-n.left),3)-(this.data.attributes.width||0),0),this.rectHeight=Math.max(F.fixedOf(Math.abs(n.bottom-n.top),3)-(this.data.attributes.width||0),0),this.isCreateStatus()?(this.x=Math.min(n.left,n.right),this.y=Math.min(n.bottom,n.top)):this.status===Z.EDIT?(this.x=Math.min(n.left,n.right)-Math.min(this.srcRect.left,this.srcRect.right),this.y=Math.max(this.srcRect.top,this.srcRect.bottom)-Math.max(n.bottom,n.top)):(this.y=0,this.x=this.y),this.x+=this.width*.5,this.y+=this.width*.5}},ds=class extends Ao{render(){super.render(),this.status===Z.CREATE&&(this.fill=this.data.attributes.color||"none"),this.stroke=this.data.attributes.contentsRichtext.borderColor,this.viewClasses.freeText=!0}},aa=class extends ds{render(){super.render();let n=this.data.attributes.rect,i=this.data.attributes.textRect,e=this.data.attributes.width,t=this.isCreateStatus();if(!T.isDefined(i))throw new Mt('Cannot find "textRect" in TextCalloutRender.render');t?(this.x+=Math.min(i.left,i.right)-Math.min(n.left,n.right),this.y+=Math.min(i.bottom,i.top)-Math.min(n.bottom,n.top)):(this.x=i.left-n.left+e/2,this.y=n.top-i.top+e/2),this.rectWidth=Math.max(F.fixedOf(Math.abs(i.right-i.left),3)-this.data.attributes.width,0),this.rectHeight=Math.max(F.fixedOf(Math.abs(i.top-i.bottom),3)-this.data.attributes.width,0)}postCreate(n){let i=this.data.attributes.textRect;if(!T.isDefined(i))throw new Mt('Cannot find "textRect" in TextCalloutRender.postCreate');i.bottom=n.bbox.h+n.bbox.y-i.bottom,i.top=n.bbox.h+n.bbox.y-i.top,U.validateRect(i)}pvOnMove(n){let i=this.data.attributes.textRect;if(!T.isDefined(i))throw new Mt('Cannot find "textRect" in TextCalloutRender.pvOnMove');let e=Math.abs((i.left-i.right)/2),t=(i.top-i.bottom)/2;i.left=n.offsetX-e,i.right=n.offsetX+e,i.bottom=n.offsetY-t,i.top=n.offsetY+t}},ca=class extends Ao{fillOpacity;overlayText;fontColor;fontName;fontSize;alignment;render(){if(super.render(),this.data.attributes.isHover){this.fill=this.data.attributes.InteriorColor,this.fillOpacity=this.data.attributes.fillOpacity,this.overlayText=this.data.attributes.overlayText,this.fontColor=this.data.attributes.fontColor,this.fontName=this.data.attributes.fontName,this.fontSize=this.data.attributes.fontSize,this.alignment=this.data.attributes.alignment;return}this.fill=this.data.attributes.OutlineColor,this.fillOpacity=.2}overlayTextStyle(){return{top:`${this.y}px`,left:`${this.x}px`,display:this.overlayText?"block":"none",color:this.fontColor,fontSize:`${this.fontSize}px`,fontFamily:this.fontName??"inherit",textAlign:this.alignment,padding:`${this.width}px`,width:`${this.rectWidth}px`,height:`${this.rectHeight}px`}}};var cf=["form"];function lf(r,n){if(r&1&&I(0,"sd-form-text",9,0),r&2){let i=d(2);p("data",i.data)}}function pf(r,n){if(r&1&&I(0,"sd-form-checkable-button",9,0),r&2){let i=d(2);p("data",i.data)}}function df(r,n){if(r&1&&I(0,"sd-form-signature",10,0),r&2){let i=d(2);p("data",i.data)("canEdit",i.canEdit)}}function uf(r,n){if(r&1&&I(0,"sd-form-button",9,0),r&2){let i=d(2);p("data",i.data)}}function mf(r,n){if(r&1&&I(0,"sd-form-list-box",9,0),r&2){let i=d(2);p("data",i.data)}}function hf(r,n){if(r&1&&I(0,"sd-form-combo-box",9,0),r&2){let i=d(2);p("data",i.data)}}function _f(r,n){if(r&1&&(h(0,"p"),M(1),_()),r&2){let i=d(2);l(),ke("TODO::",i.type,"")}}function ff(r,n){if(r&1){let i=w();h(0,"div",4),O("mousedown",function(t){f(i);let o=d();return g(o.onMousedown(t))})("click",function(){f(i);let t=d();return g(t.onClick())})("touchstart",function(t){f(i);let o=d();return g(o.onTouchstart(t))}),h(1,"div",5),R(2,lf,2,1,"sd-form-text",6)(3,pf,2,1,"sd-form-checkable-button",6)(4,df,2,2,"sd-form-signature",7)(5,uf,2,1,"sd-form-button",6)(6,mf,2,1,"sd-form-list-box",6)(7,hf,2,1,"sd-form-combo-box",6),_(),R(8,_f,2,1,"p",8),_()}if(r&2){let i=d();p("ngSwitch",i.type)("title",i.canEdit?i.title:"")("ngStyle",i.transformStyle),l(),p("ngStyle",i.widgetStyle),l(),p("ngSwitchCase","Tx"),l(),p("ngSwitchCase",i.caseCheckableButton(i.type)),l(),p("ngSwitchCase","Sig"),l(),p("ngSwitchCase","Btn"),l(),p("ngSwitchCase","Lx"),l(),p("ngSwitchCase","Cx")}}function gf(r,n){if(r&1&&(ne(),h(0,"svg",11),I(1,"rect")(2,"rect",12),_()),r&2){let i=d();p("ngStyle",i.transformStyle),l(),G("x",i.rectX)("y",i.rectY)("width",i.rectWidth+i.renderer.width)("height",i.rectHeight+i.renderer.width)("fill",i.rectFill)("fill-opacity",i.rectFillOpacity),l(),G("x",i.rectX+i.rectStrokeWidth/2)("y",i.rectY+i.rectStrokeWidth/2)("width",i.Math.max(i.rectWidth-(i.isFixedStrokeWidth?1:0),0))("height",i.Math.max(i.rectHeight-(i.isFixedStrokeWidth?1:0),0))("stroke",i.rectStroke)("stroke-width",i.rectStrokeWidth)("stroke-dasharray",i.rectStrokeDasharray)}}function Cf(r,n){if(r&1&&(h(0,"div",13)(1,"div",14),M(2),_()()),r&2){let i=d();qe("width",i.rectWidth+i.rectStrokeWidth-(i.isFixedStrokeWidth?1:0),"px")("height",i.rectHeight+i.rectStrokeWidth-(i.isFixedStrokeWidth?1:0),"px"),W("left-align",i.isLeftAlign),p("ngStyle",i.transformStyle),l(),qe("background-color",i.isRequired()?i.preferences.formFieldRequiredColor:"#000000"),l(),k(i.title)}}var ti=(()=>{let n=class n{elementRef;acroFormService;contentService;annotService;documentService;editService;changeDetectorRef;subscriptionService;scriptService;store$;viewerService;loggingService;data;status=Z.RENDER;form;get AnnotStatus(){return Z}renderer;preferences;widgetStyle={overflow:"hidden"};transformStyle={};type;canEdit=null;detectWithChild=!1;rectX=0;rectY=0;rectWidth=0;rectHeight=0;acroFieldsInit=!1;acroField;srcRect;constructor(e,t,o,s,c,u,C,x,N,D,X,Q){this.elementRef=e,this.acroFormService=t,this.contentService=o,this.annotService=s,this.documentService=c,this.editService=u,this.changeDetectorRef=C,this.subscriptionService=x,this.scriptService=N,this.store$=D,this.viewerService=X,this.loggingService=Q}onMousedown(e){return e.stopPropagation(),this.emitWidgetMouseDownEvent(),!0}onClick(){if(this.data.attributes.type==="JavaScript"){if(!T.isDefined(this.acroField)){console.debug(`AcroField is not defined. (oid: ${this.data.oid}, type: ${this.data.type})`);return}this.scriptService.execute(this.acroField,this.data.attributes.JS||T.EMPTY_STRING)}}onTouchstart(e){e.stopPropagation(),this.emitWidgetMouseDownEvent()}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(T.isDefined),L(e=>e.annot.oid===this.data.oid)).subscribe({next:()=>{this.srcRect=T.deepClone(this.data.attributes.rect),this.detectWithChild=!0,this.detectChange()}}),this.acroFormService.acroFields$.pipe(L(e=>!!e),je({next:()=>this.acroFieldsInit=!0})).subscribe({next:()=>{this.detectWithChild=!0,this.detectChange()}}),this.store$.pipe(_e("dragMode"),je({next:e=>this.canEdit=e===ye.SELECT_ANNOT})).subscribe({next:()=>{this.detectChange()}}),this.store$.pipe(Xe()).subscribe({next:e=>{this.preferences=e,this.detectWithChild=!0,this.detectChange()}}),this.contentService.fieldEvent$.pipe(L(T.isDefined),L(e=>e.fieldTitle===this.title)).subscribe({next:()=>{this.detectWithChild=!0,this.detectChange()}}))}ngOnDestroy(){T.removeElement(this.elementRef.nativeElement),ve.destroy(this)}ngOnChanges(e){e.data&&this.updateAcroField(),this.srcRect=T.deepClone(this.data.attributes.rect),this.renderer=ni.create(this.data,this.status,this.annotService),this.setFieldRotateStyle(),this.detectWithChild=!0,this.detectChange()}get title(){return this.acroField?.T||this.data.attributes.T||T.EMPTY_STRING}get Math(){return Math}get value(){return this.acroField?.hasOwnProperty("V")?this.acroField.V:this.data.attributes.V}set value(e){if(!this.acroField){this.loggingService.common("warn",le.NOT_EXIST,"acroField");return}this.acroField.V!==e&&(this.acroField.V=e,this.acroFormService.putModel(this.acroField,"modify"))}get flag(){return this.acroField?.Ff||this.data.attributes.Ff}get opt(){return this.acroField?.Opt||[]}get selectedItems(){return this.acroField?.I||[]}set selectedItems(e){this.acroField&&(this.acroField.I=e,this.acroFormService.putModel(this.acroField,"modify"))}get rectFill(){if(this.status===Z.CREATE)return this.viewerService.customColor.main;if(this.isNeedHighlight()){let e=this.preferences.formFieldHighlightedColor;if(!this.data.attributes.MK?.backgroundColor&&!this.data.attributes.MK?.borderColor)return e;let t=hn.parseRgbString(e),o=hn.rgbToHsl(t);o.l=o.l-7;let s=hn.hslToRgb(o);return hn.rgbToHexString(s)}return this.data.attributes.MK?.backgroundColor||"none"}get rectFillOpacity(){return this.status===Z.CREATE?.08:this.isNeedHighlight()&&!this.data.attributes.MK?.backgroundColor&&!this.data.attributes.MK?.borderColor?.66:1}get rectStroke(){return this.status===Z.CREATE?this.viewerService.customColor.main:this.data.attributes.MK?.borderColor?this.isNeedHighlight()&&this.isRequired()?this.preferences?.formFieldRequiredColor:this.data.attributes.MK?.borderColor||"none":this.isRequired()?!this.canEdit&&!this.isNeedHighlight()?"none":this.preferences?.formFieldRequiredColor:this.canEdit?"#000000":"none"}get rectStrokeWidth(){return this.isFixedStrokeWidth?1:this.renderer.width}get isFixedStrokeWidth(){return this.status===Z.CREATE||this.renderer.width<=0&&(this.canEdit||this.isNeedHighlight()&&this.isRequired())}get isLeftAlign(){let e=document.createElement("canvas").getContext("2d");if(e===null)throw new wi("Failed to get CanvasRenderingContext2D");e.font="8px NotoSans-Regular";let{rect:t}=this.data.attributes;return Math.abs(t.right-t.left)<e.measureText(this.title).width}get rectStrokeDasharray(){return this.status===Z.CREATE?"8 8":this.isNeedHighlight()&&this.isRequired()?null:this.renderer.dashArray}isRequired(){let e=this.acroField?this.acroField.Ff:this.data.attributes.Ff;return T.isDefined(e)&&Li.isRequired(e)}isReadonly(){let e=this.acroField?this.acroField.Ff:this.data.attributes.Ff;return T.isDefined(e)&&(Li.isReadonly(e)||!this.documentService.checkAuthority(Be.FILL_FORM))}isNeedHighlight(){return this.preferences?.formFieldHighlighted&&!this.isReadonly()&&(!this.isSignature()||this.isSignature()&&!this.data.attributes.appearance&&!this.value)&&this.type!=="Btn"}isEdited(){return this.data.attributes.Parent<0?!0:this.annotService.getActionLogAnnots(this.data.attributes.pageIdx).findIndex(t=>t.oid===this.data.oid)>-1||this.value!==this.acroFormService.lastFetchedAcroFields?.get(this.data.attributes.Parent)?.V}pvOnMove(e){this.renderer.pvOnMove(e);let{rect:t}=this.data.attributes;this.rectX=Math.min(t.left,t.right),this.rectY=Math.min(t.top,t.bottom),this.rectWidth=Math.abs(t.right-t.left),this.rectHeight=Math.abs(t.top-t.bottom),this.detectChange()}postCreate(e){this.renderer.postCreate(e),(A.isCheckBox(this.data,this.acroFormService.acroFields)||A.isRadioWidget(this.data,this.acroFormService.acroFields))&&this.annotService.updateCheckableButtonAppearance(this.data),this.validate()}verticesOf(e,t,o){return this.editService.createRectVertices(t,o)}postEdit(e,t){this.validate(),this.transformStyle.transform=T.EMPTY_STRING,this.form?.postEdit&&this.form.postEdit(e,t),this.ngOnChanges({}),this.detectChange()}pvOnVertexMove(e,t,o){if(this.renderer.status=Z.EDIT,!this.editService.resizeByRectVertex(this.data,t,o))return;let s=this.data.attributes.rect;this.transformStyle.transform=`translate(${Math.min(s.left,s.right)-this.srcRect.left}px, ${this.srcRect.top-Math.max(s.top,s.bottom)}px)`,this.setFieldRotateStyle(),this.form?.pvOnVertexMove&&this.form.pvOnVertexMove(void 0,void 0,void 0),this.detectChange()}caseCheckableButton(e){return e==="Cb"||e==="Rb"?e:null}setFieldRotateStyle(){let e=U.elementStyleOf(this.data);this.widgetStyle.width=e.width,this.widgetStyle.height=e.height,Object.assign(this.widgetStyle,U.fieldRotateStyleOf(this.data,e))}isComponentInitialized(){return this.acroFieldsInit&&this.preferences!==null&&this.canEdit!==null}isSignature(){return this.type==="Sig"}emitWidgetMouseDownEvent(){let e=T.deepClone(this.data);e.attributes.Parent=T.deepClone(this.acroFormService.acroFields[this.data.attributes.Parent]),this.annotService.fireWidgetMousedownEvent(e)}updateAcroField(){this.acroField=this.acroFormService.getAcroField(this.data.attributes.Parent),this.type=this.acroField?.FT||this.data.attributes.FT}validate(){U.validateRect(this.data.attributes.rect)}detectChange(){if(!this.isComponentInitialized()||this.changeDetectorRef.destroyed)return;this.renderer&&(this.renderer.render(),this.rectWidth=this.renderer.rectWidth,this.rectHeight=this.renderer.rectHeight),this.data.attributes.Parent&&this.updateAcroField();let e=this.form;this.setFieldRotateStyle(),this.detectWithChild&&e?.detectChange&&(e.detectChange(),this.detectWithChild=!1),this.changeDetectorRef.detach(),this.changeDetectorRef.detectChanges(),this.changeDetectorRef.reattach()}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Lt),m(ge),m(Re),m(It),m(_t),m(Y),m(P),m(Oi),m(xe),m(zn),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-widget"]],viewQuery:function(t,o){if(t&1&&se(cf,5),t&2){let s;ae(s=ce())&&(o.form=s.first)}},inputs:{data:"data",status:"status"},standalone:!1,features:[$([P]),Ie],decls:3,vars:3,consts:[["form",""],[3,"ngSwitch","title","ngStyle","mousedown","click","touchstart",4,"ngIf"],["class","absolute","id","background",3,"ngStyle",4,"ngIf"],["class","title-container",3,"left-align","width","height","ngStyle",4,"ngIf"],[3,"mousedown","click","touchstart","ngSwitch","title","ngStyle"],[3,"ngStyle"],[3,"data",4,"ngSwitchCase"],[3,"data","canEdit",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"data"],[3,"data","canEdit"],["id","background",1,"absolute",3,"ngStyle"],["fill","none"],[1,"title-container",3,"ngStyle"],[1,"title-text"]],template:function(t,o){t&1&&R(0,ff,9,10,"div",1)(1,gf,3,14,"svg",2)(2,Cf,3,10,"div",3),t&2&&(p("ngIf",o.type&&o.status!==o.AnnotStatus.CREATE),l(),p("ngIf",o.type&&o.status!==o.AnnotStatus.PREVIEW),l(),p("ngIf",o.type&&o.canEdit&&o.status!==o.AnnotStatus.CREATE&&o.status!==o.AnnotStatus.PREVIEW))},styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}div[_ngcontent-%COMP%]{width:100%;height:100%;display:block}svg[_ngcontent-%COMP%]{left:0;top:0}svg#background[_ngcontent-%COMP%]{z-index:-1;cursor:crosshair}.title-container[_ngcontent-%COMP%]{position:absolute;left:0;top:0;display:flex;align-items:center;justify-content:center;overflow:hidden}.title-container.left-align[_ngcontent-%COMP%]{justify-content:flex-start}.title-container.left-align[_ngcontent-%COMP%]   .title-text[_ngcontent-%COMP%]{transform-origin:0 center}.title-container[_ngcontent-%COMP%]   .title-text[_ngcontent-%COMP%]{width:auto;height:auto;color:#fff;padding:0 2px;font-family:NotoSans-Regular;font-size:10px;transform-origin:center;transform:scale(.8)}.SELECT_ANNOT[_nghost-%COMP%]:hover, .SELECT_ANNOT   [_nghost-%COMP%]:hover, .SELECT_ANNOT.hover[_nghost-%COMP%], .SELECT_ANNOT   .hover[_nghost-%COMP%]{opacity:.3}"],changeDetection:0}));let r=n;return r})();var sp=(()=>{let n=class n{elementRef;changeDetectorRef;annotService;loggingService;data;_annotStyle={};widget;rendererMap={Cb:ls,Rb:ps};appearanceTypeMap={4:"check",l:"circle",8:"cross",u:"diamond",n:"square",H:"star"};selectBtnRenderer=null;lastRenderedImageInfo={width:0,height:0,appearanceType:null};constructor(e,t,o,s,c){this.elementRef=e,this.changeDetectorRef=t,this.annotService=o,this.loggingService=s,this.widget=c}ngOnChanges(){this.widget.status!==Z.CREATE&&U.hasAppearance(this.data.attributes.appearance)&&(this.lastRenderedImageInfo.width=this.widget.rectWidth,this.lastRenderedImageInfo.height=this.widget.rectHeight,this.lastRenderedImageInfo.appearanceType=this.data.attributes.MK?.CA||(this.widget.type==="Cb"?"4":"l")),this.detectChange()}get onValue(){let e="";return this.data.attributes.AP_N.forEach(t=>{t.toLowerCase()!=="off"&&(e=t)}),e}get annotStyle(){return this.selectBtnRenderer&&(this._annotStyle["background-image"]=this.selectBtnRenderer.buttonStyle(this.widget.value===this.onValue)),this.widget.isReadonly()?this._annotStyle.cursor="default":this._annotStyle.cursor=null,this._annotStyle}buttonClick(){this.widget.isReadonly()||(this.selectBtnRenderer.buttonAction(this.onValue),this.detectChange())}postEdit(e,t){this.isValidAppearance()||(this.data.attributes.appearance=void 0,this.annotService.updateCheckableButtonAppearance(this.data))}detectChange(){if(this.changeDetectorRef.destroyed)return;let e=this.widget.type;if(this.widget.renderer.status===Z.EDIT||this.data.attributes.appearance===void 0||this.widget.isNeedHighlight()){let t=this.data.attributes.MK?.CA||(this.widget.type==="Cb"?"4":"l"),o=this.widget.type==="Cb"?"assets/images/checkbox":"assets/images/radio";this.selectBtnRenderer=Se.hasKey(this.rendererMap,e)&&Se.hasKey(this.appearanceTypeMap,t)?new this.rendererMap[e](this,`url(${o}/${this.appearanceTypeMap[t]}.svg)`,`url(${o}/unchecked.svg)`):null}else if(this.data.attributes.appearance!==void 0){let t=this.data.attributes.appearance?.find(s=>s.state!=="Off"),o=this.data.attributes.appearance?.find(s=>s.state==="Off");(!T.isDefined(t)||!T.isDefined(o))&&this.loggingService.common("warn",le.NOT_EXIST,"on/off AP"),this.selectBtnRenderer=Se.hasKey(this.rendererMap,e)?new this.rendererMap[e](this,`url('data:image/png;base64,${t?.data}')`,`url('data:image/png;base64,${o?.data}')`):null}this.changeDetectorRef.detectChanges()}isValidAppearance(){return this.lastRenderedImageInfo.width===this.widget.rectWidth&&this.lastRenderedImageInfo.height===this.widget.rectHeight&&this.lastRenderedImageInfo.appearanceType===(this.data.attributes.MK?.CA||(this.widget.type==="Cb"?"4":"l"))}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Y),m(Re),m(De),m(ti,1))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-form-checkable-button"]],inputs:{data:"data"},standalone:!1,features:[$([P]),Ie],decls:1,vars:1,consts:[[3,"click","ngStyle"]],template:function(t,o){t&1&&(h(0,"div",0),O("click",function(){return o.buttonClick()}),_()),t&2&&p("ngStyle",o.annotStyle)},dependencies:[Ce],styles:["div[_ngcontent-%COMP%]{width:100%;height:100%;display:block;margin:0;padding:0;cursor:pointer;border:none;background-color:#fff0;background-size:contain;background-repeat:no-repeat;background-position:center center}"]}));let r=n;return r})();var Tf=["container"],Ef=["selectionContainer"];function Sf(r,n){r&1&&I(0,"i",6)}function xf(r,n){if(r&1){let i=w();h(0,"div",8),O("mousedown",function(){let t=f(i).index,o=d(2);return g(o.onItemClicked(t))}),M(1),_()}if(r&2){let i=n.$implicit,e=d(2);l(),k(e.getDisplayName(i))}}function vf(r,n){if(r&1&&(h(0,"section",3,1),R(2,xf,2,1,"div",7),_()),r&2){let i=d();p("ngStyle",i.selectionContainerStyle),l(2),p("ngForOf",i.widget.opt)}}var ap=(()=>{let n=class n{elementRef;contentService;changeDetectorRef;pageService;subscriptionService;data;containerEl;selectionContainerEl;widget;selectionContainerStyle={};_active=!1;autoFitFontSize=0;currentPage;constructor(e,t,o,s,c,u){this.elementRef=e,this.contentService=o,this.changeDetectorRef=s,this.pageService=c,this.subscriptionService=u,this.widget=t}ngOnInit(){this.subscriptionService.push(this.pageService.pdfPages$.subscribe({next:e=>this.currentPage=e[this.data.attributes.pageIdx]}))}get active(){return this._active}set active(e){this.widget.isReadonly()||(this._active=e,e?setTimeout(()=>{this.determineSelectionPosition(),this.selectionContainerStyle.visibility="visible",this.detectChange(!1)}):this.selectionContainerStyle.visibility="hidden",this.contentService.fireAnnotEvent({sdEventType:e?fe.FOCUSED:fe.UNFOCUSED,annot:this.data}))}get itemStyle(){let e=`${this.data.attributes.fontSize||this.autoFitFontSize}px`,t=this.data.attributes.fontColor,o=this.data.attributes.fontName;return{fontSize:e,color:t,fontFamily:o}}get containerStyles(){let e=`${this.data.attributes.fontSize}px`,t=this.data.attributes.fontColor;return{background:this.active?"#C4E5F6":"rgba(255, 255, 255, 0)",outline:this.active?"1px solid #4D90FE":"none",fontSize:e,fontColor:t}}getActiveItem(){return this.widget.selectedItems?.length>0?this.widget.opt[this.widget.selectedItems[0]]:null}getDisplayName(e){return e?typeof e=="string"?e:e[1]:""}getValue(e){return typeof e=="string"?e:e[0]}onItemClicked(e){this.widget.selectedItems=[e],this.widget.value=this.getValue(this.widget.opt[e]),this.containerEl.nativeElement.blur(),this.detectChange()}detectChange(e=!0){this.changeDetectorRef.destroyed||(!this.data.attributes.fontSize&&e&&this.fitFontSize(),this.changeDetectorRef.detectChanges())}fitFontSize(){if(this.getDisplayName(this.getActiveItem()).length===0)return;let o=!1,s=this.containerEl.nativeElement;for(;this.autoFitFontSize<300&&s.scrollHeight-1<=s.clientHeight&&s.scrollWidth-1<=s.clientWidth;)++this.autoFitFontSize,this.detectChange(!1);for(s.scrollHeight-1>s.clientHeight&&(o=!0);this.autoFitFontSize>10&&(s.scrollHeight-1>s.clientHeight||s.scrollWidth-1>s.clientWidth);)--this.autoFitFontSize,this.detectChange(!1);this.autoFitFontSize<10&&(this.autoFitFontSize=10),o&&(this.autoFitFontSize-=3),this.detectChange(!1)}determineSelectionPosition(){let e=this.selectionContainerEl.nativeElement.offsetHeight,t=this.data.attributes.rect;!this.selectionContainerEl||t.bottom-e>=this.currentPage.bbox.y?(this.selectionContainerStyle.top="100%",this.selectionContainerStyle.bottom=null):(this.selectionContainerStyle.top=null,this.selectionContainerStyle.bottom="100%")}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(ti,1),m(ge),m(Y),m(bt),m(P))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-form-combo-box"]],viewQuery:function(t,o){if(t&1&&(se(Tf,7),se(Ef,5)),t&2){let s;ae(s=ce())&&(o.containerEl=s.first),ae(s=ce())&&(o.selectionContainerEl=s.first)}},inputs:{data:"data"},standalone:!1,features:[$([P])],decls:6,vars:5,consts:[["container",""],["selectionContainer",""],["id","container","tabIndex","-1",3,"blur","focus","ngStyle"],[3,"ngStyle"],["aria-hidden","true","class","papycon papycon-chevron-down",4,"ngIf"],[3,"ngStyle",4,"ngIf"],["aria-hidden","true",1,"papycon","papycon-chevron-down"],["class","items",3,"mousedown",4,"ngFor","ngForOf"],[1,"items",3,"mousedown"]],template:function(t,o){if(t&1){let s=w();h(0,"div",2,0),O("blur",function(){return f(s),g(o.active=!1)})("focus",function(){return f(s),g(o.active=!0)}),h(2,"span",3),M(3),_(),R(4,Sf,1,0,"i",4),_(),R(5,vf,3,2,"section",5)}t&2&&(p("ngStyle",o.containerStyles),l(2),p("ngStyle",o.itemStyle),l(),k(o.getDisplayName(o.getActiveItem())),l(),p("ngIf",o.active),l(),p("ngIf",o.active))},dependencies:[Ue,be,Ce],styles:["div#container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:space-between;overflow:hidden}div[_ngcontent-%COMP%]{cursor:default}div.items[_ngcontent-%COMP%]{font-size:12px;overflow:hidden}i[_ngcontent-%COMP%]{font-size:10px;padding:0 5px 0 3px}section[_ngcontent-%COMP%]{position:absolute;width:100%;box-sizing:border-box;background:#fff;border:1px solid #000000}div.items[_ngcontent-%COMP%]:hover{background:#4d90fe;color:#fff}"]}));let r=n;return r})();var Of=["container"],bf=["items"];function If(r,n){if(r&1){let i=w();h(0,"div",4,1),O("mousedown",function(t){let o=f(i).index,s=d();return g(s.onItemClicked(t,o))}),M(2),_()}if(r&2){let i=n.$implicit,e=n.index,t=d();p("ngStyle",t.itemStyles(e)),l(2),k(t.getDisplayName(i))}}var cp=(()=>{let n=class n{elementRef;changeDetectorRef;data;containerEl;itemsEl;widget;_active=!1;longestNameLength=0;containerWidth=0;totalItemsCount=0;autoFontSize=64;constructor(e,t,o){this.elementRef=e,this.changeDetectorRef=o,this.widget=t}get active(){return this._active}set active(e){this.widget.isReadonly()||(this._active=e)}ngAfterViewInit(){this.widget.selectedItems.length>0&&(this.containerEl.nativeElement.scrollTop=this.itemsEl.toArray()[this.widget.selectedItems[0]].nativeElement.offsetTop)}get containerStyles(){return this.magnifyAutoFont(),this.containerWidth=this.containerEl.nativeElement.offsetWidth,{"overflow-y":this.active?"auto":"hidden",outline:this.active?"1px solid #4D90FE":"none"}}isFontSizeAuto(){return this.data.attributes.fontSize===0}magnifyAutoFont(){if(this.isFontSizeAuto()){if(this.containerWidth<this.containerEl.nativeElement.offsetWidth&&this.containerWidth!==0){let e=(this.containerEl.nativeElement.offsetWidth-this.containerWidth+this.containerWidth)/this.containerWidth;this.autoFontSize=this.autoFontSize*e}this.totalItemsCount!==this.widget.opt.length&&(this.totalItemsCount=this.widget.opt.length,this.autoFontSize=64)}}itemStyles(e){let t=`${this.data.attributes.fontSize===0?this.autoFontSize:this.data.attributes.fontSize}px`,o=this.data.attributes.fontColor,s=this.data.attributes.fontName;return this.isActiveItem(e)?{background:"#4D90FE",color:"#FFF",fontSize:t,fontFamily:s}:{background:null,color:o,fontSize:t,fontFamily:s}}getDisplayName(e){let t=typeof e=="string"?e:e[1];return this.longestNameLength=this.longestNameLength<t.length?t.length:this.longestNameLength,t}getValue(e){return typeof e=="string"?e:e[0]}onItemClicked(e,t){this.active&&(e.stopPropagation(),this.widget.selectedItems=[t],this.widget.value=this.getValue(this.widget.opt[t]))}detectChange(e=!0){this.changeDetectorRef.destroyed||(!this.data.attributes.fontSize&&e&&(this.changeDetectorRef.detectChanges(),this.autoFontSizeCheck()),this.changeDetectorRef.detectChanges())}autoFontSizeCheck(){this.isFontSizeAuto()&&this.itemsEl!==void 0&&this.itemsEl.forEach(e=>{if(e.nativeElement.offsetWidth<e.nativeElement.scrollWidth){if(this.autoFontSize>12)for(;e.nativeElement.offsetWidth<e.nativeElement.scrollWidth&&this.autoFontSize>12;)this.autoFontSize--,this.detectChange(!1);return}}),this.containerEl.nativeElement.offsetHeight<this.autoFontSize&&(this.autoFontSize=this.containerEl.nativeElement.offsetHeight)}isActiveItem(e){return this.widget.selectedItems.length===0?!1:this.widget.selectedItems[0]===e}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(ti,1),m(Y))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-form-list-box"]],viewQuery:function(t,o){if(t&1&&(se(Of,7),se(bf,5)),t&2){let s;ae(s=ce())&&(o.containerEl=s.first),ae(s=ce())&&(o.itemsEl=s)}},inputs:{data:"data"},standalone:!1,features:[$([P])],decls:3,vars:2,consts:[["container",""],["items",""],["id","container","tabIndex","-1",3,"blur","focus","ngStyle"],["class","items",3,"ngStyle","mousedown",4,"ngFor","ngForOf"],[1,"items",3,"mousedown","ngStyle"]],template:function(t,o){if(t&1){let s=w();h(0,"div",2,0),O("blur",function(){return f(s),g(o.active=!1)})("focus",function(){return f(s),g(o.active=!0)}),R(2,If,3,2,"div",3),_()}t&2&&(p("ngStyle",o.containerStyles),l(2),p("ngForOf",o.widget.opt))},dependencies:[Ue,Ce],styles:["div#container[_ngcontent-%COMP%]{width:100%;height:100%;overflow-x:hidden;background:#fff0}.items[_ngcontent-%COMP%]{font-size:12px;white-space:nowrap}"]}));let r=n;return r})();function yf(r,n){if(r&1&&(h(0,"section"),I(1,"div",3),_()),r&2){let i=d();l(),p("ngStyle",i.styles)}}function Af(r,n){if(r&1&&(ne(),h(0,"g"),I(1,"rect",4)(2,"rect",5),h(3,"text",6),M(4),E(5,"translate"),_()()),r&2){let i=d();l(),G("width",i.widget.widgetStyle.width)("height",i.widget.widgetStyle.height),l(),G("width",i.getLanguage()==="en"?48:28)("transform",i.getLanguage()==="en"?"translate(-24,-7)":"translate(-14,-9)"),l(),G("letter-spacing",i.getLanguage()==="en"?"0.2ch":"0.5ch")("font-size",i.fontSize),l(),k(S(5,7,"SIGN"))}}var la=(()=>{let n=class n{elementRef;changeDetectorRef;contentService;documentService;renderer;pageService;acroFormService;annotService;subscriptionService;i18nService;signatureService;data;canEdit;fontSize=6;pdfDoc;timer=null;styles_={};widget;hasSignedSignature=!1;canvas;imageData=T.EMPTY_STRING;backgroundColor=[0,0,0,0];validityImgMap={F:"verify-fail.png",S:"valid.png",M:"invalid.png"};_tsaParam;get tsaParam(){return this._tsaParam}constructor(e,t,o,s,c,u,C,x,N,D,X,Q){this.elementRef=e,this.changeDetectorRef=t,this.contentService=o,this.documentService=s,this.renderer=c,this.pageService=u,this.acroFormService=x,this.annotService=N,this.subscriptionService=D,this.i18nService=X,this.signatureService=Q,this.widget=C,this.canvas=this.renderer.createElement("canvas"),this._tsaParam=T.deepClone(this.signatureService.getTSAParam(this.data?.attributes??this.widget.acroField))}ngOnInit(){this.initSubscription()}ngOnChanges(e){e.data&&this.updateAppearance()}getLanguage(){return this.i18nService.language}get canSign(){return!this.hasSignedSignature||this.documentService.checkAuthority(Be.FILL_FORM)}renderDefaultAppearance(){return!this.data.attributes.appearance&&!this.canEdit&&!this.widget.isReadonly()&&!this.widget.value}onClick(e){if(this.widget.isReadonly()||!this.canSign||this.data.attributes.V||this.documentService.isDAP)return!0;e.preventDefault(),e.stopPropagation(),this.subscriptionService.set("openSignatureDrawDialog",this.signatureService.openSignatureDrawDialog(this.pdfDoc.streamdocsId,this.data).pipe(jo(t=>{throw this.signatureService.toggleOverlay(!1),t})).subscribe({next:t=>{t&&(this.data.attributes.appearance=t.attributes.appearance,this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotEvent({sdEventType:fe.UPDATE,pageIdx:this.data.attributes.pageIdx,annot:this.data}))}}))}detectChange(e=!0){this.changeDetectorRef.destroyed||(e&&this.updateAppearance(),this.changeDetectorRef.detectChanges())}updateAppearance(){this.timer&&(this.timer.unsubscribe(),this.timer=null);let e=this.data.attributes.appearance;if(e){let t=this.canvas.getContext("2d");if(t===null)throw new wi("Failed to get CanvasRenderingContext2D");t.imageSmoothingEnabled=!1,this.timer=ve.runAsync(()=>{let o=new Image;o.onload=()=>{if(!U.hasAppearance(this.data.attributes.appearance))return;t.canvas.width=o.naturalWidth,t.canvas.height=o.naturalHeight,t.drawImage(o,0,0);let s=t.getImageData(0,0,1,1).data;for(let c=0;c<4;++c)this.backgroundColor[c]=s[c];this.renderCanvas(),this.validateDocument(),this.timer?.unsubscribe(),this.timer=null},o.src=`data:image/${e.format};base64,${e.data}`})}else this.imageData=T.EMPTY_STRING}renderCanvas(){this.imageData=this.canvas.toDataURL("image/png"),this.detectChange(!1)}get styles(){return this.styles_.backgroundImage=`url(${this.imageData})`,this.styles_}initSubscription(){this.subscriptionService.push(this.documentService.openedDocument$.pipe(L(T.isDefined)).subscribe({next:e=>this.pdfDoc=e}),this.contentService.annotEvent$.pipe(L(e=>e?.annot.oid===this.data.oid)).subscribe({next:()=>this.detectChange()}),this.acroFormService.hasSignedSignature$.subscribe({next:e=>this.hasSignedSignature=e}))}validateDocument(){this.subscriptionService.push(this.signatureService.tsaVerifyCache$.pipe(L(()=>T.isDefined(this.tsaParam)&&this.data.attributes.V.Contents),Gt(e=>this.documentService.isDAP?this.documentService.pageDescriptions$.pipe(L(T.isDefined),ii(1),St(t=>{let o=t[this.pageService.originalPdfPages[this.data.attributes.pageIdx].ref];return e[o.refId]})):Hi(e[1])),L(e=>!!e)).subscribe({next:e=>{e.validity==="S"?this.setValidity(e):this.setValidity(e.validity),this.detectChange(!1)}}))}get baseBox(){return this.tsaParam?{width:this.tsaParam.baseBox.w,height:this.tsaParam.baseBox.h}:{width:this.canvas.width,height:this.canvas.height}}get baseBoxCanvasRatio(){return{x:this.canvas.width/this.baseBox.width,y:this.canvas.height/this.baseBox.height}}get blockArea(){return this.tsaParam?this.tsaParam.blockArea.map(e=>{let t=this.baseBoxCanvasRatio;return e.x*=t.x,e.y*=t.y,e.w*=t.x,e.h*=t.y,e}):[]}get txtBox(){if(!this.tsaParam){let o=this.baseBox;return{x:0,y:0,w:o.width,h:o.height}}let e=this.tsaParam.txtBox,t=this.baseBoxCanvasRatio;return e.x*=t.x,e.y*=t.y,e.w*=t.x,e.h*=t.y,e}get txtWithTimestrBox(){if(!this.tsaParam){let o=this.baseBox;return{x:0,y:0,w:o.width,h:o.height}}let e=this.tsaParam.txtWithTimestrBox,t=this.baseBoxCanvasRatio;return e.x*=t.x,e.y*=t.y,e.w*=t.x,e.h*=t.y,e}calcCenterFit(e,t){let o=t.width/t.height;if(e.w/e.h>o){let c={w:e.h*o,h:e.h};return Oe({x:(e.w-c.w)/2+e.x,y:e.y},c)}else{let c={w:e.w,h:e.w/o};return Oe({x:e.x,y:(e.h-c.h)/2+e.y},c)}}setValidity(e){if(!this.canvas||this.documentService.isDAP)return;let t,o,s=e;typeof s!="string"&&(t=s.text,o=s.fontName,s=s.validity);let c=new Image;c.onload=()=>{let u=this.canvas.getContext("2d");if(u===null)throw new wi("Failed to get CanvasRenderingContext2D");let C=360-this.pageService.pdfPages[this.data.attributes.pageIdx].r,x=0,N=0;C>0&&((C===90||C===180)&&(N=this.canvas.height),(C===180||C===270)&&(x=this.canvas.width),u.save(),u.rotate(C*Math.PI/180),u.translate(-x,-N)),u.save(),this.blockArea.forEach(X=>{u.clearRect(X.x,X.y,X.w,X.h),u.fillStyle=`rgba(
          ${this.backgroundColor[0]},
          ${this.backgroundColor[1]},
          ${this.backgroundColor[2]},
          ${this.backgroundColor[3]}
        )`,u.fillRect(X.x,X.y,X.w,X.h)});let D;if(s==="S"?D=this.calcCenterFit(t&&o?this.txtWithTimestrBox:this.txtBox,{width:c.naturalWidth,height:c.naturalHeight}):D={x:0,y:0,w:this.canvas.width,h:this.canvas.height},u.drawImage(c,D.x,D.y,D.w,D.h),u.restore(),this.signatureService.shouldRenderTimeStamp&&t&&o){u.font=`${6*this.canvas.height/60}px ${o}`;let X=33*this.canvas.height/60;u.textAlign="center",t.split(`
`).forEach((Q,ft)=>{u.fillText(Q,this.canvas.width/2,X+6*ft*this.canvas.height/60)})}u.restore(),this.renderCanvas()},c.src=`assets/images/time-stamp/${this.validityImgMap[s]||this.validityImgMap.F}`}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Y),m(ge),m(It),m(Qt),m(bt),m(ti,1),m(Lt),m(Re),m(P),m(Sr),m(Wn))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-form-signature"]],inputs:{data:"data",canEdit:"canEdit"},standalone:!1,features:[$([P]),Ie],decls:4,vars:2,consts:[[4,"ngIf"],[1,"focused-container"],["focusable","false",1,"absolute",3,"click"],[3,"ngStyle"],["fill","#f79f1a","fill-opacity","0.08","stroke","#f79f1a","stroke-width","1"],["fill","#1e1e1e","height","16","x","50%","y","50%"],["x","50%","y","50%","alignment-baseline","middle","text-anchor","middle","fill","#ffffff"]],template:function(t,o){t&1&&(R(0,yf,2,1,"section",0),h(1,"div",1),ne(),h(2,"svg",2),O("click",function(c){return o.onClick(c)}),R(3,Af,6,9,"g",0),_()()),t&2&&(p("ngIf",o.data.attributes.appearance),l(3),p("ngIf",o.renderDefaultAppearance()))},styles:["canvas[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;display:block}div[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;display:block;background-repeat:no-repeat;background-size:contain;background-position:center}text[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Regular,sans-serif}"]}));let r=n;return r})();var Rf=["txtArea"],Pf=["sizeCheckerArea"];function Nf(r,n){if(r&1&&I(0,"div",5),r&2){let i=d();p("ngStyle",i.appearanceStyle)}}var ms=class{text;rect;constructor(n,i){this.text=n,this.rect=i}equals(n){return this.text===n.text&&this.rect.width===n.rect.width&&this.rect.height===n.rect.height}},us=2,Mf=12,Df=300,lp=(()=>{let n=class n{elementRef;changeDetectorRef;acroFormService;scriptService;contentService;subscriptionService;store$;txtAreaElementRef;sizeCheckerAreaElementRef;data;appearanceStyle={};calculatedFontSize=us;widget;focused=!1;lastCalculationContext=new ms(void 0,{width:0,height:0});checkerFontSize=0;_annotStyle={};get sizeCheckerStyle(){if(!T.isDefined(this._annotStyle.height))throw new Mt("Annotation style height is not defined");return rt(Oe({},this._annotStyle),{height:`${Number.parseInt(this._annotStyle.height)*.9}px`,"font-size":`${this.checkerFontSize}px`})}formControl=new tt;get isEdited(){let e=this.acroFormService.lastFetchedAcroFields?.get(this.data.attributes.Parent),t=this.widget.acroField?.Ff,o=e?.Ff!==void 0&&Li.isMultiLine(e.Ff),s=t!==void 0&&Li.isMultiLine(t);return this.widget.isEdited()||this.focused||o!==s}lastFocusedValue;dragMode;constructor(e,t,o,s,c,u,C,x){this.elementRef=e,this.changeDetectorRef=t,this.acroFormService=o,this.scriptService=s,this.contentService=u,this.subscriptionService=C,this.store$=x,this.widget=c}ngOnInit(){this.formControl.setValue(this.widget.value,{emitEvent:!1}),this.updateAppearanceStyle(),this.subscriptionService.push(this.contentService.fieldEvent$.pipe(L(T.isDefined),L(e=>e.fieldTitle===this.widget.title),L(()=>this.data.attributes.fontSize===0)).subscribe({next:()=>this.sizeChecker(this.widget.value)}),this.store$.pipe(_e("dragMode")).subscribe({next:e=>{this.dragMode=e,this.changeDetectorRef.markForCheck()}}),this.formControl.valueChanges.subscribe({next:e=>this.onChangeValue(e)}))}ngOnChanges(){this.updateAppearanceStyle(),this.detectChange()}ngAfterViewInit(){this.widget.canEdit||this.data.action!=="create"||this.txtAreaElementRef.nativeElement.focus()}get fontSize(){return this.isEdited||!this.imageUrl?this.data.attributes.fontSize||this.calculatedFontSize:0}get fontName(){return this.data.attributes.fontName}get imageUrl(){let{appearance:e}=this.data.attributes;return e===void 0?"":`url(data:image/${e.format};base64,${e.data})`}get annotStyle(){if(this._annotStyle.fontSize=`${this.fontSize}px`,this._annotStyle.fontFamily=this.fontName,this._annotStyle.fontFamily=JSON.stringify(this._annotStyle.fontFamily),this._annotStyle.textAlign=this.data.attributes.alignment,this._annotStyle.color=this.data.attributes.fontColor,this._annotStyle.width=`${this.widget.rectWidth-(this.data.attributes.width||0)*2}px`,this._annotStyle.height=`${this.widget.rectHeight-(this.data.attributes.width||0)*2}px`,this._annotStyle.lineHeight=this.isMultiLine?null:this._annotStyle.height,this.data.attributes.MK===void 0)return this._annotStyle;let e=this.data.attributes.MK.R;return(e===90||e===270)&&(this._annotStyle.width=`${this.widget.rectHeight-(this.data.attributes.width||0)*2}px`,this._annotStyle.height=`${this.widget.rectWidth-(this.data.attributes.width||0)*2}px`),this._annotStyle.whiteSpace=this.isMultiLine?"pre-wrap":"pre",this._annotStyle}get isMultiLine(){return Li.isMultiLine(this.widget.flag)}get tabIndex(){return this.dragMode===ye.SELECT_ANNOT||this.dragMode===ye.AUTO?-1:null}onFocus(){this.focused=!0,this.lastFocusedValue=this.widget.value}onBlur(e){this.widget.value=e.target.value,this.focused=!1,this.lastFocusedValue!==this.widget.value&&this.scriptService.executeAll(this.acroFormService.acroFields,!1,qi.MERGE_WITH_PREVIOUS)}onChangeValue(e){let t=e,o=t;this.isMultiLine||(o=t.replace(/\n/g,T.EMPTY_STRING),t!==o&&(this.formControl.setValue(o,{emitEvent:!1}),t=o)),o!==t&&(this.formControl.setValue(o),t=o),this.widget.value=t,this.detectChange(),this.contentService.fireFieldEvent({sdEventType:fe.UPDATE,fieldTitle:this.widget.title})}sizeChecker(e){if(this.fontSize===null||this.data.attributes.fontSize)return;let t=this.isMultiLine?Mf:Df,o=this.txtAreaElementRef.nativeElement;if(!o.value){this.calculatedFontSize=Math.max(Math.min(o.scrollHeight*.8,t),us),this.detectChange(!1);return}if(this.isMultiLine){let N=this.sizeCheckerAreaElementRef?.nativeElement;if(!N)return;for(this.checkerFontSize=t,N.value=N.value,this.detectChange(!1);this.checkerFontSize>us&&N.scrollHeight-1>N.clientHeight;)--this.checkerFontSize,N.value=N.value,this.detectChange(!1);this.calculatedFontSize=this.checkerFontSize,this.detectChange(!1);return}let s=new ms(e,{width:this.widget.rectWidth,height:this.widget.rectHeight});if(this.calculatedFontSize===0||this.lastCalculationContext.equals(s))return;this.lastCalculationContext=s;let{fontFamily:c}=window.getComputedStyle(o),u={width:this.calculateTextWidth(c,this.calculatedFontSize,e),height:this.calculateTextHeight(c,this.calculatedFontSize,e)},C=o.clientWidth/u.width,x=o.clientHeight/u.height;this.calculatedFontSize=Math.max(Math.min(this.calculatedFontSize*Math.min(C,x)*.9,t),us),this.detectChange(!1)}pvOnVertexMove(e,t,o){this.detectChange()}detectChange(e=!0){this.changeDetectorRef.destroyed||(!this.data.attributes.fontSize&&e&&this.sizeChecker(this.txtAreaElementRef.nativeElement.value),this.formControl.setValue(this.widget.value,{emitEvent:!1}),this.changeDetectorRef.detectChanges())}updateAppearanceStyle(){let e=U.fieldRotateStyleOf(this.data);if(e){let t=this.data.attributes.MK;this.appearanceStyle.width=e.height,this.appearanceStyle.height=e.width,t&&(this.appearanceStyle.transform=`rotate(${t.R}deg)`),T.isDefined(e.left)&&(this.appearanceStyle.left=`${-parseInt(e.left,10)}px`),this.appearanceStyle.top=e.bottom}this.appearanceStyle.backgroundImage=this.imageUrl}calculateTextWidth(e,t,o){let s=document.createElement("canvas").getContext("2d");if(s===null)throw new wi("Failed to get CanvasRenderingContext2D");return s.font=`${t}px ${e}`,s.measureText(o).width}calculateTextHeight(e,t,o){let s=document.createElement("span");s.style.fontFamily=e,s.style.fontSize=`${t}px`,s.innerHTML=o;let c=document.createElement("div");c.style.display="inline-block",c.style.width="1px",c.style.height="0px",c.style.verticalAlign="bottom";let u=document.createElement("div");u.appendChild(s),u.appendChild(c),u.style.height="0px",u.style.overflow="hidden",document.body.appendChild(u);let C=this.getElementOffset(s),N=this.getElementOffset(c).top-C.top;return document.body.removeChild(u),Math.min(N,t)}getElementOffset(e){let t=e,o=0,s=0;if(t.offsetParent)do s+=t.offsetLeft,o+=t.offsetTop,t=t.offsetParent;while(t);else s+=t.offsetLeft,o+=t.offsetTop;return{top:o,left:s}}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Y),m(Lt),m(Oi),m(ti,1),m(ge),m(P),m(xe))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-form-text"]],viewQuery:function(t,o){if(t&1&&(se(Rf,7),se(Pf,7)),t&2){let s;ae(s=ce())&&(o.txtAreaElementRef=s.first),ae(s=ce())&&(o.sizeCheckerAreaElementRef=s.first)}},inputs:{data:"data"},standalone:!1,features:[$([P]),Ie],decls:6,vars:7,consts:[["txtArea",""],["sizeCheckerArea",""],[3,"blur","focus","formControl","ngStyle","readonly"],[1,"hidden",3,"ngStyle","value"],["class","appearance",3,"ngStyle",4,"ngIf"],[1,"appearance",3,"ngStyle"]],template:function(t,o){if(t&1){let s=w();h(0,"textarea",2,0),O("blur",function(u){return f(s),g(o.onBlur(u))})("focus",function(){return f(s),g(o.onFocus())}),M(2,"  "),_(),I(3,"textarea",3,1),R(5,Nf,1,1,"div",4)}t&2&&(p("formControl",o.formControl)("ngStyle",o.annotStyle)("readonly",o.widget.isReadonly()),G("tabIndex",o.tabIndex),l(3),p("ngStyle",o.sizeCheckerStyle)("value",o.widget.value),l(2),p("ngIf",!o.isEdited))},dependencies:[be,Ce,Xi,vt,gn],styles:["[_nghost-%COMP%]{display:flex;width:100%;height:100%;justify-content:center;align-items:center}textarea[_ngcontent-%COMP%]{width:100%;height:100%;display:block;margin:0;padding:0;box-sizing:border-box;resize:none;overflow:hidden;border:none;background:#fff0;background-size:100% 100%}.hidden[_ngcontent-%COMP%]{visibility:hidden;position:absolute;left:0;top:0;pointer-events:none;height:90%}.appearance[_ngcontent-%COMP%]{left:0;top:0;width:100%;height:100%;background-size:100%;position:absolute;pointer-events:none}"]}));let r=n;return r})();var wf=(r,n,i,e)=>({shape:r,stroke:n,strokeDasharray:i,fill:e,location:"start"}),Lf=(r,n,i,e)=>({shape:r,stroke:n,strokeDasharray:i,fill:e,location:"end"});function kf(r,n){if(r&1&&(ne(),h(0,"marker",6),I(1,"path",7),_()),r&2){let i=d();G("id",i.markerID.sp.def)("refX",i.environment.annotation.refX)("refY",i.environment.annotation.refY),l(),p("markerStyle",Mn(4,wf,i.data.attributes.LE==null?null:i.data.attributes.LE[0],i.lineStroke,i.markerDashArray,i.data.attributes.InteriorColor))}}function Ff(r,n){if(r&1&&(ne(),h(0,"marker",8),I(1,"path",7),_()),r&2){let i=d();G("id",i.markerID.ep.def),l(),p("markerStyle",Mn(2,Lf,i.data.attributes.LE==null?null:i.data.attributes.LE[1],i.lineStroke,i.markerDashArray,i.data.attributes.InteriorColor))}}function Vf(r,n){if(r&1&&(ne(),I(0,"path")),r&2){let i=d();G("id","lp-"+i.data.oid)("d",i.textPath)}}function Uf(r,n){if(r&1&&(ne(),I(0,"line")),r&2){let i=n.$implicit,e=d();G("stroke",e.lineStroke)("stroke-width",e.lineWidth)("stroke-dasharray",e.dashArray)("x1",i.x1)("y1",i.y1)("x2",i.x2)("y2",i.y2)}}function Bf(r,n){if(r&1&&(ne(),h(0,"text",9)(1,"textPath",10),M(2),_()()),r&2){let i=d();G("dy",i.annotLine.attributes.width*-6),l(),G("href",i.localhost+"#lp-"+i.data.oid,null,"xlink"),l(),k(i.measurement)}}var Po=(()=>{let n=class n{elementRef;contentService;editService;changeDetectorRef;subscriptionService;annotLine;status=Z.RENDER;lineAttrs={};dashArray=null;markerDashArray=null;measureLineCoords=[];measureLineAttrs=[];measurement="";viewClasses={absolute:!0,create:!1,remove:!1};get localhost(){return location.href}get lineStroke(){return this.annotLine.attributes.color}get lineWidth(){return this.annotLine.attributes.width}get environment(){return Fe}get data(){return this.annotLine}get isLineDimension(){return A.isLineDimension(this.data)}get screenCoord(){let e=this.annotLine.attributes.coordinates;if(!this.isLineDimension)return e;let t=this.getLineUnitVector(e),o=this.getNumberAttribute("LL"),s={x:-t.y*o,y:t.x*o};return{sp:{x:e.sp.x+s.x,y:e.sp.y+s.y},ep:{x:e.ep.x+s.x,y:e.ep.y+s.y}}}get textPath(){if(!this.lineAttrs||this.lineAttrs.x1===null||this.lineAttrs.y1===null||this.lineAttrs.x2===null||this.lineAttrs.y2===null)return null;let e={x:this.lineAttrs.x2-this.lineAttrs.x1,y:this.lineAttrs.y2-this.lineAttrs.y1},t=Math.sqrt(Math.pow(this.lineAttrs.x2-this.lineAttrs.x1,2)+Math.pow(this.lineAttrs.y2-this.lineAttrs.y1,2));return t===0?null:(e.x=e.x/t*100,e.y=e.y/t*100,`M ${Number(this.lineAttrs.x1)-Number(e.x)} ${Number(this.lineAttrs.y1)-Number(e.y)} L ${Number(this.lineAttrs.x2)+Number(e.x)} ${Number(this.lineAttrs.y2)+Number(e.y)}`)}markerID={};constructor(e,t,o,s,c){this.elementRef=e,this.contentService=t,this.editService=o,this.changeDetectorRef=s,this.subscriptionService=c}isExistLineMarker(e){return U.isExistLineMarker(e,this.data)}getNumberAttribute(e){return this.data?.attributes&&Se.hasKey(this.data.attributes,e)?this.data.attributes[e]:0}ngOnInit(){this.calcDistance(),this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(e=>e===null||e.from==="AnnotationViewComponent"?!1:e.annot.oid===this.data.oid)).subscribe({next:()=>{this.fitBox(),this.calcDistance(),this.detectChange()}}))}ngOnChanges(){this.render(),this.markerID.sp=U.createMarkerID(!0,this.data),this.markerID.ep=U.createMarkerID(!1,this.data)}pvOnMove(e){let{rect:t,coordinates:{ep:o}}=this.annotLine.attributes;o.x=e.offsetX,o.y=t.top-t.bottom-e.offsetY,this.calcDistance(),this.detectChange()}postCreate(e){this.annotLine.attributes.coordinates.sp.y+=e.bbox.y,this.annotLine.attributes.coordinates.ep.y+=e.bbox.y,this.fitBox()}verticesOf(e,t,o){let s=this.annotLine.attributes.coordinates,c=this.isLineDimension?[this.screenCoord.sp,this.screenCoord.ep,s.sp,s.ep]:[s.sp,s.ep];return this.editService.createPathVertices(e,o,...c)}postEdit(e,t){let o=this.data.attributes,s=o.coordinates;U.applyVertexDelta(t,s.sp,s.ep),this.isLineDimension&&(o.LL=Number(this.getNumberAttribute("LL").toFixed(0))),this.fitBox(),this.detectChange()}pvOnVertexMove(e,t,o){if(!this.isLineDimension){let s=this.data.attributes.coordinates[n.indexProperties[t]];U.applyVertexDelta(o,s),this.calcDistance(),this.detectChange();return}if(t>=2){let s=this.data.attributes.coordinates[n.indexProperties[t-2]];U.applyVertexDelta(o,s),this.calcDistance()}else this.resizeMeasureLength(o);this.detectChange()}isTouched(e){let t=this.annotLine.attributes.coordinates,o=8+this.data.attributes.width*Fe.hitTestToleranceConst;return this.isLineDimension?this.isMeasureLineTouched(e):!!this.isContained(t,e,o)}isMeasureLineTouched(e){let t=this.annotLine.attributes.coordinates,o=[...this.measureLineCoords,{sp:[this.measureLineCoords[1].sp,this.measureLineCoords[1].ep].find(c=>!this.compareTPoint(t.ep,c,!0))??this.measureLineCoords[1].sp,ep:[this.measureLineCoords[0].sp,this.measureLineCoords[0].ep].find(c=>!this.compareTPoint(t.sp,c,!0))??this.measureLineCoords[0].ep}],s=8+this.data.attributes.width*Fe.hitTestToleranceConst;for(let c of o)if(this.isContained(c,e,s))return!0;return!1}isContained(e,t,o){let s=new ht(e.ep.x-e.sp.x,e.ep.y-e.sp.y),c=new ht(t.x-e.sp.x,t.y-e.sp.y);return _n.innerProduct(s,c)>0&&_n.innerProduct(s,c)<s.norm()*s.norm()&&c.orthogonalTo(s).norm()<o}fitBox(e){this.calcMeasureLine(),U.fitBox(e||this.data.attributes.rect,this.annotLine.attributes.width+2,...[this.screenCoord,...this.measureLineCoords].reduce((t,o)=>(t.push(o.sp,o.ep),t),[...Wt.rotationCoord(this.screenCoord,this.data)]))}render(){if(!this.annotLine)return;this.viewClasses.create=this.status===Z.CREATE,this.viewClasses.remove=Z.REMOVE===this.status;let e=this.screenCoord,{rect:t,borderStyle:o,width:s}=this.annotLine.attributes;this.lineAttrs.x1=Number(U.transformX(e.sp.x,t).toFixed(1)),this.lineAttrs.y1=Number(U.transformY(e.sp.y,t).toFixed(1)),this.lineAttrs.x2=Number(U.transformX(e.ep.x,t).toFixed(1)),this.lineAttrs.y2=Number(U.transformY(e.ep.y,t).toFixed(1)),this.dashArray=o?.style==="dashed"?o.dashPattern.map(c=>c.toString()).reduce((c,u)=>(c&&`${c}, `)+u,T.EMPTY_STRING):null,this.markerDashArray=o?.style==="dashed"?o.dashPattern.map(c=>(c/s).toFixed(2)).reduce((c,u)=>(c&&`${c}, `)+u,T.EMPTY_STRING):null,this.calcMeasureLine(),this.renderLineDimension()}getLineUnitVector(e){let t=e.ep.x-e.sp.x,o=e.ep.y-e.sp.y,s=Math.sqrt(t*t+o*o);return s===0?{x:0,y:0}:{x:t/s,y:o/s}}calcMeasureLine(){if(!this.isLineDimension)return;let e=this.screenCoord,t=this.getNumberAttribute("LL"),o=this.getNumberAttribute("LLE"),s=Math.abs(t<0?o:t),c=Math.abs(t<0?t:o),u=this.getLineUnitVector(e);this.measureLineCoords=[{sp:{x:-u.y*c+e.sp.x,y:u.x*c+e.sp.y},ep:{x:u.y*s+e.sp.x,y:-u.x*s+e.sp.y}},{sp:{x:-u.y*c+e.ep.x,y:u.x*c+e.ep.y},ep:{x:u.y*s+e.ep.x,y:-u.x*s+e.ep.y}}]}renderLineDimension(){if(!this.isLineDimension)return;let e=this.data.attributes.rect;this.measureLineAttrs=[{x1:Number(U.transformX(this.measureLineCoords[0].sp.x,e).toFixed(1)),y1:Number(U.transformY(this.measureLineCoords[0].sp.y,e).toFixed(1)),x2:Number(U.transformX(this.measureLineCoords[0].ep.x,e).toFixed(1)),y2:Number(U.transformY(this.measureLineCoords[0].ep.y,e).toFixed(1))},{x1:Number(U.transformX(this.measureLineCoords[1].sp.x,e).toFixed(1)),y1:Number(U.transformY(this.measureLineCoords[1].sp.y,e).toFixed(1)),x2:Number(U.transformX(this.measureLineCoords[1].ep.x,e).toFixed(1)),y2:Number(U.transformY(this.measureLineCoords[1].ep.y,e).toFixed(1))}]}detectChange(){this.changeDetectorRef.destroyed||(this.render(),this.changeDetectorRef.markForCheck())}resizeMeasureLength(e){let t=this.annotLine.attributes.coordinates,o={x:t.ep.x-t.sp.x,y:t.ep.y-t.sp.y},s=o.y*e.x+o.x*e.y,c=Math.sqrt(e.x*e.x+e.y*e.y),u=Math.sqrt(o.y*o.y+o.x*o.x),C=c*u;if(C!==0){let x=s/C,N=c*x,D=this.getNumberAttribute("LL");this.annotLine.attributes.LL=D-N}}calcDistance(){A.isLineDimension(this.data)&&(this.measurement=mc.calcMeasurement(this.data),this.contentService.fireMeasureIndicatorEvent({action:"edit"}))}compareTPoint(e,t,o=!1){if(o){let s=c=>Math.round(c*1e3)/1e3;return s(e.x)===s(t.x)&&s(e.y)===s(t.y)}return e.x===t.x&&e.y===t.y}};v(n,"indexProperties",["sp","ep"]),v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(ge),m(_t),m(Y),m(P))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-line"]],inputs:{annotLine:"annotLine",status:"status"},standalone:!1,features:[$([P]),Ie],decls:8,vars:15,consts:[[3,"ngClass"],["markerWidth","20","markerHeight","10","orient","auto",4,"ngIf"],["markerWidth","20","markerHeight","10","refX","10","refY","5","orient","auto",4,"ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["font-family","Verdana","text-anchor","middle",4,"ngIf"],["markerWidth","20","markerHeight","10","orient","auto"],["sdMarkerPath","",3,"markerStyle"],["markerWidth","20","markerHeight","10","refX","10","refY","5","orient","auto"],["font-family","Verdana","text-anchor","middle"],["startOffset","50%"]],template:function(t,o){t&1&&(ne(),h(0,"svg",0)(1,"defs"),R(2,kf,2,9,"marker",1)(3,Ff,2,7,"marker",2)(4,Vf,1,2,"path",3),_(),I(5,"line"),R(6,Uf,1,7,"line",4)(7,Bf,3,3,"text",5),_()),t&2&&(p("ngClass",o.viewClasses),l(2),p("ngIf",o.isExistLineMarker(0)),l(),p("ngIf",o.isExistLineMarker(1)),l(),p("ngIf",o.isLineDimension),l(),G("stroke",o.lineStroke)("stroke-width",o.lineWidth)("stroke-dasharray",o.dashArray)("x1",o.lineAttrs.x1)("y1",o.lineAttrs.y1)("x2",o.lineAttrs.x2)("y2",o.lineAttrs.y2)("marker-start",o.isExistLineMarker(0)?o.markerID.sp.ref:void 0)("marker-end",o.isExistLineMarker(1)?o.markerID.ep.ref:void 0),l(),p("ngForOf",o.measureLineAttrs),l(),p("ngIf",o.isLineDimension))},encapsulation:2,changeDetection:0}));let r=n;return r})();var pa=(()=>{let n=class n{elementRef;mWidth=20;mHeight=10;path;markerStyle;constructor(e){this.elementRef=e,this.path=this.elementRef.nativeElement}ngOnChanges(){this.path.setAttribute("stroke",this.markerStyle.stroke),this.path.setAttribute("stroke-width","1"),this.path.setAttribute("stroke-dasharray",this.markerStyle.strokeDasharray),Wt.isClosedCapType(this.markerStyle.shape)?this.path.setAttribute("fill",this.markerStyle.fill||"none"):this.path.setAttribute("fill","none");let e=`get${this.markerStyle.shape}`;if(Se.hasKey(Wt,e)){let t=Wt[e].bind(Wt);this.path.setAttribute("d",t(this.mWidth,this.mHeight,this.markerStyle.location))}}};v(n,"\u0275fac",function(t){return new(t||n)(m(de))}),v(n,"\u0275dir",Pn({type:n,selectors:[["","sdMarkerPath",""]],inputs:{markerStyle:"markerStyle"},standalone:!1,features:[Ie]}));let r=n;return r})();var{entries:Tp,setPrototypeOf:pp,isFrozen:Gf,getPrototypeOf:Wf,getOwnPropertyDescriptor:zf}=Object,{freeze:jt,seal:pi,create:Ep}=Object,{apply:fa,construct:ga}=typeof Reflect<"u"&&Reflect;jt||(jt=function(n){return n});pi||(pi=function(n){return n});fa||(fa=function(n,i,e){return n.apply(i,e)});ga||(ga=function(n,i){return new n(...i)});var hs=$t(Array.prototype.forEach),Hf=$t(Array.prototype.lastIndexOf),dp=$t(Array.prototype.pop),No=$t(Array.prototype.push),jf=$t(Array.prototype.splice),fs=$t(String.prototype.toLowerCase),da=$t(String.prototype.toString),up=$t(String.prototype.match),Mo=$t(String.prototype.replace),$f=$t(String.prototype.indexOf),Yf=$t(String.prototype.trim),fi=$t(Object.prototype.hasOwnProperty),Ht=$t(RegExp.prototype.test),Do=Xf(TypeError);function $t(r){return function(n){n instanceof RegExp&&(n.lastIndex=0);for(var i=arguments.length,e=new Array(i>1?i-1:0),t=1;t<i;t++)e[t-1]=arguments[t];return fa(r,n,e)}}function Xf(r){return function(){for(var n=arguments.length,i=new Array(n),e=0;e<n;e++)i[e]=arguments[e];return ga(r,i)}}function Ne(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:fs;pp&&pp(r,null);let e=n.length;for(;e--;){let t=n[e];if(typeof t=="string"){let o=i(t);o!==t&&(Gf(n)||(n[e]=o),t=o)}r[t]=!0}return r}function Kf(r){for(let n=0;n<r.length;n++)fi(r,n)||(r[n]=null);return r}function vn(r){let n=Ep(null);for(let[i,e]of Tp(r))fi(r,i)&&(Array.isArray(e)?n[i]=Kf(e):e&&typeof e=="object"&&e.constructor===Object?n[i]=vn(e):n[i]=e);return n}function wo(r,n){for(;r!==null;){let e=zf(r,n);if(e){if(e.get)return $t(e.get);if(typeof e.value=="function")return $t(e.value)}r=Wf(r)}function i(){return null}return i}var mp=jt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ua=jt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ma=jt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Qf=jt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ha=jt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Zf=jt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),hp=jt(["#text"]),_p=jt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),_a=jt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),fp=jt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),_s=jt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),qf=pi(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Jf=pi(/<%[\w\W]*|[\w\W]*%>/gm),eg=pi(/\$\{[\w\W]*/gm),tg=pi(/^data-[\-\w.\u00B7-\uFFFF]+$/),ig=pi(/^aria-[\-\w]+$/),Sp=pi(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ng=pi(/^(?:\w+script|data):/i),og=pi(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),xp=pi(/^html$/i),rg=pi(/^[a-z][.\w]*(-[.\w]+)+$/i),gp=Object.freeze({__proto__:null,ARIA_ATTR:ig,ATTR_WHITESPACE:og,CUSTOM_ELEMENT:rg,DATA_ATTR:tg,DOCTYPE_NAME:xp,ERB_EXPR:Jf,IS_ALLOWED_URI:Sp,IS_SCRIPT_OR_DATA:ng,MUSTACHE_EXPR:qf,TMPLIT_EXPR:eg}),Lo={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},sg=function(){return typeof window>"u"?null:window},ag=function(n,i){if(typeof n!="object"||typeof n.createPolicy!="function")return null;let e=null,t="data-tt-policy-suffix";i&&i.hasAttribute(t)&&(e=i.getAttribute(t));let o="dompurify"+(e?"#"+e:"");try{return n.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Cp=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function vp(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sg(),n=re=>vp(re);if(n.version="3.2.5",n.removed=[],!r||!r.document||r.document.nodeType!==Lo.document||!r.Element)return n.isSupported=!1,n;let{document:i}=r,e=i,t=e.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:c,Element:u,NodeFilter:C,NamedNodeMap:x=r.NamedNodeMap||r.MozNamedAttrMap,HTMLFormElement:N,DOMParser:D,trustedTypes:X}=r,Q=u.prototype,ft=wo(Q,"cloneNode"),di=wo(Q,"remove"),cn=wo(Q,"nextSibling"),oo=wo(Q,"childNodes"),Wi=wo(Q,"parentNode");if(typeof s=="function"){let re=i.createElement("template");re.content&&re.content.ownerDocument&&(i=re.content.ownerDocument)}let yt,ln="",{implementation:ro,createNodeIterator:bp,createDocumentFragment:Ip,getElementsByTagName:yp}=i,{importNode:Ap}=e,Vt=Cp();n.isSupported=typeof Tp=="function"&&typeof Wi=="function"&&ro&&ro.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:Ts,ERB_EXPR:Es,TMPLIT_EXPR:Ss,DATA_ATTR:Rp,ARIA_ATTR:Pp,IS_SCRIPT_OR_DATA:Np,ATTR_WHITESPACE:Sa,CUSTOM_ELEMENT:Mp}=gp,{IS_ALLOWED_URI:xa}=gp,Tt=null,va=Ne({},[...mp,...ua,...ma,...ha,...hp]),At=null,Oa=Ne({},[..._p,..._a,...fp,..._s]),ot=Object.seal(Ep(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),so=null,xs=null,ba=!0,vs=!0,Ia=!1,ya=!0,On=!1,Os=!0,pn=!1,bs=!1,Is=!1,bn=!1,Fo=!1,Vo=!1,Aa=!0,Ra=!1,Dp="user-content-",ys=!0,ao=!1,In={},yn=null,Pa=Ne({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Na=null,Ma=Ne({},["audio","video","img","source","image","track"]),As=null,Da=Ne({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Uo="http://www.w3.org/1998/Math/MathML",Bo="http://www.w3.org/2000/svg",Ni="http://www.w3.org/1999/xhtml",An=Ni,Rs=!1,Ps=null,wp=Ne({},[Uo,Bo,Ni],da),Go=Ne({},["mi","mo","mn","ms","mtext"]),Wo=Ne({},["annotation-xml"]),Lp=Ne({},["title","style","font","a","script"]),co=null,kp=["application/xhtml+xml","text/html"],Fp="text/html",Et=null,Rn=null,Vp=i.createElement("form"),wa=function(b){return b instanceof RegExp||b instanceof Function},Ns=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Rn&&Rn===b)){if((!b||typeof b!="object")&&(b={}),b=vn(b),co=kp.indexOf(b.PARSER_MEDIA_TYPE)===-1?Fp:b.PARSER_MEDIA_TYPE,Et=co==="application/xhtml+xml"?da:fs,Tt=fi(b,"ALLOWED_TAGS")?Ne({},b.ALLOWED_TAGS,Et):va,At=fi(b,"ALLOWED_ATTR")?Ne({},b.ALLOWED_ATTR,Et):Oa,Ps=fi(b,"ALLOWED_NAMESPACES")?Ne({},b.ALLOWED_NAMESPACES,da):wp,As=fi(b,"ADD_URI_SAFE_ATTR")?Ne(vn(Da),b.ADD_URI_SAFE_ATTR,Et):Da,Na=fi(b,"ADD_DATA_URI_TAGS")?Ne(vn(Ma),b.ADD_DATA_URI_TAGS,Et):Ma,yn=fi(b,"FORBID_CONTENTS")?Ne({},b.FORBID_CONTENTS,Et):Pa,so=fi(b,"FORBID_TAGS")?Ne({},b.FORBID_TAGS,Et):{},xs=fi(b,"FORBID_ATTR")?Ne({},b.FORBID_ATTR,Et):{},In=fi(b,"USE_PROFILES")?b.USE_PROFILES:!1,ba=b.ALLOW_ARIA_ATTR!==!1,vs=b.ALLOW_DATA_ATTR!==!1,Ia=b.ALLOW_UNKNOWN_PROTOCOLS||!1,ya=b.ALLOW_SELF_CLOSE_IN_ATTR!==!1,On=b.SAFE_FOR_TEMPLATES||!1,Os=b.SAFE_FOR_XML!==!1,pn=b.WHOLE_DOCUMENT||!1,bn=b.RETURN_DOM||!1,Fo=b.RETURN_DOM_FRAGMENT||!1,Vo=b.RETURN_TRUSTED_TYPE||!1,Is=b.FORCE_BODY||!1,Aa=b.SANITIZE_DOM!==!1,Ra=b.SANITIZE_NAMED_PROPS||!1,ys=b.KEEP_CONTENT!==!1,ao=b.IN_PLACE||!1,xa=b.ALLOWED_URI_REGEXP||Sp,An=b.NAMESPACE||Ni,Go=b.MATHML_TEXT_INTEGRATION_POINTS||Go,Wo=b.HTML_INTEGRATION_POINTS||Wo,ot=b.CUSTOM_ELEMENT_HANDLING||{},b.CUSTOM_ELEMENT_HANDLING&&wa(b.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ot.tagNameCheck=b.CUSTOM_ELEMENT_HANDLING.tagNameCheck),b.CUSTOM_ELEMENT_HANDLING&&wa(b.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ot.attributeNameCheck=b.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),b.CUSTOM_ELEMENT_HANDLING&&typeof b.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ot.allowCustomizedBuiltInElements=b.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),On&&(vs=!1),Fo&&(bn=!0),In&&(Tt=Ne({},hp),At=[],In.html===!0&&(Ne(Tt,mp),Ne(At,_p)),In.svg===!0&&(Ne(Tt,ua),Ne(At,_a),Ne(At,_s)),In.svgFilters===!0&&(Ne(Tt,ma),Ne(At,_a),Ne(At,_s)),In.mathMl===!0&&(Ne(Tt,ha),Ne(At,fp),Ne(At,_s))),b.ADD_TAGS&&(Tt===va&&(Tt=vn(Tt)),Ne(Tt,b.ADD_TAGS,Et)),b.ADD_ATTR&&(At===Oa&&(At=vn(At)),Ne(At,b.ADD_ATTR,Et)),b.ADD_URI_SAFE_ATTR&&Ne(As,b.ADD_URI_SAFE_ATTR,Et),b.FORBID_CONTENTS&&(yn===Pa&&(yn=vn(yn)),Ne(yn,b.FORBID_CONTENTS,Et)),ys&&(Tt["#text"]=!0),pn&&Ne(Tt,["html","head","body"]),Tt.table&&(Ne(Tt,["tbody"]),delete so.tbody),b.TRUSTED_TYPES_POLICY){if(typeof b.TRUSTED_TYPES_POLICY.createHTML!="function")throw Do('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof b.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Do('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');yt=b.TRUSTED_TYPES_POLICY,ln=yt.createHTML("")}else yt===void 0&&(yt=ag(X,t)),yt!==null&&typeof ln=="string"&&(ln=yt.createHTML(""));jt&&jt(b),Rn=b}},La=Ne({},[...ua,...ma,...Qf]),ka=Ne({},[...ha,...Zf]),Up=function(b){let z=Wi(b);(!z||!z.tagName)&&(z={namespaceURI:An,tagName:"template"});let te=fs(b.tagName),Ze=fs(z.tagName);return Ps[b.namespaceURI]?b.namespaceURI===Bo?z.namespaceURI===Ni?te==="svg":z.namespaceURI===Uo?te==="svg"&&(Ze==="annotation-xml"||Go[Ze]):!!La[te]:b.namespaceURI===Uo?z.namespaceURI===Ni?te==="math":z.namespaceURI===Bo?te==="math"&&Wo[Ze]:!!ka[te]:b.namespaceURI===Ni?z.namespaceURI===Bo&&!Wo[Ze]||z.namespaceURI===Uo&&!Go[Ze]?!1:!ka[te]&&(Lp[te]||!La[te]):!!(co==="application/xhtml+xml"&&Ps[b.namespaceURI]):!1},gi=function(b){No(n.removed,{element:b});try{Wi(b).removeChild(b)}catch{di(b)}},zo=function(b,z){try{No(n.removed,{attribute:z.getAttributeNode(b),from:z})}catch{No(n.removed,{attribute:null,from:z})}if(z.removeAttribute(b),b==="is")if(bn||Fo)try{gi(z)}catch{}else try{z.setAttribute(b,"")}catch{}},Fa=function(b){let z=null,te=null;if(Is)b="<remove></remove>"+b;else{let Rt=up(b,/^[\r\n\t ]+/);te=Rt&&Rt[0]}co==="application/xhtml+xml"&&An===Ni&&(b='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+b+"</body></html>");let Ze=yt?yt.createHTML(b):b;if(An===Ni)try{z=new D().parseFromString(Ze,co)}catch{}if(!z||!z.documentElement){z=ro.createDocument(An,"template",null);try{z.documentElement.innerHTML=Rs?ln:Ze}catch{}}let Pt=z.body||z.documentElement;return b&&te&&Pt.insertBefore(i.createTextNode(te),Pt.childNodes[0]||null),An===Ni?yp.call(z,pn?"html":"body")[0]:pn?z.documentElement:Pt},Va=function(b){return bp.call(b.ownerDocument||b,b,C.SHOW_ELEMENT|C.SHOW_COMMENT|C.SHOW_TEXT|C.SHOW_PROCESSING_INSTRUCTION|C.SHOW_CDATA_SECTION,null)},Ms=function(b){return b instanceof N&&(typeof b.nodeName!="string"||typeof b.textContent!="string"||typeof b.removeChild!="function"||!(b.attributes instanceof x)||typeof b.removeAttribute!="function"||typeof b.setAttribute!="function"||typeof b.namespaceURI!="string"||typeof b.insertBefore!="function"||typeof b.hasChildNodes!="function")},Ua=function(b){return typeof c=="function"&&b instanceof c};function Mi(re,b,z){hs(re,te=>{te.call(n,b,z,Rn)})}let Ba=function(b){let z=null;if(Mi(Vt.beforeSanitizeElements,b,null),Ms(b))return gi(b),!0;let te=Et(b.nodeName);if(Mi(Vt.uponSanitizeElement,b,{tagName:te,allowedTags:Tt}),b.hasChildNodes()&&!Ua(b.firstElementChild)&&Ht(/<[/\w!]/g,b.innerHTML)&&Ht(/<[/\w!]/g,b.textContent)||b.nodeType===Lo.progressingInstruction||Os&&b.nodeType===Lo.comment&&Ht(/<[/\w]/g,b.data))return gi(b),!0;if(!Tt[te]||so[te]){if(!so[te]&&Wa(te)&&(ot.tagNameCheck instanceof RegExp&&Ht(ot.tagNameCheck,te)||ot.tagNameCheck instanceof Function&&ot.tagNameCheck(te)))return!1;if(ys&&!yn[te]){let Ze=Wi(b)||b.parentNode,Pt=oo(b)||b.childNodes;if(Pt&&Ze){let Rt=Pt.length;for(let Yt=Rt-1;Yt>=0;--Yt){let Ci=ft(Pt[Yt],!0);Ci.__removalCount=(b.__removalCount||0)+1,Ze.insertBefore(Ci,cn(b))}}}return gi(b),!0}return b instanceof u&&!Up(b)||(te==="noscript"||te==="noembed"||te==="noframes")&&Ht(/<\/no(script|embed|frames)/i,b.innerHTML)?(gi(b),!0):(On&&b.nodeType===Lo.text&&(z=b.textContent,hs([Ts,Es,Ss],Ze=>{z=Mo(z,Ze," ")}),b.textContent!==z&&(No(n.removed,{element:b.cloneNode()}),b.textContent=z)),Mi(Vt.afterSanitizeElements,b,null),!1)},Ga=function(b,z,te){if(Aa&&(z==="id"||z==="name")&&(te in i||te in Vp))return!1;if(!(vs&&!xs[z]&&Ht(Rp,z))){if(!(ba&&Ht(Pp,z))){if(!At[z]||xs[z]){if(!(Wa(b)&&(ot.tagNameCheck instanceof RegExp&&Ht(ot.tagNameCheck,b)||ot.tagNameCheck instanceof Function&&ot.tagNameCheck(b))&&(ot.attributeNameCheck instanceof RegExp&&Ht(ot.attributeNameCheck,z)||ot.attributeNameCheck instanceof Function&&ot.attributeNameCheck(z))||z==="is"&&ot.allowCustomizedBuiltInElements&&(ot.tagNameCheck instanceof RegExp&&Ht(ot.tagNameCheck,te)||ot.tagNameCheck instanceof Function&&ot.tagNameCheck(te))))return!1}else if(!As[z]){if(!Ht(xa,Mo(te,Sa,""))){if(!((z==="src"||z==="xlink:href"||z==="href")&&b!=="script"&&$f(te,"data:")===0&&Na[b])){if(!(Ia&&!Ht(Np,Mo(te,Sa,"")))){if(te)return!1}}}}}}return!0},Wa=function(b){return b!=="annotation-xml"&&up(b,Mp)},za=function(b){Mi(Vt.beforeSanitizeAttributes,b,null);let{attributes:z}=b;if(!z||Ms(b))return;let te={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:At,forceKeepAttr:void 0},Ze=z.length;for(;Ze--;){let Pt=z[Ze],{name:Rt,namespaceURI:Yt,value:Ci}=Pt,lo=Et(Rt),Ut=Rt==="value"?Ci:Yf(Ci);if(te.attrName=lo,te.attrValue=Ut,te.keepAttr=!0,te.forceKeepAttr=void 0,Mi(Vt.uponSanitizeAttribute,b,te),Ut=te.attrValue,Ra&&(lo==="id"||lo==="name")&&(zo(Rt,b),Ut=Dp+Ut),Os&&Ht(/((--!?|])>)|<\/(style|title)/i,Ut)){zo(Rt,b);continue}if(te.forceKeepAttr||(zo(Rt,b),!te.keepAttr))continue;if(!ya&&Ht(/\/>/i,Ut)){zo(Rt,b);continue}On&&hs([Ts,Es,Ss],ja=>{Ut=Mo(Ut,ja," ")});let Ha=Et(b.nodeName);if(Ga(Ha,lo,Ut)){if(yt&&typeof X=="object"&&typeof X.getAttributeType=="function"&&!Yt)switch(X.getAttributeType(Ha,lo)){case"TrustedHTML":{Ut=yt.createHTML(Ut);break}case"TrustedScriptURL":{Ut=yt.createScriptURL(Ut);break}}try{Yt?b.setAttributeNS(Yt,Rt,Ut):b.setAttribute(Rt,Ut),Ms(b)?gi(b):dp(n.removed)}catch{}}}Mi(Vt.afterSanitizeAttributes,b,null)},Bp=function re(b){let z=null,te=Va(b);for(Mi(Vt.beforeSanitizeShadowDOM,b,null);z=te.nextNode();)Mi(Vt.uponSanitizeShadowNode,z,null),Ba(z),za(z),z.content instanceof o&&re(z.content);Mi(Vt.afterSanitizeShadowDOM,b,null)};return n.sanitize=function(re){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=null,te=null,Ze=null,Pt=null;if(Rs=!re,Rs&&(re="<!-->"),typeof re!="string"&&!Ua(re))if(typeof re.toString=="function"){if(re=re.toString(),typeof re!="string")throw Do("dirty is not a string, aborting")}else throw Do("toString is not a function");if(!n.isSupported)return re;if(bs||Ns(b),n.removed=[],typeof re=="string"&&(ao=!1),ao){if(re.nodeName){let Ci=Et(re.nodeName);if(!Tt[Ci]||so[Ci])throw Do("root node is forbidden and cannot be sanitized in-place")}}else if(re instanceof c)z=Fa("<!---->"),te=z.ownerDocument.importNode(re,!0),te.nodeType===Lo.element&&te.nodeName==="BODY"||te.nodeName==="HTML"?z=te:z.appendChild(te);else{if(!bn&&!On&&!pn&&re.indexOf("<")===-1)return yt&&Vo?yt.createHTML(re):re;if(z=Fa(re),!z)return bn?null:Vo?ln:""}z&&Is&&gi(z.firstChild);let Rt=Va(ao?re:z);for(;Ze=Rt.nextNode();)Ba(Ze),za(Ze),Ze.content instanceof o&&Bp(Ze.content);if(ao)return re;if(bn){if(Fo)for(Pt=Ip.call(z.ownerDocument);z.firstChild;)Pt.appendChild(z.firstChild);else Pt=z;return(At.shadowroot||At.shadowrootmode)&&(Pt=Ap.call(e,Pt,!0)),Pt}let Yt=pn?z.outerHTML:z.innerHTML;return pn&&Tt["!doctype"]&&z.ownerDocument&&z.ownerDocument.doctype&&z.ownerDocument.doctype.name&&Ht(xp,z.ownerDocument.doctype.name)&&(Yt="<!DOCTYPE "+z.ownerDocument.doctype.name+`>
`+Yt),On&&hs([Ts,Es,Ss],Ci=>{Yt=Mo(Yt,Ci," ")}),yt&&Vo?yt.createHTML(Yt):Yt},n.setConfig=function(){let re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ns(re),bs=!0},n.clearConfig=function(){Rn=null,bs=!1},n.isValidAttribute=function(re,b,z){Rn||Ns({});let te=Et(re),Ze=Et(b);return Ga(te,Ze,z)},n.addHook=function(re,b){typeof b=="function"&&No(Vt[re],b)},n.removeHook=function(re,b){if(b!==void 0){let z=Hf(Vt[re],b);return z===-1?void 0:jf(Vt[re],z,1)[0]}return dp(Vt[re])},n.removeHooks=function(re){Vt[re]=[]},n.removeAllHooks=function(){Vt=Cp()},n}var Op=vp();function cg(r,n){if(r&1&&(ne(),I(0,"rect",4)),r&2){let i=d();G("fill","none")("height",i.rectHeight-(i.width-1))("stroke-dasharray",i.dashArray)("stroke-width",i.width)("stroke",i.color)("width",i.rectWidth-(i.width-1))("x",i.rectX+(i.width-1)/2)("y",i.rectY+(i.width-1)/2)}}function lg(r,n){if(r&1&&(ne(),I(0,"rect",5)),r&2){let i=d();G("fill",i.canEdit?"none":i.primary50)("height",i.rectHeight)("stroke-dasharray",i.canEdit?null:8)("stroke",i.canEdit?"#000000":i.primary50)("width",i.rectWidth)("x",i.rectX)("y",i.rectY)}}function pg(r,n){if(r&1&&(ne(),I(0,"path",6)),r&2){let i=d();G("d",i.editRectD)}}var gs=(()=>{let n=class n{annotService;contentService;editService;changeDetectorRef;subscriptionService;store$;translatePipe;elementRef;viewerService;loggingService;data;status=Z.RENDER;dragMode;renderer;transformStyle={};editRectD=T.EMPTY_STRING;linkActMode=!0;srcRect;get canEdit(){return this.dragMode===ye.SELECT_ANNOT}get isCreating(){return this.status===Z.CREATE}get primary50(){return this.viewerService.customColor.main}constructor(e,t,o,s,c,u,C,x,N,D){this.annotService=e,this.contentService=t,this.editService=o,this.changeDetectorRef=s,this.subscriptionService=c,this.store$=u,this.translatePipe=C,this.elementRef=x,this.viewerService=N,this.loggingService=D}ngOnInit(){this.subscriptionService.push(this.store$.pipe(_e("dragMode")).subscribe({next:e=>{this.dragMode=e,this.changeDetectorRef.detectChanges()}}),this.contentService.annotEvent$.pipe(L(e=>e===null||e.from==="AnnotationViewComponent"?!1:e.annot.oid===this.data.oid)).subscribe({next:()=>{this.srcRect=T.deepClone(this.data.attributes.rect),this.makeContents(),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Xe("linkActMode")).subscribe({next:e=>{this.linkActMode=e}}))}ngOnDestroy(){T.removeElement(this.elementRef.nativeElement),ve.destroy(this)}ngOnChanges(){this.srcRect=T.deepClone(this.data.attributes.rect),this.createRenderer(),this.renderEditRect(),this.makeContents()}renderEditRect(){if(!this.data.attributes.quadPoints)return;let e=this.data.attributes.rect;this.editRectD=this.data.attributes.quadPoints.reduce((t,o)=>{let s={x:o[0].x,y:o[0].y},c={x:o[0].x,y:o[0].y};return o.forEach(u=>{s.x=Math.min(u.x,s.x),s.y=Math.min(u.y,s.y),c.x=Math.max(u.x,c.x),c.y=Math.max(u.y,c.y)}),s.x=s.x-e.left,c.x=c.x-e.left,s.y=e.top-s.y,c.y=e.top-c.y,`${t}M ${s.x} ${s.y} L ${c.x} ${s.y} L ${c.x} ${c.y} L ${s.x} ${c.y} L ${s.x} ${s.y}`},"")}get rectX(){let{rect:e}=this.data.attributes;return this.status!==Z.CREATE?0:Math.min(e.left,e.right)}get rectY(){let{rect:e}=this.data.attributes;return this.status!==Z.CREATE?0:Math.min(e.top,e.bottom)}get rectWidth(){let{rect:e}=this.data.attributes;return Math.abs(e.right-e.left)}get rectHeight(){let{rect:e}=this.data.attributes;return Math.abs(e.top-e.bottom)}get color(){return this.data.attributes.color}get width(){return this.data.attributes.width??0}get dashArray(){let e=this.data.attributes.borderStyle;return e?.style==="dashed"?e.dashPattern.join(" "):"none"}onClick(e){if(!(this.canEdit||!this.linkActMode)){if(e.preventDefault(),e.stopPropagation(),this.data.attributes.type==="GoTo"){let t=Number(this.data.attributes.dest);if(Number.isNaN(t)||t<0)return;this.contentService.requestViewChange({pageNo:t+1})}else if(this.data.attributes.type==="URI"){let t=this.data.attributes.dest;if(!T.isDefined(this.sanitizeUrl(t))){this.loggingService.common("warn",le.INVALID,"Can't execute JavaScript in a link annotation.",t);return}t.indexOf("://")<0&&(t=`http://${t}`),window.open(t,"_blank")}}}pvOnMove(e){this.renderer.pvOnMove(e),this.changeDetectorRef.markForCheck()}postCreate(e){this.renderer.postCreate(e),this.validate()}verticesOf(e,t,o){return this.editService.createRectVertices(t,o)}pvOnVertexMove(e,t,o){if(this.renderer.status=Z.EDIT,!this.editService.resizeByRectVertex(this.data,t,o))return;let s=this.data.attributes.rect;this.transformStyle.transform=`translate(${Math.min(s.left,s.right)-this.srcRect.left}px, ${this.srcRect.top-Math.max(s.top,s.bottom)}px)`,this.changeDetectorRef.markForCheck()}postEdit(e,t){this.validate(),this.renderEditRect(),this.transformStyle.transform=T.EMPTY_STRING,this.ngOnChanges(),this.changeDetectorRef.markForCheck()}makeContents(){this.data.attributes.type==="GoTo"?this.data.attributes.contents=this.translatePipe.transform("GO_TO_PAGE").replace("%s",`${parseInt(this.data.attributes.dest,10)+1}`):this.data.attributes.type==="URI"&&(this.data.attributes.contents=this.translatePipe.transform("GO_TO_SITE").replace("%s",`${this.data.attributes.dest}`))}validate(){U.validateRect(this.data.attributes.rect)}createRenderer(){this.renderer=ni.create(this.data,this.status,this.annotService)}sanitizeUrl(e){let t=`<a href="${e}">test</a>`,o=Op.sanitize(t);return new DOMParser().parseFromString(o,"text/html").querySelector("a")?.getAttribute("href")??null}};v(n,"\u0275fac",function(t){return new(t||n)(m(Re),m(ge),m(_t),m(Y),m(P),m(xe),m(oe),m(de),m(zn),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-link"]],inputs:{data:"data",status:"status"},standalone:!1,features:[$([P]),Ie],decls:4,vars:4,consts:[["id","background",1,"absolute",3,"click","ngStyle"],["stroke-alignment","inside",4,"ngIf"],["fill-opacity","0.08",4,"ngIf"],["fill","none","stroke","#000000",4,"ngIf"],["stroke-alignment","inside"],["fill-opacity","0.08"],["fill","none","stroke","#000000"]],template:function(t,o){t&1&&(ne(),h(0,"svg",0),O("click",function(c){return o.onClick(c)}),R(1,cg,1,8,"rect",1)(2,lg,1,7,"rect",2)(3,pg,1,1,"path",3),_()),t&2&&(p("ngStyle",o.transformStyle),l(),p("ngIf",!o.isCreating),l(),p("ngIf",o.isCreating||o.canEdit&&!o.data.attributes.quadPoints),l(),p("ngIf",o.canEdit&&o.data.attributes.quadPoints))},dependencies:[be,Ce],encapsulation:2,changeDetection:0}));let r=n;return r})();var dg=(r,n,i,e)=>({shape:r,stroke:n,strokeDasharray:i,fill:e,location:"start"}),ug=(r,n,i,e)=>({shape:r,stroke:n,strokeDasharray:i,fill:e,location:"end"});function mg(r,n){if(r&1&&(ne(),h(0,"marker",4),I(1,"path",5),_()),r&2){let i=d(2);G("id",i.markerID.sp.def),l(),p("markerStyle",Mn(2,dg,i.polylineData.attributes.LE==null?null:i.polylineData.attributes.LE[0],i.pathStroke,i.markerDashArray,i.isCallout()?i.data.attributes.color:i.data.attributes.InteriorColor))}}function hg(r,n){if(r&1&&(ne(),h(0,"marker",4),I(1,"path",5),_()),r&2){let i=d(2);G("id",i.markerID.ep.def),l(),p("markerStyle",Mn(2,ug,i.polylineData.attributes.LE==null?null:i.polylineData.attributes.LE[1],i.pathStroke,i.markerDashArray,i.isCallout()?i.data.attributes.color:i.data.attributes.InteriorColor))}}function _g(r,n){if(r&1&&(ne(),h(0,"defs"),R(1,mg,2,7,"marker",3)(2,hg,2,7,"marker",3),_()),r&2){let i=d();l(),p("ngIf",i.isExistLineMarker(0)),l(),p("ngIf",i.isExistLineMarker(1))}}function fg(r,n){if(r&1&&(ne(),I(0,"path")),r&2){let i=d();G("stroke",i.pathStroke)("stroke-width",i.pathStrokeWidth)("stroke-dasharray",i.pathStrokeDashArray)("d",i.isCloudType()?i.cloudPointsNote:i.linePath)}}var no=(()=>{let n=class n{elementRef;annotService;contentService;shapeService;changeDetectorRef;subscriptionService;data;status=Z.RENDER;fillColor;pathStroke;pathStrokeWidth;pathStrokeDashArray=null;markerDashArray=null;viewClasses={};linePointsNote;linePath;cloudPointsNote;markerID={};get polylineData(){return this.data}get interiorColor(){return this.data.attributes.InteriorColor}get isMarkerType(){return this.isPolyLine()||this.isCallout()}lineRenderer;cloudRenderer;vertexEditor;constructor(e,t,o,s,c,u){this.elementRef=e,this.annotService=t,this.contentService=o,this.shapeService=s,this.changeDetectorRef=c,this.subscriptionService=u}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(e=>e?.annot.oid===this.data.oid),L(e=>e?.from!=="AnnotationViewComponent")).subscribe({next:()=>{this.isCallout()||this.fitBox(),this.fireMeasureIndicatorEvent(),this.detectChange()}}))}ngOnDestroy(){ve.destroy(this)}ngOnChanges(e){e.status&&this.annotService.bindCursorClass(this.viewClasses,this.status),e.data&&(this.checkFinalVertex(),this.lineRenderer=this.shapeService.createRenderer(this),this.cloudRenderer=this.shapeService.createCloudRenderer(this),this.vertexEditor=this.shapeService.createVertexEditor(this),this.render()),this.markerID.sp=this.isMarkerType?U.createMarkerID(!0,this.data):{},this.markerID.ep=this.isMarkerType?U.createMarkerID(!1,this.data):{}}isCloudType(){return A.isPolygonCloud(this.data)}isPolyLine(){return A.isPolyLine(this.data)}isCallout(){return A.isFreeTextCallout(this.data)}isExistLineMarker(e){return U.isExistLineMarker(e,this.data)}pvOnRepress(e){this.pvOnMove(e);let t=this.data.attributes.vertices;if(t.length>1){let[o,s]=t.slice(t.length-2);if(o.x===s.x&&o.y===s.y)return}t.push({x:void 0,y:void 0}),this.pvOnMove(e)}pvOnMove(e){this.vertexEditor.pvOnMove(e),this.detectChange()}pvOnOver(){this.lineRenderer.finalizeLine(),this.detectChange()}postCreate(e){this.lineRenderer.postCreate();let t=this.data.attributes.vertices;t.forEach(o=>o.y=e.bbox.h+e.bbox.y-o.y),U.fitBox(this.data.attributes.rect,this.data.attributes.width+(this.isCloudType()?Bs:0),...t),this.fireMeasureIndicatorEvent(),this.detectChange()}verticesOf(e,t,o){return this.vertexEditor.verticesOf(e,t,o)}postEdit(e,t){U.applyVertexDelta(t,...this.data.attributes.vertices),this.fitBox(),this.detectChange()}pvOnVertexMove(e,t,o){this.vertexEditor.pvOnVertexMove(e,t,o),this.detectChange()}detectChange(){this.changeDetectorRef.destroyed||(this.render(),this.changeDetectorRef.markForCheck())}fireMeasureIndicatorEvent(){!A.isPolyLineDimension(this.data)&&!A.isPolygonDimension(this.data)||this.contentService.fireMeasureIndicatorEvent({action:"edit"})}isTouched(e){let t=this.isLineTouched(e);return this.fillColor!=="none"&&!t&&(t=this.isAreaTouched(e)),t}isLineTouched(e){let t=this.data.attributes.vertices,o=t[0],s=o;for(let c of t){s=c;let u=new ht(s.x-o.x,s.y-o.y),C=new ht(e.x-o.x,e.y-o.y),x=_n.innerProduct(u,C),N=u.norm()*u.norm(),D=C.orthogonalTo(u).norm(),X=8+this.data.attributes.width*Fe.hitTestToleranceConst;if(0<x&&x<N&&D<X)return!0;o=c}return!1}isAreaTouched(e){let t=this.data.attributes.vertices,o=0,s=t[0],c=s;for(let u of t)c=u,s!==c&&(s.y<=e.y?c.y>e.y&&this.isLeft(s,c,e)>0&&++o:c.y<=e.y&&this.isLeft(s,c,e)<0&&--o),s=u;return o!==0}isLeft(e,t,o){return(t.x-e.x)*(o.y-e.y)-(o.x-e.x)*(t.y-e.y)}fitBox(e){let t=e||this.data.attributes.rect,o=this.data.attributes.vertices,s=A.isPolyLine(this.data)?Wt.calcLinecapCoord(o,this.data):o;U.fitBox(t,this.data.attributes.width+(this.isCloudType()?Bs:0),...s)}checkFinalVertex(){if(this.data.type!=="Polygon"||!this.data||!this.data.attributes)return;let e=this.data.attributes.vertices;if(!e||e.length<1)return;let t=e.length-1;(e[0].x!==e[t].x||e[0].y!==e[t].y)&&e.push(T.deepClone(e[0]))}render(){this.pathStroke=this.isCallout()?this.data.attributes.contentsRichtext.borderColor:this.data.attributes.color,this.pathStrokeWidth=this.data.attributes.width,this.fillColor=this.lineRenderer.interiorColor,this.linePointsNote=this.lineRenderer.render(),this.cloudPointsNote=this.cloudRenderer?.render();let{rect:e,borderStyle:t,width:o}=this.data.attributes,s=this.status===Z.CREATE?this.data.attributes.vertices:this.data.attributes.vertices.map(c=>U.transformPoint(c,e));this.linePath=s.reduce((c,u,C)=>C===0?`M ${u.x} ${u.y}`:`${c} L ${u.x} ${u.y}`,""),this.pathStrokeDashArray=t?.style==="dashed"?t.dashPattern.map(c=>c.toString()).reduce((c,u)=>(c&&`${c}, `)+u,T.EMPTY_STRING):null,this.markerDashArray=t?.style==="dashed"?t.dashPattern.map(c=>(c/o).toFixed(2)).reduce((c,u)=>(c&&`${c}, `)+u,T.EMPTY_STRING):null}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Re),m(ge),m(wr),m(Y),m(P))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-poly-shape"]],inputs:{data:"data",status:"status"},standalone:!1,features:[$([P]),Ie],decls:4,vars:10,consts:[["focusable","false",3,"ngClass"],[4,"ngIf"],["stroke-linecap","square"],["markerWidth","20","markerHeight","10","refX","10","refY","5","orient","auto",4,"ngIf"],["markerWidth","20","markerHeight","10","refX","10","refY","5","orient","auto"],["sdMarkerPath","",3,"markerStyle"]],template:function(t,o){t&1&&(ne(),h(0,"svg",0),R(1,_g,3,2,"defs",1),I(2,"polyline",2),R(3,fg,1,4,"path",1),_()),t&2&&(p("ngClass",o.viewClasses),G("fill",o.fillColor),l(),p("ngIf",o.isMarkerType),l(),G("stroke",o.isCloudType()?o.interiorColor:o.pathStrokeDashArray?null:o.pathStroke)("stroke-width",o.isCloudType()?1:o.pathStrokeWidth)("stroke-dasharray",o.isCloudType()?null:o.pathStrokeDashArray)("points",o.linePointsNote)("marker-start",o.isExistLineMarker(0)&&o.markerID.sp.ref)("marker-end",o.isExistLineMarker(1)&&o.markerID.ep.ref),l(),p("ngIf",o.isCloudType()||o.pathStrokeDashArray))},styles:["svg[_ngcontent-%COMP%]{opacity:.999999;position:absolute}"],changeDetection:0}));let r=n;return r})();function gg(r,n){if(r&1&&(ne(),I(0,"ellipse")),r&2){let i=d();G("cx",i.circleRenderer.cx)("cy",i.circleRenderer.cy)("fill",i.circleRenderer.fill)("rx",i.circleRenderer.rx)("ry",i.circleRenderer.ry)("stroke-dasharray",i.circleRenderer.dashArray)("stroke-width",i.circleRenderer.width)("stroke",i.circleRenderer.stroke)}}function Cg(r,n){if(r&1&&(ne(),I(0,"rect")),r&2){let i=d();G("fill-opacity",i.redactionRectRender.fillOpacity)("fill",i.squareRenderer.fill)("height",i.squareRenderer.rectHeight)("stroke-dasharray",i.squareRenderer.dashArray)("stroke-width",i.squareRenderer.width)("stroke",i.squareRenderer.stroke)("width",i.squareRenderer.rectWidth)("x",i.squareRenderer.x)("y",i.squareRenderer.y)}}function Tg(r,n){if(r&1&&(ne(),I(0,"path",3)),r&2){let i=d();G("d",i.cloudRenderer.render())("fill",i.renderer.fill)("stroke-width",i.renderer.width)("stroke",i.renderer.stroke)}}var ko=(()=>{let n=class n{elementRef;annotService;editService;contentService;changeDetectorRef;subscriptionService;data;status=Z.RENDER;renderer;get circleRenderer(){return this.renderer}get squareRenderer(){return this.renderer}get redactionRectRender(){return this.renderer}cloudRenderer;constructor(e,t,o,s,c,u){this.elementRef=e,this.annotService=t,this.editService=o,this.contentService=s,this.changeDetectorRef=c,this.subscriptionService=u}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(e=>e===null?!1:e.annot.oid===this.data.oid)).subscribe({next:()=>{this.renderer.srcRect=T.deepClone(this.data.attributes.rect),this.detectChange()}}))}ngOnDestroy(){T.removeElement(this.elementRef.nativeElement),ve.destroy(this)}ngOnChanges(){this.createRenderer(),this.renderer.render()}isCircle(){return A.isCircle(this.data)}isCloud(){return this.data?.attributes.borderEffect?.style==="C"}pvOnMove(e){this.renderer.pvOnMove(e),this.detectChange()}postCreate(e){this.renderer.postCreate(e),this.validate()}verticesOf(e,t,o){return this.editService.createRectVertices(t,o)}postEdit(e,t){this.validate(),this.createRenderer(),this.detectChange()}pvOnVertexMove(e,t,o){this.renderer.status=Z.EDIT,this.isCloud()&&T.isDefined(this.cloudRenderer)&&(this.cloudRenderer.comp.status=Z.EDIT),this.editService.resizeByRectVertex(this.data,t,o)&&this.detectChange()}detectChange(){this.checkRenderer(),this.renderer?.render(),this.changeDetectorRef.markForCheck()}isTouched(e){return this.isCircle()?this.isCircleTouch(e):this.isRectTouch(e)}validate(){U.validateRect(this.data.attributes.rect)}createRenderer(){this.renderer=ni.create(this.data,this.status,this.annotService),this.isCloud()&&(this.cloudRenderer=new Gs(this.data,this.status))}checkRenderer(){this.isCloud()&&!this.cloudRenderer?this.cloudRenderer=new Gs(this.data,this.status):!this.isCloud()&&this.cloudRenderer&&delete this.cloudRenderer}isCircleTouch(e){let t=this.data.attributes.rect,o=Math.abs(t.right-t.left)/2,s=Math.abs(t.top-t.bottom)/2,c={x:(t.right+t.left)/2,y:(t.top+t.bottom)/2},u=s>o,C,x,N,D=8+this.data.attributes.width*Fe.hitTestToleranceConst;u?(C={x:c.x,y:c.y+Math.sqrt(s*s-o*o)},x={x:c.x,y:c.y-Math.sqrt(s*s-o*o)},N=2*s):(C={x:c.x+Math.sqrt(o*o-s*s),y:c.y},x={x:c.x-Math.sqrt(o*o-s*s),y:c.y},N=2*o);let X=new ht(e.x-C.x,e.y-C.y).norm()+new ht(e.x-x.x,e.y-x.y).norm();return this.renderer.fill==="none"&&Math.abs(N-X)<D||this.renderer.fill!=="none"&&X-N<D}isRectTouch(e){let t=this.data.attributes.rect,o=Math.abs(t.right-t.left)/2,s=Math.abs(t.top-t.bottom)/2,c=8+this.data.attributes.width*Fe.hitTestToleranceConst,u={x:(t.right+t.left)/2,y:(t.top+t.bottom)/2},C=Math.abs(e.x-u.x),x=Math.abs(e.y-u.y),N={left:t.left-c,right:t.right+c,bottom:t.bottom-c,top:t.top+c};return this.renderer.fill==="none"&&(Math.abs(o-C)<c||Math.abs(s-x)<c)&&xt.isPointInRect(N,e)||this.renderer.fill!=="none"&&xt.isPointInRect(t,e)}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Re),m(_t),m(ge),m(Y),m(P))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-rect"]],inputs:{data:"data",status:"status"},standalone:!1,features:[$([P]),Ie],decls:4,vars:4,consts:[[3,"ngClass"],[4,"ngIf"],["stroke-linejoin","bevel",4,"ngIf"],["stroke-linejoin","bevel"]],template:function(t,o){t&1&&(ne(),h(0,"svg",0),R(1,gg,1,8,"ellipse",1)(2,Cg,1,9,"rect",1)(3,Tg,1,4,"path",2),_()),t&2&&(p("ngClass",o.renderer.viewClasses),l(),p("ngIf",o.isCircle()&&!o.isCloud()),l(),p("ngIf",!o.isCircle()&&!o.isCloud()),l(),p("ngIf",o.isCloud()))},dependencies:[Je,be],encapsulation:2,changeDetection:0}));let r=n;return r})();function Eg(r,n){if(r&1&&(h(0,"div",3)(1,"div"),M(2),_()()),r&2){let i=d();p("ngStyle",i.render.overlayTextStyle()),l(2),k(i.render.overlayText)}}function Sg(r,n){if(r&1){let i=w();ne(),h(0,"rect",4),O("mouseover",function(){f(i);let t=d();return g(t.changeRenderer(!0))})("mouseout",function(){f(i);let t=d();return g(t.changeRenderer(t.isPreviewRedaction||!1))}),_()}if(r&2){let i=d();G("fill",i.render.fill)("fill-opacity",i.render.fillOpacity)("stroke",i.render.stroke)("stroke-width",i.render.width)("x",i.render.x)("y",i.render.y)("width",i.render.rectWidth)("height",i.render.rectHeight)}}var Ca=(()=>{let n=class n{elementRef;contentService;annotService;editService;changeDetectorRef;subscriptionService;redactionService;data;status=Z.RENDER;render;originalRender;hoverRender;isPreviewRedaction=!1;constructor(e,t,o,s,c,u,C){this.elementRef=e,this.contentService=t,this.annotService=o,this.editService=s,this.changeDetectorRef=c,this.subscriptionService=u,this.redactionService=C}initSubscription(){this.subscriptionService.push(this.contentService.redactionEvent$.pipe(L(e=>e.annot.oid===this.data.oid&&(e.sdEventType===fe.HOVER||e.sdEventType===fe.UNHOVER))).subscribe({next:e=>{let t=e.sdEventType===fe.HOVER;this.changeRenderer(this.isPreviewRedaction||t)}}),this.contentService.annotEvent$.pipe(L(T.isDefined),L(e=>e.sdEventType===fe.UPDATE||e.sdEventType===fe.CREATE),L(e=>T.isDefined(e.annot)&&T.isDefined(this.data)&&e.annot.oid===this.data.oid)).subscribe({next:()=>{this.render&&(this.ngOnChanges(),this.changeDetectorRef.markForCheck())}}),this.redactionService.redactionPreview$.subscribe({next:e=>{this.isPreviewRedaction=e,this.changeRenderer(e),this.changeDetectorRef.markForCheck()}}))}changeRenderer(e){e?((!this.hoverRender||this.hoverRender.fill!==this.data.attributes.InteriorColor)&&this.renewHoverRenderer(),this.render=this.hoverRender,this.render.render()):(this.render=this.originalRender,this.render.render()),this.changeDetectorRef.destroyed||this.changeDetectorRef.detectChanges()}renewHoverRenderer(){let e=T.deepClone(this.data);e.attributes.OutlineColor=this.data.attributes.CoverLineColor??this.data.attributes.InteriorColor,e.attributes.rect=this.data.attributes.rect,e.attributes.width=this.data.attributes.CoverLineWidth??0,e.attributes.fillOpacity=1,e.attributes.isHover=!0,this.hoverRender=ni.create(e,this.status,this.annotService)}ngOnDestroy(){T.removeElement(this.elementRef.nativeElement),ve.destroy(this)}ngOnChanges(){this.originalRender=ni.create(this.data,this.status,this.annotService),this.renewHoverRenderer(),this.render=this.originalRender,this.changeRenderer(this.isPreviewRedaction)}ngOnInit(){this.initSubscription()}pvOnMove(e){this.render.pvOnMove(e)}postCreate(e){this.render.postCreate(e)}verticesOf(e,t,o){return this.editService.createRectVertices(t,o)}postEdit(e,t){this.ngOnChanges()}isRedaction(){return A.isRedact(this.data)}pvOnVertexMove(e,t,o){this.render.status=Z.EDIT,this.editService.resizeByRectVertex(this.data,t,o)&&this.render.render()}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(ge),m(Re),m(_t),m(Y),m(P),m(kr))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-redaction"]],inputs:{data:"data",status:"status"},standalone:!1,features:[$([P]),Ie],decls:3,vars:3,consts:[["class","overlay-text",3,"ngStyle",4,"ngIf"],["id","oid","target","redaction",3,"ngClass"],[3,"mouseover","mouseout",4,"ngIf"],[1,"overlay-text",3,"ngStyle"],[3,"mouseover","mouseout"]],template:function(t,o){t&1&&(R(0,Eg,3,2,"div",0),ne(),h(1,"svg",1),R(2,Sg,1,8,"rect",2),_()),t&2&&(p("ngIf",o.render.overlayText),l(),p("ngClass",o.render.viewClasses),l(),p("ngIf",o.isRedaction()))},dependencies:[Je,be,Ce],styles:[".overlay-text[_ngcontent-%COMP%]{position:absolute;z-index:1;width:100%;height:100%;overflow:hidden;pointer-events:none;box-sizing:border-box}.overlay-text[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{word-wrap:break-word;width:100%}"]}));let r=n;return r})();var xg=[F.RATIO_FULL+F.SPACE+F.RATIO_FULL,F.RATIO_FULL+F.SPACE+F.RATIO_HALF,F.RATIO_FULL+F.SPACE+F.RATIO_ZERO,F.RATIO_HALF+F.SPACE+F.RATIO_ZERO,F.RATIO_ZERO+F.SPACE+F.RATIO_ZERO,F.RATIO_ZERO+F.SPACE+F.RATIO_HALF,F.RATIO_ZERO+F.SPACE+F.RATIO_FULL,F.RATIO_HALF+F.SPACE+F.RATIO_FULL],Ta=class{backgroundImage;backgroundSize;transform=null;transformOrigin=null;backgroundPositionX;backgroundPositionY;minWidth;minHeight},Cs=(()=>{let n=class n{elementRef;editService;changeDetectorRef;contentService;subscriptionService;store$;loggingService;data;status=Z.RENDER;pdfData;styles=new Ta;degree;srcBbox;srcRect;firstMouseEvent=null;constructor(e,t,o,s,c,u,C){this.elementRef=e,this.editService=t,this.changeDetectorRef=o,this.contentService=s,this.subscriptionService=c,this.store$=u,this.loggingService=C}isCreate(){return this.status===Z.CREATE}ngOnChanges(){let e=this.data.attributes.appearance;if(e.type!=="image"){this.loggingService.common("warn",le.INVALID,"stamp.appearance.type",`[${e.type}] of oid=${this.data.oid}`);return}this.render()}ngOnInit(){this.subscriptionService.push(this.store$.pipe(_e("degree")).subscribe({next:e=>this.degree=e}),this.contentService.annotEvent$.pipe(L(T.isDefined),L(e=>e.annot?.oid===this.data.oid)).subscribe({next:()=>this.render()}))}ngOnDestroy(){ve.destroy(this.styles),ve.destroy(this)}pvOnMove(e){this.firstMouseEvent===null&&(this.firstMouseEvent=e);let t=(this.pdfData.r+this.degree+360)%360,o=e.clientX-this.firstMouseEvent.clientX,s=e.clientY-this.firstMouseEvent.clientY,c=this.data.attributes.rect,u=this.data.attributes.appearance,C=u.width/u.height,x=e.offsetX-c.left,N=e.offsetY-c.top,D=t===90||t===270;o*s>0&&!D||o*s<0&&D?Math.abs(x)<Math.abs(N*C)?(c.right=e.offsetX,c.bottom=c.top+x/C):(c.right=c.left+N*C,c.bottom=e.offsetY):Math.abs(x)<Math.abs(N*C)?(c.right=e.offsetX,c.bottom=c.top-x/C):(c.right=c.left-N*C,c.bottom=e.offsetY),this.render(),this.changeDetectorRef.markForCheck()}postCreate(e){this.firstMouseEvent=null;let t=this.data.attributes.rect;this.data.attributes.rect={left:Math.min(t.left,t.right),top:e.bbox.h+e.bbox.y-Math.min(t.top,t.bottom),right:Math.max(t.left,t.right),bottom:e.bbox.h+e.bbox.y-Math.max(t.top,t.bottom)},this.render(),this.changeDetectorRef.markForCheck()}verticesOf(e,t,o){return this.editService.createRectVertices(t,o)}postEdit(e,t){U.validateRect(this.data.attributes.rect),this.render()}pvOnVertexMove(e,t,o){if(!this.editService.resizeByRectVertex(this.data,t,o))return;let s=this.data.attributes.rect,c=U.bboxOf(s);if(this.styles.transformOrigin=xg[t],this.styles.transform=`scale(${Math.abs(c.w/this.srcBbox.w).toFixed(3)}, ${F.SPACE}${Math.abs(c.h/this.srcBbox.h).toFixed(3)})`,c.w<0||c.h<0){let u={x:(this.srcRect.right!==s.right?"-":T.EMPTY_STRING)+F.RATIO_FULL,y:(this.srcRect.bottom!==s.bottom?"-":T.EMPTY_STRING)+F.RATIO_FULL};this.styles.transform+=` translate(${c.w<0?u.x:0}, ${c.h<0?u.y:0}`}this.changeDetectorRef.markForCheck()}render(){let e=this.data.attributes.appearance,t=this.data.attributes.rect;this.isCreate()?(t.right<t.left?this.styles.backgroundPositionX=`${t.right}px`:this.styles.backgroundPositionX=`${t.left}px`,t.bottom<t.top?this.styles.backgroundPositionY=`${t.bottom}px`:this.styles.backgroundPositionY=`${t.top}px`):(this.styles.backgroundPositionX="0",this.styles.backgroundPositionX="0",this.styles.minWidth="100%",this.styles.minHeight="100%"),this.srcBbox=U.bboxOf(t),this.srcRect=T.deepClone(t),this.styles.backgroundImage=`url(data:image/${e.format};base64,${e.data})`,this.styles.backgroundSize=`${Math.abs(t.right-t.left)}px ${Math.abs(t.bottom-t.top)}px`,this.styles.transform=null,this.styles.transformOrigin=null,this.changeDetectorRef.markForCheck()}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(_t),m(Y),m(ge),m(P),m(xe),m(De))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-stamp"]],inputs:{data:"data",status:"status",pdfData:"pdfData"},standalone:!1,features:[$([P]),Ie],decls:1,vars:1,consts:[[3,"ngStyle"]],template:function(t,o){t&1&&I(0,"div",0),t&2&&p("ngStyle",o.styles)},dependencies:[Ce],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}div[_ngcontent-%COMP%]{position:absolute;left:0;top:0;padding:0;margin:0;min-width:100%;min-height:100%;background-repeat:no-repeat}"],changeDetection:0}));let r=n;return r})();var Ea=(()=>{let n=class n{elementRef;annotService;contentService;changeDetectorRef;subscriptionService;store$;annotText;status=Z.RENDER;pdfPage;scale;degree;annotStyle={transform:null,color:null};get data(){return this.annotText}changesSrc=new zi({});constructor(e,t,o,s,c,u){this.elementRef=e,this.annotService=t,this.contentService=o,this.changeDetectorRef=s,this.subscriptionService=c,this.store$=u}ngOnInit(){this.subscriptionService.push(this.contentService.annotEvent$.pipe(L(e=>e?.sdEventType===fe.UPDATE&&e.annot.oid===this.data.oid)).subscribe({next:()=>{this.detectChange()}}),Xt(this.changesSrc,this.store$.pipe(_e("scale"),je({next:e=>this.scale=e})),this.store$.pipe(_e("degree"),je({next:e=>this.degree=e}))).pipe(ui(10)).subscribe({next:()=>this.detectChange()}))}ngOnDestroy(){T.removeElement(this.elementRef.nativeElement),ve.destroy(this)}ngOnChanges(e){this.changesSrc.next(e)}postCreate(e){this.annotService.togglePopup(this.annotText)}postEdit(e,t){this.annotService.moveText(this.annotText,{x:0,y:0})}verticesOf(e,t,o){return[]}pvOnAnnotMove(e,t,o){this.annotService.moveText(this.annotText,o)}render(){let e=this.annotStyle;e.transform=`scale(${100/Math.max(this.scale,100)}) rotate(${-(this.pdfPage.r+this.degree)}deg)`,this.data?.attributes.color&&(e.color=this.data.attributes.color)}detectChange(){this.changeDetectorRef.markForCheck(),this.render()}};v(n,"\u0275fac",function(t){return new(t||n)(m(de),m(Re),m(ge),m(Y),m(P),m(xe))}),v(n,"\u0275cmp",j({type:n,selectors:[["sd-text"]],inputs:{annotText:"annotText",status:"status",pdfPage:"pdfPage"},standalone:!1,features:[$([P]),Ie],decls:1,vars:1,consts:[[1,"papycon","papycon-memo",3,"pointerdown","pointermove","pointerup","ngStyle"]],template:function(t,o){t&1&&(h(0,"i",0),O("pointerdown",function(c){return c.stopPropagation()})("pointermove",function(c){return c.stopPropagation()})("pointerup",function(c){return c.stopPropagation()}),_()),t&2&&p("ngStyle",o.annotStyle)},dependencies:[Ce],styles:["[_nghost-%COMP%]{left:0;top:0;text-align:center;cursor:pointer;display:block}i[_ngcontent-%COMP%]{font-size:20px;text-shadow:-1.5px 0 0 #000000,1.5px 0 0 #000000,0 1.5px 0 #000000,0 -1.5px 0 #000000,-1.5px -1.5px 0 #000000,1.5px -1.5px 0 #000000}"],changeDetection:0}));let r=n;return r})();var Zl=(()=>{let n=class n{};v(n,"\u0275fac",function(t){return new(t||n)}),v(n,"\u0275mod",ut({type:n})),v(n,"\u0275inj",dt({providers:[_t,wr],imports:[mt,kn,ai,Fn,br.forFeature(Gc,Bc),ep]}));let r=n;return r})();We(Jn,function(){return[Je,Ue,be,Ce,un,mn,uo,oa,yo,Bi,Zn,Po,gs,no,ko,Ca,Cs,Ea,rs,ti]},function(){return[ac]});We(ts,function(){return[be,Ce,un,mn,Jl,Bi,Zn,Po,gs,no,ko,Cs,rs,ti]},function(){return[oe]});We(oa,function(){return[Ue,be,Ce,ra]},[]);We(ra,function(){return[Je,Ue,Ce,ji]},function(){return[oe]});We(la,function(){return[be,Ce]},function(){return[oe]});We(Bi,function(){return[Je,be,Ce,Xi,vt,ri,no,ko]},[]);We(Po,function(){return[Je,Ue,be,pa]},[]);We(no,function(){return[Je,be,pa]},[]);We(es,function(){return[be,Ce,un,mn,Bi,Zn,Po,gs,no,ko,Ca,Cs,Ea,rs]},[]);We(ti,function(){return[be,Ce,un,mn,uo,rp,sp,ap,cp,la,lp]},[]);export{H as a,sl as b,al as c,cl as d,Vr as e,Jt as f,ml as g,hl as h,_l as i,fl as j,Pl as k,HT as l,ci as m,TE as n,AE as o,na as p,Jn as q,HE as r,Yr as s,Xr as t,mS as u,Jl as v,ep as w,Zl as x,hv as y};
