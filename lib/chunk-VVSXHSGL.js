import{a as Xp}from"./chunk-PWLQCZAI.js";import{a as Ho,f as Vp,k as Lp,l as Fp,m as qo,n as Bp,o as Up,p as gc,q as Hp,r as $p,s as jp,t as Wp,u as ba,v as zp,w as Gp,x as Yp}from"./chunk-ECDKDJNR.js";import{$ as Xn,$a as $e,$c as Qe,$d as Jn,$e as sp,$g as $,$h as Pp,$i as Sa,A as Ji,Ab as Ii,Ad as Qn,Af as ye,Ag as dp,B as Ws,Bb as Ai,Be as Vn,Bg as la,Bh as fe,C as ul,Ca as Tl,Cb as xe,Cc as qn,Ce as ql,Cg as dc,Ch as it,Da as Fo,Db as ai,Dh as _p,Di as to,E as oc,Eb as Zs,Ec as wo,Ed as Zn,Ee as Vr,Eh as ot,F as Co,Fb as St,Fc as _t,Fd as xn,Fe as Ql,G as zs,Ga as ni,Gb as sc,Gc as kl,Gh as Sp,H as Ge,Hc as bs,Hd as Bi,He as ra,Hg as hc,Hh as bp,I as lr,Ia as Ol,Id as Tn,Ie as sa,Ig as hp,Ih as Pn,J as gl,Ja as wl,Jb as Y,Jc as Cn,Jd as On,Jg as up,Jh as Cp,K as ut,Ka as Sn,Kb as X,Ke as Zl,Kg as gp,Ki as Os,L as Gs,La as x,Lc as Vl,Lg as Wt,Li as va,M as F,Mb as Li,Mc as ci,Mg as an,Mh as Br,Mi as ve,N as xo,Nb as Ae,Nc as ur,Nf as ap,Nh as xp,Ni as Ip,O as fl,Oa as $t,Oc as Ll,Og as Qt,Oh as Ur,Oi as lt,P as Ys,Pa as _,Pc as Fl,Pd as Cs,Pf as cp,Pg as zt,Pi as B,Q as ml,Qa as rc,Qc as Bl,Qf as Lr,Qi as ln,R as pr,Ra as Ce,Rb as Ml,Rc as Ul,Rd as pc,Re as Jl,Rg as $o,Rh as Yo,S as vl,Sa as ui,Sb as Oo,Sc as Hl,Se as ep,Sf as Le,Sg as jo,T as _l,Ta as bn,Tb as yi,Tc as $l,Te as tp,Tf as Di,Tg as pa,Ti as Ap,U as Sl,Ub as bt,Ud as J,Ue as ip,Ui as Dp,V as Xs,Va as se,Vc as yo,Vd as Gl,Ve as np,Vf as gi,Vi as Gr,W as ii,Wa as yl,Wc as ac,Wg as Pt,Wh as Tp,X as en,Xa as El,Xc as jl,Xd as kn,Xe as op,Xf as lp,Xg as Rt,Xh as Op,Xi as _a,Y as Ks,Ya as ge,Yb as qt,Yc as gr,Ye as aa,Yf as oi,Yg as De,Yh as wp,Yi as io,Z as Yn,Za as O,Zb as Js,Zd as G,Ze as ca,Zg as Ln,Zh as yp,Zi as Np,_ as bl,_a as nn,_b as Rl,_c as Nn,_e as rp,_f as Fr,_g as ue,_h as Ep,_i as Yr,a as si,ad as Fi,ae as na,ag as Uo,ah as fi,ai as ha,aj as Zt,b as Rr,bb as hr,bc as on,bh as Ki,bi as Hr,cb as Kt,cd as Gt,ce as xs,cg as jt,ci as $r,cj as kp,d as Rh,db as A,dg as rn,e as pl,eb as D,ec as Il,eh as Wo,f as N,fb as Q,fd as Ze,fe as wn,fh as fp,fi as ri,ga as qs,gb as Bt,gc as Al,gd as Ar,ge as Yl,gh as mp,ha as Lo,hb as Ut,i as wt,ia as st,ib as To,ie as Xl,ig as Pe,j as Ti,jb as Se,jd as Wl,je as fr,jg as Ui,jh as da,ji as ua,k as Ht,ka as Cl,kb as Pl,ke as Po,kg as sn,ki as Mp,la as rt,ld as Vt,le as Kl,lh as zo,li as Ne,ma as dr,mb as ce,md as zl,me as Ts,mh as Ei,mi as ct,n as nc,na as xl,nb as E,nd as w,nf as He,ng as ie,nh as Go,ni as Ni,od as cc,of as yn,og as xt,oh as at,oi as ga,p as _n,pa as di,pc as Dl,pd as Xi,ph as cn,q as ze,qa as hi,qb as Bo,qd as ei,qh as eo,qi as Xo,rb as Ye,rc as Nl,re as oa,rg as pp,ri as fa,sa as Ue,sb as Me,sd as Ih,sh as En,si as uc,t as bo,tb as Re,tc as Ir,te as Nr,tg as K,ti as jr,u as ht,ub as wi,ud as Dr,ue as kr,ui as Wr,v as Gn,va as tn,vb as be,vd as ia,vh as vp,vi as Rp,wa as W,wb as Ee,wd as lc,x as dl,xa as z,xb as Kn,xc as ee,xi as Ko,y as hl,ya as Oi,yb as Qs,yc as ea,yi as ma,z as Ve,zb as Ri,zc as ta,zd as Eo,zh as $i,zi as zr}from"./chunk-GMSVUTYH.js";var dd=Rh((pd,Rs)=>{"use strict";(function(s,t){"use strict";typeof Rs=="object"&&typeof Rs.exports=="object"?Rs.exports=s.document?t(s,!0):function(i){if(!i.document)throw new Error("jQuery requires a window with a document");return t(i)}:t(s)})(typeof window<"u"?window:pd,function(s,t){"use strict";var i=[],e=s.document,n=Object.getPrototypeOf,r=i.slice,c=i.concat,g=i.push,v=i.indexOf,y={},M=y.toString,V=y.hasOwnProperty,Z=V.toString,le=Z.call(Object),pe={};function he(o,a){a=a||e;var l=a.createElement("script");l.text=o,a.head.appendChild(l).parentNode.removeChild(l)}var Te="3.2.0",p=function(o,a){return new p.fn.init(o,a)},dt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,vt=/^-ms-/,gt=/-([a-z])/g,Mi=function(o,a){return a.toUpperCase()};p.fn=p.prototype={jquery:Te,constructor:p,length:0,toArray:function(){return r.call(this)},get:function(o){return o==null?r.call(this):o<0?this[o+this.length]:this[o]},pushStack:function(o){var a=p.merge(this.constructor(),o);return a.prevObject=this,a},each:function(o){return p.each(this,o)},map:function(o){return this.pushStack(p.map(this,function(a,l){return o.call(a,l,a)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(o){var a=this.length,l=+o+(o<0?a:0);return this.pushStack(l>=0&&l<a?[this[l]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:i.sort,splice:i.splice},p.extend=p.fn.extend=function(){var o,a,l,d,m,f,S=arguments[0]||{},R=1,L=arguments.length,H=!1;for(typeof S=="boolean"&&(H=S,S=arguments[R]||{},R++),typeof S=="object"||p.isFunction(S)||(S={}),R===L&&(S=this,R--);R<L;R++)if((o=arguments[R])!=null)for(a in o)l=S[a],d=o[a],S!==d&&(H&&d&&(p.isPlainObject(d)||(m=Array.isArray(d)))?(m?(m=!1,f=l&&Array.isArray(l)?l:[]):f=l&&p.isPlainObject(l)?l:{},S[a]=p.extend(H,f,d)):d!==void 0&&(S[a]=d));return S},p.extend({expando:"jQuery"+(Te+Math.random()).replace(/\D/g,""),isReady:!0,error:function(o){throw new Error(o)},noop:function(){},isFunction:function(o){return p.type(o)==="function"},isWindow:function(o){return o!=null&&o===o.window},isNumeric:function(o){var a=p.type(o);return(a==="number"||a==="string")&&!isNaN(o-parseFloat(o))},isPlainObject:function(o){var a,l;return!(!o||M.call(o)!=="[object Object]")&&(!(a=n(o))||(l=V.call(a,"constructor")&&a.constructor,typeof l=="function"&&Z.call(l)===le))},isEmptyObject:function(o){var a;for(a in o)return!1;return!0},type:function(o){return o==null?o+"":typeof o=="object"||typeof o=="function"?y[M.call(o)]||"object":typeof o},globalEval:function(o){he(o)},camelCase:function(o){return o.replace(vt,"ms-").replace(gt,Mi)},each:function(o,a){var l,d=0;if(At(o))for(l=o.length;d<l&&a.call(o[d],d,o[d])!==!1;d++);else for(d in o)if(a.call(o[d],d,o[d])===!1)break;return o},trim:function(o){return o==null?"":(o+"").replace(dt,"")},makeArray:function(o,a){var l=a||[];return o!=null&&(At(Object(o))?p.merge(l,typeof o=="string"?[o]:o):g.call(l,o)),l},inArray:function(o,a,l){return a==null?-1:v.call(a,o,l)},merge:function(o,a){for(var l=+a.length,d=0,m=o.length;d<l;d++)o[m++]=a[d];return o.length=m,o},grep:function(o,a,l){for(var d,m=[],f=0,S=o.length,R=!l;f<S;f++)d=!a(o[f],f),d!==R&&m.push(o[f]);return m},map:function(o,a,l){var d,m,f=0,S=[];if(At(o))for(d=o.length;f<d;f++)m=a(o[f],f,l),m!=null&&S.push(m);else for(f in o)m=a(o[f],f,l),m!=null&&S.push(m);return c.apply([],S)},guid:1,proxy:function(o,a){var l,d,m;if(typeof a=="string"&&(l=o[a],a=o,o=l),p.isFunction(o))return d=r.call(arguments,2),m=function(){return o.apply(a||this,d.concat(r.call(arguments)))},m.guid=o.guid=o.guid||p.guid++,m},now:Date.now,support:pe}),typeof Symbol=="function"&&(p.fn[Symbol.iterator]=i[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(o,a){y["[object "+a+"]"]=a.toLowerCase()});function At(o){var a=!!o&&"length"in o&&o.length,l=p.type(o);return l!=="function"&&!p.isWindow(o)&&(l==="array"||a===0||typeof a=="number"&&a>0&&a-1 in o)}var li=function(o){var a,l,d,m,f,S,R,L,H,ne,de,j,re,Ke,tt,ke,bi,pi,hn,Nt="sizzle"+1*new Date,et=o.document,Zi=0,Ct=0,ti=Qa(),fs=Qa(),Mr=Qa(),An=function(C,P){return C===P&&(de=!0),0},ms={}.hasOwnProperty,un=[],ko=un.pop,Vo=un.push,Ci=un.push,il=un.slice,sr=function(C,P){for(var k=0,te=C.length;k<te;k++)if(C[k]===P)return k;return-1},Xa="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",kt="[\\x20\\t\\r\\n\\f]",ar="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",nl="\\["+kt+"*("+ar+")(?:"+kt+"*([*^$|!~]?=)"+kt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+ar+"))|)"+kt+"*\\]",Ka=":("+ar+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+nl+")*)|.*)\\)|)",mh=new RegExp(kt+"+","g"),Bs=new RegExp("^"+kt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+kt+"+$","g"),vh=new RegExp("^"+kt+"*,"+kt+"*"),_h=new RegExp("^"+kt+"*([>+~]|"+kt+")"+kt+"*"),Sh=new RegExp("="+kt+`*([^\\]'"]*?)`+kt+"*\\]","g"),bh=new RegExp(Ka),Ch=new RegExp("^"+ar+"$"),Us={ID:new RegExp("^#("+ar+")"),CLASS:new RegExp("^\\.("+ar+")"),TAG:new RegExp("^("+ar+"|[*])"),ATTR:new RegExp("^"+nl),PSEUDO:new RegExp("^"+Ka),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+kt+"*(even|odd|(([+-]|)(\\d*)n|)"+kt+"*(?:([+-]|)"+kt+"*(\\d+)|))"+kt+"*\\)|)","i"),bool:new RegExp("^(?:"+Xa+")$","i"),needsContext:new RegExp("^"+kt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+kt+"*((?:-\\d)?\\d*)"+kt+"*\\)|)(?=[^-]|$)","i")},xh=/^(?:input|select|textarea|button)$/i,Th=/^h\d$/i,vs=/^[^{]+\{\s*\[native \w/,Oh=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,qa=/[+~]/,_o=new RegExp("\\\\([\\da-f]{1,6}"+kt+"?|("+kt+")|.)","ig"),So=function(C,P,k){var te="0x"+P-65536;return te!==te||k?P:te<0?String.fromCharCode(te+65536):String.fromCharCode(te>>10|55296,1023&te|56320)},ol=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,rl=function(C,P){return P?C==="\0"?"\uFFFD":C.slice(0,-1)+"\\"+C.charCodeAt(C.length-1).toString(16)+" ":"\\"+C},sl=function(){j()},wh=$s(function(C){return C.disabled===!0&&("form"in C||"label"in C)},{dir:"parentNode",next:"legend"});try{Ci.apply(un=il.call(et.childNodes),et.childNodes),un[et.childNodes.length].nodeType}catch{Ci={apply:un.length?function(P,k){Vo.apply(P,il.call(k))}:function(P,k){for(var te=P.length,U=0;P[te++]=k[U++];);P.length=te-1}}}function Lt(C,P,k,te){var U,oe,ae,me,_e,je,Be,qe=P&&P.ownerDocument,ft=P?P.nodeType:9;if(k=k||[],typeof C!="string"||!C||ft!==1&&ft!==9&&ft!==11)return k;if(!te&&((P?P.ownerDocument||P:et)!==re&&j(P),P=P||re,tt)){if(ft!==11&&(_e=Oh.exec(C)))if(U=_e[1]){if(ft===9){if(!(ae=P.getElementById(U)))return k;if(ae.id===U)return k.push(ae),k}else if(qe&&(ae=qe.getElementById(U))&&hn(P,ae)&&ae.id===U)return k.push(ae),k}else{if(_e[2])return Ci.apply(k,P.getElementsByTagName(C)),k;if((U=_e[3])&&l.getElementsByClassName&&P.getElementsByClassName)return Ci.apply(k,P.getElementsByClassName(U)),k}if(l.qsa&&!Mr[C+" "]&&(!ke||!ke.test(C))){if(ft!==1)qe=P,Be=C;else if(P.nodeName.toLowerCase()!=="object"){for((me=P.getAttribute("id"))?me=me.replace(ol,rl):P.setAttribute("id",me=Nt),je=S(C),oe=je.length;oe--;)je[oe]="#"+me+" "+Hs(je[oe]);Be=je.join(","),qe=qa.test(C)&&Ja(P.parentNode)||P}if(Be)try{return Ci.apply(k,qe.querySelectorAll(Be)),k}catch{}finally{me===Nt&&P.removeAttribute("id")}}}return L(C.replace(Bs,"$1"),P,k,te)}function Qa(){var C=[];function P(k,te){return C.push(k+" ")>d.cacheLength&&delete P[C.shift()],P[k+" "]=te}return P}function Dn(C){return C[Nt]=!0,C}function zn(C){var P=re.createElement("fieldset");try{return!!C(P)}catch{return!1}finally{P.parentNode&&P.parentNode.removeChild(P),P=null}}function Za(C,P){for(var k=C.split("|"),te=k.length;te--;)d.attrHandle[k[te]]=P}function al(C,P){var k=P&&C,te=k&&C.nodeType===1&&P.nodeType===1&&C.sourceIndex-P.sourceIndex;if(te)return te;if(k){for(;k=k.nextSibling;)if(k===P)return-1}return C?1:-1}function yh(C){return function(P){var k=P.nodeName.toLowerCase();return k==="input"&&P.type===C}}function Eh(C){return function(P){var k=P.nodeName.toLowerCase();return(k==="input"||k==="button")&&P.type===C}}function cl(C){return function(P){return"form"in P?P.parentNode&&P.disabled===!1?"label"in P?"label"in P.parentNode?P.parentNode.disabled===C:P.disabled===C:P.isDisabled===C||P.isDisabled!==!C&&wh(P)===C:P.disabled===C:"label"in P&&P.disabled===C}}function cr(C){return Dn(function(P){return P=+P,Dn(function(k,te){for(var U,oe=C([],k.length,P),ae=oe.length;ae--;)k[U=oe[ae]]&&(k[U]=!(te[U]=k[U]))})})}function Ja(C){return C&&typeof C.getElementsByTagName<"u"&&C}l=Lt.support={},f=Lt.isXML=function(C){var P=C&&(C.ownerDocument||C).documentElement;return!!P&&P.nodeName!=="HTML"},j=Lt.setDocument=function(C){var P,k,te=C?C.ownerDocument||C:et;return te!==re&&te.nodeType===9&&te.documentElement&&(re=te,Ke=re.documentElement,tt=!f(re),et!==re&&(k=re.defaultView)&&k.top!==k&&(k.addEventListener?k.addEventListener("unload",sl,!1):k.attachEvent&&k.attachEvent("onunload",sl)),l.attributes=zn(function(U){return U.className="i",!U.getAttribute("className")}),l.getElementsByTagName=zn(function(U){return U.appendChild(re.createComment("")),!U.getElementsByTagName("*").length}),l.getElementsByClassName=vs.test(re.getElementsByClassName),l.getById=zn(function(U){return Ke.appendChild(U).id=Nt,!re.getElementsByName||!re.getElementsByName(Nt).length}),l.getById?(d.filter.ID=function(U){var oe=U.replace(_o,So);return function(ae){return ae.getAttribute("id")===oe}},d.find.ID=function(U,oe){if(typeof oe.getElementById<"u"&&tt){var ae=oe.getElementById(U);return ae?[ae]:[]}}):(d.filter.ID=function(U){var oe=U.replace(_o,So);return function(ae){var me=typeof ae.getAttributeNode<"u"&&ae.getAttributeNode("id");return me&&me.value===oe}},d.find.ID=function(U,oe){if(typeof oe.getElementById<"u"&&tt){var ae,me,_e,je=oe.getElementById(U);if(je){if(ae=je.getAttributeNode("id"),ae&&ae.value===U)return[je];for(_e=oe.getElementsByName(U),me=0;je=_e[me++];)if(ae=je.getAttributeNode("id"),ae&&ae.value===U)return[je]}return[]}}),d.find.TAG=l.getElementsByTagName?function(U,oe){return typeof oe.getElementsByTagName<"u"?oe.getElementsByTagName(U):l.qsa?oe.querySelectorAll(U):void 0}:function(U,oe){var ae,me=[],_e=0,je=oe.getElementsByTagName(U);if(U==="*"){for(;ae=je[_e++];)ae.nodeType===1&&me.push(ae);return me}return je},d.find.CLASS=l.getElementsByClassName&&function(U,oe){if(typeof oe.getElementsByClassName<"u"&&tt)return oe.getElementsByClassName(U)},bi=[],ke=[],(l.qsa=vs.test(re.querySelectorAll))&&(zn(function(U){Ke.appendChild(U).innerHTML="<a id='"+Nt+"'></a><select id='"+Nt+"-\r\\' msallowcapture=''><option selected=''></option></select>",U.querySelectorAll("[msallowcapture^='']").length&&ke.push("[*^$]="+kt+`*(?:''|"")`),U.querySelectorAll("[selected]").length||ke.push("\\["+kt+"*(?:value|"+Xa+")"),U.querySelectorAll("[id~="+Nt+"-]").length||ke.push("~="),U.querySelectorAll(":checked").length||ke.push(":checked"),U.querySelectorAll("a#"+Nt+"+*").length||ke.push(".#.+[+~]")}),zn(function(U){U.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var oe=re.createElement("input");oe.setAttribute("type","hidden"),U.appendChild(oe).setAttribute("name","D"),U.querySelectorAll("[name=d]").length&&ke.push("name"+kt+"*[*^$|!~]?="),U.querySelectorAll(":enabled").length!==2&&ke.push(":enabled",":disabled"),Ke.appendChild(U).disabled=!0,U.querySelectorAll(":disabled").length!==2&&ke.push(":enabled",":disabled"),U.querySelectorAll("*,:x"),ke.push(",.*:")})),(l.matchesSelector=vs.test(pi=Ke.matches||Ke.webkitMatchesSelector||Ke.mozMatchesSelector||Ke.oMatchesSelector||Ke.msMatchesSelector))&&zn(function(U){l.disconnectedMatch=pi.call(U,"*"),pi.call(U,"[s!='']:x"),bi.push("!=",Ka)}),ke=ke.length&&new RegExp(ke.join("|")),bi=bi.length&&new RegExp(bi.join("|")),P=vs.test(Ke.compareDocumentPosition),hn=P||vs.test(Ke.contains)?function(U,oe){var ae=U.nodeType===9?U.documentElement:U,me=oe&&oe.parentNode;return U===me||!(!me||me.nodeType!==1||!(ae.contains?ae.contains(me):U.compareDocumentPosition&&16&U.compareDocumentPosition(me)))}:function(U,oe){if(oe){for(;oe=oe.parentNode;)if(oe===U)return!0}return!1},An=P?function(U,oe){if(U===oe)return de=!0,0;var ae=!U.compareDocumentPosition-!oe.compareDocumentPosition;return ae||(ae=(U.ownerDocument||U)===(oe.ownerDocument||oe)?U.compareDocumentPosition(oe):1,1&ae||!l.sortDetached&&oe.compareDocumentPosition(U)===ae?U===re||U.ownerDocument===et&&hn(et,U)?-1:oe===re||oe.ownerDocument===et&&hn(et,oe)?1:ne?sr(ne,U)-sr(ne,oe):0:4&ae?-1:1)}:function(U,oe){if(U===oe)return de=!0,0;var ae,me=0,_e=U.parentNode,je=oe.parentNode,Be=[U],qe=[oe];if(!_e||!je)return U===re?-1:oe===re?1:_e?-1:je?1:ne?sr(ne,U)-sr(ne,oe):0;if(_e===je)return al(U,oe);for(ae=U;ae=ae.parentNode;)Be.unshift(ae);for(ae=oe;ae=ae.parentNode;)qe.unshift(ae);for(;Be[me]===qe[me];)me++;return me?al(Be[me],qe[me]):Be[me]===et?-1:qe[me]===et?1:0}),re},Lt.matches=function(C,P){return Lt(C,null,null,P)},Lt.matchesSelector=function(C,P){if((C.ownerDocument||C)!==re&&j(C),P=P.replace(Sh,"='$1']"),l.matchesSelector&&tt&&!Mr[P+" "]&&(!bi||!bi.test(P))&&(!ke||!ke.test(P)))try{var k=pi.call(C,P);if(k||l.disconnectedMatch||C.document&&C.document.nodeType!==11)return k}catch{}return Lt(P,re,null,[C]).length>0},Lt.contains=function(C,P){return(C.ownerDocument||C)!==re&&j(C),hn(C,P)},Lt.attr=function(C,P){(C.ownerDocument||C)!==re&&j(C);var k=d.attrHandle[P.toLowerCase()],te=k&&ms.call(d.attrHandle,P.toLowerCase())?k(C,P,!tt):void 0;return te!==void 0?te:l.attributes||!tt?C.getAttribute(P):(te=C.getAttributeNode(P))&&te.specified?te.value:null},Lt.escape=function(C){return(C+"").replace(ol,rl)},Lt.error=function(C){throw new Error("Syntax error, unrecognized expression: "+C)},Lt.uniqueSort=function(C){var P,k=[],te=0,U=0;if(de=!l.detectDuplicates,ne=!l.sortStable&&C.slice(0),C.sort(An),de){for(;P=C[U++];)P===C[U]&&(te=k.push(U));for(;te--;)C.splice(k[te],1)}return ne=null,C},m=Lt.getText=function(C){var P,k="",te=0,U=C.nodeType;if(U){if(U===1||U===9||U===11){if(typeof C.textContent=="string")return C.textContent;for(C=C.firstChild;C;C=C.nextSibling)k+=m(C)}else if(U===3||U===4)return C.nodeValue}else for(;P=C[te++];)k+=m(P);return k},d=Lt.selectors={cacheLength:50,createPseudo:Dn,match:Us,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(C){return C[1]=C[1].replace(_o,So),C[3]=(C[3]||C[4]||C[5]||"").replace(_o,So),C[2]==="~="&&(C[3]=" "+C[3]+" "),C.slice(0,4)},CHILD:function(C){return C[1]=C[1].toLowerCase(),C[1].slice(0,3)==="nth"?(C[3]||Lt.error(C[0]),C[4]=+(C[4]?C[5]+(C[6]||1):2*(C[3]==="even"||C[3]==="odd")),C[5]=+(C[7]+C[8]||C[3]==="odd")):C[3]&&Lt.error(C[0]),C},PSEUDO:function(C){var P,k=!C[6]&&C[2];return Us.CHILD.test(C[0])?null:(C[3]?C[2]=C[4]||C[5]||"":k&&bh.test(k)&&(P=S(k,!0))&&(P=k.indexOf(")",k.length-P)-k.length)&&(C[0]=C[0].slice(0,P),C[2]=k.slice(0,P)),C.slice(0,3))}},filter:{TAG:function(C){var P=C.replace(_o,So).toLowerCase();return C==="*"?function(){return!0}:function(k){return k.nodeName&&k.nodeName.toLowerCase()===P}},CLASS:function(C){var P=ti[C+" "];return P||(P=new RegExp("(^|"+kt+")"+C+"("+kt+"|$)"))&&ti(C,function(k){return P.test(typeof k.className=="string"&&k.className||typeof k.getAttribute<"u"&&k.getAttribute("class")||"")})},ATTR:function(C,P,k){return function(te){var U=Lt.attr(te,C);return U==null?P==="!=":!P||(U+="",P==="="?U===k:P==="!="?U!==k:P==="^="?k&&U.indexOf(k)===0:P==="*="?k&&U.indexOf(k)>-1:P==="$="?k&&U.slice(-k.length)===k:P==="~="?(" "+U.replace(mh," ")+" ").indexOf(k)>-1:P==="|="&&(U===k||U.slice(0,k.length+1)===k+"-"))}},CHILD:function(C,P,k,te,U){var oe=C.slice(0,3)!=="nth",ae=C.slice(-4)!=="last",me=P==="of-type";return te===1&&U===0?function(_e){return!!_e.parentNode}:function(_e,je,Be){var qe,ft,Ft,We,xi,Hi,gn=oe!==ae?"nextSibling":"previousSibling",Xt=_e.parentNode,_s=me&&_e.nodeName.toLowerCase(),Ss=!Be&&!me,fn=!1;if(Xt){if(oe){for(;gn;){for(We=_e;We=We[gn];)if(me?We.nodeName.toLowerCase()===_s:We.nodeType===1)return!1;Hi=gn=C==="only"&&!Hi&&"nextSibling"}return!0}if(Hi=[ae?Xt.firstChild:Xt.lastChild],ae&&Ss){for(We=Xt,Ft=We[Nt]||(We[Nt]={}),ft=Ft[We.uniqueID]||(Ft[We.uniqueID]={}),qe=ft[C]||[],xi=qe[0]===Zi&&qe[1],fn=xi&&qe[2],We=xi&&Xt.childNodes[xi];We=++xi&&We&&We[gn]||(fn=xi=0)||Hi.pop();)if(We.nodeType===1&&++fn&&We===_e){ft[C]=[Zi,xi,fn];break}}else if(Ss&&(We=_e,Ft=We[Nt]||(We[Nt]={}),ft=Ft[We.uniqueID]||(Ft[We.uniqueID]={}),qe=ft[C]||[],xi=qe[0]===Zi&&qe[1],fn=xi),fn===!1)for(;(We=++xi&&We&&We[gn]||(fn=xi=0)||Hi.pop())&&!((me?We.nodeName.toLowerCase()===_s:We.nodeType===1)&&++fn&&(Ss&&(Ft=We[Nt]||(We[Nt]={}),ft=Ft[We.uniqueID]||(Ft[We.uniqueID]={}),ft[C]=[Zi,fn]),We===_e)););return fn-=U,fn===te||fn%te===0&&fn/te>=0}}},PSEUDO:function(C,P){var k,te=d.pseudos[C]||d.setFilters[C.toLowerCase()]||Lt.error("unsupported pseudo: "+C);return te[Nt]?te(P):te.length>1?(k=[C,C,"",P],d.setFilters.hasOwnProperty(C.toLowerCase())?Dn(function(U,oe){for(var ae,me=te(U,P),_e=me.length;_e--;)ae=sr(U,me[_e]),U[ae]=!(oe[ae]=me[_e])}):function(U){return te(U,0,k)}):te}},pseudos:{not:Dn(function(C){var P=[],k=[],te=R(C.replace(Bs,"$1"));return te[Nt]?Dn(function(U,oe,ae,me){for(var _e,je=te(U,null,me,[]),Be=U.length;Be--;)(_e=je[Be])&&(U[Be]=!(oe[Be]=_e))}):function(U,oe,ae){return P[0]=U,te(P,null,ae,k),P[0]=null,!k.pop()}}),has:Dn(function(C){return function(P){return Lt(C,P).length>0}}),contains:Dn(function(C){return C=C.replace(_o,So),function(P){return(P.textContent||P.innerText||m(P)).indexOf(C)>-1}}),lang:Dn(function(C){return Ch.test(C||"")||Lt.error("unsupported lang: "+C),C=C.replace(_o,So).toLowerCase(),function(P){var k;do if(k=tt?P.lang:P.getAttribute("xml:lang")||P.getAttribute("lang"))return k=k.toLowerCase(),k===C||k.indexOf(C+"-")===0;while((P=P.parentNode)&&P.nodeType===1);return!1}}),target:function(C){var P=o.location&&o.location.hash;return P&&P.slice(1)===C.id},root:function(C){return C===Ke},focus:function(C){return C===re.activeElement&&(!re.hasFocus||re.hasFocus())&&!!(C.type||C.href||~C.tabIndex)},enabled:cl(!1),disabled:cl(!0),checked:function(C){var P=C.nodeName.toLowerCase();return P==="input"&&!!C.checked||P==="option"&&!!C.selected},selected:function(C){return C.parentNode&&C.parentNode.selectedIndex,C.selected===!0},empty:function(C){for(C=C.firstChild;C;C=C.nextSibling)if(C.nodeType<6)return!1;return!0},parent:function(C){return!d.pseudos.empty(C)},header:function(C){return Th.test(C.nodeName)},input:function(C){return xh.test(C.nodeName)},button:function(C){var P=C.nodeName.toLowerCase();return P==="input"&&C.type==="button"||P==="button"},text:function(C){var P;return C.nodeName.toLowerCase()==="input"&&C.type==="text"&&((P=C.getAttribute("type"))==null||P.toLowerCase()==="text")},first:cr(function(){return[0]}),last:cr(function(C,P){return[P-1]}),eq:cr(function(C,P,k){return[k<0?k+P:k]}),even:cr(function(C,P){for(var k=0;k<P;k+=2)C.push(k);return C}),odd:cr(function(C,P){for(var k=1;k<P;k+=2)C.push(k);return C}),lt:cr(function(C,P,k){for(var te=k<0?k+P:k;--te>=0;)C.push(te);return C}),gt:cr(function(C,P,k){for(var te=k<0?k+P:k;++te<P;)C.push(te);return C})}},d.pseudos.nth=d.pseudos.eq;for(a in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[a]=yh(a);for(a in{submit:!0,reset:!0})d.pseudos[a]=Eh(a);function ll(){}ll.prototype=d.filters=d.pseudos,d.setFilters=new ll,S=Lt.tokenize=function(C,P){var k,te,U,oe,ae,me,_e,je=fs[C+" "];if(je)return P?0:je.slice(0);for(ae=C,me=[],_e=d.preFilter;ae;){k&&!(te=vh.exec(ae))||(te&&(ae=ae.slice(te[0].length)||ae),me.push(U=[])),k=!1,(te=_h.exec(ae))&&(k=te.shift(),U.push({value:k,type:te[0].replace(Bs," ")}),ae=ae.slice(k.length));for(oe in d.filter)!(te=Us[oe].exec(ae))||_e[oe]&&!(te=_e[oe](te))||(k=te.shift(),U.push({value:k,type:oe,matches:te}),ae=ae.slice(k.length));if(!k)break}return P?ae.length:ae?Lt.error(C):fs(C,me).slice(0)};function Hs(C){for(var P=0,k=C.length,te="";P<k;P++)te+=C[P].value;return te}function $s(C,P,k){var te=P.dir,U=P.next,oe=U||te,ae=k&&oe==="parentNode",me=Ct++;return P.first?function(_e,je,Be){for(;_e=_e[te];)if(_e.nodeType===1||ae)return C(_e,je,Be);return!1}:function(_e,je,Be){var qe,ft,Ft,We=[Zi,me];if(Be){for(;_e=_e[te];)if((_e.nodeType===1||ae)&&C(_e,je,Be))return!0}else for(;_e=_e[te];)if(_e.nodeType===1||ae)if(Ft=_e[Nt]||(_e[Nt]={}),ft=Ft[_e.uniqueID]||(Ft[_e.uniqueID]={}),U&&U===_e.nodeName.toLowerCase())_e=_e[te]||_e;else{if((qe=ft[oe])&&qe[0]===Zi&&qe[1]===me)return We[2]=qe[2];if(ft[oe]=We,We[2]=C(_e,je,Be))return!0}return!1}}function ec(C){return C.length>1?function(P,k,te){for(var U=C.length;U--;)if(!C[U](P,k,te))return!1;return!0}:C[0]}function Ph(C,P,k){for(var te=0,U=P.length;te<U;te++)Lt(C,P[te],k);return k}function js(C,P,k,te,U){for(var oe,ae=[],me=0,_e=C.length,je=P!=null;me<_e;me++)(oe=C[me])&&(k&&!k(oe,te,U)||(ae.push(oe),je&&P.push(me)));return ae}function tc(C,P,k,te,U,oe){return te&&!te[Nt]&&(te=tc(te)),U&&!U[Nt]&&(U=tc(U,oe)),Dn(function(ae,me,_e,je){var Be,qe,ft,Ft=[],We=[],xi=me.length,Hi=ae||Ph(P||"*",_e.nodeType?[_e]:_e,[]),gn=!C||!ae&&P?Hi:js(Hi,Ft,C,_e,je),Xt=k?U||(ae?C:xi||te)?[]:me:gn;if(k&&k(gn,Xt,_e,je),te)for(Be=js(Xt,We),te(Be,[],_e,je),qe=Be.length;qe--;)(ft=Be[qe])&&(Xt[We[qe]]=!(gn[We[qe]]=ft));if(ae){if(U||C){if(U){for(Be=[],qe=Xt.length;qe--;)(ft=Xt[qe])&&Be.push(gn[qe]=ft);U(null,Xt=[],Be,je)}for(qe=Xt.length;qe--;)(ft=Xt[qe])&&(Be=U?sr(ae,ft):Ft[qe])>-1&&(ae[Be]=!(me[Be]=ft))}}else Xt=js(Xt===me?Xt.splice(xi,Xt.length):Xt),U?U(null,me,Xt,je):Ci.apply(me,Xt)})}function ic(C){for(var P,k,te,U=C.length,oe=d.relative[C[0].type],ae=oe||d.relative[" "],me=oe?1:0,_e=$s(function(qe){return qe===P},ae,!0),je=$s(function(qe){return sr(P,qe)>-1},ae,!0),Be=[function(qe,ft,Ft){var We=!oe&&(Ft||ft!==H)||((P=ft).nodeType?_e(qe,ft,Ft):je(qe,ft,Ft));return P=null,We}];me<U;me++)if(k=d.relative[C[me].type])Be=[$s(ec(Be),k)];else{if(k=d.filter[C[me].type].apply(null,C[me].matches),k[Nt]){for(te=++me;te<U&&!d.relative[C[te].type];te++);return tc(me>1&&ec(Be),me>1&&Hs(C.slice(0,me-1).concat({value:C[me-2].type===" "?"*":""})).replace(Bs,"$1"),k,me<te&&ic(C.slice(me,te)),te<U&&ic(C=C.slice(te)),te<U&&Hs(C))}Be.push(k)}return ec(Be)}function Mh(C,P){var k=P.length>0,te=C.length>0,U=function(oe,ae,me,_e,je){var Be,qe,ft,Ft=0,We="0",xi=oe&&[],Hi=[],gn=H,Xt=oe||te&&d.find.TAG("*",je),_s=Zi+=gn==null?1:Math.random()||.1,Ss=Xt.length;for(je&&(H=ae===re||ae||je);We!==Ss&&(Be=Xt[We])!=null;We++){if(te&&Be){for(qe=0,ae||Be.ownerDocument===re||(j(Be),me=!tt);ft=C[qe++];)if(ft(Be,ae||re,me)){_e.push(Be);break}je&&(Zi=_s)}k&&((Be=!ft&&Be)&&Ft--,oe&&xi.push(Be))}if(Ft+=We,k&&We!==Ft){for(qe=0;ft=P[qe++];)ft(xi,Hi,ae,me);if(oe){if(Ft>0)for(;We--;)xi[We]||Hi[We]||(Hi[We]=ko.call(_e));Hi=js(Hi)}Ci.apply(_e,Hi),je&&!oe&&Hi.length>0&&Ft+P.length>1&&Lt.uniqueSort(_e)}return je&&(Zi=_s,H=gn),xi};return k?Dn(U):U}return R=Lt.compile=function(C,P){var k,te=[],U=[],oe=Mr[C+" "];if(!oe){for(P||(P=S(C)),k=P.length;k--;)oe=ic(P[k]),oe[Nt]?te.push(oe):U.push(oe);oe=Mr(C,Mh(U,te)),oe.selector=C}return oe},L=Lt.select=function(C,P,k,te){var U,oe,ae,me,_e,je=typeof C=="function"&&C,Be=!te&&S(C=je.selector||C);if(k=k||[],Be.length===1){if(oe=Be[0]=Be[0].slice(0),oe.length>2&&(ae=oe[0]).type==="ID"&&P.nodeType===9&&tt&&d.relative[oe[1].type]){if(P=(d.find.ID(ae.matches[0].replace(_o,So),P)||[])[0],!P)return k;je&&(P=P.parentNode),C=C.slice(oe.shift().value.length)}for(U=Us.needsContext.test(C)?0:oe.length;U--&&(ae=oe[U],!d.relative[me=ae.type]);)if((_e=d.find[me])&&(te=_e(ae.matches[0].replace(_o,So),qa.test(oe[0].type)&&Ja(P.parentNode)||P))){if(oe.splice(U,1),C=te.length&&Hs(oe),!C)return Ci.apply(k,te),k;break}}return(je||R(C,Be))(te,P,!tt,k,!P||qa.test(C)&&Ja(P.parentNode)||P),k},l.sortStable=Nt.split("").sort(An).join("")===Nt,l.detectDuplicates=!!de,j(),l.sortDetached=zn(function(C){return 1&C.compareDocumentPosition(re.createElement("fieldset"))}),zn(function(C){return C.innerHTML="<a href='#'></a>",C.firstChild.getAttribute("href")==="#"})||Za("type|href|height|width",function(C,P,k){if(!k)return C.getAttribute(P,P.toLowerCase()==="type"?1:2)}),l.attributes&&zn(function(C){return C.innerHTML="<input/>",C.firstChild.setAttribute("value",""),C.firstChild.getAttribute("value")===""})||Za("value",function(C,P,k){if(!k&&C.nodeName.toLowerCase()==="input")return C.defaultValue}),zn(function(C){return C.getAttribute("disabled")==null})||Za(Xa,function(C,P,k){var te;if(!k)return C[P]===!0?P.toLowerCase():(te=C.getAttributeNode(P))&&te.specified?te.value:null}),Lt}(s);p.find=li,p.expr=li.selectors,p.expr[":"]=p.expr.pseudos,p.uniqueSort=p.unique=li.uniqueSort,p.text=li.getText,p.isXMLDoc=li.isXML,p.contains=li.contains,p.escapeSelector=li.escape;var mi=function(o,a,l){for(var d=[],m=l!==void 0;(o=o[a])&&o.nodeType!==9;)if(o.nodeType===1){if(m&&p(o).is(l))break;d.push(o)}return d},Oe=function(o,a){for(var l=[];o;o=o.nextSibling)o.nodeType===1&&o!==a&&l.push(o);return l},Fe=p.expr.match.needsContext;function h(o,a){return o.nodeName&&o.nodeName.toLowerCase()===a.toLowerCase()}var u=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,b=/^.[^:#\[\.,]*$/;function T(o,a,l){return p.isFunction(a)?p.grep(o,function(d,m){return!!a.call(d,m,d)!==l}):a.nodeType?p.grep(o,function(d){return d===a!==l}):typeof a!="string"?p.grep(o,function(d){return v.call(a,d)>-1!==l}):b.test(a)?p.filter(a,o,l):(a=p.filter(a,o),p.grep(o,function(d){return v.call(a,d)>-1!==l&&d.nodeType===1}))}p.filter=function(o,a,l){var d=a[0];return l&&(o=":not("+o+")"),a.length===1&&d.nodeType===1?p.find.matchesSelector(d,o)?[d]:[]:p.find.matches(o,p.grep(a,function(m){return m.nodeType===1}))},p.fn.extend({find:function(o){var a,l,d=this.length,m=this;if(typeof o!="string")return this.pushStack(p(o).filter(function(){for(a=0;a<d;a++)if(p.contains(m[a],this))return!0}));for(l=this.pushStack([]),a=0;a<d;a++)p.find(o,m[a],l);return d>1?p.uniqueSort(l):l},filter:function(o){return this.pushStack(T(this,o||[],!1))},not:function(o){return this.pushStack(T(this,o||[],!0))},is:function(o){return!!T(this,typeof o=="string"&&Fe.test(o)?p(o):o||[],!1).length}});var I,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,we=p.fn.init=function(o,a,l){var d,m;if(!o)return this;if(l=l||I,typeof o=="string"){if(d=o[0]==="<"&&o[o.length-1]===">"&&o.length>=3?[null,o,null]:q.exec(o),!d||!d[1]&&a)return!a||a.jquery?(a||l).find(o):this.constructor(a).find(o);if(d[1]){if(a=a instanceof p?a[0]:a,p.merge(this,p.parseHTML(d[1],a&&a.nodeType?a.ownerDocument||a:e,!0)),u.test(d[1])&&p.isPlainObject(a))for(d in a)p.isFunction(this[d])?this[d](a[d]):this.attr(d,a[d]);return this}return m=e.getElementById(d[2]),m&&(this[0]=m,this.length=1),this}return o.nodeType?(this[0]=o,this.length=1,this):p.isFunction(o)?l.ready!==void 0?l.ready(o):o(p):p.makeArray(o,this)};we.prototype=p.fn,I=p(e);var Je=/^(?:parents|prev(?:Until|All))/,pt={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({has:function(o){var a=p(o,this),l=a.length;return this.filter(function(){for(var d=0;d<l;d++)if(p.contains(this,a[d]))return!0})},closest:function(o,a){var l,d=0,m=this.length,f=[],S=typeof o!="string"&&p(o);if(!Fe.test(o)){for(;d<m;d++)for(l=this[d];l&&l!==a;l=l.parentNode)if(l.nodeType<11&&(S?S.index(l)>-1:l.nodeType===1&&p.find.matchesSelector(l,o))){f.push(l);break}}return this.pushStack(f.length>1?p.uniqueSort(f):f)},index:function(o){return o?typeof o=="string"?v.call(p(o),this[0]):v.call(this,o.jquery?o[0]:o):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(o,a){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(o,a))))},addBack:function(o){return this.add(o==null?this.prevObject:this.prevObject.filter(o))}});function Ot(o,a){for(;(o=o[a])&&o.nodeType!==1;);return o}p.each({parent:function(o){var a=o.parentNode;return a&&a.nodeType!==11?a:null},parents:function(o){return mi(o,"parentNode")},parentsUntil:function(o,a,l){return mi(o,"parentNode",l)},next:function(o){return Ot(o,"nextSibling")},prev:function(o){return Ot(o,"previousSibling")},nextAll:function(o){return mi(o,"nextSibling")},prevAll:function(o){return mi(o,"previousSibling")},nextUntil:function(o,a,l){return mi(o,"nextSibling",l)},prevUntil:function(o,a,l){return mi(o,"previousSibling",l)},siblings:function(o){return Oe((o.parentNode||{}).firstChild,o)},children:function(o){return Oe(o.firstChild)},contents:function(o){return h(o,"iframe")?o.contentDocument:(h(o,"template")&&(o=o.content||o),p.merge([],o.childNodes))}},function(o,a){p.fn[o]=function(l,d){var m=p.map(this,a,l);return o.slice(-5)!=="Until"&&(d=l),d&&typeof d=="string"&&(m=p.filter(d,m)),this.length>1&&(pt[o]||p.uniqueSort(m),Je.test(o)&&m.reverse()),this.pushStack(m)}});var mt=/[^\x20\t\r\n\f]+/g;function vi(o){var a={};return p.each(o.match(mt)||[],function(l,d){a[d]=!0}),a}p.Callbacks=function(o){o=typeof o=="string"?vi(o):p.extend({},o);var a,l,d,m,f=[],S=[],R=-1,L=function(){for(m=m||o.once,d=a=!0;S.length;R=-1)for(l=S.shift();++R<f.length;)f[R].apply(l[0],l[1])===!1&&o.stopOnFalse&&(R=f.length,l=!1);o.memory||(l=!1),a=!1,m&&(f=l?[]:"")},H={add:function(){return f&&(l&&!a&&(R=f.length-1,S.push(l)),function ne(de){p.each(de,function(j,re){p.isFunction(re)?o.unique&&H.has(re)||f.push(re):re&&re.length&&p.type(re)!=="string"&&ne(re)})}(arguments),l&&!a&&L()),this},remove:function(){return p.each(arguments,function(ne,de){for(var j;(j=p.inArray(de,f,j))>-1;)f.splice(j,1),j<=R&&R--}),this},has:function(ne){return ne?p.inArray(ne,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return m=S=[],f=l="",this},disabled:function(){return!f},lock:function(){return m=S=[],l||a||(f=l=""),this},locked:function(){return!!m},fireWith:function(ne,de){return m||(de=de||[],de=[ne,de.slice?de.slice():de],S.push(de),a||L()),this},fire:function(){return H.fireWith(this,arguments),this},fired:function(){return!!d}};return H};function pn(o){return o}function lo(o){throw o}function po(o,a,l,d){var m;try{o&&p.isFunction(m=o.promise)?m.call(o).done(a).fail(l):o&&p.isFunction(m=o.then)?m.call(o,a,l):a.apply(void 0,[o].slice(d))}catch(f){l.apply(void 0,[f])}}p.extend({Deferred:function(o){var a=[["notify","progress",p.Callbacks("memory"),p.Callbacks("memory"),2],["resolve","done",p.Callbacks("once memory"),p.Callbacks("once memory"),0,"resolved"],["reject","fail",p.Callbacks("once memory"),p.Callbacks("once memory"),1,"rejected"]],l="pending",d={state:function(){return l},always:function(){return m.done(arguments).fail(arguments),this},catch:function(f){return d.then(null,f)},pipe:function(){var f=arguments;return p.Deferred(function(S){p.each(a,function(R,L){var H=p.isFunction(f[L[4]])&&f[L[4]];m[L[1]](function(){var ne=H&&H.apply(this,arguments);ne&&p.isFunction(ne.promise)?ne.promise().progress(S.notify).done(S.resolve).fail(S.reject):S[L[0]+"With"](this,H?[ne]:arguments)})}),f=null}).promise()},then:function(f,S,R){var L=0;function H(ne,de,j,re){return function(){var Ke=this,tt=arguments,ke=function(){var pi,hn;if(!(ne<L)){if(pi=j.apply(Ke,tt),pi===de.promise())throw new TypeError("Thenable self-resolution");hn=pi&&(typeof pi=="object"||typeof pi=="function")&&pi.then,p.isFunction(hn)?re?hn.call(pi,H(L,de,pn,re),H(L,de,lo,re)):(L++,hn.call(pi,H(L,de,pn,re),H(L,de,lo,re),H(L,de,pn,de.notifyWith))):(j!==pn&&(Ke=void 0,tt=[pi]),(re||de.resolveWith)(Ke,tt))}},bi=re?ke:function(){try{ke()}catch(pi){p.Deferred.exceptionHook&&p.Deferred.exceptionHook(pi,bi.stackTrace),ne+1>=L&&(j!==lo&&(Ke=void 0,tt=[pi]),de.rejectWith(Ke,tt))}};ne?bi():(p.Deferred.getStackHook&&(bi.stackTrace=p.Deferred.getStackHook()),s.setTimeout(bi))}}return p.Deferred(function(ne){a[0][3].add(H(0,ne,p.isFunction(R)?R:pn,ne.notifyWith)),a[1][3].add(H(0,ne,p.isFunction(f)?f:pn)),a[2][3].add(H(0,ne,p.isFunction(S)?S:lo))}).promise()},promise:function(f){return f!=null?p.extend(f,d):d}},m={};return p.each(a,function(f,S){var R=S[2],L=S[5];d[S[1]]=R.add,L&&R.add(function(){l=L},a[3-f][2].disable,a[0][2].lock),R.add(S[3].fire),m[S[0]]=function(){return m[S[0]+"With"](this===m?void 0:this,arguments),this},m[S[0]+"With"]=R.fireWith}),d.promise(m),o&&o.call(m,m),m},when:function(o){var a=arguments.length,l=a,d=Array(l),m=r.call(arguments),f=p.Deferred(),S=function(R){return function(L){d[R]=this,m[R]=arguments.length>1?r.call(arguments):L,--a||f.resolveWith(d,m)}};if(a<=1&&(po(o,f.done(S(l)).resolve,f.reject,!a),f.state()==="pending"||p.isFunction(m[l]&&m[l].then)))return f.then();for(;l--;)po(m[l],S(l),f.reject);return f.promise()}});var ir=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;p.Deferred.exceptionHook=function(o,a){s.console&&s.console.warn&&o&&ir.test(o.name)&&s.console.warn("jQuery.Deferred exception: "+o.message,o.stack,a)},p.readyException=function(o){s.setTimeout(function(){throw o})};var Do=p.Deferred();p.fn.ready=function(o){return Do.then(o).catch(function(a){p.readyException(a)}),this},p.extend({isReady:!1,readyWait:1,ready:function(o){(o===!0?--p.readyWait:p.isReady)||(p.isReady=!0,o!==!0&&--p.readyWait>0||Do.resolveWith(e,[p]))}}),p.ready.then=Do.then;function ho(){e.removeEventListener("DOMContentLoaded",ho),s.removeEventListener("load",ho),p.ready()}e.readyState==="complete"||e.readyState!=="loading"&&!e.documentElement.doScroll?s.setTimeout(p.ready):(e.addEventListener("DOMContentLoaded",ho),s.addEventListener("load",ho));var Gi=function(o,a,l,d,m,f,S){var R=0,L=o.length,H=l==null;if(p.type(l)==="object"){m=!0;for(R in l)Gi(o,a,R,l[R],!0,f,S)}else if(d!==void 0&&(m=!0,p.isFunction(d)||(S=!0),H&&(S?(a.call(o,d),a=null):(H=a,a=function(ne,de,j){return H.call(p(ne),j)})),a))for(;R<L;R++)a(o[R],l,S?d:d.call(o[R],R,a(o[R],l)));return m?o:H?a.call(o):L?a(o[0],l):f},No=function(o){return o.nodeType===1||o.nodeType===9||!+o.nodeType};function dn(){this.expando=p.expando+dn.uid++}dn.uid=1,dn.prototype={cache:function(o){var a=o[this.expando];return a||(a={},No(o)&&(o.nodeType?o[this.expando]=a:Object.defineProperty(o,this.expando,{value:a,configurable:!0}))),a},set:function(o,a,l){var d,m=this.cache(o);if(typeof a=="string")m[p.camelCase(a)]=l;else for(d in a)m[p.camelCase(d)]=a[d];return m},get:function(o,a){return a===void 0?this.cache(o):o[this.expando]&&o[this.expando][p.camelCase(a)]},access:function(o,a,l){return a===void 0||a&&typeof a=="string"&&l===void 0?this.get(o,a):(this.set(o,a,l),l!==void 0?l:a)},remove:function(o,a){var l,d=o[this.expando];if(d!==void 0){if(a!==void 0)for(Array.isArray(a)?a=a.map(p.camelCase):(a=p.camelCase(a),a=a in d?[a]:a.match(mt)||[]),l=a.length;l--;)delete d[a[l]];(a===void 0||p.isEmptyObject(d))&&(o.nodeType?o[this.expando]=void 0:delete o[this.expando])}},hasData:function(o){var a=o[this.expando];return a!==void 0&&!p.isEmptyObject(a)}};var Xe=new dn,_i=new dn,jn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Tr=/[A-Z]/g;function Ns(o){return o==="true"||o!=="false"&&(o==="null"?null:o===+o+""?+o:jn.test(o)?JSON.parse(o):o)}function vn(o,a,l){var d;if(l===void 0&&o.nodeType===1)if(d="data-"+a.replace(Tr,"-$&").toLowerCase(),l=o.getAttribute(d),typeof l=="string"){try{l=Ns(l)}catch{}_i.set(o,a,l)}else l=void 0;return l}p.extend({hasData:function(o){return _i.hasData(o)||Xe.hasData(o)},data:function(o,a,l){return _i.access(o,a,l)},removeData:function(o,a){_i.remove(o,a)},_data:function(o,a,l){return Xe.access(o,a,l)},_removeData:function(o,a){Xe.remove(o,a)}}),p.fn.extend({data:function(o,a){var l,d,m,f=this[0],S=f&&f.attributes;if(o===void 0){if(this.length&&(m=_i.get(f),f.nodeType===1&&!Xe.get(f,"hasDataAttrs"))){for(l=S.length;l--;)S[l]&&(d=S[l].name,d.indexOf("data-")===0&&(d=p.camelCase(d.slice(5)),vn(f,d,m[d])));Xe.set(f,"hasDataAttrs",!0)}return m}return typeof o=="object"?this.each(function(){_i.set(this,o)}):Gi(this,function(R){var L;if(f&&R===void 0){if(L=_i.get(f,o),L!==void 0||(L=vn(f,o),L!==void 0))return L}else this.each(function(){_i.set(this,o,R)})},null,a,arguments.length>1,null,!0)},removeData:function(o){return this.each(function(){_i.remove(this,o)})}}),p.extend({queue:function(o,a,l){var d;if(o)return a=(a||"fx")+"queue",d=Xe.get(o,a),l&&(!d||Array.isArray(l)?d=Xe.access(o,a,p.makeArray(l)):d.push(l)),d||[]},dequeue:function(o,a){a=a||"fx";var l=p.queue(o,a),d=l.length,m=l.shift(),f=p._queueHooks(o,a),S=function(){p.dequeue(o,a)};m==="inprogress"&&(m=l.shift(),d--),m&&(a==="fx"&&l.unshift("inprogress"),delete f.stop,m.call(o,S,f)),!d&&f&&f.empty.fire()},_queueHooks:function(o,a){var l=a+"queueHooks";return Xe.get(o,l)||Xe.access(o,l,{empty:p.Callbacks("once memory").add(function(){Xe.remove(o,[a+"queue",l])})})}}),p.fn.extend({queue:function(o,a){var l=2;return typeof o!="string"&&(a=o,o="fx",l--),arguments.length<l?p.queue(this[0],o):a===void 0?this:this.each(function(){var d=p.queue(this,o,a);p._queueHooks(this,o),o==="fx"&&d[0]!=="inprogress"&&p.dequeue(this,o)})},dequeue:function(o){return this.each(function(){p.dequeue(this,o)})},clearQueue:function(o){return this.queue(o||"fx",[])},promise:function(o,a){var l,d=1,m=p.Deferred(),f=this,S=this.length,R=function(){--d||m.resolveWith(f,[f])};for(typeof o!="string"&&(a=o,o=void 0),o=o||"fx";S--;)l=Xe.get(f[S],o+"queueHooks"),l&&l.empty&&(d++,l.empty.add(R));return R(),m.promise(a)}});var Or=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Yt=new RegExp("^(?:([+-])=|)("+Or+")([a-z%]*)$","i"),uo=["Top","Right","Bottom","Left"],go=function(o,a){return o=a||o,o.style.display==="none"||o.style.display===""&&p.contains(o.ownerDocument,o)&&p.css(o,"display")==="none"},wr=function(o,a,l,d){var m,f,S={};for(f in a)S[f]=o.style[f],o.style[f]=a[f];m=l.apply(o,d||[]);for(f in a)o.style[f]=S[f];return m};function fo(o,a,l,d){var m,f=1,S=20,R=d?function(){return d.cur()}:function(){return p.css(o,a,"")},L=R(),H=l&&l[3]||(p.cssNumber[a]?"":"px"),ne=(p.cssNumber[a]||H!=="px"&&+L)&&Yt.exec(p.css(o,a));if(ne&&ne[3]!==H){H=H||ne[3],l=l||[],ne=+L||1;do f=f||".5",ne/=f,p.style(o,a,ne+H);while(f!==(f=R()/L)&&f!==1&&--S)}return l&&(ne=+ne||+L||0,m=l[1]?ne+(l[1]+1)*l[2]:+l[2],d&&(d.unit=H,d.start=ne,d.end=m)),m}var Wn={};function nr(o){var a,l=o.ownerDocument,d=o.nodeName,m=Wn[d];return m||(a=l.body.appendChild(l.createElement(d)),m=p.css(a,"display"),a.parentNode.removeChild(a),m==="none"&&(m="block"),Wn[d]=m,m)}function nt(o,a){for(var l,d,m=[],f=0,S=o.length;f<S;f++)d=o[f],d.style&&(l=d.style.display,a?(l==="none"&&(m[f]=Xe.get(d,"display")||null,m[f]||(d.style.display="")),d.style.display===""&&go(d)&&(m[f]=nr(d))):l!=="none"&&(m[f]="none",Xe.set(d,"display",l)));for(f=0;f<S;f++)m[f]!=null&&(o[f].style.display=m[f]);return o}p.fn.extend({show:function(){return nt(this,!0)},hide:function(){return nt(this)},toggle:function(o){return typeof o=="boolean"?o?this.show():this.hide():this.each(function(){go(this)?p(this).show():p(this).hide()})}});var ki=/^(?:checkbox|radio)$/i,Dt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Si=/^$|\/(?:java|ecma)script/i,Yi={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Yi.optgroup=Yi.option,Yi.tbody=Yi.tfoot=Yi.colgroup=Yi.caption=Yi.thead,Yi.th=Yi.td;function Vi(o,a){var l;return l=typeof o.getElementsByTagName<"u"?o.getElementsByTagName(a||"*"):typeof o.querySelectorAll<"u"?o.querySelectorAll(a||"*"):[],a===void 0||a&&h(o,a)?p.merge([o],l):l}function Rn(o,a){for(var l=0,d=o.length;l<d;l++)Xe.set(o[l],"globalEval",!a||Xe.get(a[l],"globalEval"))}var mo=/<|&#?\w+;/;function ps(o,a,l,d,m){for(var f,S,R,L,H,ne,de=a.createDocumentFragment(),j=[],re=0,Ke=o.length;re<Ke;re++)if(f=o[re],f||f===0)if(p.type(f)==="object")p.merge(j,f.nodeType?[f]:f);else if(mo.test(f)){for(S=S||de.appendChild(a.createElement("div")),R=(Dt.exec(f)||["",""])[1].toLowerCase(),L=Yi[R]||Yi._default,S.innerHTML=L[1]+p.htmlPrefilter(f)+L[2],ne=L[0];ne--;)S=S.lastChild;p.merge(j,S.childNodes),S=de.firstChild,S.textContent=""}else j.push(a.createTextNode(f));for(de.textContent="",re=0;f=j[re++];)if(d&&p.inArray(f,d)>-1)m&&m.push(f);else if(H=p.contains(f.ownerDocument,f),S=Vi(de.appendChild(f),"script"),H&&Rn(S),l)for(ne=0;f=S[ne++];)Si.test(f.type||"")&&l.push(f);return de}(function(){var o=e.createDocumentFragment(),a=o.appendChild(e.createElement("div")),l=e.createElement("input");l.setAttribute("type","radio"),l.setAttribute("checked","checked"),l.setAttribute("name","t"),a.appendChild(l),pe.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="<textarea>x</textarea>",pe.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue})();var vo=e.documentElement,kd=/^key/,Vd=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Rc=/^([^.]*)(?:\.(.+)|)/;function ks(){return!0}function yr(){return!1}function Ic(){try{return e.activeElement}catch{}}function Ba(o,a,l,d,m,f){var S,R;if(typeof a=="object"){typeof l!="string"&&(d=d||l,l=void 0);for(R in a)Ba(o,R,l,d,a[R],f);return o}if(d==null&&m==null?(m=l,d=l=void 0):m==null&&(typeof l=="string"?(m=d,d=void 0):(m=d,d=l,l=void 0)),m===!1)m=yr;else if(!m)return o;return f===1&&(S=m,m=function(L){return p().off(L),S.apply(this,arguments)},m.guid=S.guid||(S.guid=p.guid++)),o.each(function(){p.event.add(this,a,m,d,l)})}p.event={global:{},add:function(o,a,l,d,m){var f,S,R,L,H,ne,de,j,re,Ke,tt,ke=Xe.get(o);if(ke)for(l.handler&&(f=l,l=f.handler,m=f.selector),m&&p.find.matchesSelector(vo,m),l.guid||(l.guid=p.guid++),(L=ke.events)||(L=ke.events={}),(S=ke.handle)||(S=ke.handle=function(bi){return typeof p<"u"&&p.event.triggered!==bi.type?p.event.dispatch.apply(o,arguments):void 0}),a=(a||"").match(mt)||[""],H=a.length;H--;)R=Rc.exec(a[H])||[],re=tt=R[1],Ke=(R[2]||"").split(".").sort(),re&&(de=p.event.special[re]||{},re=(m?de.delegateType:de.bindType)||re,de=p.event.special[re]||{},ne=p.extend({type:re,origType:tt,data:d,handler:l,guid:l.guid,selector:m,needsContext:m&&p.expr.match.needsContext.test(m),namespace:Ke.join(".")},f),(j=L[re])||(j=L[re]=[],j.delegateCount=0,de.setup&&de.setup.call(o,d,Ke,S)!==!1||o.addEventListener&&o.addEventListener(re,S)),de.add&&(de.add.call(o,ne),ne.handler.guid||(ne.handler.guid=l.guid)),m?j.splice(j.delegateCount++,0,ne):j.push(ne),p.event.global[re]=!0)},remove:function(o,a,l,d,m){var f,S,R,L,H,ne,de,j,re,Ke,tt,ke=Xe.hasData(o)&&Xe.get(o);if(ke&&(L=ke.events)){for(a=(a||"").match(mt)||[""],H=a.length;H--;)if(R=Rc.exec(a[H])||[],re=tt=R[1],Ke=(R[2]||"").split(".").sort(),re){for(de=p.event.special[re]||{},re=(d?de.delegateType:de.bindType)||re,j=L[re]||[],R=R[2]&&new RegExp("(^|\\.)"+Ke.join("\\.(?:.*\\.|)")+"(\\.|$)"),S=f=j.length;f--;)ne=j[f],!m&&tt!==ne.origType||l&&l.guid!==ne.guid||R&&!R.test(ne.namespace)||d&&d!==ne.selector&&(d!=="**"||!ne.selector)||(j.splice(f,1),ne.selector&&j.delegateCount--,de.remove&&de.remove.call(o,ne));S&&!j.length&&(de.teardown&&de.teardown.call(o,Ke,ke.handle)!==!1||p.removeEvent(o,re,ke.handle),delete L[re])}else for(re in L)p.event.remove(o,re+a[H],l,d,!0);p.isEmptyObject(L)&&Xe.remove(o,"handle events")}},dispatch:function(o){var a=p.event.fix(o),l,d,m,f,S,R,L=new Array(arguments.length),H=(Xe.get(this,"events")||{})[a.type]||[],ne=p.event.special[a.type]||{};for(L[0]=a,l=1;l<arguments.length;l++)L[l]=arguments[l];if(a.delegateTarget=this,!ne.preDispatch||ne.preDispatch.call(this,a)!==!1){for(R=p.event.handlers.call(this,a,H),l=0;(f=R[l++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,d=0;(S=f.handlers[d++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(S.namespace)||(a.handleObj=S,a.data=S.data,m=((p.event.special[S.origType]||{}).handle||S.handler).apply(f.elem,L),m!==void 0&&(a.result=m)===!1&&(a.preventDefault(),a.stopPropagation()));return ne.postDispatch&&ne.postDispatch.call(this,a),a.result}},handlers:function(o,a){var l,d,m,f,S,R=[],L=a.delegateCount,H=o.target;if(L&&H.nodeType&&!(o.type==="click"&&o.button>=1)){for(;H!==this;H=H.parentNode||this)if(H.nodeType===1&&(o.type!=="click"||H.disabled!==!0)){for(f=[],S={},l=0;l<L;l++)d=a[l],m=d.selector+" ",S[m]===void 0&&(S[m]=d.needsContext?p(m,this).index(H)>-1:p.find(m,this,null,[H]).length),S[m]&&f.push(d);f.length&&R.push({elem:H,handlers:f})}}return H=this,L<a.length&&R.push({elem:H,handlers:a.slice(L)}),R},addProp:function(o,a){Object.defineProperty(p.Event.prototype,o,{enumerable:!0,configurable:!0,get:p.isFunction(a)?function(){if(this.originalEvent)return a(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[o]},set:function(l){Object.defineProperty(this,o,{enumerable:!0,configurable:!0,writable:!0,value:l})}})},fix:function(o){return o[p.expando]?o:new p.Event(o)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Ic()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Ic()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(ki.test(this.type)&&this.click&&h(this,"input"))return this.click(),!1},_default:function(o){return h(o.target,"a")}},beforeunload:{postDispatch:function(o){o.result!==void 0&&o.originalEvent&&(o.originalEvent.returnValue=o.result)}}}},p.removeEvent=function(o,a,l){o.removeEventListener&&o.removeEventListener(a,l)},p.Event=function(o,a){return this instanceof p.Event?(o&&o.type?(this.originalEvent=o,this.type=o.type,this.isDefaultPrevented=o.defaultPrevented||o.defaultPrevented===void 0&&o.returnValue===!1?ks:yr,this.target=o.target&&o.target.nodeType===3?o.target.parentNode:o.target,this.currentTarget=o.currentTarget,this.relatedTarget=o.relatedTarget):this.type=o,a&&p.extend(this,a),this.timeStamp=o&&o.timeStamp||p.now(),void(this[p.expando]=!0)):new p.Event(o,a)},p.Event.prototype={constructor:p.Event,isDefaultPrevented:yr,isPropagationStopped:yr,isImmediatePropagationStopped:yr,isSimulated:!1,preventDefault:function(){var o=this.originalEvent;this.isDefaultPrevented=ks,o&&!this.isSimulated&&o.preventDefault()},stopPropagation:function(){var o=this.originalEvent;this.isPropagationStopped=ks,o&&!this.isSimulated&&o.stopPropagation()},stopImmediatePropagation:function(){var o=this.originalEvent;this.isImmediatePropagationStopped=ks,o&&!this.isSimulated&&o.stopImmediatePropagation(),this.stopPropagation()}},p.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(o){var a=o.button;return o.which==null&&kd.test(o.type)?o.charCode!=null?o.charCode:o.keyCode:!o.which&&a!==void 0&&Vd.test(o.type)?1&a?1:2&a?3:4&a?2:0:o.which}},p.event.addProp),p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(o,a){p.event.special[o]={delegateType:a,bindType:a,handle:function(l){var d,m=this,f=l.relatedTarget,S=l.handleObj;return f&&(f===m||p.contains(m,f))||(l.type=S.origType,d=S.handler.apply(this,arguments),l.type=a),d}}}),p.fn.extend({on:function(o,a,l,d){return Ba(this,o,a,l,d)},one:function(o,a,l,d){return Ba(this,o,a,l,d,1)},off:function(o,a,l){var d,m;if(o&&o.preventDefault&&o.handleObj)return d=o.handleObj,p(o.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if(typeof o=="object"){for(m in o)this.off(m,a,o[m]);return this}return a!==!1&&typeof a!="function"||(l=a,a=void 0),l===!1&&(l=yr),this.each(function(){p.event.remove(this,o,l,a)})}});var Ld=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Fd=/<script|<style|<link/i,Bd=/checked\s*(?:[^=]|=\s*.checked.)/i,Ud=/^true\/(.*)/,Hd=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ac(o,a){return h(o,"table")&&h(a.nodeType!==11?a:a.firstChild,"tr")&&p(">tbody",o)[0]||o}function $d(o){return o.type=(o.getAttribute("type")!==null)+"/"+o.type,o}function jd(o){var a=Ud.exec(o.type);return a?o.type=a[1]:o.removeAttribute("type"),o}function Dc(o,a){var l,d,m,f,S,R,L,H;if(a.nodeType===1){if(Xe.hasData(o)&&(f=Xe.access(o),S=Xe.set(a,f),H=f.events)){delete S.handle,S.events={};for(m in H)for(l=0,d=H[m].length;l<d;l++)p.event.add(a,m,H[m][l])}_i.hasData(o)&&(R=_i.access(o),L=p.extend({},R),_i.set(a,L))}}function Wd(o,a){var l=a.nodeName.toLowerCase();l==="input"&&ki.test(o.type)?a.checked=o.checked:l!=="input"&&l!=="textarea"||(a.defaultValue=o.defaultValue)}function Er(o,a,l,d){a=c.apply([],a);var m,f,S,R,L,H,ne=0,de=o.length,j=de-1,re=a[0],Ke=p.isFunction(re);if(Ke||de>1&&typeof re=="string"&&!pe.checkClone&&Bd.test(re))return o.each(function(tt){var ke=o.eq(tt);Ke&&(a[0]=re.call(this,tt,ke.html())),Er(ke,a,l,d)});if(de&&(m=ps(a,o[0].ownerDocument,!1,o,d),f=m.firstChild,m.childNodes.length===1&&(m=f),f||d)){for(S=p.map(Vi(m,"script"),$d),R=S.length;ne<de;ne++)L=m,ne!==j&&(L=p.clone(L,!0,!0),R&&p.merge(S,Vi(L,"script"))),l.call(o[ne],L,ne);if(R)for(H=S[S.length-1].ownerDocument,p.map(S,jd),ne=0;ne<R;ne++)L=S[ne],Si.test(L.type||"")&&!Xe.access(L,"globalEval")&&p.contains(H,L)&&(L.src?p._evalUrl&&p._evalUrl(L.src):he(L.textContent.replace(Hd,""),H))}return o}function Nc(o,a,l){for(var d,m=a?p.filter(a,o):o,f=0;(d=m[f])!=null;f++)l||d.nodeType!==1||p.cleanData(Vi(d)),d.parentNode&&(l&&p.contains(d.ownerDocument,d)&&Rn(Vi(d,"script")),d.parentNode.removeChild(d));return o}p.extend({htmlPrefilter:function(o){return o.replace(Ld,"<$1></$2>")},clone:function(o,a,l){var d,m,f,S,R=o.cloneNode(!0),L=p.contains(o.ownerDocument,o);if(!(pe.noCloneChecked||o.nodeType!==1&&o.nodeType!==11||p.isXMLDoc(o)))for(S=Vi(R),f=Vi(o),d=0,m=f.length;d<m;d++)Wd(f[d],S[d]);if(a)if(l)for(f=f||Vi(o),S=S||Vi(R),d=0,m=f.length;d<m;d++)Dc(f[d],S[d]);else Dc(o,R);return S=Vi(R,"script"),S.length>0&&Rn(S,!L&&Vi(o,"script")),R},cleanData:function(o){for(var a,l,d,m=p.event.special,f=0;(l=o[f])!==void 0;f++)if(No(l)){if(a=l[Xe.expando]){if(a.events)for(d in a.events)m[d]?p.event.remove(l,d):p.removeEvent(l,d,a.handle);l[Xe.expando]=void 0}l[_i.expando]&&(l[_i.expando]=void 0)}}}),p.fn.extend({detach:function(o){return Nc(this,o,!0)},remove:function(o){return Nc(this,o)},text:function(o){return Gi(this,function(a){return a===void 0?p.text(this):this.empty().each(function(){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||(this.textContent=a)})},null,o,arguments.length)},append:function(){return Er(this,arguments,function(o){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var a=Ac(this,o);a.appendChild(o)}})},prepend:function(){return Er(this,arguments,function(o){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var a=Ac(this,o);a.insertBefore(o,a.firstChild)}})},before:function(){return Er(this,arguments,function(o){this.parentNode&&this.parentNode.insertBefore(o,this)})},after:function(){return Er(this,arguments,function(o){this.parentNode&&this.parentNode.insertBefore(o,this.nextSibling)})},empty:function(){for(var o,a=0;(o=this[a])!=null;a++)o.nodeType===1&&(p.cleanData(Vi(o,!1)),o.textContent="");return this},clone:function(o,a){return o=o!=null&&o,a=a??o,this.map(function(){return p.clone(this,o,a)})},html:function(o){return Gi(this,function(a){var l=this[0]||{},d=0,m=this.length;if(a===void 0&&l.nodeType===1)return l.innerHTML;if(typeof a=="string"&&!Fd.test(a)&&!Yi[(Dt.exec(a)||["",""])[1].toLowerCase()]){a=p.htmlPrefilter(a);try{for(;d<m;d++)l=this[d]||{},l.nodeType===1&&(p.cleanData(Vi(l,!1)),l.innerHTML=a);l=0}catch{}}l&&this.empty().append(a)},null,o,arguments.length)},replaceWith:function(){var o=[];return Er(this,arguments,function(a){var l=this.parentNode;p.inArray(this,o)<0&&(p.cleanData(Vi(this)),l&&l.replaceChild(a,this))},o)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(o,a){p.fn[o]=function(l){for(var d,m=[],f=p(l),S=f.length-1,R=0;R<=S;R++)d=R===S?this:this.clone(!0),p(f[R])[a](d),g.apply(m,d.get());return this.pushStack(m)}});var kc=/^margin/,Ua=new RegExp("^("+Or+")(?!px)[a-z%]+$","i"),Vs=function(o){var a=o.ownerDocument.defaultView;return a&&a.opener||(a=s),a.getComputedStyle(o)};(function(){function o(){if(S){S.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",S.innerHTML="",vo.appendChild(f);var R=s.getComputedStyle(S);a=R.top!=="1%",m=R.marginLeft==="2px",l=R.width==="4px",S.style.marginRight="50%",d=R.marginRight==="4px",vo.removeChild(f),S=null}}var a,l,d,m,f=e.createElement("div"),S=e.createElement("div");S.style&&(S.style.backgroundClip="content-box",S.cloneNode(!0).style.backgroundClip="",pe.clearCloneStyle=S.style.backgroundClip==="content-box",f.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",f.appendChild(S),p.extend(pe,{pixelPosition:function(){return o(),a},boxSizingReliable:function(){return o(),l},pixelMarginRight:function(){return o(),d},reliableMarginLeft:function(){return o(),m}}))})();function ds(o,a,l){var d,m,f,S,R=o.style;return l=l||Vs(o),l&&(S=l.getPropertyValue(a)||l[a],S!==""||p.contains(o.ownerDocument,o)||(S=p.style(o,a)),!pe.pixelMarginRight()&&Ua.test(S)&&kc.test(a)&&(d=R.width,m=R.minWidth,f=R.maxWidth,R.minWidth=R.maxWidth=R.width=S,S=l.width,R.width=d,R.minWidth=m,R.maxWidth=f)),S!==void 0?S+"":S}function Vc(o,a){return{get:function(){return o()?void delete this.get:(this.get=a).apply(this,arguments)}}}var zd=/^(none|table(?!-c[ea]).+)/,Lc=/^--/,Gd={position:"absolute",visibility:"hidden",display:"block"},Fc={letterSpacing:"0",fontWeight:"400"},Bc=["Webkit","Moz","ms"],Uc=e.createElement("div").style;function Yd(o){if(o in Uc)return o;for(var a=o[0].toUpperCase()+o.slice(1),l=Bc.length;l--;)if(o=Bc[l]+a,o in Uc)return o}function Hc(o){var a=p.cssProps[o];return a||(a=p.cssProps[o]=Yd(o)||o),a}function $c(o,a,l){var d=Yt.exec(a);return d?Math.max(0,d[2]-(l||0))+(d[3]||"px"):a}function jc(o,a,l,d,m){var f,S=0;for(f=l===(d?"border":"content")?4:a==="width"?1:0;f<4;f+=2)l==="margin"&&(S+=p.css(o,l+uo[f],!0,m)),d?(l==="content"&&(S-=p.css(o,"padding"+uo[f],!0,m)),l!=="margin"&&(S-=p.css(o,"border"+uo[f]+"Width",!0,m))):(S+=p.css(o,"padding"+uo[f],!0,m),l!=="padding"&&(S+=p.css(o,"border"+uo[f]+"Width",!0,m)));return S}function Wc(o,a,l){var d,m=Vs(o),f=ds(o,a,m),S=p.css(o,"boxSizing",!1,m)==="border-box";return Ua.test(f)?f:(d=S&&(pe.boxSizingReliable()||f===o.style[a]),f=parseFloat(f)||0,f+jc(o,a,l||(S?"border":"content"),d,m)+"px")}p.extend({cssHooks:{opacity:{get:function(o,a){if(a){var l=ds(o,"opacity");return l===""?"1":l}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(o,a,l,d){if(o&&o.nodeType!==3&&o.nodeType!==8&&o.style){var m,f,S,R=p.camelCase(a),L=Lc.test(a),H=o.style;return L||(a=Hc(R)),S=p.cssHooks[a]||p.cssHooks[R],l===void 0?S&&"get"in S&&(m=S.get(o,!1,d))!==void 0?m:H[a]:(f=typeof l,f==="string"&&(m=Yt.exec(l))&&m[1]&&(l=fo(o,a,m),f="number"),l!=null&&l===l&&(f==="number"&&(l+=m&&m[3]||(p.cssNumber[R]?"":"px")),pe.clearCloneStyle||l!==""||a.indexOf("background")!==0||(H[a]="inherit"),S&&"set"in S&&(l=S.set(o,l,d))===void 0||(L?H.setProperty(a,l):H[a]=l)),void 0)}},css:function(o,a,l,d){var m,f,S,R=p.camelCase(a),L=Lc.test(a);return L||(a=Hc(R)),S=p.cssHooks[a]||p.cssHooks[R],S&&"get"in S&&(m=S.get(o,!0,l)),m===void 0&&(m=ds(o,a,d)),m==="normal"&&a in Fc&&(m=Fc[a]),l===""||l?(f=parseFloat(m),l===!0||isFinite(f)?f||0:m):m}}),p.each(["height","width"],function(o,a){p.cssHooks[a]={get:function(l,d,m){if(d)return!zd.test(p.css(l,"display"))||l.getClientRects().length&&l.getBoundingClientRect().width?Wc(l,a,m):wr(l,Gd,function(){return Wc(l,a,m)})},set:function(l,d,m){var f,S=m&&Vs(l),R=m&&jc(l,a,m,p.css(l,"boxSizing",!1,S)==="border-box",S);return R&&(f=Yt.exec(d))&&(f[3]||"px")!=="px"&&(l.style[a]=d,d=p.css(l,a)),$c(l,d,R)}}}),p.cssHooks.marginLeft=Vc(pe.reliableMarginLeft,function(o,a){if(a)return(parseFloat(ds(o,"marginLeft"))||o.getBoundingClientRect().left-wr(o,{marginLeft:0},function(){return o.getBoundingClientRect().left}))+"px"}),p.each({margin:"",padding:"",border:"Width"},function(o,a){p.cssHooks[o+a]={expand:function(l){for(var d=0,m={},f=typeof l=="string"?l.split(" "):[l];d<4;d++)m[o+uo[d]+a]=f[d]||f[d-2]||f[0];return m}},kc.test(o)||(p.cssHooks[o+a].set=$c)}),p.fn.extend({css:function(o,a){return Gi(this,function(l,d,m){var f,S,R={},L=0;if(Array.isArray(d)){for(f=Vs(l),S=d.length;L<S;L++)R[d[L]]=p.css(l,d[L],!1,f);return R}return m!==void 0?p.style(l,d,m):p.css(l,d)},o,a,arguments.length>1)}});function Qi(o,a,l,d,m){return new Qi.prototype.init(o,a,l,d,m)}p.Tween=Qi,Qi.prototype={constructor:Qi,init:function(o,a,l,d,m,f){this.elem=o,this.prop=l,this.easing=m||p.easing._default,this.options=a,this.start=this.now=this.cur(),this.end=d,this.unit=f||(p.cssNumber[l]?"":"px")},cur:function(){var o=Qi.propHooks[this.prop];return o&&o.get?o.get(this):Qi.propHooks._default.get(this)},run:function(o){var a,l=Qi.propHooks[this.prop];return this.options.duration?this.pos=a=p.easing[this.easing](o,this.options.duration*o,0,1,this.options.duration):this.pos=a=o,this.now=(this.end-this.start)*a+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),l&&l.set?l.set(this):Qi.propHooks._default.set(this),this}},Qi.prototype.init.prototype=Qi.prototype,Qi.propHooks={_default:{get:function(o){var a;return o.elem.nodeType!==1||o.elem[o.prop]!=null&&o.elem.style[o.prop]==null?o.elem[o.prop]:(a=p.css(o.elem,o.prop,""),a&&a!=="auto"?a:0)},set:function(o){p.fx.step[o.prop]?p.fx.step[o.prop](o):o.elem.nodeType!==1||o.elem.style[p.cssProps[o.prop]]==null&&!p.cssHooks[o.prop]?o.elem[o.prop]=o.now:p.style(o.elem,o.prop,o.now+o.unit)}}},Qi.propHooks.scrollTop=Qi.propHooks.scrollLeft={set:function(o){o.elem.nodeType&&o.elem.parentNode&&(o.elem[o.prop]=o.now)}},p.easing={linear:function(o){return o},swing:function(o){return .5-Math.cos(o*Math.PI)/2},_default:"swing"},p.fx=Qi.prototype.init,p.fx.step={};var Pr,Ls,Xd=/^(?:toggle|show|hide)$/,Kd=/queueHooks$/;function Ha(){Ls&&(e.hidden===!1&&s.requestAnimationFrame?s.requestAnimationFrame(Ha):s.setTimeout(Ha,p.fx.interval),p.fx.tick())}function zc(){return s.setTimeout(function(){Pr=void 0}),Pr=p.now()}function Fs(o,a){var l,d=0,m={height:o};for(a=a?1:0;d<4;d+=2-a)l=uo[d],m["margin"+l]=m["padding"+l]=o;return a&&(m.opacity=m.width=o),m}function Gc(o,a,l){for(var d,m=(In.tweeners[a]||[]).concat(In.tweeners["*"]),f=0,S=m.length;f<S;f++)if(d=m[f].call(l,a,o))return d}function qd(o,a,l){var d,m,f,S,R,L,H,ne,de="width"in a||"height"in a,j=this,re={},Ke=o.style,tt=o.nodeType&&go(o),ke=Xe.get(o,"fxshow");l.queue||(S=p._queueHooks(o,"fx"),S.unqueued==null&&(S.unqueued=0,R=S.empty.fire,S.empty.fire=function(){S.unqueued||R()}),S.unqueued++,j.always(function(){j.always(function(){S.unqueued--,p.queue(o,"fx").length||S.empty.fire()})}));for(d in a)if(m=a[d],Xd.test(m)){if(delete a[d],f=f||m==="toggle",m===(tt?"hide":"show")){if(m!=="show"||!ke||ke[d]===void 0)continue;tt=!0}re[d]=ke&&ke[d]||p.style(o,d)}if(L=!p.isEmptyObject(a),L||!p.isEmptyObject(re)){de&&o.nodeType===1&&(l.overflow=[Ke.overflow,Ke.overflowX,Ke.overflowY],H=ke&&ke.display,H==null&&(H=Xe.get(o,"display")),ne=p.css(o,"display"),ne==="none"&&(H?ne=H:(nt([o],!0),H=o.style.display||H,ne=p.css(o,"display"),nt([o]))),(ne==="inline"||ne==="inline-block"&&H!=null)&&p.css(o,"float")==="none"&&(L||(j.done(function(){Ke.display=H}),H==null&&(ne=Ke.display,H=ne==="none"?"":ne)),Ke.display="inline-block")),l.overflow&&(Ke.overflow="hidden",j.always(function(){Ke.overflow=l.overflow[0],Ke.overflowX=l.overflow[1],Ke.overflowY=l.overflow[2]})),L=!1;for(d in re)L||(ke?"hidden"in ke&&(tt=ke.hidden):ke=Xe.access(o,"fxshow",{display:H}),f&&(ke.hidden=!tt),tt&&nt([o],!0),j.done(function(){tt||nt([o]),Xe.remove(o,"fxshow");for(d in re)p.style(o,d,re[d])})),L=Gc(tt?ke[d]:0,d,j),d in ke||(ke[d]=L.start,tt&&(L.end=L.start,L.start=0))}}function Qd(o,a){var l,d,m,f,S;for(l in o)if(d=p.camelCase(l),m=a[d],f=o[l],Array.isArray(f)&&(m=f[1],f=o[l]=f[0]),l!==d&&(o[d]=f,delete o[l]),S=p.cssHooks[d],S&&"expand"in S){f=S.expand(f),delete o[d];for(l in f)l in o||(o[l]=f[l],a[l]=m)}else a[d]=m}function In(o,a,l){var d,m,f=0,S=In.prefilters.length,R=p.Deferred().always(function(){delete L.elem}),L=function(){if(m)return!1;for(var de=Pr||zc(),j=Math.max(0,H.startTime+H.duration-de),re=j/H.duration||0,Ke=1-re,tt=0,ke=H.tweens.length;tt<ke;tt++)H.tweens[tt].run(Ke);return R.notifyWith(o,[H,Ke,j]),Ke<1&&ke?j:(ke||R.notifyWith(o,[H,1,0]),R.resolveWith(o,[H]),!1)},H=R.promise({elem:o,props:p.extend({},a),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},l),originalProperties:a,originalOptions:l,startTime:Pr||zc(),duration:l.duration,tweens:[],createTween:function(de,j){var re=p.Tween(o,H.opts,de,j,H.opts.specialEasing[de]||H.opts.easing);return H.tweens.push(re),re},stop:function(de){var j=0,re=de?H.tweens.length:0;if(m)return this;for(m=!0;j<re;j++)H.tweens[j].run(1);return de?(R.notifyWith(o,[H,1,0]),R.resolveWith(o,[H,de])):R.rejectWith(o,[H,de]),this}}),ne=H.props;for(Qd(ne,H.opts.specialEasing);f<S;f++)if(d=In.prefilters[f].call(H,o,ne,H.opts))return p.isFunction(d.stop)&&(p._queueHooks(H.elem,H.opts.queue).stop=p.proxy(d.stop,d)),d;return p.map(ne,Gc,H),p.isFunction(H.opts.start)&&H.opts.start.call(o,H),H.progress(H.opts.progress).done(H.opts.done,H.opts.complete).fail(H.opts.fail).always(H.opts.always),p.fx.timer(p.extend(L,{elem:o,anim:H,queue:H.opts.queue})),H}p.Animation=p.extend(In,{tweeners:{"*":[function(o,a){var l=this.createTween(o,a);return fo(l.elem,o,Yt.exec(a),l),l}]},tweener:function(o,a){p.isFunction(o)?(a=o,o=["*"]):o=o.match(mt);for(var l,d=0,m=o.length;d<m;d++)l=o[d],In.tweeners[l]=In.tweeners[l]||[],In.tweeners[l].unshift(a)},prefilters:[qd],prefilter:function(o,a){a?In.prefilters.unshift(o):In.prefilters.push(o)}}),p.speed=function(o,a,l){var d=o&&typeof o=="object"?p.extend({},o):{complete:l||!l&&a||p.isFunction(o)&&o,duration:o,easing:l&&a||a&&!p.isFunction(a)&&a};return p.fx.off?d.duration=0:typeof d.duration!="number"&&(d.duration in p.fx.speeds?d.duration=p.fx.speeds[d.duration]:d.duration=p.fx.speeds._default),d.queue!=null&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){p.isFunction(d.old)&&d.old.call(this),d.queue&&p.dequeue(this,d.queue)},d},p.fn.extend({fadeTo:function(o,a,l,d){return this.filter(go).css("opacity",0).show().end().animate({opacity:a},o,l,d)},animate:function(o,a,l,d){var m=p.isEmptyObject(o),f=p.speed(a,l,d),S=function(){var R=In(this,p.extend({},o),f);(m||Xe.get(this,"finish"))&&R.stop(!0)};return S.finish=S,m||f.queue===!1?this.each(S):this.queue(f.queue,S)},stop:function(o,a,l){var d=function(m){var f=m.stop;delete m.stop,f(l)};return typeof o!="string"&&(l=a,a=o,o=void 0),a&&o!==!1&&this.queue(o||"fx",[]),this.each(function(){var m=!0,f=o!=null&&o+"queueHooks",S=p.timers,R=Xe.get(this);if(f)R[f]&&R[f].stop&&d(R[f]);else for(f in R)R[f]&&R[f].stop&&Kd.test(f)&&d(R[f]);for(f=S.length;f--;)S[f].elem!==this||o!=null&&S[f].queue!==o||(S[f].anim.stop(l),m=!1,S.splice(f,1));!m&&l||p.dequeue(this,o)})},finish:function(o){return o!==!1&&(o=o||"fx"),this.each(function(){var a,l=Xe.get(this),d=l[o+"queue"],m=l[o+"queueHooks"],f=p.timers,S=d?d.length:0;for(l.finish=!0,p.queue(this,o,[]),m&&m.stop&&m.stop.call(this,!0),a=f.length;a--;)f[a].elem===this&&f[a].queue===o&&(f[a].anim.stop(!0),f.splice(a,1));for(a=0;a<S;a++)d[a]&&d[a].finish&&d[a].finish.call(this);delete l.finish})}}),p.each(["toggle","show","hide"],function(o,a){var l=p.fn[a];p.fn[a]=function(d,m,f){return d==null||typeof d=="boolean"?l.apply(this,arguments):this.animate(Fs(a,!0),d,m,f)}}),p.each({slideDown:Fs("show"),slideUp:Fs("hide"),slideToggle:Fs("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(o,a){p.fn[o]=function(l,d,m){return this.animate(a,l,d,m)}}),p.timers=[],p.fx.tick=function(){var o,a=0,l=p.timers;for(Pr=p.now();a<l.length;a++)o=l[a],o()||l[a]!==o||l.splice(a--,1);l.length||p.fx.stop(),Pr=void 0},p.fx.timer=function(o){p.timers.push(o),p.fx.start()},p.fx.interval=13,p.fx.start=function(){Ls||(Ls=!0,Ha())},p.fx.stop=function(){Ls=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(o,a){return o=p.fx&&p.fx.speeds[o]||o,a=a||"fx",this.queue(a,function(l,d){var m=s.setTimeout(l,o);d.stop=function(){s.clearTimeout(m)}})},function(){var o=e.createElement("input"),a=e.createElement("select"),l=a.appendChild(e.createElement("option"));o.type="checkbox",pe.checkOn=o.value!=="",pe.optSelected=l.selected,o=e.createElement("input"),o.value="t",o.type="radio",pe.radioValue=o.value==="t"}();var Yc,hs=p.expr.attrHandle;p.fn.extend({attr:function(o,a){return Gi(this,p.attr,o,a,arguments.length>1)},removeAttr:function(o){return this.each(function(){p.removeAttr(this,o)})}}),p.extend({attr:function(o,a,l){var d,m,f=o.nodeType;if(f!==3&&f!==8&&f!==2)return typeof o.getAttribute>"u"?p.prop(o,a,l):(f===1&&p.isXMLDoc(o)||(m=p.attrHooks[a.toLowerCase()]||(p.expr.match.bool.test(a)?Yc:void 0)),l!==void 0?l===null?void p.removeAttr(o,a):m&&"set"in m&&(d=m.set(o,l,a))!==void 0?d:(o.setAttribute(a,l+""),l):m&&"get"in m&&(d=m.get(o,a))!==null?d:(d=p.find.attr(o,a),d??void 0))},attrHooks:{type:{set:function(o,a){if(!pe.radioValue&&a==="radio"&&h(o,"input")){var l=o.value;return o.setAttribute("type",a),l&&(o.value=l),a}}}},removeAttr:function(o,a){var l,d=0,m=a&&a.match(mt);if(m&&o.nodeType===1)for(;l=m[d++];)o.removeAttribute(l)}}),Yc={set:function(o,a,l){return a===!1?p.removeAttr(o,l):o.setAttribute(l,l),l}},p.each(p.expr.match.bool.source.match(/\w+/g),function(o,a){var l=hs[a]||p.find.attr;hs[a]=function(d,m,f){var S,R,L=m.toLowerCase();return f||(R=hs[L],hs[L]=S,S=l(d,m,f)!=null?L:null,hs[L]=R),S}});var Zd=/^(?:input|select|textarea|button)$/i,Jd=/^(?:a|area)$/i;p.fn.extend({prop:function(o,a){return Gi(this,p.prop,o,a,arguments.length>1)},removeProp:function(o){return this.each(function(){delete this[p.propFix[o]||o]})}}),p.extend({prop:function(o,a,l){var d,m,f=o.nodeType;if(f!==3&&f!==8&&f!==2)return f===1&&p.isXMLDoc(o)||(a=p.propFix[a]||a,m=p.propHooks[a]),l!==void 0?m&&"set"in m&&(d=m.set(o,l,a))!==void 0?d:o[a]=l:m&&"get"in m&&(d=m.get(o,a))!==null?d:o[a]},propHooks:{tabIndex:{get:function(o){var a=p.find.attr(o,"tabindex");return a?parseInt(a,10):Zd.test(o.nodeName)||Jd.test(o.nodeName)&&o.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),pe.optSelected||(p.propHooks.selected={get:function(o){var a=o.parentNode;return a&&a.parentNode&&a.parentNode.selectedIndex,null},set:function(o){var a=o.parentNode;a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this});function or(o){var a=o.match(mt)||[];return a.join(" ")}function rr(o){return o.getAttribute&&o.getAttribute("class")||""}p.fn.extend({addClass:function(o){var a,l,d,m,f,S,R,L=0;if(p.isFunction(o))return this.each(function(H){p(this).addClass(o.call(this,H,rr(this)))});if(typeof o=="string"&&o){for(a=o.match(mt)||[];l=this[L++];)if(m=rr(l),d=l.nodeType===1&&" "+or(m)+" "){for(S=0;f=a[S++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");R=or(d),m!==R&&l.setAttribute("class",R)}}return this},removeClass:function(o){var a,l,d,m,f,S,R,L=0;if(p.isFunction(o))return this.each(function(H){p(this).removeClass(o.call(this,H,rr(this)))});if(!arguments.length)return this.attr("class","");if(typeof o=="string"&&o){for(a=o.match(mt)||[];l=this[L++];)if(m=rr(l),d=l.nodeType===1&&" "+or(m)+" "){for(S=0;f=a[S++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");R=or(d),m!==R&&l.setAttribute("class",R)}}return this},toggleClass:function(o,a){var l=typeof o;return typeof a=="boolean"&&l==="string"?a?this.addClass(o):this.removeClass(o):p.isFunction(o)?this.each(function(d){p(this).toggleClass(o.call(this,d,rr(this),a),a)}):this.each(function(){var d,m,f,S;if(l==="string")for(m=0,f=p(this),S=o.match(mt)||[];d=S[m++];)f.hasClass(d)?f.removeClass(d):f.addClass(d);else o!==void 0&&l!=="boolean"||(d=rr(this),d&&Xe.set(this,"__className__",d),this.setAttribute&&this.setAttribute("class",d||o===!1?"":Xe.get(this,"__className__")||""))})},hasClass:function(o){var a,l,d=0;for(a=" "+o+" ";l=this[d++];)if(l.nodeType===1&&(" "+or(rr(l))+" ").indexOf(a)>-1)return!0;return!1}});var eh=/\r/g;p.fn.extend({val:function(o){var a,l,d,m=this[0];{if(arguments.length)return d=p.isFunction(o),this.each(function(f){var S;this.nodeType===1&&(S=d?o.call(this,f,p(this).val()):o,S==null?S="":typeof S=="number"?S+="":Array.isArray(S)&&(S=p.map(S,function(R){return R==null?"":R+""})),a=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],a&&"set"in a&&a.set(this,S,"value")!==void 0||(this.value=S))});if(m)return a=p.valHooks[m.type]||p.valHooks[m.nodeName.toLowerCase()],a&&"get"in a&&(l=a.get(m,"value"))!==void 0?l:(l=m.value,typeof l=="string"?l.replace(eh,""):l??"")}}}),p.extend({valHooks:{option:{get:function(o){var a=p.find.attr(o,"value");return a??or(p.text(o))}},select:{get:function(o){var a,l,d,m=o.options,f=o.selectedIndex,S=o.type==="select-one",R=S?null:[],L=S?f+1:m.length;for(d=f<0?L:S?f:0;d<L;d++)if(l=m[d],(l.selected||d===f)&&!l.disabled&&(!l.parentNode.disabled||!h(l.parentNode,"optgroup"))){if(a=p(l).val(),S)return a;R.push(a)}return R},set:function(o,a){for(var l,d,m=o.options,f=p.makeArray(a),S=m.length;S--;)d=m[S],(d.selected=p.inArray(p.valHooks.option.get(d),f)>-1)&&(l=!0);return l||(o.selectedIndex=-1),f}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(o,a){if(Array.isArray(a))return o.checked=p.inArray(p(o).val(),a)>-1}},pe.checkOn||(p.valHooks[this].get=function(o){return o.getAttribute("value")===null?"on":o.value})});var Xc=/^(?:focusinfocus|focusoutblur)$/;p.extend(p.event,{trigger:function(o,a,l,d){var m,f,S,R,L,H,ne,de=[l||e],j=V.call(o,"type")?o.type:o,re=V.call(o,"namespace")?o.namespace.split("."):[];if(f=S=l=l||e,l.nodeType!==3&&l.nodeType!==8&&!Xc.test(j+p.event.triggered)&&(j.indexOf(".")>-1&&(re=j.split("."),j=re.shift(),re.sort()),L=j.indexOf(":")<0&&"on"+j,o=o[p.expando]?o:new p.Event(j,typeof o=="object"&&o),o.isTrigger=d?2:3,o.namespace=re.join("."),o.rnamespace=o.namespace?new RegExp("(^|\\.)"+re.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,o.result=void 0,o.target||(o.target=l),a=a==null?[o]:p.makeArray(a,[o]),ne=p.event.special[j]||{},d||!ne.trigger||ne.trigger.apply(l,a)!==!1)){if(!d&&!ne.noBubble&&!p.isWindow(l)){for(R=ne.delegateType||j,Xc.test(R+j)||(f=f.parentNode);f;f=f.parentNode)de.push(f),S=f;S===(l.ownerDocument||e)&&de.push(S.defaultView||S.parentWindow||s)}for(m=0;(f=de[m++])&&!o.isPropagationStopped();)o.type=m>1?R:ne.bindType||j,H=(Xe.get(f,"events")||{})[o.type]&&Xe.get(f,"handle"),H&&H.apply(f,a),H=L&&f[L],H&&H.apply&&No(f)&&(o.result=H.apply(f,a),o.result===!1&&o.preventDefault());return o.type=j,d||o.isDefaultPrevented()||ne._default&&ne._default.apply(de.pop(),a)!==!1||!No(l)||L&&p.isFunction(l[j])&&!p.isWindow(l)&&(S=l[L],S&&(l[L]=null),p.event.triggered=j,l[j](),p.event.triggered=void 0,S&&(l[L]=S)),o.result}},simulate:function(o,a,l){var d=p.extend(new p.Event,l,{type:o,isSimulated:!0});p.event.trigger(d,null,a)}}),p.fn.extend({trigger:function(o,a){return this.each(function(){p.event.trigger(o,a,this)})},triggerHandler:function(o,a){var l=this[0];if(l)return p.event.trigger(o,a,l,!0)}}),p.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(o,a){p.fn[a]=function(l,d){return arguments.length>0?this.on(a,null,l,d):this.trigger(a)}}),p.fn.extend({hover:function(o,a){return this.mouseenter(o).mouseleave(a||o)}}),pe.focusin="onfocusin"in s,pe.focusin||p.each({focus:"focusin",blur:"focusout"},function(o,a){var l=function(d){p.event.simulate(a,d.target,p.event.fix(d))};p.event.special[a]={setup:function(){var d=this.ownerDocument||this,m=Xe.access(d,a);m||d.addEventListener(o,l,!0),Xe.access(d,a,(m||0)+1)},teardown:function(){var d=this.ownerDocument||this,m=Xe.access(d,a)-1;m?Xe.access(d,a,m):(d.removeEventListener(o,l,!0),Xe.remove(d,a))}}});var us=s.location,Kc=p.now(),$a=/\?/;p.parseXML=function(o){var a;if(!o||typeof o!="string")return null;try{a=new s.DOMParser().parseFromString(o,"text/xml")}catch{a=void 0}return a&&!a.getElementsByTagName("parsererror").length||p.error("Invalid XML: "+o),a};var th=/\[\]$/,qc=/\r?\n/g,ih=/^(?:submit|button|image|reset|file)$/i,nh=/^(?:input|select|textarea|keygen)/i;function ja(o,a,l,d){var m;if(Array.isArray(a))p.each(a,function(f,S){l||th.test(o)?d(o,S):ja(o+"["+(typeof S=="object"&&S!=null?f:"")+"]",S,l,d)});else if(l||p.type(a)!=="object")d(o,a);else for(m in a)ja(o+"["+m+"]",a[m],l,d)}p.param=function(o,a){var l,d=[],m=function(f,S){var R=p.isFunction(S)?S():S;d[d.length]=encodeURIComponent(f)+"="+encodeURIComponent(R??"")};if(Array.isArray(o)||o.jquery&&!p.isPlainObject(o))p.each(o,function(){m(this.name,this.value)});else for(l in o)ja(l,o[l],a,m);return d.join("&")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var o=p.prop(this,"elements");return o?p.makeArray(o):this}).filter(function(){var o=this.type;return this.name&&!p(this).is(":disabled")&&nh.test(this.nodeName)&&!ih.test(o)&&(this.checked||!ki.test(o))}).map(function(o,a){var l=p(this).val();return l==null?null:Array.isArray(l)?p.map(l,function(d){return{name:a.name,value:d.replace(qc,`\r
`)}}):{name:a.name,value:l.replace(qc,`\r
`)}}).get()}});var oh=/%20/g,rh=/#.*$/,sh=/([?&])_=[^&]*/,ah=/^(.*?):[ \t]*([^\r\n]*)$/gm,ch=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,lh=/^(?:GET|HEAD)$/,ph=/^\/\//,Qc={},Wa={},Zc="*/".concat("*"),za=e.createElement("a");za.href=us.href;function Jc(o){return function(a,l){typeof a!="string"&&(l=a,a="*");var d,m=0,f=a.toLowerCase().match(mt)||[];if(p.isFunction(l))for(;d=f[m++];)d[0]==="+"?(d=d.slice(1)||"*",(o[d]=o[d]||[]).unshift(l)):(o[d]=o[d]||[]).push(l)}}function el(o,a,l,d){var m={},f=o===Wa;function S(R){var L;return m[R]=!0,p.each(o[R]||[],function(H,ne){var de=ne(a,l,d);return typeof de!="string"||f||m[de]?f?!(L=de):void 0:(a.dataTypes.unshift(de),S(de),!1)}),L}return S(a.dataTypes[0])||!m["*"]&&S("*")}function Ga(o,a){var l,d,m=p.ajaxSettings.flatOptions||{};for(l in a)a[l]!==void 0&&((m[l]?o:d||(d={}))[l]=a[l]);return d&&p.extend(!0,o,d),o}function dh(o,a,l){for(var d,m,f,S,R=o.contents,L=o.dataTypes;L[0]==="*";)L.shift(),d===void 0&&(d=o.mimeType||a.getResponseHeader("Content-Type"));if(d){for(m in R)if(R[m]&&R[m].test(d)){L.unshift(m);break}}if(L[0]in l)f=L[0];else{for(m in l){if(!L[0]||o.converters[m+" "+L[0]]){f=m;break}S||(S=m)}f=f||S}if(f)return f!==L[0]&&L.unshift(f),l[f]}function hh(o,a,l,d){var m,f,S,R,L,H={},ne=o.dataTypes.slice();if(ne[1])for(S in o.converters)H[S.toLowerCase()]=o.converters[S];for(f=ne.shift();f;)if(o.responseFields[f]&&(l[o.responseFields[f]]=a),!L&&d&&o.dataFilter&&(a=o.dataFilter(a,o.dataType)),L=f,f=ne.shift()){if(f==="*")f=L;else if(L!=="*"&&L!==f){if(S=H[L+" "+f]||H["* "+f],!S){for(m in H)if(R=m.split(" "),R[1]===f&&(S=H[L+" "+R[0]]||H["* "+R[0]])){S===!0?S=H[m]:H[m]!==!0&&(f=R[0],ne.unshift(R[1]));break}}if(S!==!0)if(S&&o.throws)a=S(a);else try{a=S(a)}catch(de){return{state:"parsererror",error:S?de:"No conversion from "+L+" to "+f}}}}return{state:"success",data:a}}p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:us.href,type:"GET",isLocal:ch.test(us.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Zc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(o,a){return a?Ga(Ga(o,p.ajaxSettings),a):Ga(p.ajaxSettings,o)},ajaxPrefilter:Jc(Qc),ajaxTransport:Jc(Wa),ajax:function(o,a){typeof o=="object"&&(a=o,o=void 0),a=a||{};var l,d,m,f,S,R,L,H,ne,de,j=p.ajaxSetup({},a),re=j.context||j,Ke=j.context&&(re.nodeType||re.jquery)?p(re):p.event,tt=p.Deferred(),ke=p.Callbacks("once memory"),bi=j.statusCode||{},pi={},hn={},Nt="canceled",et={readyState:0,getResponseHeader:function(Ct){var ti;if(L){if(!f)for(f={};ti=ah.exec(m);)f[ti[1].toLowerCase()]=ti[2];ti=f[Ct.toLowerCase()]}return ti??null},getAllResponseHeaders:function(){return L?m:null},setRequestHeader:function(Ct,ti){return L==null&&(Ct=hn[Ct.toLowerCase()]=hn[Ct.toLowerCase()]||Ct,pi[Ct]=ti),this},overrideMimeType:function(Ct){return L==null&&(j.mimeType=Ct),this},statusCode:function(Ct){var ti;if(Ct)if(L)et.always(Ct[et.status]);else for(ti in Ct)bi[ti]=[bi[ti],Ct[ti]];return this},abort:function(Ct){var ti=Ct||Nt;return l&&l.abort(ti),Zi(0,ti),this}};if(tt.promise(et),j.url=((o||j.url||us.href)+"").replace(ph,us.protocol+"//"),j.type=a.method||a.type||j.method||j.type,j.dataTypes=(j.dataType||"*").toLowerCase().match(mt)||[""],j.crossDomain==null){R=e.createElement("a");try{R.href=j.url,R.href=R.href,j.crossDomain=za.protocol+"//"+za.host!=R.protocol+"//"+R.host}catch{j.crossDomain=!0}}if(j.data&&j.processData&&typeof j.data!="string"&&(j.data=p.param(j.data,j.traditional)),el(Qc,j,a,et),L)return et;H=p.event&&j.global,H&&p.active++===0&&p.event.trigger("ajaxStart"),j.type=j.type.toUpperCase(),j.hasContent=!lh.test(j.type),d=j.url.replace(rh,""),j.hasContent?j.data&&j.processData&&(j.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(j.data=j.data.replace(oh,"+")):(de=j.url.slice(d.length),j.data&&(d+=($a.test(d)?"&":"?")+j.data,delete j.data),j.cache===!1&&(d=d.replace(sh,"$1"),de=($a.test(d)?"&":"?")+"_="+Kc+++de),j.url=d+de),j.ifModified&&(p.lastModified[d]&&et.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&et.setRequestHeader("If-None-Match",p.etag[d])),(j.data&&j.hasContent&&j.contentType!==!1||a.contentType)&&et.setRequestHeader("Content-Type",j.contentType),et.setRequestHeader("Accept",j.dataTypes[0]&&j.accepts[j.dataTypes[0]]?j.accepts[j.dataTypes[0]]+(j.dataTypes[0]!=="*"?", "+Zc+"; q=0.01":""):j.accepts["*"]);for(ne in j.headers)et.setRequestHeader(ne,j.headers[ne]);if(j.beforeSend&&(j.beforeSend.call(re,et,j)===!1||L))return et.abort();if(Nt="abort",ke.add(j.complete),et.done(j.success),et.fail(j.error),l=el(Wa,j,a,et)){if(et.readyState=1,H&&Ke.trigger("ajaxSend",[et,j]),L)return et;j.async&&j.timeout>0&&(S=s.setTimeout(function(){et.abort("timeout")},j.timeout));try{L=!1,l.send(pi,Zi)}catch(Ct){if(L)throw Ct;Zi(-1,Ct)}}else Zi(-1,"No Transport");function Zi(Ct,ti,fs,Mr){var An,ms,un,ko,Vo,Ci=ti;L||(L=!0,S&&s.clearTimeout(S),l=void 0,m=Mr||"",et.readyState=Ct>0?4:0,An=Ct>=200&&Ct<300||Ct===304,fs&&(ko=dh(j,et,fs)),ko=hh(j,ko,et,An),An?(j.ifModified&&(Vo=et.getResponseHeader("Last-Modified"),Vo&&(p.lastModified[d]=Vo),Vo=et.getResponseHeader("etag"),Vo&&(p.etag[d]=Vo)),Ct===204||j.type==="HEAD"?Ci="nocontent":Ct===304?Ci="notmodified":(Ci=ko.state,ms=ko.data,un=ko.error,An=!un)):(un=Ci,!Ct&&Ci||(Ci="error",Ct<0&&(Ct=0))),et.status=Ct,et.statusText=(ti||Ci)+"",An?tt.resolveWith(re,[ms,Ci,et]):tt.rejectWith(re,[et,Ci,un]),et.statusCode(bi),bi=void 0,H&&Ke.trigger(An?"ajaxSuccess":"ajaxError",[et,j,An?ms:un]),ke.fireWith(re,[et,Ci]),H&&(Ke.trigger("ajaxComplete",[et,j]),--p.active||p.event.trigger("ajaxStop")))}return et},getJSON:function(o,a,l){return p.get(o,a,l,"json")},getScript:function(o,a){return p.get(o,void 0,a,"script")}}),p.each(["get","post"],function(o,a){p[a]=function(l,d,m,f){return p.isFunction(d)&&(f=f||m,m=d,d=void 0),p.ajax(p.extend({url:l,type:a,dataType:f,data:d,success:m},p.isPlainObject(l)&&l))}}),p._evalUrl=function(o){return p.ajax({url:o,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},p.fn.extend({wrapAll:function(o){var a;return this[0]&&(p.isFunction(o)&&(o=o.call(this[0])),a=p(o,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&a.insertBefore(this[0]),a.map(function(){for(var l=this;l.firstElementChild;)l=l.firstElementChild;return l}).append(this)),this},wrapInner:function(o){return p.isFunction(o)?this.each(function(a){p(this).wrapInner(o.call(this,a))}):this.each(function(){var a=p(this),l=a.contents();l.length?l.wrapAll(o):a.append(o)})},wrap:function(o){var a=p.isFunction(o);return this.each(function(l){p(this).wrapAll(a?o.call(this,l):o)})},unwrap:function(o){return this.parent(o).not("body").each(function(){p(this).replaceWith(this.childNodes)}),this}}),p.expr.pseudos.hidden=function(o){return!p.expr.pseudos.visible(o)},p.expr.pseudos.visible=function(o){return!!(o.offsetWidth||o.offsetHeight||o.getClientRects().length)},p.ajaxSettings.xhr=function(){try{return new s.XMLHttpRequest}catch{}};var uh={0:200,1223:204},gs=p.ajaxSettings.xhr();pe.cors=!!gs&&"withCredentials"in gs,pe.ajax=gs=!!gs,p.ajaxTransport(function(o){var a,l;if(pe.cors||gs&&!o.crossDomain)return{send:function(d,m){var f,S=o.xhr();if(S.open(o.type,o.url,o.async,o.username,o.password),o.xhrFields)for(f in o.xhrFields)S[f]=o.xhrFields[f];o.mimeType&&S.overrideMimeType&&S.overrideMimeType(o.mimeType),o.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)S.setRequestHeader(f,d[f]);a=function(R){return function(){a&&(a=l=S.onload=S.onerror=S.onabort=S.onreadystatechange=null,R==="abort"?S.abort():R==="error"?typeof S.status!="number"?m(0,"error"):m(S.status,S.statusText):m(uh[S.status]||S.status,S.statusText,(S.responseType||"text")!=="text"||typeof S.responseText!="string"?{binary:S.response}:{text:S.responseText},S.getAllResponseHeaders()))}},S.onload=a(),l=S.onerror=a("error"),S.onabort!==void 0?S.onabort=l:S.onreadystatechange=function(){S.readyState===4&&s.setTimeout(function(){a&&l()})},a=a("abort");try{S.send(o.hasContent&&o.data||null)}catch(R){if(a)throw R}},abort:function(){a&&a()}}}),p.ajaxPrefilter(function(o){o.crossDomain&&(o.contents.script=!1)}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(o){return p.globalEval(o),o}}}),p.ajaxPrefilter("script",function(o){o.cache===void 0&&(o.cache=!1),o.crossDomain&&(o.type="GET")}),p.ajaxTransport("script",function(o){if(o.crossDomain){var a,l;return{send:function(d,m){a=p("<script>").prop({charset:o.scriptCharset,src:o.url}).on("load error",l=function(f){a.remove(),l=null,f&&m(f.type==="error"?404:200,f.type)}),e.head.appendChild(a[0])},abort:function(){l&&l()}}}});var tl=[],Ya=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var o=tl.pop()||p.expando+"_"+Kc++;return this[o]=!0,o}}),p.ajaxPrefilter("json jsonp",function(o,a,l){var d,m,f,S=o.jsonp!==!1&&(Ya.test(o.url)?"url":typeof o.data=="string"&&(o.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Ya.test(o.data)&&"data");if(S||o.dataTypes[0]==="jsonp")return d=o.jsonpCallback=p.isFunction(o.jsonpCallback)?o.jsonpCallback():o.jsonpCallback,S?o[S]=o[S].replace(Ya,"$1"+d):o.jsonp!==!1&&(o.url+=($a.test(o.url)?"&":"?")+o.jsonp+"="+d),o.converters["script json"]=function(){return f||p.error(d+" was not called"),f[0]},o.dataTypes[0]="json",m=s[d],s[d]=function(){f=arguments},l.always(function(){m===void 0?p(s).removeProp(d):s[d]=m,o[d]&&(o.jsonpCallback=a.jsonpCallback,tl.push(d)),f&&p.isFunction(m)&&m(f[0]),f=m=void 0}),"script"}),pe.createHTMLDocument=function(){var o=e.implementation.createHTMLDocument("").body;return o.innerHTML="<form></form><form></form>",o.childNodes.length===2}(),p.parseHTML=function(o,a,l){if(typeof o!="string")return[];typeof a=="boolean"&&(l=a,a=!1);var d,m,f;return a||(pe.createHTMLDocument?(a=e.implementation.createHTMLDocument(""),d=a.createElement("base"),d.href=e.location.href,a.head.appendChild(d)):a=e),m=u.exec(o),f=!l&&[],m?[a.createElement(m[1])]:(m=ps([o],a,f),f&&f.length&&p(f).remove(),p.merge([],m.childNodes))},p.fn.load=function(o,a,l){var d,m,f,S=this,R=o.indexOf(" ");return R>-1&&(d=or(o.slice(R)),o=o.slice(0,R)),p.isFunction(a)?(l=a,a=void 0):a&&typeof a=="object"&&(m="POST"),S.length>0&&p.ajax({url:o,type:m||"GET",dataType:"html",data:a}).done(function(L){f=arguments,S.html(d?p("<div>").append(p.parseHTML(L)).find(d):L)}).always(l&&function(L,H){S.each(function(){l.apply(this,f||[L.responseText,H,L])})}),this},p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(o,a){p.fn[a]=function(l){return this.on(a,l)}}),p.expr.pseudos.animated=function(o){return p.grep(p.timers,function(a){return o===a.elem}).length},p.offset={setOffset:function(o,a,l){var d,m,f,S,R,L,H,ne=p.css(o,"position"),de=p(o),j={};ne==="static"&&(o.style.position="relative"),R=de.offset(),f=p.css(o,"top"),L=p.css(o,"left"),H=(ne==="absolute"||ne==="fixed")&&(f+L).indexOf("auto")>-1,H?(d=de.position(),S=d.top,m=d.left):(S=parseFloat(f)||0,m=parseFloat(L)||0),p.isFunction(a)&&(a=a.call(o,l,p.extend({},R))),a.top!=null&&(j.top=a.top-R.top+S),a.left!=null&&(j.left=a.left-R.left+m),"using"in a?a.using.call(o,j):de.css(j)}},p.fn.extend({offset:function(o){if(arguments.length)return o===void 0?this:this.each(function(S){p.offset.setOffset(this,o,S)});var a,l,d,m,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),a=f.ownerDocument,l=a.documentElement,m=a.defaultView,{top:d.top+m.pageYOffset-l.clientTop,left:d.left+m.pageXOffset-l.clientLeft}):{top:0,left:0}},position:function(){if(this[0]){var o,a,l=this[0],d={top:0,left:0};return p.css(l,"position")==="fixed"?a=l.getBoundingClientRect():(o=this.offsetParent(),a=this.offset(),h(o[0],"html")||(d=o.offset()),d={top:d.top+p.css(o[0],"borderTopWidth",!0),left:d.left+p.css(o[0],"borderLeftWidth",!0)}),{top:a.top-d.top-p.css(l,"marginTop",!0),left:a.left-d.left-p.css(l,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var o=this.offsetParent;o&&p.css(o,"position")==="static";)o=o.offsetParent;return o||vo})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(o,a){var l=a==="pageYOffset";p.fn[o]=function(d){return Gi(this,function(m,f,S){var R;return p.isWindow(m)?R=m:m.nodeType===9&&(R=m.defaultView),S===void 0?R?R[a]:m[f]:void(R?R.scrollTo(l?R.pageXOffset:S,l?S:R.pageYOffset):m[f]=S)},o,d,arguments.length)}}),p.each(["top","left"],function(o,a){p.cssHooks[a]=Vc(pe.pixelPosition,function(l,d){if(d)return d=ds(l,a),Ua.test(d)?p(l).position()[a]+"px":d})}),p.each({Height:"height",Width:"width"},function(o,a){p.each({padding:"inner"+o,content:a,"":"outer"+o},function(l,d){p.fn[d]=function(m,f){var S=arguments.length&&(l||typeof m!="boolean"),R=l||(m===!0||f===!0?"margin":"border");return Gi(this,function(L,H,ne){var de;return p.isWindow(L)?d.indexOf("outer")===0?L["inner"+o]:L.document.documentElement["client"+o]:L.nodeType===9?(de=L.documentElement,Math.max(L.body["scroll"+o],de["scroll"+o],L.body["offset"+o],de["offset"+o],de["client"+o])):ne===void 0?p.css(L,H,R):p.style(L,H,ne,R)},a,S?m:void 0,S)}})}),p.fn.extend({bind:function(o,a,l){return this.on(o,null,a,l)},unbind:function(o,a){return this.off(o,null,a)},delegate:function(o,a,l,d){return this.on(a,o,l,d)},undelegate:function(o,a,l){return arguments.length===1?this.off(o,"**"):this.off(a,o||"**",l)},holdReady:function(o){o?p.readyWait++:p.ready(!0)}}),p.isArray=Array.isArray,p.parseJSON=JSON.parse,p.nodeName=h,typeof define=="function"&&define.amd&&define("jquery",[],function(){return p});var gh=s.jQuery,fh=s.$;return p.noConflict=function(o){return s.$===p&&(s.$=fh),o&&s.jQuery===p&&(s.jQuery=gh),p},t||(s.jQuery=s.$=p),p});jQuery=Rs.exports;(function(s){function t(h,u,b){if(!b[0]||typeof b[0]=="object")return u.init.apply(h,b);if(u[b[0]])return u[b[0]].apply(h,Array.prototype.slice.call(b,1));throw V(b[0]+" is not a method or property")}function i(h,u,b,T){return{css:{position:"absolute",top:h,left:u,overflow:T||"hidden",zIndex:b||"auto"}}}function e(h,u,b,T,I){var q=1-I,we=q*q*q,Je=I*I*I;return n(Math.round(we*h.x+3*I*q*q*u.x+3*I*I*q*b.x+Je*T.x),Math.round(we*h.y+3*I*q*q*u.y+3*I*I*q*b.y+Je*T.y))}function n(h,u){return{x:h,y:u}}function r(h,u,b){return le&&b?" translate3d("+h+"px,"+u+"px, 0px) ":" translate("+h+"px, "+u+"px) "}function c(h){return" rotate("+h+"deg) "}function g(h,u){return Object.prototype.hasOwnProperty.call(u,h)}function v(){for(var h=["Moz","Webkit","Khtml","O","ms"],u=h.length,b="";u--;)h[u]+"Transform"in document.body.style&&(b="-"+h[u].toLowerCase()+"-");return b}function y(h,u,b,T,I){var q,we=[];if(he=="-webkit-"){for(q=0;q<I;q++)we.push("color-stop("+T[q][0]+", "+T[q][1]+")");h.css({"background-image":"-webkit-gradient(linear, "+u.x+"% "+u.y+"%,"+b.x+"% "+b.y+"%, "+we.join(",")+" )"})}else{var u={x:u.x/100*h.width(),y:u.y/100*h.height()},b={x:b.x/100*h.width(),y:b.y/100*h.height()},Ot=b.x-u.x;q=b.y-u.y;var Je=Math.atan2(q,Ot),pt=Je-Math.PI/2,pt=Math.abs(h.width()*Math.sin(pt))+Math.abs(h.height()*Math.cos(pt)),Ot=Math.sqrt(q*q+Ot*Ot),b=n(b.x<u.x?h.width():0,b.y<u.y?h.height():0),mt=Math.tan(Je);for(q=-1/mt,mt=(q*b.x-b.y-mt*u.x+u.y)/(q-mt),b=q*mt-q*b.x+b.y,u=Math.sqrt(Math.pow(mt-u.x,2)+Math.pow(b-u.y,2)),q=0;q<I;q++)we.push(" "+T[q][1]+" "+100*(u+Ot*T[q][0])/pt+"%");h.css({"background-image":he+"linear-gradient("+-Je+"rad,"+we.join(",")+")"})}}function M(h,u,b){return h=s.Event(h),u.trigger(h,b),h.isDefaultPrevented()?"prevented":h.isPropagationStopped()?"stopped":""}function V(h){function u(b){this.name="TurnJsError",this.message=b}return u.prototype=Error(),u.prototype.constructor=u,new u(h)}function Z(h){var u={top:0,left:0};do u.left+=h.offsetLeft,u.top+=h.offsetTop;while(h=h.offsetParent);return u}var le,pe,he="",Te=Math.PI,p=Te/2,dt="ontouchstart"in window,vt=dt?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},gt={backward:["bl","tl"],forward:["br","tr"],all:"tl bl tr br l r".split(" ")},Mi=["single","double"],At=["ltr","rtl"],li={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},mi={cornerSize:100},Oe={init:function(q){le="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;var u;pe=(u=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))?534.3<parseFloat(u[1]):!0,he=v();var b;u=0;var T=this.data(),I=this.children(),q=s.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},li,q);if(T.opts=q,T.pageObjs={},T.pages={},T.pageWrap={},T.pageZoom={},T.pagePlace={},T.pageMv=[],T.zoom=1,T.totalPages=q.pages||0,T.eventHandlers={touchStart:s.proxy(Oe._touchStart,this),touchMove:s.proxy(Oe._touchMove,this),touchEnd:s.proxy(Oe._touchEnd,this),start:s.proxy(Oe._eventStart,this)},q.when)for(b in q.when)g(b,q.when)&&this.bind(b,q.when[b]);for(this.css({position:"relative",width:q.width,height:q.height}),this.turn("display",q.display),q.direction!==""&&this.turn("direction",q.direction),le&&!dt&&q.acceleration&&this.transform(r(0,0,!0)),b=0;b<I.length;b++)s(I[b]).attr("ignore")!="1"&&this.turn("addPage",I[b],++u);return s(this).bind(vt.down,T.eventHandlers.touchStart).bind("end",Oe._eventEnd).bind("pressed",Oe._eventPressed).bind("released",Oe._eventReleased).bind("flip",Oe._flip),s(this).parent().bind("start",T.eventHandlers.start),s(document).bind(vt.move,T.eventHandlers.touchMove).bind(vt.up,T.eventHandlers.touchEnd),this.turn("page",q.page),T.done=!0,this},addPage:function(h,u){var b,T=!1,I=this.data(),q=I.totalPages+1;if(I.destroying)return!1;if((b=/\bp([0-9]+)\b/.exec(s(h).attr("class")))&&(u=parseInt(b[1],10)),u){if(u==q)T=!0;else if(u>q)throw V('Page "'+u+'" cannot be inserted')}else u=q,T=!0;return 1<=u&&u<=q&&(b=I.display=="double"?u%2?" odd":" even":"",I.done&&this.turn("stop"),u in I.pageObjs&&Oe._movePages.call(this,u,1),T&&(I.totalPages=q),I.pageObjs[u]=s(h).css({float:"left"}).addClass("page p"+u+b),navigator.userAgent.indexOf("MSIE 9.0")!=-1&&I.pageObjs[u].hasClass("hard")&&I.pageObjs[u].removeClass("hard"),Oe._addPage.call(this,u),Oe._removeFromDOM.call(this)),this},_addPage:function(h){var u=this.data(),b=u.pageObjs[h];if(b)if(Oe._necessPage.call(this,h)){if(!u.pageWrap[h]){u.pageWrap[h]=s("<div/>",{class:"page-wrapper",page:h,css:{position:"absolute",overflow:"hidden"}}),this.append(u.pageWrap[h]),u.pagePlace[h]||(u.pagePlace[h]=h,u.pageObjs[h].appendTo(u.pageWrap[h]));var T=Oe._pageSize.call(this,h,!0);b.css({width:T.width,height:T.height}),u.pageWrap[h].css(T)}u.pagePlace[h]==h&&Oe._makeFlip.call(this,h)}else u.pagePlace[h]=0,u.pageObjs[h]&&u.pageObjs[h].remove()},hasPage:function(h){return g(h,this.data().pageObjs)},center:function(h){var u=this.data(),b=s(this).turn("size"),T=0;return u.noCenter||(u.display=="double"&&(h=this.turn("view",h||u.tpage||u.page),u.direction=="ltr"?h[0]?h[1]||(T+=b.width/4):T-=b.width/4:h[0]?h[1]||(T-=b.width/4):T+=b.width/4),s(this).css({marginLeft:T})),this},destroy:function(){var h=this,u=this.data(),b="end first flip last pressed released start turning turned zooming missing".split(" ");if(M("destroying",this)!="prevented"){for(u.destroying=!0,s.each(b,function(T,I){h.unbind(I)}),this.parent().unbind("start",u.eventHandlers.start),s(document).unbind(vt.move,u.eventHandlers.touchMove).unbind(vt.up,u.eventHandlers.touchEnd);u.totalPages!==0;)this.turn("removePage",u.totalPages);return u.fparent&&u.fparent.remove(),u.shadow&&u.shadow.remove(),this.removeData(),u=null,this}},is:function(){return typeof this.data().pages=="object"},zoom:function(h){var u=this.data();if(typeof h=="number"){if(.001>h||100<h)throw V(h+" is not a value for zoom");if(M("zooming",this,[h,u.zoom])=="prevented")return this;var q=this.turn("size"),b=this.turn("view"),T=1/u.zoom,I=Math.round(q.width*T*h),q=Math.round(q.height*T*h);for(u.zoom=h,s(this).turn("stop").turn("size",I,q),u.opts.autoCenter&&this.turn("center"),Oe._updateShadow.call(this),h=0;h<b.length;h++)b[h]&&u.pageZoom[b[h]]!=u.zoom&&(this.trigger("zoomed",[b[h],b,u.pageZoom[b[h]],u.zoom]),u.pageZoom[b[h]]=u.zoom);return this}return u.zoom},_pageSize:function(h,u){var b=this.data(),T={};if(b.display=="single")T.width=this.width(),T.height=this.height(),u&&(T.top=0,T.left=0,T.right="auto");else{var I=this.width()/2,q=this.height();if(b.pageObjs[h].hasClass("own-size")?(T.width=b.pageObjs[h].width(),T.height=b.pageObjs[h].height()):(T.width=I,T.height=q),u){var we=h%2;T.top=(q-T.height)/2,b.direction=="ltr"?(T[we?"right":"left"]=I-T.width,T[we?"left":"right"]="auto"):(T[we?"left":"right"]=I-T.width,T[we?"right":"left"]="auto")}}return T},_makeFlip:function(h){var u=this.data();if(!u.pages[h]&&u.pagePlace[h]==h){var b=u.display=="single",T=h%2;u.pages[h]=u.pageObjs[h].css(Oe._pageSize.call(this,h)).flip({page:h,next:T||b?h+1:h-1,turn:this}).flip("disable",u.disabled),Oe._setPageLoc.call(this,h),u.pageZoom[h]=u.zoom}return u.pages[h]},_makeRange:function(){var h,u;if(!(1>this.data().totalPages))for(u=this.turn("range"),h=u[0];h<=u[1];h++)Oe._addPage.call(this,h)},range:function(q){var u,b,T,I=this.data(),q=q||I.tpage||I.page||1;if(T=Oe._view.call(this,q),1>q||q>I.totalPages)throw V('"'+q+'" is not a valid page');return T[1]=T[1]||T[0],1<=T[0]&&T[1]<=I.totalPages?(q=Math.floor(2),I.totalPages-T[1]>T[0]?(u=Math.min(T[0]-1,q),b=2*q-u):(b=Math.min(I.totalPages-T[1],q),u=2*q-b)):b=u=5,[Math.max(1,T[0]-u),Math.min(I.totalPages,T[1]+b)]},_necessPage:function(h){if(h===0)return!0;var u=this.turn("range");return this.data().pageObjs[h].hasClass("fixed")||h>=u[0]&&h<=u[1]},_removeFromDOM:function(){var h,u=this.data();for(h in u.pageWrap)g(h,u.pageWrap)&&!Oe._necessPage.call(this,h)&&Oe._removePageFromDOM.call(this,h)},_removePageFromDOM:function(h){var u=this.data();if(u.pages[h]){var b=u.pages[h].data();Fe._moveFoldingPage.call(u.pages[h],!1),b.f&&b.f.fwrapper&&b.f.fwrapper.remove(),u.pages[h].removeData(),u.pages[h].remove(),delete u.pages[h]}u.pageObjs[h]&&u.pageObjs[h].remove(),u.pageWrap[h]&&(u.pageWrap[h].remove(),delete u.pageWrap[h]),Oe._removeMv.call(this,h),delete u.pagePlace[h],delete u.pageZoom[h]},removePage:function(h){var u=this.data();if(h=="*")for(;u.totalPages!==0;)this.turn("removePage",u.totalPages);else{if(1>h||h>u.totalPages)throw V("The page "+h+" doesn't exist");u.pageObjs[h]&&(this.turn("stop"),Oe._removePageFromDOM.call(this,h),delete u.pageObjs[h]),Oe._movePages.call(this,h,-1),u.totalPages-=1,u.page>u.totalPages?(u.page=null,Oe._fitPage.call(this,u.totalPages)):(Oe._makeRange.call(this),this.turn("update"))}return this},_movePages:function(h,u){var b,T=this,I=this.data(),q=I.display=="single",we=function(Je){var pt=Je+u,Ot=pt%2,mt=Ot?" odd ":" even ";I.pageObjs[Je]&&(I.pageObjs[pt]=I.pageObjs[Je].removeClass("p"+Je+" odd even").addClass("p"+pt+mt)),I.pagePlace[Je]&&I.pageWrap[Je]&&(I.pagePlace[pt]=pt,I.pageWrap[pt]=I.pageObjs[pt].hasClass("fixed")?I.pageWrap[Je].attr("page",pt):I.pageWrap[Je].css(Oe._pageSize.call(T,pt,!0)).attr("page",pt),I.pages[Je]&&(I.pages[pt]=I.pages[Je].flip("options",{page:pt,next:q||Ot?pt+1:pt-1})),u&&(delete I.pages[Je],delete I.pagePlace[Je],delete I.pageZoom[Je],delete I.pageObjs[Je],delete I.pageWrap[Je]))};if(0<u)for(b=I.totalPages;b>=h;b--)we(b);else for(b=h;b<=I.totalPages;b++)we(b)},display:function(h){var u=this.data(),b=u.display;if(h===void 0)return b;if(s.inArray(h,Mi)==-1)throw V('"'+h+'" is not a value for display');switch(h){case"single":u.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),u.pageObjs[0]=s("<div />",{class:"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)),this.addClass("shadow");break;case"double":u.pageObjs[0]&&(this.turn("stop").css({overflow:""}),u.pageObjs[0].remove(),delete u.pageObjs[0]),this.removeClass("shadow")}return u.display=h,b&&(h=this.turn("size"),Oe._movePages.call(this,1,0),this.turn("size",h.width,h.height).turn("update")),this},direction:function(h){var u=this.data();if(h===void 0)return u.direction;if(h=h.toLowerCase(),s.inArray(h,At)==-1)throw V('"'+h+'" is not a value for direction');return h=="rtl"&&s(this).attr("dir","ltr").css({direction:"ltr"}),u.direction=h,u.done&&this.turn("size",s(this).width(),s(this).height()),this},animating:function(){return 0<this.data().pageMv.length},corner:function(){var h,u,b=this.data();for(u in b.pages)if(g(u,b.pages)&&(h=b.pages[u].flip("corner")))return h;return!1},data:function(){return this.data()},disable:function(h){var u,b=this.data(),T=this.turn("view");b.disabled=h===void 0||h===!0;for(u in b.pages)g(u,b.pages)&&b.pages[u].flip("disable",b.disabled?!0:s.inArray(parseInt(u,10),T)==-1);return this},disabled:function(h){return h===void 0?this.data().disabled===!0:this.turn("disable",h)},size:function(h,u){if(h===void 0||u===void 0)return{width:this.width(),height:this.height()};this.turn("stop");var b,T,I=this.data();T=I.display=="double"?h/2:h,this.css({width:h,height:u}),I.pageObjs[0]&&I.pageObjs[0].css({width:T,height:u});for(b in I.pageWrap)g(b,I.pageWrap)&&(T=Oe._pageSize.call(this,b,!0),I.pageObjs[b].css({width:T.width,height:T.height}),I.pageWrap[b].css(T),I.pages[b]&&I.pages[b].css({width:T.width,height:T.height}));return this.turn("resize"),this},resize:function(){var h,u=this.data();for(u.pages[0]&&(u.pageWrap[0].css({left:-this.width()}),u.pages[0].flip("resize",!0)),h=1;h<=u.totalPages;h++)u.pages[h]&&u.pages[h].flip("resize",!0);Oe._updateShadow.call(this),u.opts.autoCenter&&this.turn("center")},_removeMv:function(h){var u,b=this.data();for(u=0;u<b.pageMv.length;u++)if(b.pageMv[u]==h)return b.pageMv.splice(u,1),!0;return!1},_addMv:function(h){var u=this.data();Oe._removeMv.call(this,h),u.pageMv.push(h)},_view:function(b){var u=this.data(),b=b||u.page;return u.display=="double"?b%2?[b-1,b]:[b,b+1]:[b]},view:function(b){var u=this.data(),b=Oe._view.call(this,b);return u.display=="double"?[0<b[0]?b[0]:0,b[1]<=u.totalPages?b[1]:0]:[0<b[0]&&b[0]<=u.totalPages?b[0]:0]},stop:function(h,u){if(this.turn("animating")){var b,T,I,q=this.data();for(q.tpage&&(q.page=q.tpage,delete q.tpage),b=0;b<q.pageMv.length;b++)q.pageMv[b]&&q.pageMv[b]!==h&&(I=q.pages[q.pageMv[b]],T=I.data().f.opts,I.flip("hideFoldedPage",u),u||Fe._moveFoldingPage.call(I,!1),T.force&&(T.next=T.page%2===0?T.page-1:T.page+1,delete T.force))}return this.turn("update"),this},pages:function(h){var u=this.data();if(h){if(h<u.totalPages)for(var b=u.totalPages;b>h;b--)this.turn("removePage",b);return u.totalPages=h,Oe._fitPage.call(this,u.page),this}return u.totalPages},_missing:function(h){var u=this.data();if(!(1>u.totalPages)){for(var b=this.turn("range",h),T=[],h=b[0];h<=b[1];h++)u.pageObjs[h]||T.push(h);0<T.length&&this.trigger("missing",[T])}},_fitPage:function(h){var u=this.data(),b=this.turn("view",h);if(Oe._missing.call(this,h),u.pageObjs[h]){u.page=h,this.turn("stop");for(var T=0;T<b.length;T++)b[T]&&u.pageZoom[b[T]]!=u.zoom&&(this.trigger("zoomed",[b[T],b,u.pageZoom[b[T]],u.zoom]),u.pageZoom[b[T]]=u.zoom);Oe._removeFromDOM.call(this),Oe._makeRange.call(this),Oe._updateShadow.call(this),this.trigger("turned",[h,b]),this.turn("update"),u.opts.autoCenter&&this.turn("center")}},_turnPage:function(h){var u,b,T=this.data(),I=T.pagePlace[h],q=this.turn("view"),we=this.turn("view",h);if(T.page!=h){var Je=T.page;if(M("turning",this,[h,we])=="prevented"){Je==T.page&&s.inArray(I,T.pageMv)!=-1&&T.pages[I].flip("hideFoldedPage",!0);return}s.inArray(1,we)!=-1&&this.trigger("first"),s.inArray(T.totalPages,we)!=-1&&this.trigger("last")}T.display=="single"?(u=q[0],b=we[0]):q[1]&&h>q[1]?(u=q[1],b=we[0]):q[0]&&h<q[0]&&(u=q[0],b=we[1]),I=T.opts.turnCorners.split(","),q=T.pages[u].data().f,we=q.opts,Je=q.point,Oe._missing.call(this,h),T.pageObjs[h]&&(this.turn("stop"),T.page=h,Oe._makeRange.call(this),T.tpage=b,we.next!=b&&(we.next=b,we.force=!0),this.turn("update"),q.point=Je,q.effect=="hard"?T.direction=="ltr"?T.pages[u].flip("turnPage",h>u?"r":"l"):T.pages[u].flip("turnPage",h>u?"l":"r"):T.direction=="ltr"?T.pages[u].flip("turnPage",I[h>u?1:0]):T.pages[u].flip("turnPage",I[h>u?0:1]))},page:function(h){var u=this.data();if(h===void 0)return u.page;if(!u.disabled&&!u.destroying){if(h=parseInt(h,10),0<h&&h<=u.totalPages)return h!=u.page&&(!u.done||s.inArray(h,this.turn("view"))!=-1?Oe._fitPage.call(this,h):Oe._turnPage.call(this,h)),this;throw V("The page "+h+" does not exist")}},next:function(){return this.turn("page",Math.min(this.data().totalPages,Oe._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,Oe._view.call(this,this.data().page).shift()-1))},peel:function(h,I){var b=this.data(),T=this.turn("view"),I=I===void 0?!0:I===!0;return h===!1?this.turn("stop",null,I):b.display=="single"?b.pages[b.page].flip("peel",h,I):(T=b.direction=="ltr"?h.indexOf("l")!=-1?T[0]:T[1]:h.indexOf("l")!=-1?T[1]:T[0],b.pages[T]&&b.pages[T].flip("peel",h,I)),this},_addMotionPage:function(){var h=s(this).data().f.opts,u=h.turn;u.data(),Oe._addMv.call(u,h.page)},_eventStart:function(h,u,b){var T=u.turn.data(),I=T.pageZoom[u.page];h.isDefaultPrevented()||(I&&I!=T.zoom&&(u.turn.trigger("zoomed",[u.page,u.turn.turn("view",u.page),I,T.zoom]),T.pageZoom[u.page]=T.zoom),T.display=="single"&&b&&(b.charAt(1)=="l"&&T.direction=="ltr"||b.charAt(1)=="r"&&T.direction=="rtl"?(u.next=u.next<u.page?u.next:u.page-1,u.force=!0):u.next=u.next>u.page?u.next:u.page+1),Oe._addMotionPage.call(h.target)),Oe._updateShadow.call(u.turn)},_eventEnd:function(T,u,b){s(T.target).data();var T=u.turn,I=T.data();b?(b=I.tpage||I.page,(b==u.next||b==u.page)&&(delete I.tpage,Oe._fitPage.call(T,b||u.next,!0))):(Oe._removeMv.call(T,u.page),Oe._updateShadow.call(T),T.turn("update"))},_eventPressed:function(u){var u=s(u.target).data().f,b=u.opts.turn;return b.data().mouseAction=!0,b.turn("update"),u.time=new Date().getTime()},_eventReleased:function(h,u){var b;b=s(h.target);var T=b.data().f,I=T.opts.turn,q=I.data();b=q.display=="single"?u.corner=="br"||u.corner=="tr"?u.x<b.width()/2:u.x>b.width()/2:0>u.x||u.x>b.width(),(200>new Date().getTime()-T.time||b)&&(h.preventDefault(),Oe._turnPage.call(I,T.opts.next)),q.mouseAction=!1},_flip:function(h){h.stopPropagation(),h=s(h.target).data().f.opts,h.turn.trigger("turn",[h.next]),h.turn.data().opts.autoCenter&&h.turn.turn("center",h.next)},_touchStart:function(){var h=this.data(),u;for(u in h.pages)if(g(u,h.pages)&&Fe._eventStart.apply(h.pages[u],arguments)===!1)return!1},_touchMove:function(){var h=this.data(),u;for(u in h.pages)g(u,h.pages)&&Fe._eventMove.apply(h.pages[u],arguments)},_touchEnd:function(){var h=this.data(),u;for(u in h.pages)g(u,h.pages)&&Fe._eventEnd.apply(h.pages[u],arguments)},calculateZ:function(h){var u,b,T,I,q=this,we=this.data();u=this.turn("view");var Je=u[0]||u[1],pt=h.length-1,Ot={pageZ:{},partZ:{},pageV:{}},mt=function(vi){vi=q.turn("view",vi),vi[0]&&(Ot.pageV[vi[0]]=!0),vi[1]&&(Ot.pageV[vi[1]]=!0)};for(u=0;u<=pt;u++)b=h[u],T=we.pages[b].data().f.opts.next,I=we.pagePlace[b],mt(b),mt(T),b=we.pagePlace[T]==T?T:b,Ot.pageZ[b]=we.totalPages-Math.abs(Je-b),Ot.partZ[I]=2*we.totalPages-pt+u;return Ot},update:function(){var h,u=this.data();if(this.turn("animating")&&u.pageMv[0]!==0){var b,T=this.turn("calculateZ",u.pageMv),I=this.turn("corner"),q=this.turn("view"),we=this.turn("view",u.tpage);for(h in u.pageWrap)g(h,u.pageWrap)&&(b=u.pageObjs[h].hasClass("fixed"),u.pageWrap[h].css({display:T.pageV[h]||b?"":"none",zIndex:(u.pageObjs[h].hasClass("hard")?T.partZ[h]:T.pageZ[h])||(b?-1:0)}),b=u.pages[h])&&(b.flip("z",T.partZ[h]||null),T.pageV[h]&&b.flip("resize"),u.tpage?b.flip("hover",!1).flip("disable",s.inArray(parseInt(h,10),u.pageMv)==-1&&h!=we[0]&&h!=we[1]):b.flip("hover",I===!1).flip("disable",h!=q[0]&&h!=q[1]))}else for(h in u.pageWrap)g(h,u.pageWrap)&&(T=Oe._setPageLoc.call(this,h),u.pages[h]&&u.pages[h].flip("disable",u.disabled||T!=1).flip("hover",!0).flip("z",null));return this},_updateShadow:function(){var h,u,b=this.data(),T=this.width(),I=this.height(),q=b.display=="single"?T:T/2;h=this.turn("view"),b.shadow||(b.shadow=s("<div />",{class:"shadow",css:i(0,0,0).css}).appendTo(this));for(var we=0;we<b.pageMv.length&&h[0]&&h[1];we++)h=this.turn("view",b.pages[b.pageMv[we]].data().f.opts.next),u=this.turn("view",b.pageMv[we]),h[0]=h[0]&&u[0],h[1]=h[1]&&u[1];switch(h[0]?h[1]?3:b.direction=="ltr"?2:1:b.direction=="ltr"?1:2){case 1:b.shadow.css({width:q,height:I,top:0,left:q});break;case 2:b.shadow.css({width:q,height:I,top:0,left:0});break;case 3:b.shadow.css({width:T,height:I,top:0,left:0})}},_setPageLoc:function(h){var u=this.data(),b=this.turn("view"),T=0;if(h==b[0]||h==b[1]?T=1:(u.display=="single"&&h==b[0]+1||u.display=="double"&&h==b[0]-2||h==b[1]+2)&&(T=2),!this.turn("animating"))switch(T){case 1:u.pageWrap[h].css({zIndex:u.totalPages,display:""});break;case 2:u.pageWrap[h].css({zIndex:u.totalPages-1,display:""});break;case 0:u.pageWrap[h].css({zIndex:0,display:u.pageObjs[h].hasClass("fixed")?"":"none"})}return T},options:function(h){if(h===void 0)return this.data().opts;var u=this.data();if(s.extend(u.opts,h),h.pages&&this.turn("pages",h.pages),h.page&&this.turn("page",h.page),h.display&&this.turn("display",h.display),h.direction&&this.turn("direction",h.direction),h.width&&h.height&&this.turn("size",h.width,h.height),h.when)for(var b in h.when)g(b,h.when)&&this.unbind(b).bind(b,h.when[b]);return this},version:function(){return"4.1.0"}},Fe={init:function(h){return this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}}),this.flip("options",h),Fe._addPageWrapper.call(this),this},setData:function(h){var u=this.data();return u.f=s.extend(u.f,h),this},options:function(h){var u=this.data().f;return h?(Fe.setData.call(this,{opts:s.extend({},u.opts||mi,h)}),this):u.opts},z:function(h){var u=this.data().f;return u.opts["z-index"]=h,u.fwrapper&&u.fwrapper.css({zIndex:h||parseInt(u.parent.css("z-index"),10)||0}),this},_cAllowed:function(){var h=this.data().f,u=h.opts.page,b=h.opts.turn.data(),T=u%2;return h.effect=="hard"?b.direction=="ltr"?[T?"r":"l"]:[T?"l":"r"]:b.display=="single"?u==1?b.direction=="ltr"?gt.forward:gt.backward:u==b.totalPages?b.direction=="ltr"?gt.backward:gt.forward:gt.all:b.direction=="ltr"?gt[T?"forward":"backward"]:gt[T?"backward":"forward"]},_cornerActivated:function(I){var u=this.data().f,b=this.width(),T=this.height(),I={x:I.x,y:I.y,corner:""},q=u.opts.cornerSize;if(0>=I.x||0>=I.y||I.x>=b||I.y>=T)return!1;var we=Fe._cAllowed.call(this);switch(u.effect){case"hard":if(I.x>b-q)I.corner="r";else if(I.x<q)I.corner="l";else return!1;break;case"sheet":if(I.y<q)I.corner+="t";else if(I.y>=T-q)I.corner+="b";else return!1;if(I.x<=q)I.corner+="l";else if(I.x>=b-q)I.corner+="r";else return!1}return!I.corner||s.inArray(I.corner,we)==-1?!1:I},_isIArea:function(b){var u=this.data().f.parent.offset(),b=dt&&b.originalEvent?b.originalEvent.touches[0]:b;return Fe._cornerActivated.call(this,{x:b.pageX-u.left,y:b.pageY-u.top})},_c:function(h,u){switch(u=u||0,h){case"tl":return n(u,u);case"tr":return n(this.width()-u,u);case"bl":return n(u,this.height()-u);case"br":return n(this.width()-u,this.height()-u);case"l":return n(u,0);case"r":return n(this.width()-u,0)}},_c2:function(h){switch(h){case"tl":return n(2*this.width(),0);case"tr":return n(-this.width(),0);case"bl":return n(2*this.width(),this.height());case"br":return n(-this.width(),this.height());case"l":return n(2*this.width(),0);case"r":return n(-this.width(),0)}},_foldingPage:function(){var h=this.data().f;if(h){var u=h.opts;if(u.turn)return h=u.turn.data(),h.display=="single"?1<u.next||1<u.page?h.pageObjs[0]:null:h.pageObjs[u.next]}},_backGradient:function(){var h=this.data().f,u=h.opts.turn.data();return(u=u.opts.gradients&&(u.display=="single"||h.opts.page!=2&&h.opts.page!=u.totalPages-1))&&!h.bshadow&&(h.bshadow=s("<div/>",i(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(h.parent)),u},type:function(){return this.data().f.effect},resize:function(h){var u=this.data().f,b=u.opts.turn.data(),T=this.width(),I=this.height();switch(u.effect){case"hard":h&&(u.wrapper.css({width:T,height:I}),u.fpage.css({width:T,height:I}),b.opts.gradients&&(u.ashadow.css({width:T,height:I}),u.bshadow.css({width:T,height:I})));break;case"sheet":h&&(h=Math.round(Math.sqrt(Math.pow(T,2)+Math.pow(I,2))),u.wrapper.css({width:h,height:h}),u.fwrapper.css({width:h,height:h}).children(":first-child").css({width:T,height:I}),u.fpage.css({width:T,height:I}),b.opts.gradients&&u.ashadow.css({width:T,height:I}),Fe._backGradient.call(this)&&u.bshadow.css({width:T,height:I})),u.parent.is(":visible")&&(b=Z(u.parent[0]),u.fwrapper.css({top:b.top,left:b.left}),b=Z(u.opts.turn[0]),u.fparent.css({top:-b.top,left:-b.left})),this.flip("z",u.opts["z-index"])}},_addPageWrapper:function(){var h=this.data().f,u=h.opts.turn.data(),b=this.parent();if(h.parent=b,!h.wrapper)switch(h.effect){case"hard":var T={};T[he+"transform-style"]="preserve-3d",T[he+"backface-visibility"]="hidden",h.wrapper=s("<div/>",i(0,0,2)).css(T).appendTo(b).prepend(this),h.fpage=s("<div/>",i(0,0,1)).css(T).appendTo(b),u.opts.gradients&&(h.ashadow=s("<div/>",i(0,0,0)).hide().appendTo(b),h.bshadow=s("<div/>",i(0,0,0)));break;case"sheet":var T=this.width(),I=this.height();Math.round(Math.sqrt(Math.pow(T,2)+Math.pow(I,2))),h.fparent=h.opts.turn.data().fparent,h.fparent||(T=s("<div/>",{css:{"pointer-events":"none"}}).hide(),T.data().flips=0,T.css(i(0,0,"auto","visible").css).appendTo(h.opts.turn),h.opts.turn.data().fparent=T,h.fparent=T),this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),h.wrapper=s("<div/>",i(0,0,this.css("z-index"))).appendTo(b).prepend(this),h.fwrapper=s("<div/>",i(b.offset().top,b.offset().left)).hide().appendTo(h.fparent),h.fpage=s("<div/>",i(0,0,0,"visible")).css({cursor:"default"}).appendTo(h.fwrapper),u.opts.gradients&&(h.ashadow=s("<div/>",i(0,0,1)).appendTo(h.fpage)),Fe.setData.call(this,h)}Fe.resize.call(this,!0)},_fold:function(h){var u=this.data().f,b=u.opts.turn.data(),T=Fe._c.call(this,h.corner),I=this.width(),q=this.height();switch(u.effect){case"hard":h.x=h.corner=="l"?Math.min(Math.max(h.x,0),2*I):Math.max(Math.min(h.x,I),-I);var we,Je,pt,Ot,mt,vi=b.totalPages,pn=u.opts["z-index"]||vi,lo={overflow:"visible"},po=T.x?(T.x-h.x)/I:h.x/I,ir=90*po,Do=90>ir;switch(h.corner){case"l":Ot="0% 50%",mt="100% 50%",Do?(we=0,Je=0<u.opts.next-1,pt=1):(we="100%",Je=u.opts.page+1<vi,pt=0);break;case"r":Ot="100% 50%",mt="0% 50%",ir=-ir,I=-I,Do?(we=0,Je=u.opts.next+1<vi,pt=0):(we="-100%",Je=u.opts.page!=1,pt=1)}lo[he+"perspective-origin"]=mt,u.wrapper.transform("rotateY("+ir+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",mt),u.fpage.transform("translateX("+I+"px) rotateY("+(180+ir)+"deg)",Ot),u.parent.css(lo),Do?(po=-po+1,u.wrapper.css({zIndex:pn+1}),u.fpage.css({zIndex:pn})):(po-=1,u.wrapper.css({zIndex:pn}),u.fpage.css({zIndex:pn+1})),b.opts.gradients&&(Je?u.ashadow.css({display:"",left:we,backgroundColor:"rgba(0,0,0,"+.5*po+")"}).transform("rotateY(0deg)"):u.ashadow.hide(),u.bshadow.css({opacity:-po+1}),Do?u.bshadow.parent()[0]!=u.wrapper[0]&&u.bshadow.appendTo(u.wrapper):u.bshadow.parent()[0]!=u.fpage[0]&&u.bshadow.appendTo(u.fpage),y(u.bshadow,n(100*pt,0),n(100*(-pt+1),0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case"sheet":var ho=this,Gi=0,No,dn,Xe,_i,jn,Tr,Ns,vn=n(0,0),Or=n(0,0),Yt=n(0,0),uo=Fe._foldingPage.call(this);Math.tan(0);var go=b.opts.acceleration,wr=u.wrapper.height(),fo=h.corner.substr(0,1)=="t",Wn=h.corner.substr(1,1)=="l",nr=function(){var nt=n(0,0),ki=n(0,0);nt.x=T.x?T.x-h.x:h.x,nt.y=pe?T.y?T.y-h.y:h.y:0,ki.x=Wn?I-nt.x/2:h.x+nt.x/2,ki.y=nt.y/2;var Dt=p-Math.atan2(nt.y,nt.x),Si=Dt-Math.atan2(ki.y,ki.x),Si=Math.max(0,Math.sin(Si)*Math.sqrt(Math.pow(ki.x,2)+Math.pow(ki.y,2)));return Gi=180*(Dt/Te),Yt=n(Si*Math.sin(Dt),Si*Math.cos(Dt)),Dt>p&&(Yt.x+=Math.abs(Yt.y*nt.y/nt.x),Yt.y=0,Math.round(Yt.x*Math.tan(Te-Dt))<q)?(h.y=Math.sqrt(Math.pow(q,2)+2*ki.x*nt.x),fo&&(h.y=q-h.y),nr()):(Dt>p&&(nt=Te-Dt,ki=wr-q/Math.sin(nt),vn=n(Math.round(ki*Math.cos(nt)),Math.round(ki*Math.sin(nt))),Wn&&(vn.x=-vn.x),fo&&(vn.y=-vn.y)),No=Math.round(Yt.y/Math.tan(Dt)+Yt.x),nt=I-No,ki=nt*Math.cos(2*Dt),Si=nt*Math.sin(2*Dt),Or=n(Math.round(Wn?nt-ki:No+ki),Math.round(fo?Si:q-Si)),b.opts.gradients&&(jn=nt*Math.sin(Dt),nt=Fe._c2.call(ho,h.corner),nt=Math.sqrt(Math.pow(nt.x-h.x,2)+Math.pow(nt.y-h.y,2))/I,Ns=Math.sin(p*(1<nt?2-nt:nt)),Tr=Math.min(nt,1),_i=100<jn?(jn-100)/jn:0,dn=n(100*(jn*Math.sin(Dt)/I),100*(jn*Math.cos(Dt)/q)),Fe._backGradient.call(ho)&&(Xe=n(100*(1.2*jn*Math.sin(Dt)/I),100*(1.2*jn*Math.cos(Dt)/q)),Wn||(Xe.x=100-Xe.x),fo||(Xe.y=100-Xe.y))),Yt.x=Math.round(Yt.x),Yt.y=Math.round(Yt.y),!0)};switch(we=function(nt,Rn,Dt,Si){var mo=["0","auto"],Yi=(I-wr)*Dt[0]/100,Vi=(q-wr)*Dt[1]/100,Rn={left:mo[Rn[0]],top:mo[Rn[1]],right:mo[Rn[2]],bottom:mo[Rn[3]]},mo={},ps=Si!=90&&Si!=-90?Wn?-1:1:0,vo=Dt[0]+"% "+Dt[1]+"%";ho.css(Rn).transform(c(Si)+r(nt.x+ps,nt.y,go),vo),u.fpage.css(Rn).transform(c(Si)+r(nt.x+Or.x-vn.x-I*Dt[0]/100,nt.y+Or.y-vn.y-q*Dt[1]/100,go)+c((180/Si-2)*Si),vo),u.wrapper.transform(r(-nt.x+Yi-ps,-nt.y+Vi,go)+c(-Si),vo),u.fwrapper.transform(r(-nt.x+vn.x+Yi,-nt.y+vn.y+Vi,go)+c(-Si),vo),b.opts.gradients&&(Dt[0]&&(dn.x=100-dn.x),Dt[1]&&(dn.y=100-dn.y),mo["box-shadow"]="0 0 20px rgba(0,0,0,"+.5*Ns+")",uo.css(mo),y(u.ashadow,n(Wn?100:0,fo?0:100),n(dn.x,dn.y),[[_i,"rgba(0,0,0,0)"],[.8*(1-_i)+_i,"rgba(0,0,0,"+.2*Tr+")"],[1,"rgba(255,255,255,"+.2*Tr+")"]],3,0),Fe._backGradient.call(ho)&&y(u.bshadow,n(Wn?0:100,fo?0:100),n(Xe.x,Xe.y),[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*Tr+")"],[1,"rgba(0,0,0,0)"]],3))},h.corner){case"tl":h.x=Math.max(h.x,1),nr(),we(Yt,[1,0,0,1],[100,0],Gi);break;case"tr":h.x=Math.min(h.x,I-1),nr(),we(n(-Yt.x,Yt.y),[0,0,0,1],[0,0],-Gi);break;case"bl":h.x=Math.max(h.x,1),nr(),we(n(Yt.x,-Yt.y),[1,1,0,0],[100,100],-Gi);break;case"br":h.x=Math.min(h.x,I-1),nr(),we(n(-Yt.x,-Yt.y),[0,1,1,0],[0,100],Gi)}}u.point=h},_moveFoldingPage:function(h){var u=this.data().f;if(u){var b=u.opts.turn,T=b.data(),I=T.pagePlace;h?(T=u.opts.next,I[T]!=u.opts.page&&(u.folding&&Fe._moveFoldingPage.call(this,!1),Fe._foldingPage.call(this).appendTo(u.fpage),I[T]=u.opts.page,u.folding=T),b.turn("update")):u.folding&&(T.pages[u.folding]?(b=T.pages[u.folding].data().f,T.pageObjs[u.folding].appendTo(b.wrapper)):T.pageWrap[u.folding]&&T.pageObjs[u.folding].appendTo(T.pageWrap[u.folding]),u.folding in I&&(I[u.folding]=u.folding),delete u.folding)}},_showFoldedPage:function(h,u){var b=Fe._foldingPage.call(this),T=this.data(),I=T.f,q=I.visible;if(b){if((!q||!I.point||I.point.corner!=h.corner)&&(b=I.status=="hover"||I.status=="peel"||I.opts.turn.data().mouseAction?h.corner:null,q=!1,M("start",this,[I.opts,b])=="prevented"))return!1;if(u){var we=this,T=I.point&&I.point.corner==h.corner?I.point:Fe._c.call(this,h.corner,1);this.animatef({from:[T.x,T.y],to:[h.x,h.y],duration:500,frame:function(pt){h.x=Math.round(pt[0]),h.y=Math.round(pt[1]),Fe._fold.call(we,h)}})}else Fe._fold.call(this,h),T.effect&&!T.effect.turning&&this.animatef(!1);if(!q)switch(I.effect){case"hard":I.visible=!0,Fe._moveFoldingPage.call(this,!0),I.fpage.show(),I.opts.shadows&&I.bshadow.show();break;case"sheet":I.visible=!0,I.fparent.show().data().flips++,Fe._moveFoldingPage.call(this,!0),I.fwrapper.show(),I.bshadow&&I.bshadow.show()}return!0}return!1},hide:function(){var h=this.data().f,u=h.opts.turn.data(),b=Fe._foldingPage.call(this);switch(h.effect){case"hard":u.opts.gradients&&(h.bshadowLoc=0,h.bshadow.remove(),h.ashadow.hide()),h.wrapper.transform(""),h.fpage.hide();break;case"sheet":--h.fparent.data().flips===0&&h.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),h.wrapper.transform(""),h.fwrapper.hide(),h.bshadow&&h.bshadow.hide(),b.transform("")}return h.visible=!1,this},hideFoldedPage:function(h){var u=this.data().f;if(u.point){var b=this,T=u.point,I=function(){u.point=null,u.status="",b.flip("hide"),b.trigger("end",[u.opts,!1])};if(h){var q=Fe._c.call(this,T.corner),h=T.corner.substr(0,1)=="t"?Math.min(0,T.y-q.y)/2:Math.max(0,T.y-q.y)/2,we=n(T.x,T.y+h),Je=n(q.x,q.y-h);this.animatef({from:0,to:1,frame:function(Ot){Ot=e(T,we,Je,q,Ot),T.x=Ot.x,T.y=Ot.y,Fe._fold.call(b,T)},complete:I,duration:800,hiding:!0})}else this.animatef(!1),I()}},turnPage:function(I){var u=this,b=this.data().f,T=b.opts.turn.data(),I={corner:b.corner?b.corner.corner:I||Fe._cAllowed.call(this)[0]},q=b.point||Fe._c.call(this,I.corner,b.opts.turn?T.opts.elevation:0),we=Fe._c2.call(this,I.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(Je){Je=e(q,q,we,we,Je),I.x=Je.x,I.y=Je.y,Fe._showFoldedPage.call(u,I)},complete:function(){u.trigger("end",[b.opts,!0])},duration:T.opts.duration,turning:!0}),b.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(h){var u=this.data().f,b=u.opts.turn;if(!u.corner&&!u.disabled&&!this.flip("isTurning")&&u.opts.page==b.data().pagePlace[u.opts.page]){if(u.corner=Fe._isIArea.call(this,h),u.corner&&Fe._foldingPage.call(this))return this.trigger("pressed",[u.point]),Fe._showFoldedPage.call(this,u.corner),!1;u.corner=null}},_eventMove:function(h){var u=this.data().f;if(!u.disabled)if(h=dt?h.originalEvent.touches:[h],u.corner){var b=u.parent.offset();u.corner.x=h[0].pageX-b.left,u.corner.y=h[0].pageY-b.top,Fe._showFoldedPage.call(this,u.corner)}else u.hover&&!this.data().effect&&this.is(":visible")&&((h=Fe._isIArea.call(this,h[0]))?(u.effect=="sheet"&&h.corner.length==2||u.effect=="hard")&&(u.status="hover",u=Fe._c.call(this,h.corner,u.opts.cornerSize/2),h.x=u.x,h.y=u.y,Fe._showFoldedPage.call(this,h,!0)):u.status=="hover"&&(u.status="",Fe.hideFoldedPage.call(this,!0)))},_eventEnd:function(){var h=this.data().f,u=h.corner;!h.disabled&&u&&M("released",this,[h.point||u])!="prevented"&&Fe.hideFoldedPage.call(this,!0),h.corner=null},disable:function(h){return Fe.setData.call(this,{disabled:h}),this},hover:function(h){return Fe.setData.call(this,{hover:h}),this},peel:function(h,u){var b=this.data().f;if(h){if(s.inArray(h,gt.all)==-1)throw V("Corner "+h+" is not permitted");if(s.inArray(h,Fe._cAllowed.call(this))!=-1){var T=Fe._c.call(this,h,b.opts.cornerSize/2);b.status="peel",Fe._showFoldedPage.call(this,{corner:h,x:T.x,y:T.y},u)}}else b.status="",Fe.hideFoldedPage.call(this,u);return this}};window.requestAnim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(h){window.setTimeout(h,1e3/60)},s.extend(s.fn,{flip:function(){return t(s(this[0]),Fe,arguments)},turn:function(){return t(s(this[0]),Oe,arguments)},transform:function(h,u){var b={};return u&&(b[he+"transform-origin"]=u),b[he+"transform"]=h,this.css(b)},animatef:function(h){var u=this.data();if(u.effect&&u.effect.stop(),h){h.to.length||(h.to=[h.to]),h.from.length||(h.from=[h.from]);for(var b=[],T=h.to.length,I=!0,q=this,we=new Date().getTime(),Je=function(){if(u.effect&&I){for(var Ot=[],mt=Math.min(h.duration,new Date().getTime()-we),vi=0;vi<T;vi++)Ot.push(u.effect.easing(1,mt,h.from[vi],b[vi],h.duration));h.frame(T==1?Ot[0]:Ot),mt==h.duration?(delete u.effect,q.data(u),h.complete&&h.complete()):window.requestAnim(Je)}},pt=0;pt<T;pt++)b.push(h.to[pt]-h.from[pt]);u.effect=s.extend({stop:function(){I=!1},easing:function(Ot,mt,vi,pn,lo){return pn*Math.sqrt(1-(mt=mt/lo-1)*mt)+vi}},h),this.data(u),Je()}else delete u.effect}}),s.isTouch=dt,s.mouseEvents=vt,s.cssPrefix=v,s.cssTransitionEnd=function(){var h,u=document.createElement("fakeelement"),b={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(h in b)if(u.style[h]!==void 0)return b[h]},s.findPos=Z})(jQuery)});var Ca=(()=>{let t=class t{store$;documentService;loggingService;leftSideViewModeMap={THUMBNAIL:De.Thumbnail,BOOKMARK:De.Outline,ANNOTATION:De.Annotation,REDACTION:De.Redaction,REDACTION_SEARCHING:De.SearchingRedaction,ATTACHMENT:De.EmbeddedFile,FORM:De.Form,SIGNATURE:De.Signature};rightSideViewModeMap={DAP:Rt.DAP,TEXT_SEARCH:Rt.TextSearch,ANNOTATION_PROPERTY:Rt.AnnotProperty};sideViewVisible;sideViewMode;rightSideViewVisible;rightSideViewMode;constructor(e,n,r){this.store$=e,this.documentService=n,this.loggingService=r,this.store$.pipe($("sideViewVisible")).subscribe({next:c=>this.sideViewVisible=c}),this.store$.pipe($("sideViewMode")).subscribe({next:c=>this.sideViewMode=c}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:c=>this.rightSideViewVisible=c}),this.store$.pipe($("rightSideViewMode")).subscribe({next:c=>this.rightSideViewMode=c})}getExportableFunctions(){return[{name:"openPanel",function:e=>{let n;if(e.type in this.leftSideViewModeMap)n=this.openSideView(this.leftSideViewModeMap[e.type]);else if(e.type in this.rightSideViewModeMap)n=this.openRightSideView(this.rightSideViewModeMap[e.type]);else throw this.loggingService.common("warn",Le.INVALID,"args.type"),new _t("Cannot find suitable sideview");if(n)throw n;return ht(void 0)}},{name:"closePanel",function:e=>(e.type==="LEFT"?this.closeSideView():e.type==="RIGHT"&&this.closeRightSideView(),ht(void 0))},{name:"togglePanel",function:e=>{let n;if(e.type in this.leftSideViewModeMap)n=this.toggleSideView(this.leftSideViewModeMap[e.type]);else if(e.type in this.rightSideViewModeMap)n=this.toggleRightSideView(this.rightSideViewModeMap[e.type]);else throw this.loggingService.common("warn",Le.INVALID,"sideview args.type"),new _t("Cannot find suitable sideview");if(n)throw n;return ht(void 0)}}]}getExportableEvents(){return[{type:"sideViewOpen",subject:ut(this.store$.pipe($("sideViewVisible"),F(e=>e),Ve(()=>({type:"LEFT"}))),this.store$.pipe($("rightSideViewVisible"),F(e=>e),Ve(()=>({type:"RIGHT"}))))},{type:"sideViewClose",subject:ut(this.store$.pipe($("sideViewVisible"),F(e=>!e),Ve(()=>({type:"LEFT"}))),this.store$.pipe($("rightSideViewVisible"),F(e=>!e),Ve(()=>({type:"RIGHT"}))))}]}toggleSideView(e){return this.sideViewVisible&&this.sideViewMode===e?this.closeSideView():this.openSideView(e)}openSideView(e){let n={[De.Thumbnail]:!0,[De.EmbeddedFile]:this.documentService.checkAuthority(Ne.DOWNLOAD_EMBEDDED_FILE)||this.documentService.checkAuthority(Ne.UPLOAD_EMBEDDED_FILE)||this.documentService.checkAuthority(Ne.REMOVE_EMBEDDED_FILE),[De.Outline]:!0,[De.Redaction]:this.documentService.checkAuthority(Ne.ANNOTATION),[De.SearchingRedaction]:this.documentService.checkAuthority(Ne.ANNOTATION),[De.Annotation]:this.documentService.checkAuthority(Ne.ANNOTATION),[De.Form]:this.documentService.checkAuthority(Ne.FORM),[De.Signature]:this.documentService.checkAuthority(Ne.FORM)},r={[De.Thumbnail]:!0,[De.EmbeddedFile]:!1,[De.Outline]:!1,[De.Redaction]:!1,[De.SearchingRedaction]:!1,[De.Annotation]:!1,[De.Form]:!1,[De.Signature]:!1};return n[e]?this.documentService.isDAP&&!r[e]?new _t("Error detail: Not supported in DAP"):(this.store$.dispatch(ue.set({key:"sideViewMode",value:e})),this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0})),null):new _t("Error detail: Unauthorized")}closeSideView(){return this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),null}toggleRightSideView(e){return this.rightSideViewVisible&&this.rightSideViewMode===e?this.closeRightSideView():this.openRightSideView(e)}openRightSideView(e){let n={[Rt.DAP]:!0,[Rt.TextSearch]:this.documentService.checkAuthority(Ne.SEARCH_TEXT),[Rt.AnnotProperty]:this.documentService.checkAuthority(Ne.EDIT_ANNOTATION)},r={[Rt.DAP]:!0,[Rt.TextSearch]:!0,[Rt.AnnotProperty]:!0};return n[e]?this.documentService.isDAP&&!r[e]?new _t("Error detail: Not supported in DAP"):!this.documentService.isDAP&&e===Rt.DAP?new _t("Error detail: Not supported in PDF"):(this.store$.dispatch(ue.set({key:"rightSideViewMode",value:e})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),null):new _t("Error detail: Unauthorized")}closeRightSideView(){return this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})),null}};N(t,"\u0275fac",function(n){return new(n||t)(Ue(ye),Ue(ct),Ue(Di))}),N(t,"\u0275prov",di({token:t,factory:t.\u0275fac}));let s=t;return s})();var Zo=(()=>{let t=class t{pageService;documentService;loggingService;store$;textSearchService;highlightInfoMapChange$;get highlightInfoMap(){return this._highlightInfoMap}highlightInfoMapChangeSrc=new Ti;_highlightInfoMap={};idPageIndexMap={};viewMode;pdfPages=[];constructor(e,n,r,c,g){this.pageService=e,this.documentService=n,this.loggingService=r,this.store$=c,this.textSearchService=g,this.highlightInfoMapChange$=this.highlightInfoMapChangeSrc.asObservable(),this.store$.pipe($("viewMode")).subscribe({next:v=>this.viewMode=v}),this.pageService.pdfPages$.subscribe({next:v=>this.pdfPages=v})}getExportableFunctions(){return[{name:"highlightRects",function:e=>{if(this.viewMode===4)throw this.loggingService.error(ac,"NOT_SUPPORTED_ON_EBOOK");if(!this.documentService.checkAuthority(Ne.ANNOTATION))throw this.loggingService.error(yo,"NO_AUTHORITY");let n=new wt(c=>{if(!w.isDefined(e.rects)||e.rects.length===0){c.next([]),c.complete();return}c.next(e.rects.map(g=>({id:this.appendRect(g.pageIndex,g.rect,g.color,g.opacity)}))),c.complete()}),r=w.isDefined(e.keywords)?bo(e.keywords).pipe(Ys(3),Xs(c=>zs(c.map(g=>{let{color:v,keyword:y,caseSensitive:M=!0,useRegex:V=!0,opacity:Z=.5,pageRange:le}=g,pe=le&&le!=="all"?Nn.parse(le,{min:0,max:this.pdfPages.length-1}):Array.from({length:this.pdfPages.length},(he,Te)=>Te);if(!w.isDefined(pe))throw new ci(`Failed to parse page range.
Input: "${le}", Total pages: ${this.pdfPages.length}`);return this.textSearchService.getSearchResult(this.documentService.openedDocument.streamdocsId,y,M,V,pe).pipe(Ve(he=>this.flattenSearchResults(he,v,Z)),Ve(he=>he.flatMap(Te=>({id:this.appendRect(Te.pageIndex,Te.rect,Te.color,Te.opacity)}))))}))),Ws(c=>bo(c)),_l()):ht([]);return xo([n,r]).pipe(pr(c=>{let g=c instanceof Error?c.message:String(c);throw new _t(`Error detail: ${g}`)}),Ve(([c,g])=>[...c,...g.flat()].sort((v,y)=>y.id-v.id)))}},{name:"unhighlightRects",function:e=>{if(this.viewMode===4)throw this.loggingService.error(ac,"NOT_SUPPORTED_ON_EBOOK");if(!this.documentService.checkAuthority(Ne.ANNOTATION))throw this.loggingService.error(yo,"NO_AUTHORITY");return e.rects.forEach(n=>this.removeRect(n.id)),ht(void 0)}}]}appendRect(e,n,r,c=.5){if(e<0||this.pdfPages.length-1<e)throw new Error("pageIndex is invalid");let{r:g,bbox:v}=this.pdfPages[e],{left:y,top:M,right:V,bottom:Z}=na.deviceRectToUser(n,g,v.w,v.h);if(y>V||Z>M)throw new Error("rect is invalid");M=Math.min(v.y+v.h,v.y+v.h-M),V=Math.min(v.x+v.w,V),Z=Math.max(v.y,v.y+v.h-Z),y=Math.max(v.x,y),this._highlightInfoMap[e]||(this._highlightInfoMap[e]=[]);let le=mp.getNewOid();return this.idPageIndexMap[le]=e,this._highlightInfoMap[e].push({id:le,path:`M ${y.toFixed(2)} ${M.toFixed(2)} L ${V.toFixed(2)} ${M.toFixed(2)} L ${V.toFixed(2)} ${Z.toFixed(2)} L ${y.toFixed(2)} ${Z.toFixed(2)} Z`,color:zl.applyOpacityToHex(r,c)}),this.highlightInfoMapChangeSrc.next({pageIndex:e}),le}removeRect(e){let n=this.idPageIndexMap[e];if(n===void 0)throw new Error("id is invalid");delete this.idPageIndexMap[e];let r=this.highlightInfoMap[n].findIndex(c=>c.id===e);if(r<0)throw new Error("id is invalid");this.highlightInfoMap[n].splice(r,1),this.highlightInfoMapChangeSrc.next({pageIndex:n})}flattenSearchResults(e,n,r=.5){return e.flatMap(c=>c.words.flatMap(g=>this.mergeKeywordRects(g.rects).map(v=>({rect:v,color:n,opacity:r,pageIndex:c.pageIdx}))))}mergeKeywordRects(e){let n=e.slice().sort((c,g)=>c.top-g.top||c.left-g.left),r=[];for(let c of n){let g=r[r.length-1];g&&Math.abs(g.top-c.top)<1&&Math.abs(g.bottom-c.bottom)<1&&c.left-g.right>=-1&&c.left-g.right<=1?(g.right=Math.max(g.right,c.right),g.left=Math.min(g.left,c.left),g.top=Math.max(g.top,c.top),g.bottom=Math.min(g.bottom,c.bottom)):r.push(si({},c))}return r}};N(t,"\u0275fac",function(n){return new(n||t)(Ue(zt),Ue(ct),Ue(Di),Ue(ye),Ue(io))}),N(t,"\u0275prov",di({token:t,factory:t.\u0275fac}));let s=t;return s})();var Xm=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[Zo]}}};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({}));let s=t;return s})();var Jt=function(s){return s[s.CREATING=0]="CREATING",s[s.EDITING=1]="EDITING",s[s.READY=2]="READY",s[s.NONE=3]="NONE",s}(Jt||{}),Mn=function(s){return s[s.DOWNLOAD=0]="DOWNLOAD",s[s.COPY=1]="COPY",s[s.EXPORT=2]="EXPORT",s}(Mn||{}),no=function(s){return s.LEFT="left",s.CENTER="center",s.RIGHT="right",s}(no||{}),oo=function(s){return s.TOP="top",s.MIDDLE="middle",s.BOTTOM="bottom",s}(oo||{}),fc=function(s){return s.PNG="png",s.JPEG="jpeg",s.WEBP="webp",s}(fc||{});var ji=(()=>{let t=class t{apiEventBridgeService;store$;MIN_BBOX_SIZE=20;INITIAL_CAPTURED_AREA={bbox:{x:0,y:0,w:0,h:0},pageIndex:-1,status:Jt.NONE};lastestMousePositionSrc=new Ti;lastestMousePosition$=this.lastestMousePositionSrc.asObservable();capturedAreaSrc=new Ht(this.INITIAL_CAPTURED_AREA);capturedArea$=this.capturedAreaSrc.asObservable();get capturedArea(){return this.capturedAreaSrc.getValue()}captureActionSrc=new Ti;captureAction$=this.captureActionSrc.asObservable();readyToExportSrc=new Ht(!1);readyToExport$=this.readyToExportSrc.asObservable();constructor(e,n){this.apiEventBridgeService=e,this.store$=n,this.store$.pipe($("isCaptureMode"),F(r=>!r)).subscribe({next:()=>{this.apiEventBridgeService.captureExportedSrc.next({ok:!1,error:new Hl("User cancelled a capture.")}),this.fireReadyToExport(!1),this.capturedAreaSrc.next(this.INITIAL_CAPTURED_AREA)}})}getExportableFunctions(){return[{name:"selectAndExportCapture",function:()=>(G.nativeWindow.focus(),this.store$.dispatch(ue.set({key:"isCaptureMode",value:!0})),this.readyToExport$.pipe(F(e=>e)).subscribe({next:()=>this.fireCaptureAction(Mn.EXPORT)}),this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.captureExportedSrc))}]}publishCapture(e){this.capturedAreaSrc.next(e)}updateCaptureBBox(e){this.capturedAreaSrc.next(Rr(si({},this.capturedArea),{bbox:e}))}updateCaptureStatus(e){this.capturedAreaSrc.next(Rr(si({},this.capturedArea),{status:e}))}publishLastestMousePosition(e){this.lastestMousePositionSrc.next(e)}fireReadyToExport(e){this.readyToExportSrc.next(e)}fireCaptureAction(e){this.captureActionSrc.next(e)}};N(t,"\u0275fac",function(n){return new(n||t)(Ue(Qt),Ue(ye))}),N(t,"\u0275prov",di({token:t,factory:t.\u0275fac}));let s=t;return s})();var qp=(()=>{let t=class t{captureService;subscriptionService;changeDetectorRef;store$;translatePipe;showFloating=!0;showButton=!1;get isSecureContext(){return G.nativeWindow.isSecureContext}get copyToClipboardText(){return G.isSmallWidth()?this.translatePipe.transform("CAPTURE_EXPORT_TO_CLIPBOARD"):`${this.translatePipe.transform("CAPTURE_EXPORT_TO_CLIPBOARD")}
      (${ei.getShortcutString({ctrlKey:!0,shiftKey:!1,altKey:!1,key:"c"})})`}constructor(e,n,r,c,g){this.captureService=e,this.subscriptionService=n,this.changeDetectorRef=r,this.store$=c,this.translatePipe=g}ngOnInit(){this.subscriptionService.push(this.captureService.capturedArea$.subscribe({next:e=>{this.showFloating=e.status===Jt.READY||e.status===Jt.NONE,this.showButton=e.status===Jt.READY,this.changeDetectorRef.markForCheck()}}),Ge(G.nativeWindow,"keydown").subscribe({next:e=>{e.key==="Escape"&&this.exitCaptureMode()}}),G.windowResize$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}exitCaptureMode(){this.store$.dispatch(ue.set({key:"isCaptureMode",value:!1}))}onClickCopy(){this.captureService.fireCaptureAction(Mn.COPY)}onClickDownload(){this.captureService.fireCaptureAction(Mn.DOWNLOAD)}};N(t,"\u0275fac",function(n){return new(n||t)(_(ji),_(ee),_(Ae),_(ye),_(He))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-backdrop"]],standalone:!1,features:[xe([ee])],decls:1,vars:0,consts:[[1,"capture-backdrop"]],template:function(n,r){n&1&&Q(0,"div",0)},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}.capture-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:4;background-color:#1e1e1e40}.capture-floating[_ngcontent-%COMP%]{padding:14px 20px;display:flex;gap:12px;height:44px;align-items:center;position:fixed;top:54px;left:50%;background-color:var(--mono-00);border:1px solid var(--mono-30);border-radius:21px;box-sizing:border-box;transform:translate(-50%);z-index:5;cursor:default}.capture-floating[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{width:1px;height:24px;background-color:var(--mono-30)}.capture-floating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;cursor:pointer}.capture-floating[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--mono-70);font-size:15px;font-weight:500;white-space:pre}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]{padding:4px 8px;display:flex;gap:4px;color:var(--mono-99);background-color:var(--mono-00)}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]:hover{background-color:var(--mono-30)}"],changeDetection:0}));let s=t;return s})();function Dh(s,t){if(s&1&&Q(0,"sd-capture-edit",0),s&2){let i=E();O("pdfPage",i.pdfPage)}}function Nh(s,t){if(s&1&&Q(0,"sd-capture-create",0),s&2){let i=E();O("pdfPage",i.pdfPage)}}var xa=(()=>{let t=class t{subscriptionService;captureService;renderingService;documentService;renderer;toastService;translatePipe;changeDetectorRef;store$;loggingService;annotService;acroFormService;pageService;apiEventBridgeService;EXPORT_IMAGE_TYPE=fc.PNG;pdfPage;annot;pdfInfo=null;degree;isCreated=!1;capturedArea=null;drawTool={sdImage:null,imgEl:null,annots:[]};readyPdfImageSrc=new Ht(!1);readyPdfImage$=this.readyPdfImageSrc.asObservable();get readyPdfImage(){return this.readyPdfImageSrc.getValue()}constructor(e,n,r,c,g,v,y,M,V,Z,le,pe,he,Te){this.subscriptionService=e,this.captureService=n,this.renderingService=r,this.documentService=c,this.renderer=g,this.toastService=v,this.translatePipe=y,this.changeDetectorRef=M,this.store$=V,this.loggingService=Z,this.annotService=le,this.acroFormService=pe,this.pageService=he,this.apiEventBridgeService=Te}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),this.captureService.capturedArea$.pipe(rt(e=>{this.isCreated=e.status!==Jt.CREATING&&e.status!==Jt.NONE}),F(e=>e.pageIndex===this.pdfPage.i)).subscribe({next:e=>{this.capturedArea=e,this.changeDetectorRef.markForCheck()}}),this.captureService.capturedArea$.pipe(F(e=>e.pageIndex===this.pdfPage.i&&e.status===Jt.READY),en(1),st(()=>w.isDefined(this.documentService.openedDocument)?xo([this.renderingService.fetchImage(this.documentService.openedDocument.streamdocsId,this.pdfPage.ref,{jpegQuality:hp.HIGH,increasePrint:!1,renderAnnots:!1,zoom:Ze.captureImageScale}).pipe(Ve(e=>{if(!w.isDefined(e.data))throw new _t("Cannot handle image data");switch(e.type){case"BLOB":return URL.createObjectURL(e.data);case"BASE64":return e.data;default:throw new _t("Cannot handle image data")}})),this.store$.pipe(Yo("ALL"),Ve(e=>kn.filterChanges(e,n=>n.allowView?n.range==="all"?!0:!!Nn.parse(n.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(this.pdfPage.i):!1)),Ve(e=>kn.flattenWatermarks(e)))]):Gn(()=>new _t("No opened document."))),st(([e,n])=>new Ur({imgSrc:e,width:this.pdfPage.bbox.w,height:this.pdfPage.bbox.h,rotation:this.pdfPage.r},n).draw()),rt(e=>{this.drawTool.imgEl=document.createElement("img"),this.drawTool.sdImage=new dp(this.drawTool.imgEl,this.renderer,e,!0),this.drawTool.imgEl.addEventListener("load",()=>this.readyPdfImageSrc.next(!0)),this.drawTool.sdImage.render()})).subscribe(),this.captureService.captureAction$.pipe(F(()=>w.isDefined(this.capturedArea)&&this.readyPdfImage),en(1),st(e=>this.exportCapture(e)),Xn(()=>this.store$.dispatch(ue.set({key:"isCaptureMode",value:!1})))).subscribe({error:e=>{console.error(e),this.apiEventBridgeService.captureExportedSrc.next({ok:!1,error:new _t("Failed to export capture")})}}),this.documentService.pdfInfo$.subscribe({next:e=>this.pdfInfo=e}),this.readyPdfImage$.pipe(F(e=>e)).subscribe({next:()=>this.annotCompToImage(this.annot.editableComps?.filter(e=>w.isDefined(e.data))??[])}))}ngOnDestroy(){this.clearImage(),this.exitCaptureModeIfTargetDestroyed()}exportCapture(e){return new wt(n=>{let r=this.getCapturedImage();if(!w.isDefined(r)){this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("CAPTURE_FAILURE"),content:this.translatePipe.transform("CAPTURE_IMAGE_LOADING")}),n.next(!1),n.complete();return}switch(e){case Mn.COPY:let c=cc.base64ToBlob(r),g=()=>{this.toastService.create({toastStyle:Wt.FAILURE,header:this.translatePipe.transform("CAPTURE_FAILURE"),content:this.translatePipe.transform("NO_CLIPBOARD_AUTHORITY")}),n.next(!1),n.complete()},v=()=>{this.toastService.create({toastStyle:Wt.SUCCESS,header:this.translatePipe.transform("CAPTURE_SUCCESS"),content:this.translatePipe.transform("CAPTURE_EXPORT_SUCCESS_CLIPBOARD")}),n.next(!0),n.complete()};G.copyToClipboard("",void 0,{blob:c,type:`image/${this.EXPORT_IMAGE_TYPE}`},v,g);break;case Mn.DOWNLOAD:let y=document.createElement("a");y.href=r,y.download=`${this.pdfInfo.FileName}_${this.pdfPage.i+1}.${this.EXPORT_IMAGE_TYPE}`,y.click(),this.toastService.create({toastStyle:Wt.SUCCESS,header:this.translatePipe.transform("CAPTURE_SUCCESS"),content:this.translatePipe.transform("CAPTURE_EXPORT_SUCCESS_FILE")}),n.next(!0),n.complete();break;case Mn.EXPORT:bo(cc.base64ToBlob(r).arrayBuffer()).subscribe({next:M=>{this.apiEventBridgeService.captureExportedSrc.next({ok:!0,data:{imageBytes:new Uint8Array(M)}}),n.next(!0),n.complete()},error:M=>{console.error(M),this.apiEventBridgeService.captureExportedSrc.next({ok:!1,error:new _t("Failed to export capture")}),n.next(!1),n.complete()}});break}})}getCapturedImage(){if(!w.isDefined(this.capturedArea))return null;let e=document.createElement("canvas"),n=e.getContext("2d");return w.isDefined(n)?(this.drawImage(e),this.drawAnnots(e),e.toDataURL(`image/${this.EXPORT_IMAGE_TYPE}`)):(this.loggingService.common("debug",Le.NOT_EXIST,"Failed to get CanvasRenderingContext2D"),null)}drawImage(e){let n=e.getContext("2d");if(!w.isDefined(n)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D");return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl");return}if(!w.isDefined(this.capturedArea)){this.loggingService.common("debug",Le.NOT_EXIST,"capturedArea");return}let r=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,c=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,g=(this.degree+this.pdfPage.r)%360,v=g/90%2===1,y=this.capturedArea.bbox.w*r,M=this.capturedArea.bbox.h*c;e.width=v?M:y,e.height=v?y:M,n.save(),n.translate(e.width/2,e.height/2),n.rotate(g*Math.PI/180),n.drawImage(this.drawTool.imgEl,this.capturedArea.bbox.x*r,this.capturedArea.bbox.y*c,this.capturedArea.bbox.w*r,this.capturedArea.bbox.h*c,-y/2,-M/2,y,M),n.restore()}drawAnnots(e){let n=e.getContext("2d");if(!w.isDefined(n)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D");return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl");return}let r=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,c=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h;this.drawTool.annots.sort((y,M)=>{let V=this.annot.oidToZIndexMap;return Number(V[y.oid])-Number(V[M.oid])});let g=(this.degree+this.pdfPage.r)%360,v=g/90%2===1;n.save(),n.translate(e.width/2,e.height/2),n.rotate(g*Math.PI/180),n.translate(v?-e.height/2:-e.width/2,v?-e.width/2:-e.height/2),this.drawTool.annots.forEach(y=>{if(!w.isDefined(this.capturedArea)){this.loggingService.common("debug",Le.NOT_EXIST,"capturedArea");return}let{canvas:M,point:V}=y,Z=(V.x-this.capturedArea.bbox.x)*r,le=(V.y-this.capturedArea.bbox.y)*c,pe=n.globalCompositeOperation;y.composite&&(n.globalCompositeOperation=y.composite),n.drawImage(M,0,0,M.width,M.height,Z,le,M.width,M.height),n.globalCompositeOperation=pe}),n.restore()}annotCompToImage(e){if(this.drawTool.annots.splice(0),e.length===0){this.captureService.fireReadyToExport(!0);return}xo(e.map(n=>w.isDefined(n.data)?(Vt.isWidget(n.data)&&!(Vt.isRadioWidgetComponent(n)||Vt.isCheckBoxComponent(n))?w.isDefined(n.data.attributes.appearance)&&!this.isWidgetEdited(n):w.isDefined(n.data.attributes.appearance))?this.createAnnotImageUsingAP(n):this.createAnnotImageUsingAttribute(n):ht())).pipe(Xn(()=>this.captureService.fireReadyToExport(!0))).subscribe()}createAnnotImageUsingAttribute(e){switch(e.data.type){case"Ink":case"Circle":case"Highlight":case"Underline":case"StrikeOut":case"Line":case"Link":case"Polygon":case"PolyLine":case"Redact":case"Square":case"FreeText":return this.createAnnotImageUsingSVG(e);case"Widget":return this.createAnnotImageUsingAcroForm(e);case"Text":return this.createAnnotImageUsingIcon(e)}return ht()}createAnnotImageUsingSVG(e){return new wt(n=>{let r=document.createElement("canvas"),c=r.getContext("2d");if(!w.isDefined(c)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let g=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,v=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,{rect:y}=e.data.attributes;if(r.width=Math.abs(y.left-y.right)*g,r.height=Math.abs(y.top-y.bottom)*v,c.scale(g,v),(Vt.isFreeText(e.data)||Vt.isFreeTextCallout(e.data))&&this.drawFreeTextContent(r,e.data),!w.isDefined(e.elementRef)){this.loggingService.common("debug",Le.NOT_EXIST,"elementRef"),n.error();return}e.elementRef.nativeElement.querySelectorAll("svg").forEach(M=>{let Z=new XMLSerializer().serializeToString(M).replace(/url\([^\#]*\#([^\)]+)\)/g,"url(#$1)").replace(/xlink:href="[^#]*#([^"]+)"/,'xlink:href="#$1"'),le=new Image,pe=new Blob([Z],{type:"image/svg+xml"}),he=URL.createObjectURL(pe);le.addEventListener("load",()=>{c.drawImage(le,0,0);let Te=this.drawTool.annots.findIndex(dt=>dt.oid===e.data.oid),p={canvas:r,oid:e.data.oid,point:{x:y.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-y.top},composite:Vt.isTextMarkup(e.data)?"multiply":void 0};Te<0?this.drawTool.annots.push(p):this.drawTool.annots.splice(Te,1,p),n.next(),n.complete()}),le.src=he})})}createAnnotImageUsingAcroForm(e){return new wt(n=>{if(!w.isDefined(e.acroField)){n.error();return}let r=document.createElement("canvas"),c=r.getContext("2d");if(!w.isDefined(c)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let{rect:g}=e.data.attributes,v={x:0,y:0,w:0,h:0,border:0,margin:0,ratio:{width:1,height:1}},y=0,M=!1;if(v.ratio.width=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,v.ratio.height=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,v.w=Math.abs(g.left-g.right),v.h=Math.abs(g.top-g.bottom),r.width=v.w*v.ratio.width,r.height=v.h*v.ratio.height,c.scale(v.ratio.width,v.ratio.height),w.isDefined(e.data.attributes.MK)){let{backgroundColor:V,borderColor:Z,R:le}=e.data.attributes.MK,{width:pe}=e.data.attributes;if(w.isDefined(le)&&(y=-le,M=le/90%2===1),w.isDefined(V)&&(c.save(),c.fillStyle=V,c.fillRect(0,0,r.width,r.height),c.fill(),c.restore()),w.isDefined(Z)){let he=pe??1;v.border=he,c.save(),c.strokeStyle=Z,c.lineWidth=he,c.moveTo(0,he/2),c.lineTo(r.width-he/2,he/2),c.lineTo(r.width-he/2,r.height-he/2),c.lineTo(he/2,r.height-he/2),c.lineTo(he/2,he/2),c.stroke(),c.restore()}}if(M&&([v.x,v.y,v.w,v.h]=[v.y,v.x,v.h,v.w]),Vt.isTextFieldComponent(e)){let{V,Ff:Z}=e.acroField;if(w.isDefined(V)){let{alignment:le,fontSize:pe,fontName:he,fontColor:Te}=e.data.attributes,p=w.isDefined(Z)?gr.get(Z,12):!1;this.drawText(r,V,v,{alignment:this.isAlignment(le)?le:no.LEFT,baseline:p?oo.TOP:oo.MIDDLE,font:{color:Te,name:he,size:pe},isMultiLine:p,rotate:y})}}else if(Vt.isComboBoxComponent(e)){let{I:V,Opt:Z}=e.acroField;if(Array.isArray(V)&&Array.isArray(Z)){let pe=(Z[V[0]]??[])[1];if(w.isDefined(pe)){let{fontSize:he,fontColor:Te,fontName:p}=e.data.attributes;this.drawText(r,pe,v,{alignment:no.LEFT,baseline:oo.MIDDLE,font:{color:Te,name:p,size:he},isMultiLine:!1,rotate:y})}}}else if(Vt.isListBoxComponent(e)){let{I:V,Opt:Z}=e.acroField,{fontSize:le,fontName:pe,fontColor:he}=e.data.attributes;Array.isArray(V)&&Array.isArray(Z)&&(v.h=le+5,v.border=0,v.margin=5/2,Z.forEach(([p,dt],vt)=>{let gt=vt===V[0];w.isDefined(dt)&&(v.y=(5+le)*vt,this.drawText(r,dt,v,{alignment:no.LEFT,baseline:oo.MIDDLE,font:{color:gt?"#fff":he,name:pe,size:le},isMultiLine:!1,backgroundColor:gt?"#4D90FE":void 0,rotate:y}))}))}this.drawTool.annots.push({canvas:r,oid:e.data.oid,point:{x:g.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-g.top}}),n.next(),n.complete()})}createAnnotImageUsingIcon(e){return new wt(n=>{let r=e.elementRef?.nativeElement.querySelector(".papycon"),c=1.5;if(!w.isDefined(r)){this.loggingService.common("debug",Le.NOT_EXIST,"Not Exist Icon HTMLElement."),n.error();return}let g=document.createElement("canvas"),v=g.getContext("2d");if(!w.isDefined(v)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let{rect:y}=e.data.attributes,M=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,V=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h;g.width=(Math.abs(y.left-y.right)+c*2)*M,g.height=(Math.abs(y.top-y.bottom)+c*2)*V,v.scale(M,V);let{fontFamily:Z,fontSize:le,content:pe,color:he,textShadow:Te}=window.getComputedStyle(r,"::before"),p=pe.replaceAll('"',""),dt=c,vt=Math.floor(c)+Number(le.replace("px",""));if(v.font=`${le} ${Z}`,v.textBaseline="bottom",w.isDefined(Te)){let gt=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)\s*(-?\d+(?:\.\d+)?)px\s*(-?\d+(?:\.\d+)?)px\s*(-?\d+(?:\.\d+)?)px/g,Mi=Array.from(Te.matchAll(gt),At=>({color:`rgb(${At[1]}, ${At[2]}, ${At[3]})`,offsetX:Number.parseFloat(At[4]),offsetY:Number.parseFloat(At[5]),blur:Number.parseFloat(At[6])}));v.save(),Mi.forEach(At=>{v.shadowOffsetX=At.offsetX,v.shadowOffsetY=At.offsetY,v.shadowBlur=At.blur,v.shadowColor=At.color,v.fillText(p,dt,vt)}),v.restore()}v.fillStyle=he,v.fillText(p,dt,vt),this.drawTool.annots.push({canvas:g,oid:e.data.oid,point:{x:y.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-y.top}}),n.next(),n.complete()})}createAnnotImageUsingAP(e){return new wt(n=>{let{appearance:r,rect:c}=e.data.attributes,g={data:null,format:null};if(Array.isArray(r)){let M=r.find(V=>V.state===e.acroField?.V)??r.find(V=>V.state==="Off");if(!w.isDefined(M)){this.loggingService.common("debug",Le.INVALID,"appearance"),n.error();return}g.data=M.data,g.format=M.format}else g.data=r?.data??null,g.format=r?.format??null;if(!w.isDefined(g.data)){this.loggingService.common("debug",Le.INVALID,"appearance data"),n.error();return}let v=`data:image/${g.format};base64,${g.data}`,y=new Image;y.addEventListener("load",()=>{let M=document.createElement("canvas"),V=M.getContext("2d");if(!w.isDefined(V)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let Z=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,le=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,pe=Math.abs(c.left-c.right),he=Math.abs(c.top-c.bottom),Te=e.data.type.toLowerCase(),p=Jn.hasKey(gc,Te)?gc[Te]:1;M.width=pe*Z,M.height=he*le,V.scale(Z,le),V.globalAlpha=e.data.attributes.opacity??p,V.drawImage(y,0,0,pe,he),this.drawTool.annots.push({canvas:M,oid:e.data.oid,point:{x:c.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-c.top},composite:Vt.isTextMarkup(e.data)?"multiply":void 0}),n.next(),n.complete()}),y.src=v})}drawFreeTextContent(e,n){let{textRect:r,contentsRichtext:c,width:g,color:v,rect:y,Rotate:M}=n.attributes,V={x:0,y:0,w:0,h:0,border:g,margin:0,ratio:{width:1,height:1}},Z=M/90%2===1;if(w.isDefined(r)?(V.x=Math.max(Math.abs(r.left-y.left),Math.abs(r.right-y.right)),V.y=Math.max(Math.abs(r.top-y.top),Math.abs(r.bottom-y.bottom)),V.w=Math.abs(r.right-r.left),V.h=Math.abs(r.bottom-r.top)):(V.w=Math.abs(y.right-y.left),V.h=Math.abs(y.bottom-y.top)),Z&&([V.x,V.y,V.w,V.h]=[V.y,V.x,V.h,V.w]),!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl");return}let le=c.fontSize/10;V.margin=Math.min(g*4,Math.min(V.w,V.h))/2/le,V.ratio.width=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,V.ratio.height=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,this.drawText(e,c.text,V,{baseline:oo.TOP,alignment:no.LEFT,backgroundColor:v,isMultiLine:!0,rotate:-M,font:{size:c.fontSize,color:c.fontColor,name:c.fontName}})}drawText(e,n,r,c){let g=he=>!ei.isEnglish(he)&&!ei.isNumber(he)&&!ei.isSpecialCharacters(he,["s","-","?"]),v=e.getContext("2d");if(!w.isDefined(v)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D");return}let y=new Path2D,M=[],V=Math.abs(c.rotate)/90%2===1,Z={word:"",line:[]};if(v.save(),v.fillStyle=c.font.color,v.font=`${c.font.size}px ${c.font.name}`,v.textAlign=c.alignment,v.textBaseline=c.baseline,c.isMultiLine){for(let he of n){if(he===`
`){Z.word.length>0&&(Z.line.push(Z.word),Z.word=""),M.push(Z.line),Z.line=[];continue}else Z.word+=he;let Te=Z.line.reduce((p,dt)=>p+dt,"").concat(Z.word);if(v.measureText(Te).width+r.margin*2+r.border*2>=r.w){if(Z.line.length===0){M.push([Z.word.slice(0,-1)]),Z.word=he;continue}M.push(Z.line),Z.line=[],v.measureText(Z.word).width+r.margin*2+r.border*2>=r.w&&(M.push([Z.word.slice(0,-1)]),Z.word=he)}g(he)&&(Z.line.push(Z.word),Z.word="")}Z.word.length>0&&Z.line.push(Z.word),Z.line.length>0&&M.push(Z.line)}else M.push([n]);let le=e.width/r.ratio.width,pe=e.height/r.ratio.height;v.translate(le/2,pe/2),v.rotate(c.rotate*Math.PI/180),v.translate(V?-pe/2:-le/2,V?-le/2:-pe/2),y.rect(r.x,r.y,r.w,r.h),v.clip(y),w.isDefined(c.backgroundColor)&&(v.save(),v.fillStyle=c.backgroundColor,v.rect(r.x,r.y,r.w,r.h),v.fill(),v.restore()),M.forEach((he,Te)=>{let p=he.reduce((gt,Mi)=>gt+Mi,""),dt=this.getTextDeltaX(c.alignment,r.border+r.margin,r.w),vt=this.getTextDeltaY(c.baseline,r.border+r.margin,r.h,M.length,c.font.size,Te);v.fillText(p,r.x+dt,r.y+vt)}),v.restore()}getTextDeltaX(e,n,r){switch(e){case no.LEFT:return n;case no.CENTER:return r/2;case no.RIGHT:return r}}getTextDeltaY(e,n,r,c,g,v){let y=v+1;switch(e){case oo.TOP:return n+v*g;case oo.MIDDLE:let M=r/2,V=(c+1)/2,Z=(y-V)*g;if(c%2===0){let le=Math.abs(y-V)<1,pe=y<V;return le?M+(pe?-g/2:g/2):M+Z}return M+Z;case oo.BOTTOM:return r-n-(c-y)*g}}isAlignment(e){return Object.values(no).some(n=>n===e)}isWidgetEdited(e){if(e.data.attributes.Parent<0)return!0;let r=this.annotService.getActionLogAnnots(e.data.attributes.pageIdx).findIndex(y=>y.oid===e.data.oid)>-1,c=e.acroField?.V??e.data.attributes.V,g=this.acroFormService.lastFetchedAcroFields?.get(e.data.attributes.Parent)?.V,v=JSON.stringify(c)!==JSON.stringify(g);return r||v}clearImage(){w.isDefined(this.drawTool.sdImage)&&(this.drawTool.sdImage.destroy(!0),this.drawTool.sdImage=null)}exitCaptureModeIfTargetDestroyed(){!w.isDefined(this.capturedArea)||w.isDefined(this.capturedArea)&&this.capturedArea.pageIndex!==this.pdfPage.i||this.store$.dispatch(ue.set({key:"isCaptureMode",value:!1}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(ee),_(ji),_(jo),_(ct),_($t),_(an),_(He),_(Ae),_(ye),_(Di),_(ri),_(En),_(zt),_(Qt))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-tool"]],inputs:{pdfPage:"pdfPage",annot:"annot"},standalone:!1,features:[xe([ee])],decls:3,vars:2,consts:[[3,"pdfPage"],[3,"pageIndex"]],template:function(n,r){n&1&&(se(0,Dh,1,1,"sd-capture-edit",0)(1,Nh,1,1,"sd-capture-create",0),Q(2,"sd-capture-overlay",1)),n&2&&(Kt(r.isCreated?0:1),x(2),O("pageIndex",r.pdfPage.i))},encapsulation:2,changeDetection:0}));let s=t;return s})();var Vh=["dragArea"],Qp=(()=>{let t=class t{subscriptionService;captureService;store$;dragAreaRef;pdfPage;scale;degree;mainSub=[];point=null;layout={};constructor(e,n,r){this.subscriptionService=e,this.captureService=n,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:e=>this.scale=e}),this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),ut(Ge(this.dragAreaRef.nativeElement,"mousemove").pipe(Ve(e=>({point:{x:e.offsetX,y:e.offsetY},pageIndex:this.pdfPage.i}))),Ge(this.dragAreaRef.nativeElement,"mouseenter").pipe(Ve(e=>({point:{x:e.offsetX,y:e.offsetY},pageIndex:this.pdfPage.i}))),Ge(this.dragAreaRef.nativeElement,"mouseleave").pipe(Ve(()=>null))).subscribe({next:e=>this.captureService.publishLastestMousePosition(e)})),J.bindLayoutOrder(this.layout,J.LayoutOrder.Capture)}ngOnDestroy(){this.captureService.publishLastestMousePosition(null),this.point=null}createMover(e){e.preventDefault(),e.stopPropagation();let n=e.type.startsWith("touch"),r=this.ensureMouseEvent(e);this.point={start:{x:r.offsetX,y:r.offsetY},end:{x:r.offsetX,y:r.offsetY}};let c={bbox:{x:Math.min(this.point.start.x,this.point.end.x),y:Math.min(this.point.start.y,this.point.end.y),w:Math.abs(this.point.start.x-this.point.end.x),h:Math.abs(this.point.start.y-this.point.end.y)},pageIndex:this.pdfPage.i,status:Jt.CREATING};if(this.captureService.publishCapture(c),n){this.captureService.publishLastestMousePosition({point:{x:r.offsetX,y:r.offsetY},pageIndex:this.pdfPage.i}),this.mainSub.push(Ge(this.dragAreaRef.nativeElement,"touchmove").subscribe({next:g=>{let v=this.ensureMouseEvent(g);this.captureService.publishLastestMousePosition({point:{x:v.offsetX,y:v.offsetY},pageIndex:this.pdfPage.i}),this.onMouseMove(v)}}),Ge(this.dragAreaRef.nativeElement,"touchend").subscribe({next:g=>{let v=this.ensureMouseEvent(g);this.captureService.publishLastestMousePosition({point:{x:v.offsetX,y:v.offsetY},pageIndex:this.pdfPage.i}),this.onMouseUp(this.ensureMouseEvent(g))}}));return}this.mainSub.push(Ge(this.dragAreaRef.nativeElement,"mousemove").subscribe({next:g=>this.onMouseMove(g)}),Ge(this.dragAreaRef.nativeElement,"mouseup").subscribe({next:g=>this.onMouseUp(g)}))}onMouseMove(e){if(!w.isDefined(this.point))throw new ci("point is not initialized. Call createMover() first.");e.stopPropagation(),this.point.end.x=Math.max(0,Math.min(e.offsetX,this.pdfPage.bbox.x+this.pdfPage.bbox.w)),this.point.end.y=Math.max(0,Math.min(e.offsetY,this.pdfPage.bbox.y+this.pdfPage.bbox.h)),this.captureService.updateCaptureBBox({x:Math.min(this.point.start.x,this.point.end.x),y:Math.min(this.point.start.y,this.point.end.y),w:Math.abs(this.point.start.x-this.point.end.x),h:Math.abs(this.point.start.y-this.point.end.y)})}onMouseUp(e){if(!w.isDefined(this.point))throw new ci("point is not initialized. Call createMover() first.");e.stopPropagation(),this.point.end.x=e.offsetX,this.point.end.y=e.offsetY;let n=this.captureService.MIN_BBOX_SIZE,r=Math.abs(this.point.start.x-this.point.end.x)<n||Math.abs(this.point.start.y-this.point.end.y)<n;this.captureService.updateCaptureStatus(r?Jt.NONE:Jt.READY),this.mainSub.forEach(c=>c.unsubscribe()),this.mainSub.splice(0)}onMouseLeave(e){this.mainSub.length!==0&&this.onMouseUp(e)}ensureMouseEvent(e){return w.ensureMouseEvent(e,this.degree,this.scale,this.pdfPage,this.dragAreaRef.nativeElement)}};N(t,"\u0275fac",function(n){return new(n||t)(_(ee),_(ji),_(ye))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-create"]],viewQuery:function(n,r){if(n&1&&Ye(Vh,7),n&2){let c;Me(c=Re())&&(r.dragAreaRef=c.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([ee])],decls:2,vars:1,consts:[["dragArea",""],[1,"capture-drag-area",3,"mousedown","mouseleave","touchstart","ngStyle"]],template:function(n,r){if(n&1){let c=Se();A(0,"div",1,0),ce("mousedown",function(v){return W(c),z(r.createMover(v))})("mouseleave",function(v){return W(c),z(r.onMouseLeave(v))})("touchstart",function(v){return W(c),z(r.createMover(v))}),D()}n&2&&O("ngStyle",r.layout)},dependencies:[qt],styles:[".capture-drag-area[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:2;cursor:none}"],changeDetection:0}));let s=t;return s})();var Lh=["captureEdit"];function Fh(s,t){if(s&1){let i=Se();Oi(),A(0,"rect",5),ce("mousedown",function(n){let r=W(i).index,c=E(2);return z(c.createMover(n,r))})("touchstart",function(n){let r=W(i).index,c=E(2);return z(c.createMover(n,r))}),D()}if(s&2){let i=t.$implicit,e=t.index,n=E(2);nn("cursor",n.cursorStyle(e)),ge("x",i.x)("y",i.y)("rx",n.vertex.style.width/2)("ry",n.vertex.style.height/2)("width",n.vertex.style.width)("height",n.vertex.style.height)("stroke-width",n.vertex.stroke)}}function Bh(s,t){if(s&1){let i=Se();Oi(),A(0,"g")(1,"rect",3),ce("mousedown",function(n){W(i);let r=E();return z(r.createMover(n))})("touchstart",function(n){W(i);let r=E();return z(r.createMover(n))}),D(),se(2,Fh,1,9,"rect",4),D()}if(s&2){let i=E();x(),ge("stroke-width",i.vertex.stroke)("x",i.capturedArea.bbox.x)("y",i.capturedArea.bbox.y)("width",i.capturedArea.bbox.w)("height",i.capturedArea.bbox.h),x(),O("ngForOf",i.vertex.coords)}}var Zp=(()=>{let t=class t{subscriptionService;captureService;changeDetectorRef;store$;DEFAULT_VERTEX_SIZE=9;DEFAULT_STROKE_WIDTH=2;captureEditRef;pdfPage;degree;scale;style={layout:{width:null,height:null}};vertex={size:this.DEFAULT_VERTEX_SIZE,style:{width:this.DEFAULT_VERTEX_SIZE,height:this.DEFAULT_VERTEX_SIZE},stroke:this.DEFAULT_STROKE_WIDTH,coords:[]};moverSub=[];capturedArea;constructor(e,n,r,c){this.subscriptionService=e,this.captureService=n,this.changeDetectorRef=r,this.store$=c}ngOnInit(){this.style.layout.width=`${this.pdfPage.bbox.w+this.pdfPage.bbox.x}px`,this.style.layout.height=`${this.pdfPage.bbox.h+this.pdfPage.bbox.y}px`,this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:e=>{this.scale=e,this.render()}}),this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),this.captureService.capturedArea$.pipe(F(e=>this.pdfPage.i===e.pageIndex)).subscribe({next:e=>{this.capturedArea=e,this.render(),this.changeDetectorRef.markForCheck()}}),Ge(G.nativeWindow,"copy").pipe(F(()=>w.isDefined(this.capturedArea))).subscribe({next:e=>{e.preventDefault(),this.captureService.fireCaptureAction(Mn.COPY)}})),J.bindLayoutOrder(this.style.layout,J.LayoutOrder.Capture)}ngOnDestroy(){this.moverSub.forEach(e=>e.unsubscribe())}cursorStyle(e){let n=(this.pdfPage.r+this.degree+360)%360;return Ar.resizeCursorOf(!0,e,n)}renderVertex(e){let n=this.createRectVertices(e,this.vertex.size);if(this.vertex.coords.length===0){this.vertex.coords=n;return}this.vertex.coords.forEach((r,c)=>{r.x=n[c].x,r.y=n[c].y})}createRectVertices(e,n){let r=n/2,[c,g,v]=[-r,e.h/2-r,e.w/2-r],[y,M]=[e.w-r,e.h-r];return[{x:e.x+c,y:e.y+c},{x:e.x+c,y:e.y+g},{x:e.x+c,y:e.y+M},{x:e.x+v,y:e.y+M},{x:e.x+y,y:e.y+M},{x:e.x+y,y:e.y+g},{x:e.x+y,y:e.y+c},{x:e.x+v,y:e.y+c}]}createMover(e,n){e.preventDefault(),e.stopPropagation();let r=e.type.startsWith("touch"),c=this.ensureMouseEvent(e);this.moverSub.forEach(y=>y.unsubscribe()),this.moverSub.splice(0),this.captureService.updateCaptureStatus(Jt.EDITING);let g=w.isDefined(n)?this.moveVertex(c,n):this.moveBBox(c),v=()=>{this.captureService.updateCaptureStatus(Jt.READY),this.moverSub.forEach(y=>y.unsubscribe()),this.moverSub.splice(0)};if(r){this.moverSub.push(Ge(this.captureEditRef.nativeElement,"touchmove").subscribe({next:y=>{y.preventDefault(),g(this.ensureMouseEvent(y))}}),Ge(this.captureEditRef.nativeElement,"touchend").subscribe({next:()=>v()}));return}this.moverSub.push(Ge(this.captureEditRef.nativeElement,"mousemove").subscribe({next:y=>g(y)}),ut(Ge(this.captureEditRef.nativeElement,"mouseup"),Ge(this.captureEditRef.nativeElement,"mouseleave")).subscribe({next:()=>v()}))}moveVertex(e,n){let r={offsetX:e.offsetX,offsetY:e.offsetY};return c=>{if(!w.isDefined(this.capturedArea))return;let g=w.deepClone(this.capturedArea.bbox),v={x:c.offsetX-r.offsetX,y:c.offsetY-r.offsetY};switch(r.offsetX=c.offsetX,r.offsetY=c.offsetY,n){case Gt.TOP_LEFT:case Gt.TOP:case Gt.TOP_RIGHT:g.y+v.y>=0&&(g.y+=v.y,g.h-=v.y);break;default:break}switch(n){case Gt.LEFT:case Gt.TOP_LEFT:case Gt.BOTTOM_LEFT:g.x+v.x>=this.pdfPage.bbox.x&&(g.x+=v.x,g.w-=v.x);break;default:break}switch(n){case Gt.BOTTOM:case Gt.BOTTOM_LEFT:case Gt.BOTTOM_RIGHT:g.y+g.h+v.y<=this.pdfPage.bbox.y+this.pdfPage.bbox.h&&(g.h+=v.y);break;default:break}switch(n){case Gt.RIGHT:case Gt.TOP_RIGHT:case Gt.BOTTOM_RIGHT:g.x+g.w+v.x<=this.pdfPage.bbox.x+this.pdfPage.bbox.w&&(g.w+=v.x);break;default:break}this.captureService.updateCaptureBBox(this.resizeBBox(g,n)),this.changeDetectorRef.markForCheck()}}moveBBox(e){let n={offsetX:e.offsetX,offsetY:e.offsetY};return r=>{let c={x:r.offsetX-n.offsetX,y:r.offsetY-n.offsetY};n.offsetX=r.offsetX,n.offsetY=r.offsetY;let g=w.deepClone(this.capturedArea.bbox);g.x+=c.x,g.y+=c.y,this.captureService.updateCaptureBBox(this.resizeBBox(g))}}resizeBBox(e,n){let r=this.captureService.MIN_BBOX_SIZE;switch(n){case Gt.TOP:case Gt.TOP_LEFT:case Gt.TOP_RIGHT:if(e.h<r){let c=r-e.h;e.y-=c,e.h+=c}break;default:break}switch(n){case Gt.LEFT:case Gt.TOP_LEFT:case Gt.BOTTOM_LEFT:if(e.w<r){let c=r-e.w;e.x-=c,e.w+=c}break;default:break}switch(n){case Gt.BOTTOM:case Gt.BOTTOM_LEFT:case Gt.BOTTOM_RIGHT:e.h<r&&(e.h=r);break;default:break}switch(n){case Gt.RIGHT:case Gt.TOP_RIGHT:case Gt.BOTTOM_RIGHT:e.w<r&&(e.w=r);break;default:break}if(e.x+e.w>this.pdfPage.bbox.x+this.pdfPage.bbox.w){let c=this.pdfPage.bbox.x+this.pdfPage.bbox.w-e.w;e.x=c}if(e.x<this.pdfPage.bbox.x&&(e.x=this.pdfPage.bbox.x),e.y+e.h>this.pdfPage.bbox.h){let c=this.pdfPage.bbox.y+this.pdfPage.bbox.h-e.h;e.y=c}return e.y<0&&(e.y=0),e}render(){!w.isDefined(this.capturedArea)||this.capturedArea.status===Jt.CREATING||this.capturedArea.status===Jt.NONE||(this.calcScale(),this.renderVertex(this.capturedArea.bbox),this.changeDetectorRef.markForCheck())}calcScale(){let e=J.normalizeScale(this.scale);this.vertex.size=Number((this.DEFAULT_VERTEX_SIZE/e).toFixed(1)),this.vertex.style.width=this.vertex.size,this.vertex.style.height=this.vertex.size,this.vertex.stroke=Number((this.DEFAULT_STROKE_WIDTH/e).toFixed(1))}ensureMouseEvent(e){return w.ensureMouseEvent(e,this.degree,this.scale,this.pdfPage,this.captureEditRef.nativeElement)}};N(t,"\u0275fac",function(n){return new(n||t)(_(ee),_(ji),_(Ae),_(ye))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-edit"]],viewQuery:function(n,r){if(n&1&&Ye(Lh,7),n&2){let c;Me(c=Re())&&(r.captureEditRef=c.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([ee])],decls:3,vars:2,consts:[["captureEdit",""],[3,"ngStyle"],[4,"ngIf"],[1,"bbox",3,"mousedown","touchstart"],["class","vertex",3,"cursor","mousedown","touchstart",4,"ngFor","ngForOf"],[1,"vertex",3,"mousedown","touchstart"]],template:function(n,r){n&1&&(Oi(),A(0,"svg",1,0),se(2,Bh,3,6,"g",2),D()),n&2&&(O("ngStyle",r.style.layout),x(2),O("ngIf",r.capturedArea))},dependencies:[yi,bt,qt],styles:["svg[_ngcontent-%COMP%]{position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none;width:100%;height:100%;cursor:default;overflow:visible;z-index:10}svg[_ngcontent-%COMP%]   rect.bbox[_ngcontent-%COMP%]{fill:#0000;stroke:var(--primary-50);cursor:move}svg[_ngcontent-%COMP%]   rect.vertex[_ngcontent-%COMP%]{fill:#fff;stroke:var(--primary-50);-webkit-user-select:none;user-select:none;font-size:12px}"],changeDetection:0}));let s=t;return s})();var Uh=["captureOverlay"],Hh=["captureClipPath"];function $h(s,t){if(s&1&&(Oi(),A(0,"g"),Q(1,"line",5)(2,"line",6),D()),s&2){let i=E();x(),ge("y1",i.lastestMousePosition.point.y)("y2",i.lastestMousePosition.point.y)("stroke-dashoffset",-(i.lastestMousePosition.point.x%8)-6)("stroke-width",i.crossHairLineWidth),x(),ge("x1",i.lastestMousePosition.point.x)("x2",i.lastestMousePosition.point.x)("stroke-dashoffset",-(i.lastestMousePosition.point.y%8)-6)("stroke-width",i.crossHairLineWidth)}}var Jp=(()=>{let t=class t{subscriptionService;captureService;changeDetectorRef;store$;CROSS_HAIR_LINE_WIDTH=2;pageIndex;captureOverlayRef;captureClipPathRef;lastestMousePosition=null;isCreated=!1;crossHairLineWidth=this.CROSS_HAIR_LINE_WIDTH;get showCrossHair(){return w.isDefined(this.lastestMousePosition)&&this.lastestMousePosition.pageIndex===this.pageIndex&&!this.isCreated}get clipPathId(){return`clip-path-${this.pageIndex}`}constructor(e,n,r,c){this.subscriptionService=e,this.captureService=n,this.changeDetectorRef=r,this.store$=c}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:e=>{this.crossHairLineWidth=this.CROSS_HAIR_LINE_WIDTH/J.normalizeScale(e),this.changeDetectorRef.markForCheck()}}),this.captureService.lastestMousePosition$.subscribe({next:e=>{this.lastestMousePosition=e,this.changeDetectorRef.markForCheck()}}),this.captureService.capturedArea$.pipe(F(e=>e.pageIndex===this.pageIndex),rt(e=>{this.isCreated=e.status!==Jt.CREATING&&e.status!==Jt.NONE})).subscribe({next:e=>{let n=(V,Z,le,pe)=>{let he=document.createElementNS("http://www.w3.org/2000/svg","rect");return he.setAttribute("x",V),he.setAttribute("y",Z),he.setAttribute("width",le),he.setAttribute("height",pe),he};if(this.captureClipPathRef.nativeElement.innerHTML="",e.status===Jt.NONE){let V=n("0","0","100%","100%");this.captureClipPathRef.nativeElement.appendChild(V),this.changeDetectorRef.markForCheck();return}let{x:r,y:c,w:g,h:v}=e.bbox,y=this.captureOverlayRef.nativeElement.clientWidth,M=this.captureOverlayRef.nativeElement.clientHeight;r>0&&this.captureClipPathRef.nativeElement.appendChild(n("0","0",`${r}`,"100%")),c>0&&this.captureClipPathRef.nativeElement.appendChild(n("0","0","100%",`${c}`)),y>r+g&&this.captureClipPathRef.nativeElement.appendChild(n(`${r+g}`,"0",`${y-(r+g)}`,"100%")),M>c+v&&this.captureClipPathRef.nativeElement.appendChild(n("0",`${c+v}`,"100%",`${M-(c+v)}`)),this.changeDetectorRef.markForCheck()}}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(ee),_(ji),_(Ae),_(ye))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-overlay"]],viewQuery:function(n,r){if(n&1&&(Ye(Uh,7),Ye(Hh,7)),n&2){let c;Me(c=Re())&&(r.captureOverlayRef=c.first),Me(c=Re())&&(r.captureClipPathRef=c.first)}},inputs:{pageIndex:"pageIndex"},standalone:!1,features:[xe([ee])],decls:8,vars:3,consts:[["captureOverlay",""],["captureClipPath",""],["id","capture-overlay"],["x","0","y","0","width","100%","height","100%"],[4,"ngIf"],["x1","0","x2","100%","stroke","#FFFFFF","stroke-dasharray","4 4"],["y1","0","y2","100%","stroke","#FFFFFF","stroke-dasharray","4 4"]],template:function(n,r){n&1&&(Oi(),A(0,"svg",2,0)(2,"defs")(3,"clipPath",null,1),Q(5,"rect",3),D()(),Q(6,"rect",3),se(7,$h,3,8,"g",4),D()),n&2&&(x(3),ge("id",r.clipPathId),x(3),ge("clip-path","url(#"+r.clipPathId+")"),x(),O("ngIf",r.showCrossHair))},dependencies:[bt],styles:["#capture-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:1}#capture-overlay[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%]{fill:#1e1e1e;fill-opacity:.25}"],changeDetection:0}));let s=t;return s})();var Ta=(()=>{let t=class t{};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({providers:[ji],imports:[on,yn]}));let s=t;return s})();ai(xa,[Qp,Zp,Jp],[]);function Es(s){let t,i,e;return typeof s=="object"?(t=s.hashFunction,i=s.expiring,e=s.tags):t=s,(n,r,c)=>{if(c.value!=null)c.value=ed(c.value,t,i,e);else if(c.get!=null)c.get=ed(c.get,t,i,e);else throw"Only put a Memoize() decorator on a method or get accessor."}}var vc=new Map;function ed(s,t,i=0,e){let n=Symbol("__memoized_map__");return function(...r){let c;this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:new Map});let g=this[n];if(Array.isArray(e))for(let v of e)vc.has(v)?vc.get(v).push(g):vc.set(v,[g]);if(t||r.length>0||i>0){let v;t===!0?v=r.map(V=>V.toString()).join("!"):t?v=t.apply(this,r):v=r[0];let y=`${v}__timestamp`,M=!1;if(i>0)if(!g.has(y))M=!0;else{let V=g.get(y);M=Date.now()-V>i}g.has(v)&&!M?c=g.get(v):(c=s.apply(this,r),g.set(v,c),i>0&&g.set(y,Date.now()))}else{let v=this;g.has(v)?c=g.get(v):(c=s.apply(this,r),g.set(v,c))}return c}}var Jo=class Jo{pdfPages;constructor(t){this.pdfPages=t}getPageContainerSize(t,i,e,n){if(!J.isContinuousMode(t))return this.getRowSize(t,i,e??-1,n);let r=J.getPageMovement(t);return Array.from({length:this.pdfPages.length}).map((c,g)=>g).filter(c=>c%r===0).map(c=>this.getRowSize(t,i,c)).reduce((c,g)=>({width:Math.max(c.width,g.width),height:c.height+g.height}),{width:0,height:0})}getRowSize(t,i,e,n){let r=J.getPageMovement(t),c=Math.floor(e/r);return this.pdfPages.slice(c*r,(c+1)*r).reduce((v,y,M)=>{let V=this.getPageSize(i,c*r+M),Z=V.width+(n?0:Jo.HORIZONTAL_MARGIN*2),le=V.height+(n?0:Jo.VERTICAL_MARGIN*2);return{width:v.width+Z,height:Math.max(v.height,le)}},{width:0,height:0})}getPageSize(t,i){if(!this.pdfPages.length)return{width:0,height:0};let e=this.pdfPages[i],n=e.bbox.w,r=e.bbox.h;return(e.r+t)%180!==0&&([n,r]=[r,n]),{width:n,height:r}}getPageFrameOffset(t,i,e,n,r){let c=J.getPageMovement(t),g=Math.floor(n/c),v=this.getRowSize(t,i,n),y=this.getPageSize(i,n).height+Jo.VERTICAL_MARGIN*2,M={offsetX:0,offsetY:0};if(J.isContinuousMode(t)){let Z=this.getPageContainerSize(t,i).width;M.offsetX=(Z-v.width)/2,M.offsetY=Array.from({length:g}).reduce((le,pe,he)=>le+this.getRowSize(t,i,he*c).height,0)}let V=(()=>{let Z=Array.from({length:this.pdfPages.length}).map((le,pe)=>pe);return e?Z.slice(n+1,(g+1)*c):Z.slice(g*c,n)})();return M.offsetX+=V.reduce((Z,le)=>{let pe=this.getPageSize(i,le).width+Jo.HORIZONTAL_MARGIN*2;return Z+pe},0),r||(M.offsetY+=(v.height-y)/2),M}};N(Jo,"HORIZONTAL_MARGIN",5),N(Jo,"VERTICAL_MARGIN",5);var Un=Jo;ze([Es((s,t,i)=>J.isContinuousMode(s)?`${s}.${t}`:`${s}.${t}.${i-i%J.getPageMovement(s)}`)],Un.prototype,"getPageContainerSize",null);ze([Es((s,t,i)=>`${s}.${t}.${i-i%J.getPageMovement(s)}`)],Un.prototype,"getRowSize",null);ze([Es((s,t)=>`${s}.${t}`)],Un.prototype,"getPageSize",null);ze([Es((s,t,i,e)=>`${s}.${t}.${i}.${e}`)],Un.prototype,"getPageFrameOffset",null);var Xr=class{scrollController;rootElement;get currentPageNo(){return this.scrollController.currentPageNo}constructor(t,i){this.scrollController=t,this.rootElement=i}discontinuousOnScroll(t){let i=this.isScrollAtLeft(),e=this.isScrollAtRight(),n=this.isScrollAtTop(t),r=this.isScrollAtBottom(t),c=this.rootElement.scrollTop,g=this.rootElement.scrollLeft,v=t&&t.srcEvent||t;(this.scrollController.isR2L&&i||!this.scrollController.isR2L&&e||r)&&!this.isLastRowPage()?(this.scrollController.moveToNextPage(),v.stopPropagation(),v.preventDefault(),this.scrollController.scrollTo(e?0:g,e?c:0),this.scrollController.fitMode!==null&&this.scrollController.contentService.requestViewChange({fitMode:this.scrollController.fitMode})):(this.scrollController.isR2L&&e||!this.scrollController.isR2L&&i||n)&&!this.isFirstRowPage()&&(this.scrollController.moveToPrevPage(),v.stopPropagation(),v.preventDefault(),this.scrollController.scrollTo(i?this.rootElement.scrollWidth-this.rootElement.scrollLeft:g,i?c:this.rootElement.scrollHeight-this.rootElement.scrollTop),this.scrollController.fitMode!==null&&this.scrollController.contentService.requestViewChange({fitMode:this.scrollController.fitMode}))}isFirstRowPage(){return J.isTwoPageMode(this.scrollController.viewMode)?this.currentPageNo<3:this.currentPageNo===1}isLastRowPage(){return J.isTwoPageMode(this.scrollController.viewMode)?this.currentPageNo>=Math.ceil(this.scrollController.pageCount/2)*2-1:this.currentPageNo===this.scrollController.pageCount}};var Oa=class extends Xr{isScrollAtTop(t){return this.rootElement.scrollTop<=0&&t.key==="PageUp"}isScrollAtBottom(t){let i=this.rootElement.offsetHeight,e=this.rootElement.offsetWidth;return this.rootElement.scrollWidth>e&&(i-=15),this.rootElement.scrollHeight-this.rootElement.scrollTop<=i&&t.key==="PageDown"}isScrollAtLeft(){return!1}isScrollAtRight(){return!1}};var wa=class extends Xr{isScrollAtTop(t){return this.rootElement.scrollTop+t.deltaY<=0&&t.deltaY<0}isScrollAtBottom(t){let i=this.rootElement.offsetHeight,e=this.rootElement.offsetWidth;return this.rootElement.scrollWidth>e&&(i-=15),this.rootElement.scrollHeight-this.rootElement.scrollTop-t.deltaY<=i&&t.deltaY>=0}isScrollAtLeft(){return!1}isScrollAtRight(){return!1}};var zi=(()=>{let t=class t{contentService;store$;documentService;sdContextMenuService;apiEventBridgeService;pageService;annotService;loggingService;stateHolder=null;rootElement;currentViewRectSrc=new Ht(null);currentViewRect$=this.currentViewRectSrc.asObservable();viewScrollSrc=new Ti;viewScroll$=this.viewScrollSrc.asObservable();lastScrollTop=0;lastIndex;viewMode;currentPageNo;pageCount;isR2L;isContextMenuOpened=!1;get currentPageIndex(){return this.currentPageNo-1}wheel$;scroll$;touchStart$;touchMove$;touchEnd$;mouseWheelSub;scrollEdgeSub;windowKeyDownSub;wheelControl;keyDownControl;subs=[];scale=null;jumping;jumpingSrc=new Ti;calcViewRectSrc=new Ti;jumpingOrigin={x:0,y:0};fitMode=null;constructor(e,n,r,c,g,v,y,M){this.contentService=e,this.store$=n,this.documentService=r,this.sdContextMenuService=c,this.apiEventBridgeService=g,this.pageService=v,this.annotService=y,this.loggingService=M,this.store$.pipe($("viewMode")).subscribe({next:V=>this.viewMode=V}),this.store$.pipe($("currentPageNo")).subscribe({next:V=>this.currentPageNo=V}),this.store$.pipe($("pageCount")).subscribe({next:V=>this.pageCount=V}),this.store$.pipe($("isR2L")).subscribe({next:V=>this.isR2L=V}),this.store$.pipe($("fitMode")).subscribe({next:V=>this.fitMode=V}),this.store$.pipe($("scale")).subscribe({next:V=>this.scale=V})}getExportableFunctions(){return[{name:"scrollToPage",function:e=>new wt(n=>{this.viewMode===4&&n.error(new _t("Error detail: Not supported in ebook mode"));let r=this.stateHolder.pdfPages,c=e.pageIndex;if(c<0&&(c=r.length+c),c=Math.max(Math.min(c,r.length-1),0),this.lastIndex=void 0,e.centerPoint){let g=na.deviceToUser({x:e.centerPoint.x??0,y:e.centerPoint.y??0},r[c].r,r[c].bbox.w,r[c].bbox.h);this.contentService.requestViewChange({pageNo:c+1,center:g})}else this.contentService.requestViewChange({pageNo:c+1});n.next(),n.complete()})},{name:"scrollToAnnotation",function:e=>{if(!w.isDefined(this.documentService.openedDocument))throw new Cn("No opened document found.");if(this.viewMode===4)throw new _t("Error detail: Not supported in ebook mode");return xo(ht(this.annotService.getActionLog()).pipe(Ve(n=>(n.forEach(r=>{r.annots=r.annots.filter(c=>c.action==="create")}),n.filter(r=>r.annots.length>0)))),this.annotService.getAnnotations()).pipe(Ve(([n,r])=>{let c=r;return n.forEach(g=>r[g.pageIdx].push(...g.annots)),c}),st(n=>{for(let r of n)for(let c of r){if(w.isDefined(e.oid)&&c.oid===e.oid)return ht(c);if(w.isDefined(e.name)&&w.isDefined(e.pageIndex)&&c.attributes.pageIdx===e.pageIndex&&c.attributes.NM===e.name)return ht(c)}throw new bs("Cannot find annotation")}),st(n=>{let r=n.attributes.pageIdx,c=n.attributes.rect;return new wt(g=>{this.contentService.requestViewChange({pageNo:r+1,center:{x:(c.left+c.right)/2,y:(c.top+c.bottom)/2}}),e.select&&this.contentService.fireAnnotEvent({sdEventType:cn.SELECTED,annot:n}),g.next(),g.complete()})}))}}]}getExportableEvents(){return[{type:"scrollPositionChange",subject:this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.scrollEventSrc).pipe(Ve(e=>({position:e.position})))},{type:"currentReadingPageChange",subject:this.apiEventBridgeService.currentReadingPageChange$.pipe(Ve(e=>({pageInfos:e.pageInfos})))}]}start(e,n){this.loggingService.common("debug",Le.STARTED,"scroll service"),this.wheelControl=new wa(this,n),this.keyDownControl=new Oa(this,n),this.stateHolder=e,this.rootElement=n,this.wheel$=Ge(this.rootElement,"wheel",{passive:!0}),this.scroll$=Ge(this.rootElement,"scroll",{passive:!0}),this.touchStart$=Ge(this.rootElement,"touchstart"),this.touchMove$=Ge(this.rootElement,"touchmove",{passive:!0}),this.touchEnd$=Ge(this.rootElement,"touchend",{passive:!0}),this.subscribeEvents()}stop(){this.loggingService.common("debug",Le.STOPPED,"scroll service"),Xi.unsubscribe(this.scrollEdgeSub,this.mouseWheelSub,this.windowKeyDownSub,...this.subs),this.subs.splice(0),this.stateHolder=null,this.scale=null}publishScrollEvent(e){this.viewScrollSrc.next(e)}moveToPage(e){let n=J.getNextPageNo(e,this.viewMode,this.pageCount);this.contentService.requestViewChange({pageNo:n})}moveToPrevPage(){let e=J.getPageMovement(this.viewMode);this.moveToPage(this.currentPageNo-e)}moveToNextPage(){let e=J.getPageMovement(this.viewMode);this.moveToPage(this.currentPageNo+e)}scrollTo(e,n){if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}this.lockScrollEvent(),this.rootElement.scrollLeft=e,this.rootElement.scrollTop=n,this.releaseScrollEvent()}updateReadStatus(){if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}if(J.isContinuousMode(this.viewMode)){let e=J.normalizeScale(this.scale),n=this.rootElement.scrollTop/e,r=(this.rootElement.scrollTop+this.rootElement.clientHeight)/e,c=[],g=M=>{if(!w.isDefined(this.stateHolder))throw new ci("stateHolder is undefined. Call start() first.");let V=this.stateHolder.getPageFrameOffset(this.viewMode,M),Z=this.stateHolder.getPageSize(M),le=V.offsetY,pe=V.offsetY+Z.height+Un.VERTICAL_MARGIN*2,he=Math.max(n,le),Te=Math.min(r,pe);return he+1<Te};g(this.currentPageIndex)&&this.pageService.pdfPages.length&&c.push(this.pageService.pdfPages[this.currentPageIndex]);for(let M=this.currentPageIndex-1;0<M&&g(M);M--)c.unshift(this.pageService.pdfPages[M]);for(let M=this.currentPageIndex+1;M<this.pageService.pdfPages.length&&g(M);M++)c.push(this.pageService.pdfPages[M]);let v=[];if(this.lastIndex!==void 0&&c.length)if(this.lastScrollTop-n<0)for(let V=this.lastIndex;V<c[c.length-1].i;V++)v.push(V);else for(let V=this.lastIndex;V>c[c.length-1].i;V--)v.push(V);this.lastIndex=c[c.length-1]?.i,this.lastScrollTop=n;let y=c.concat(v.map(M=>this.pageService.pdfPages[M]).filter(M=>!!M)).filter((M,V,Z)=>Z.indexOf(M)===V).sort((M,V)=>M.i-V.i);y.forEach(M=>M.read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:y.map(({i:M})=>({pageIndex:M}))}})}else if(this.viewMode===4){let e=J.getEbookPageNo(this.currentPageNo);if(e===1){let n=this.pageService.pdfPages.find(({i:r})=>e-1===r);n.read=!0,this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:[{pageIndex:0}]}})}else{let n=[{pageIndex:e-1}];e<this.pageCount&&n.push({pageIndex:e}),n.forEach(({pageIndex:r})=>this.pageService.pdfPages.find(({i:c})=>r===c).read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:n}})}}else{let e=[this.currentPageIndex];J.isTwoPageMode(this.viewMode)&&this.currentPageIndex<this.pageCount-1&&e.push(this.currentPageIndex+(this.currentPageIndex%2===0?1:-1));let n=e.filter((r,c,g)=>g.indexOf(r)===c).sort((r,c)=>r-c);n.forEach(r=>this.pageService.pdfPages.find(({i:c})=>r===c).read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:n.map(r=>({pageIndex:r}))}})}}subscribeEvents(){this.subscribeMouseWheel(),this.subscribeScroll(),this.subscribeWindowKeyDown(),this.subscribeOverscroll(),this.subs.push(this.sdContextMenuService.contextMenuStatus$.subscribe({next:e=>this.isContextMenuOpened=e}),this.jumpingSrc.pipe(ii(100)).subscribe({next:()=>this.jumping=!1}),ut(this.calcViewRectSrc,G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).pipe(fl(25)).subscribe({next:e=>{e&&this.calculateViewRect()}}),lr(1e3).subscribe({next:()=>{this.updateReadStatus()}}))}subscribeOverscroll(){if(!w.isDefined(this.wheel$)||!w.isDefined(this.scroll$)||!w.isDefined(this.touchStart$)||!w.isDefined(this.touchMove$)||!w.isDefined(this.touchEnd$)){this.loggingService.common("debug",Le.NOT_EXIST,"Event handlers","Call start() first.");return}this.subs.push((()=>{let e=Ze.scrollPositionDetectionSensitivity,n=[],r;return this.wheel$.pipe(this.scrollDetectableStatusFilter(),F(()=>this.viewMode!==4)).subscribe({next:c=>{this.isContextMenuOpened&&this.sdContextMenuService.publishContextMenuStatus(!1),this.isTop()&&c.deltaY<0?n.push("top"):this.isBottom()&&c.deltaY>0&&n.push("bottom"),clearTimeout(r),r=G.nativeWindow.setTimeout(()=>{n.length<3||(this.isTop()&&n.every(g=>g==="top")?this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}}):this.isBottom()&&n.every(g=>g==="bottom")&&this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}}),n.splice(0))},e)}})})(),G.windowKeyDown$.pipe(this.scrollDetectableStatusFilter(),F(()=>this.viewMode!==4)).subscribe({next:e=>{this.isTop()&&e.key==="PageUp"?this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}}):this.isBottom()&&e.key==="PageDown"&&this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}})}}),...(()=>{let n=0,r=0,c=0,g=0,v=0,y=0,M=0,V=0;return[this.touchStart$.pipe(F(()=>this.viewMode!==4)).subscribe({next:Z=>{if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}n=this.rootElement.scrollTop,r=this.rootElement.scrollLeft;let le=Z.touches[0];c=le.clientY,g=le.clientX,M=this.scale}}),this.touchMove$.pipe(F(()=>this.viewMode!==4)).subscribe({next:Z=>{let le=Z.touches[0];v=c-le.clientY,y=g-le.clientX,V=M-this.scale}}),this.touchEnd$.pipe(F(()=>this.viewMode!==4),F(()=>!this.stateHolder?.isSlideshow)).subscribe({next:()=>{if(!w.isDefined(this.stateHolder)){this.loggingService.common("debug",Le.NOT_EXIST,"stateHolder","Call start() first.");return}if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}if(!(Math.abs(V)>0)){if(Math.abs(y)>Math.abs(v)){if(J.isContinuousMode(this.viewMode))return;if(r+y/4<=0){if(this.currentPageNo>1){let Z=this.rootElement.scrollTop;this.moveToPrevPage(),this.rootElement.scrollLeft=this.rootElement.scrollWidth,this.rootElement.scrollTop=Z}}else if(r+this.rootElement.offsetWidth+y/4>=this.rootElement.scrollWidth&&this.currentPageNo<this.stateHolder.pdfPages.length){let Z=this.rootElement.scrollTop;this.moveToNextPage(),this.rootElement.scrollTop=Z}}else if(n+v/4<=0){if(this.currentPageNo===1)this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}});else if(!J.isContinuousMode(this.viewMode)){let Z=this.rootElement.scrollLeft;this.moveToPrevPage(),this.rootElement.scrollTop=this.rootElement.scrollHeight,this.rootElement.scrollLeft=Z}}else if(n+this.rootElement.offsetHeight+v/4>=this.rootElement.scrollHeight){if(this.currentPageNo>=this.stateHolder.pdfPages.length)this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}});else if(!J.isContinuousMode(this.viewMode)){let Z=this.rootElement.scrollLeft;this.moveToNextPage(),this.rootElement.scrollLeft=Z}}}}})]})())}subscribeScroll(){if(!w.isDefined(this.scroll$)){this.loggingService.common("debug",Le.NOT_EXIST,"scroll$","Call start() first.");return}w.isDefined(this.scrollEdgeSub)&&Xi.unsubscribe(this.scrollEdgeSub),this.scrollEdgeSub=ht(this.scroll$.pipe(rt(()=>{this.stateHolder&&this.updateReadStatus()})),this.store$.pipe($("scale"))).pipe(F(()=>this.viewMode!==4),ul(),ii(10),this.scrollDetectableStatusFilter(),Ve(()=>this.isBottom()?"bottom":this.isTop()?"top":"reset"),Yn(),F(e=>e!=="reset")).subscribe({next:e=>this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:e}})})}scrollDetectableStatusFilter(){return e=>e.pipe(F(()=>{let n=this.currentPageNo===this.pageCount,r=this.currentPageNo===1&&this.currentPageNo<this.pageCount,c=this.currentPageNo===this.pageCount&&this.pageCount>1;return!(!J.isContinuousMode(this.viewMode)&&(!r&&!c&&!n||r&&this.isBottom()||c&&this.isTop()))}))}subscribeMouseWheel(){if(!w.isDefined(this.wheel$)){this.loggingService.common("debug",Le.NOT_EXIST,"wheel$","Call start() first.");return}w.isDefined(this.mouseWheelSub)&&Xi.unsubscribe(this.mouseWheelSub),this.mouseWheelSub=this.wheel$.pipe(ii(50),F(e=>!e.ctrlKey&&!e.metaKey),F(()=>!this.jumping&&!J.isContinuousMode(this.viewMode))).subscribe({next:e=>this.wheelControl.discontinuousOnScroll(e)})}subscribeWindowKeyDown(){w.isDefined(this.windowKeyDownSub)&&Xi.unsubscribe(this.windowKeyDownSub),this.windowKeyDownSub=G.windowKeyDown$.pipe(F(()=>!this.stateHolder?.isSlideshow),F(()=>!J.isContinuousMode(this.viewMode))).subscribe({next:e=>this.keyDownControl.discontinuousOnScroll(e)})}lockScrollEvent(){this.jumping=!0}releaseScrollEvent(){this.jumpingSrc.next(!1)}calculateViewRect(){if(this.viewMode===4)return;let e=this.currentPageIndex,n=J.getPageMovement(this.viewMode)-1,r=this.stateHolder,c=J.normalizeScale(this.scale),g=y=>{if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}if(!w.isDefined(r?.pdfPages[y]))return;let M=r.getPageFrameOffset(this.viewMode,y),{width:V,height:Z}=r.getPageSize(y),le=M.offsetX,pe=M.offsetY,he=le+V,Te=pe+Z,p=this.rootElement.scrollLeft/c,dt=p+this.rootElement.clientWidth/c,vt=this.rootElement.scrollTop/c,gt=vt+this.rootElement.clientHeight/c;return{x:Math.max(p-le,0),y:Math.max(vt-pe,0),w:Math.min(dt,he)-Math.max(p,le),h:Math.min(gt,Te)-Math.max(vt,pe)}},v={idx:e,rect:g(e)};if(v.rect){if(n===1){let y=e+(e%2===0?1:-1),M=g(y);M&&M.w*M.h>v.rect.w*v.rect.h&&(v.rect=M,v.idx=y,this.currentPageNo!==v.idx+1&&this.contentService.requestViewChange({pageNo:v.idx+1}))}this.currentViewRectSrc.next(v)}}isTop(){return w.isDefined(this.rootElement)&&this.rootElement.scrollTop<=0}isBottom(){return w.isDefined(this.rootElement)&&Math.ceil(this.rootElement.scrollTop)+this.rootElement.offsetHeight>=this.rootElement.scrollHeight}};N(t,"\u0275fac",function(n){return new(n||t)(Ue(at),Ue(ye),Ue(ct),Ue(qo),Ue(Qt),Ue(zt),Ue(ri),Ue(Di))}),N(t,"\u0275prov",di({token:t,factory:t.\u0275fac}));let s=t;return s})();var Kr=(()=>{let t=class t{logoWidth=100;logoHeight=24;logoDataURLSrc=new Ht(null);logoDataURL$=this.logoDataURLSrc.asObservable();getExportableFunctions(){return[{name:"setLogo",function:e=>new wt(n=>{let r=new Image;r.onload=()=>{let c=document.createElement("canvas"),g=c.getContext("2d"),v=Math.min(this.logoWidth/r.naturalWidth,this.logoHeight/r.naturalHeight),y=r.naturalWidth*v,M=r.naturalHeight*v;if(c.width=y,c.height=M,!w.isDefined(g)){this.logoDataURLSrc.next(null),n.error(new _t("Failed to get CanvasRenderingContext2D"));return}g.drawImage(r,0,0,y,M),this.logoDataURLSrc.next(c.toDataURL("image/png")),n.next(void 0)},r.onerror=c=>{this.logoDataURLSrc.next(null),n.error(c)},r.src=e.url}).pipe(hl(1e3),pr(n=>{throw n instanceof dl?new kl("Something was wrong :("):new _t(n)}))}]}get isLogoVisible(){return this.logoDataURLSrc.value!==null}};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275prov",di({token:t,factory:t.\u0275fac}));let s=t;return s})();var mr=class mr{documentService;productService;quickActionService;store$;translatePipe;viewerService;isPanelOpened=!1;selectedPanel=null;panelMenuSrc=new Ht([]);panelMenu$=this.panelMenuSrc.asObservable();hiddenPanel={};customPanelMenus=null;viewMode=void 0;subToolbar=null;constructor(t,i,e,n,r,c){this.documentService=t,this.productService=i,this.quickActionService=e,this.store$=n,this.translatePipe=r,this.viewerService=c,this.panelMenuSrc.next(this.buildPanel()),this.initRegisterQuickActions(),this.store$.pipe($("sideViewMode")).subscribe({next:g=>{this.selectedPanel=g,this.isRedactionPanel(this.selectedPanel)&&this.subToolbar!==lt.REDACT&&this.viewerService.openSubToolbar(lt.REDACT),!this.isRedactionPanel(this.selectedPanel)&&this.subToolbar===lt.REDACT&&this.viewerService.closeSubToolbar()}}),this.store$.pipe($("sideViewVisible")).subscribe({next:g=>{this.isPanelOpened=g,!this.isPanelOpened&&this.isRedactionPanel(this.selectedPanel)&&this.subToolbar===lt.REDACT&&this.viewerService.closeSubToolbar()}}),this.store$.pipe(fi([B.SIDE_VIEW,B.SIDE_VIEW_THUMBNAIL,B.SIDE_VIEW_BOOKMARK,B.SIDE_VIEW_ANNOTATION,B.SIDE_VIEW_REDACTION,B.SIDE_VIEW_EMBEDDED_FILE,B.SIDE_VIEW_EMBEDDED_FILE,B.SIDE_VIEW_SIGNATURE])).subscribe({next:g=>{Object.assign(this.hiddenPanel,g),this.panelMenuSrc.next(this.buildPanel()),this.isPanelOpened&&J.isOpenedHiddenView(this.hiddenPanel,this.selectedPanel)&&this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1}))}}),this.store$.pipe($("viewMode")).subscribe({next:g=>this.viewMode=g}),this.viewerService.subToolbar$.pipe(F(g=>this.subToolbar!==g)).subscribe({next:g=>{g===lt.REDACT?(this.subToolbar=g,this.isRedactionPanel(this.selectedPanel)||this.store$.dispatch(ue.set({key:"sideViewMode",value:De.Redaction})),this.isPanelOpened||this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0}))):this.subToolbar===lt.REDACT&&this.isRedactionPanel(this.selectedPanel)?(this.subToolbar=g,this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1}))):this.subToolbar=g}})}getExportableFunctions(){return[{name:"defineDocumentPanel",noNeedDocumentLoaded:!0,hasCallback:!0,function:t=>{let i=t.items.map(e=>({label:e.label,icon:e.icon,command:e.onclick}));return this.customPanelMenus=[{items:i}],this.panelMenuSrc.next(this.buildPanel()),ht(void 0)}}]}buildPanel(){let t={items:[]};return this.hiddenPanel[B.SIDE_VIEW]?[t]:this.customPanelMenus?this.customPanelMenus:(K.get(ie.THUMBNAIL_VIEW_BUTTON)&&!this.hiddenPanel[B.SIDE_VIEW_THUMBNAIL]&&t.items.push({label:this.translatePipe.transform("THUMBNAIL"),icon:Ln.THUMBNAIL,command:()=>this.onPanelSelectForStatistics(fe.THUMBNAIL_VIEW,De.Thumbnail),data:De.Thumbnail}),K.get(ie.OUTLINE_VIEW_BUTTON)&&!this.isDAP&&!this.hiddenPanel[B.SIDE_VIEW_BOOKMARK]&&t.items.push({label:this.translatePipe.transform("OUTLINE"),icon:Ln.OUTLINE,command:()=>this.onPanelSelectForStatistics(fe.OUTLINE_VIEW,De.Outline),data:De.Outline}),this.productService.isStreamDocs&&!this.isDAP&&!this.isEbookMode&&K.get(ie.ANNOTATION_VIEW_BUTTON)&&this.documentService.checkAuthority(Ne.ANNOTATION)&&!this.hiddenPanel[B.SIDE_VIEW_ANNOTATION]&&t.items.push({label:this.translatePipe.transform("ANNOTATION_LIST"),icon:Ln.ANNOTATION,command:()=>this.onPanelSelectForStatistics(fe.ANNOTATION_VIEW,De.Annotation),data:De.Annotation}),this.isStreamDocs&&!this.isDAP&&!this.isEbookMode&&K.get(ie.REDACTION_VIEW_BUTTON)&&this.documentService.checkAuthority(Ne.ANNOTATION)&&!this.hiddenPanel[B.SIDE_VIEW_REDACTION]&&t.items.push({label:this.translatePipe.transform("REDACT"),icon:Ln.REDACTION,command:()=>this.onPanelSelectForStatistics(fe.REDACTION_VIEW,De.Redaction),data:De.Redaction}),K.get(ie.EMBEDDED_FILE_VIEW_BUTTON)&&this.isStreamDocs&&!this.isDAP&&!this.hiddenPanel[B.SIDE_VIEW_EMBEDDED_FILE]&&t.items.push({label:this.translatePipe.transform("EMBEDDED_FILE"),icon:Ln.EMBEDDED_FILE,command:()=>this.onPanelSelectForStatistics(fe.EMBEDDEDFILE_VIEW,De.EmbeddedFile),data:De.EmbeddedFile}),!this.isDAP&&!this.isEbookMode&&K.get(ie.FORM_VIEW_BUTTON)&&this.documentService.checkAuthority(Ne.FORM)&&!this.hiddenPanel[B.SIDE_VIEW_FORM]&&t.items.push({label:this.translatePipe.transform("FORM_TOOL"),icon:Ln.FORM,command:()=>this.onPanelSelectForStatistics(fe.FORM_VIEW,De.Form),data:De.Form}),K.get(ie.SIGNATURE_VIEW_BUTTON)&&!this.isDAP&&!this.isEbookMode&&!this.hiddenPanel[B.SIDE_VIEW_SIGNATURE]&&t.items.push({label:this.translatePipe.transform("SIGNATURE_LIST"),icon:Ln.SIGNATURE,command:()=>this.onPanelSelectForStatistics(fe.SIGNATURE_VIEW,De.Signature),data:De.Signature}),[t])}isOpened(t){return this.selectedPanel===t&&this.isPanelOpened}onPanelSelectForStatistics(t,i){this.onPanelSelect(i)}onPanelSelect(t){this.selectedPanel===t?this.store$.dispatch(ue.set({key:"sideViewVisible",value:!this.isPanelOpened})):(this.store$.dispatch(ue.set({key:"sideViewMode",value:t})),this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0})))}get isDAP(){return this.documentService.isDAP}get isStreamDocs(){return this.productService.isStreamDocs}get isEbookMode(){return this.viewMode===4}isRedactionPanel(t){return t?[De.Redaction,De.SearchingRedaction].includes(t):!1}initRegisterQuickActions(){this.quickActionService.registerActions([{id:ve.THUMBNAIL,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_THUMBNAIL_BY_QUICK_SEARCH,De.Thumbnail)},{id:ve.OUTLINE,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_OUTLINE_BY_QUICK_SEARCH,De.Outline)},{id:ve.ANNOTATION_LIST,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_ANNOTBYION_LIST_BY_QUICK_SEARCH,De.Annotation)},{id:ve.REDACT,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_REDACT_BY_QUICK_SEARCH,De.Redaction)},{id:ve.EMBEDDED_FILE,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_EMBEDDED_FILE_BY_QUICK_SEARCH,De.EmbeddedFile)},{id:ve.FORM_TOOL,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_FORM_TOOL_BY_QUICK_SEARCH,De.Form)},{id:ve.SIGNATURE_LIST,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_SIGNATURE_LIST_BY_QUICK_SEARCH,De.Signature)}])}};N(mr,"\u0275fac",function(i){return new(i||mr)(Ue(ct),Ue(Lr),Ue(ln),Ue(ye),Ue(He),Ue(Zt))}),N(mr,"\u0275prov",di({token:mr,factory:mr.\u0275fac}));var Mo=mr;ze([ot(it.mainToolbarComp.onSideViewMenuSelectForStatistics)],Mo.prototype,"onPanelSelectForStatistics",null);var ya=(()=>{let t=class t{getExportableEvents(){return[{type:"keydown",subject:G.windowKeyDown$.pipe(Ve(e=>{let n={};return Eo.getAllPropertyNames(e).forEach(r=>{Jn.hasKey(e,r)&&(e[r]===G.nativeWindow||e[r]instanceof Node||r==="path"||(n[r]=e[r]))}),{event:JSON.parse(JSON.stringify(n))}}))},{type:"keyup",subject:G.windowKeyUp$.pipe(Ve(e=>{let n={};return Eo.getAllPropertyNames(e).forEach(r=>{Jn.hasKey(e,r)&&(e[r]===G.nativeWindow||e[r]instanceof Node||r==="path"||(n[r]=e[r]))}),{event:JSON.parse(JSON.stringify(n))}}))},{type:"mousedown",subject:G.windowMousedown$.pipe(Ve(e=>({event:Qn.simplifyMouseEvent(e)})))},{type:"mouseup",subject:G.windowMouseUp$.pipe(Ve(e=>({event:Qn.simplifyMouseEvent(e)})))},{type:"pointerdown",subject:G.windowPointerDown$.pipe(Ve(e=>({event:Qn.simplifyPointerEvent(e)})))},{type:"pointerup",subject:G.windowPointerUp$.pipe(Ve(e=>({event:Qn.simplifyPointerEvent(e)})))}]}};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275prov",di({token:t,factory:t.\u0275fac}));let s=t;return s})();var qv=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[ya]}}};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({}));let s=t;return s})();var od=pl(Ih());function Gh(s,t){if(s&1&&(A(0,"div",9)(1,"div",10),be(2),Y(3,"translate"),D(),A(4,"div",11),be(5),D()()),s&2){let i=E(2);x(2),Ee(X(3,2,"ERROR_CODE")),x(3),Ee(i.errorCode)}}function Yh(s,t){if(s&1&&(A(0,"div",9)(1,"div",10),be(2),Y(3,"translate"),D(),A(4,"div",11),be(5),D()()),s&2){let i=E(2);x(2),Ee(X(3,2,"DOCUMENT_ID")),x(3),Ee(i.streamdocsId)}}function Xh(s,t){if(s&1&&(Q(0,"img",7),Y(1,"translate"),A(2,"span",8),be(3),Y(4,"translate"),D(),A(5,"div",9)(6,"div",10),be(7),Y(8,"translate"),D(),A(9,"div",11),be(10),D()(),se(11,Gh,6,4,"div",12)(12,Yh,6,4,"div",12)),s&2){let i=E();ge("src",i.illustImageSrc,Sn)("alt",X(1,7,"ERROR_PAGE_ILLUST")),x(3),Ee(X(4,9,"APOLOGY_FOR_INCONVENIENCE")),x(4),Ee(X(8,11,"OCCURRED_DATE")),x(3),Ee(i.occurredDate),x(),O("ngIf",i.errorCode),x(),O("ngIf",i.streamdocsId)}}function Kh(s,t){if(s&1&&(Q(0,"img",13),Y(1,"translate"),Q(2,"img",14),Y(3,"translate"),A(4,"div",9)(5,"div",10),be(6),Y(7,"translate"),D(),A(8,"div",11),be(9),Y(10,"translate"),D()()),s&2){let i=E();ge("src",i.messageImageSrc,Sn)("alt",X(1,6,"ERROR_STATUS_ILLUST")),x(2),ge("src",i.illustImageSrc,Sn)("alt",X(3,8,"ERROR_PAGE_ILLUST")),x(4),Ee(X(7,10,"INFO")),x(3),Ee(X(10,12,"ERROR_PAGES_"+(i.errorCode||i.statusCode)))}}function qh(s,t){if(s&1&&(A(0,"div",15)(1,"a",16),Q(2,"img"),Y(3,"translate"),A(4,"span"),be(5),D()()()),s&2){let i=E();x(),O("href","tel:"+i.environment.errorPage.telephone,Sn),x(),ge("src",i.callImageSrc,Sn)("alt",X(3,4,"SUPPORT_TELEPHONE")),x(3),Ee(i.environment.errorPage.telephone)}}function Qh(s,t){if(s&1&&(A(0,"div",17)(1,"a",18),Q(2,"i",19),A(3,"span"),be(4),D()()()),s&2){let i=E();x(),O("href",i.environment.errorPage.link,Sn),x(3),Ee(i.environment.errorPage.linkLabel||i.environment.errorPage.link)}}var s_=(()=>{let t=class t{activatedRoute;changeDetectorRef;contentService;subscriptionService;documentService;viewerService;productService;get environment(){return Ze}assetDir="assets/images/error-pages";statusCode=Yr.NOT_FOUND;errorCode;get logoImageSrc(){return`${this.assetDir}/logo.svg`}get messageImageSrc(){return`${this.assetDir}/${this.statusCode}_message.svg`}get illustImageSrc(){return this.isErrorCode?`${this.assetDir}/error_code_illust.svg`:`${this.assetDir}/${this.statusCode}_illust.svg`}get callImageSrc(){return`${this.assetDir}/call.svg`}get isErrorCode(){return w.isDefined(this.statusCode)&&!Object.values(Yr).includes(this.statusCode)||this.statusCode===Yr.INTERNAL_SERVER_ERROR&&w.isDefined(this.errorCode)}get occurredDate(){return(0,od.default)(new Date).format("YYYY. MM. DD. HH:mm:ss")}get streamdocsId(){return this.documentService.openedDocument?.streamdocsId}get isStreamdocs(){return this.productService.isStreamDocs}constructor(e,n,r,c,g,v,y){this.activatedRoute=e,this.changeDetectorRef=n,this.contentService=r,this.subscriptionService=c,this.documentService=g,this.viewerService=v,this.productService=y}ngOnInit(){this.initSubscriptions(),this.viewerService.loadComplete(),this.contentService.togglePageLoader(!1)}initSubscriptions(){this.subscriptionService.push(this.activatedRoute.paramMap.pipe(Ve(e=>({statusCode:parseInt(String(e.get("statusCode"))),errorCode:e.get("errorCode")})),F(e=>w.isDefined(e.statusCode))).subscribe({next:e=>{this.statusCode=Number.isNaN(e.statusCode)?null:e.statusCode,this.errorCode=e.errorCode,this.changeDetectorRef.markForCheck()}}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(Nl),_(Ae),_(at),_(ee),_(ct),_(Zt),_(Lr))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-error-pages"]],standalone:!1,features:[xe([ee])],decls:11,vars:11,consts:[["statusRef",""],[1,"logo-image"],[3,"ngIf","ngIfElse"],[1,"enquiry-box"],[1,"call-box-header"],["class","call-box",4,"ngIf"],["class","link-box",4,"ngIf"],[1,"illust-image","margin"],[1,"message-text"],[1,"info-box"],[1,"info-box-header"],[1,"info-box-body"],["class","info-box",4,"ngIf"],[1,"message-image"],[1,"illust-image"],[1,"call-box"],[1,"call-box-body",3,"href"],[1,"link-box"],[3,"href"],[1,"papycon","papycon-link"]],template:function(n,r){if(n&1&&(Q(0,"img",1),Y(1,"translate"),se(2,Xh,13,13,"ng-template",2)(3,Kh,11,14,"ng-template",null,0,Li),A(5,"div",3)(6,"div",4),be(7),Y(8,"translate"),D(),se(9,qh,6,6,"div",5)(10,Qh,5,2,"div",6),D()),n&2){let c=wi(4);ge("src",r.logoImageSrc,Sn)("alt",X(1,7,r.isStreamdocs?"STREAMDOCS_LOGO":"STREAMDOCS_VU_LOGO")),x(2),O("ngIf",r.isErrorCode)("ngIfElse",c),x(5),Ee(X(8,9,"FAILURE_PERSISTS_MESSAGE")),x(2),O("ngIf",r.environment.errorPage.telephone),x(),O("ngIf",r.environment.errorPage.link)}},dependencies:[bt,He],styles:["[_nghost-%COMP%]{font-size:16px;line-height:26px;font-family:NotoSans-Medium,sans-serif;color:#1e1e1e;display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;background-color:var(--mono-00);overflow-y:auto}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{max-width:80%}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.logo-image[_ngcontent-%COMP%]{height:24px}.message-image[_ngcontent-%COMP%]{height:184px;margin-top:70px;margin-bottom:40px}.illust-image[_ngcontent-%COMP%]{height:144px;margin-bottom:40px}.message-text[_ngcontent-%COMP%]{font-weight:700;font-size:32px;margin-bottom:40px}.info-box[_ngcontent-%COMP%]{width:400px;height:100px;border:1px solid var(--mono-99);box-sizing:border-box;text-align:center}.info-box-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--mono-99);background-color:var(--mono-50)}.info-box-body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:74px;white-space:pre-wrap}.info-box[_ngcontent-%COMP%] + .info-box[_ngcontent-%COMP%]{margin-top:20px}.enquiry-box[_ngcontent-%COMP%]{margin-top:28px;text-align:center}.call-box[_ngcontent-%COMP%]{text-align:center}.call-box-header[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif;color:#6c6c6c}.call-box-body[_ngcontent-%COMP%]{font-family:NotoSans-Medium,sans-serif;font-size:16px;line-height:26px;color:#6c6c6c;display:flex;align-items:center;justify-content:center;margin-top:9px;-webkit-user-select:none;user-select:none}.call-box-body[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.link-box[_ngcontent-%COMP%]{margin-top:8px;-webkit-user-select:none;user-select:none}.link-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration-color:#3884d0}.link-box[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{margin-right:4px;font-size:20px;color:var(--mono-90)}.link-box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#3884d0}.margin[_ngcontent-%COMP%]{margin-top:50px}"],changeDetection:0}));let s=t;return s})();var rd=class{router;constructor(t){this.router=t.get(Ir)}canActivate(t){let i=Jn.keys(hc).map(y=>hc[y].toString()),e=Object.values(Sa),n=t.paramMap.get("errorCode"),r=t.paramMap.get("statusCode"),c=w.isDefined(n)&&e.includes(n),g=w.isDefined(r)&&i.includes(r),v=Ze.errorPage.redirection;if(Object.keys(v).length>1||v.fallback.length>0){let y=`fallback${r}`;if(Jn.hasKey(v,y)&&v[y].length>0)return location.href=v[y],!1;if(v.fallback.length>0)return location.href=v.fallback,!1}return c||g?!0:this.router.createUrlTree([...t.url.slice(0,t.url.length-1).map(y=>y.path),Yr.NOT_FOUND])}canDeactivate(){return!0}};rd=ze([Xp()],rd);var Zh=(s,t,i,e)=>{let n={version:2,authKey:e,id:t===null?void 0:t||cp(),messageType:s,args:i};return Object.freeze(n)},sd=[eo,Zt,Pn,ct,kp,En,at,zi,ri,Ca,ya,Tp,io,Zo,Uo,Gr,zt,Xo,Wr,zr,qo,Ep,an,fa,Ni,Hr,Kr,Mo,vp,to,ji],_r=class _r{injector;documentService;router;viewerService;exportedFunctions={};acknowledged=!1;message$=G.windowMessage$.pipe(F(w.isDefined),F(t=>t.type==="message"),Ve(t=>this.documentService.viewingMode&&this.documentService.openedDocument!==null?(console.error("The MuPDF WebViewer API is not available in Free License"),null):t.data),F(w.isDefined),F(t=>!!t.messageType&&t.version===2));subscriptions=[];functionStatus={};_authKey;get authKey(){return this._authKey}set authKey(t){if(this._authKey){console.warn("authKey can't not be assigned more than twice");return}this._authKey=t}constructor(t,i,e,n){this.injector=t,this.documentService=i,this.router=e,this.viewerService=n,window.parent!==window&&(K.get(ie.USE_STREAMDOCS_API)&&(this.registerFunctions(),this.registerEvents()),this.subscribeMessageEvent(),this.connectWithParent())}emitEvent(t,i){this.dispatchEvent("EVENT",void 0,{type:t,data:i},this.authKey)}registerFunctions(){sd.forEach(t=>{let i=this.injector.get(t);if(!i||!i.getExportableFunctions)return;i.getExportableFunctions().forEach(n=>{this.exportedFunctions[n.name]=n,this.functionStatus[n.name]={running:!1,queue:[]}})})}registerEvents(){sd.forEach(t=>{let i=this.injector.get(t);if(!i||!i.getExportableEvents)return;i.getExportableEvents().forEach(n=>{this.subscriptions.push(n.subject.subscribe({next:r=>this.emitEvent(n.type,r)}))})})}connectWithParent(){this.acknowledged=!1,this.notifyToParent()}notifyToParent(t=100){if(this.acknowledged)return;if(t>100*Math.pow(2,8)){this.destroy();return}let i=K.get(ie.USE_STREAMDOCS_API)?"INITIATED":"REJECTED";this.dispatchEvent(i),setTimeout(()=>this.notifyToParent(t*2),t)}dispatchEvent(t,i,e,n){let r=Zh(t,i,e,n);G.nativeWindow.parent!==G.nativeWindow&&window.parent.postMessage(r,"*")}subscribeMessageEvent(){this.subscriptions.push(this.message$.subscribe({next:t=>this.listenMessageEvent(t)}))}listenMessageEvent(t){switch(t.messageType){case"ACKNOWLEDGED":this.acknowledged=!0;break;case"CALL_FUNCTION":this.handleFunctionCall(t);break;case"REQUEST_CHALLENGE":this.responseChallenge(t);break;case"REJECTED":this.router.navigateByUrl(`view/error-pages;errorCode=${Sa.FSD000003}`);break;case"ADD_EVENT":break;default:console.warn(`Unhandled message received: ${t.messageType}`);break}}handleFunctionCall(t){if(t.authKey!==this.authKey){console.error("Calling function failed (authentication error)");return}if(!t.args){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ci("Argument is empty")));return}if(!t.args.functionName){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ci("Function name is empty")));return}let i=this.exportedFunctions[t.args.functionName];if(i===void 0){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ci("Can't find function")));return}if(!i.noNeedDocumentLoaded&&this.documentService.openedDocument===null){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ci("Document is not loaded. This function cannot be executed before document is loaded")));return}i.hasCallback&&this.replaceCallbackFunction(t.args.functionParams||{});let e={name:i.name,boundFunction:i.function.bind(null,...t.args.functionParams||[]),replyId:t.id},n=this.functionStatus[i.name];!i.parallelizable&&w.isDefined(n)&&n.running?n.queue.push(e):this.executeFunction(e)}wrapError(t){return{__sd_symbol__object_type__:"error",name:t.name,message:t.message,stack:t.stack}}executeFunction(t){let i=this.functionStatus[t.name];if(!w.isDefined(i))throw new jl(`Cannot find "${t.name}" in FunctionStatus.`);let e;i.running=!0;try{e=t.boundFunction()}catch(n){i.running=!1,e=Gn(n)}e.pipe(en(1),Xn(()=>{i.running=!1;let n=i.queue;n.length>0&&this.executeFunction(n.shift())})).subscribe({next:n=>this.dispatchEvent("FUNCTION_SUCCESS",t.replyId,n),error:n=>this.dispatchEvent("FUNCTION_ERROR",t.replyId,n instanceof Error?this.wrapError(n):n)})}responseChallenge(t){if(!t?.authKey){console.error("Challenge message didn't have authKey");return}this.authKey&&this.authKey!==t.authKey?console.warn(`StreamDocs already has been connected with another adapter. (current iframe src: ${location.href})`):(this.authKey||(this.authKey=t.authKey),this.dispatchEvent("RESPONSE_CHALLENGE",void 0,null,this.authKey),this.viewerService.loadComplete(t.args))}replaceCallbackFunction(t){Object.keys(t).forEach(i=>{if(typeof t[i]=="object")if(t[i].__sd_symbol__object_type__==="callbackFunction"){let e=t[i].__sd_symbol__callback_id__;t[i]=(...n)=>{this.dispatchEvent("CALLBACK_FUNCTION",void 0,{functionArgs:n,functionId:e},this.authKey)}}else this.replaceCallbackFunction(t[i])})}destroy(){this.subscriptions.forEach(t=>t.unsubscribe());for(let t of Jn.keys(this.exportedFunctions))delete this.exportedFunctions[t]}};N(_r,"\u0275fac",function(i){return new(i||_r)(Ue(Tl),Ue(ct),Ue(Ir),Ue(Zt))}),N(_r,"\u0275prov",di({token:_r,factory:_r.\u0275fac}));var Sr=_r;ze([Sp()],Sr.prototype,"listenMessageEvent",null);var eu=s=>({content:s,gap:14}),Ea=s=>({content:s});function tu(s,t){s&1&&To(0)}function iu(s,t){if(s&1&&(A(0,"section",1),se(1,tu,1,0,"ng-container",7),Q(2,"div",8),D()),s&2){E();let i=wi(8);x(),O("ngTemplateOutlet",i)}}function nu(s,t){s&1&&To(0)}function ou(s,t){if(s&1&&(A(0,"section",9),se(1,nu,1,0,"ng-container",7),D(),Q(2,"div",5)),s&2){E();let i=wi(8);x(),O("ngTemplateOutlet",i)}}function ru(s,t){if(s&1){let i=Se();A(0,"button",16),Y(1,"translate"),ce("click",function(){W(i);let n=E(2).$implicit,r=E(2);return z(r.expanderClicked(n))}),Q(2,"i",17),D()}if(s&2){let i=E(4);$e("dark",i.isDarkMode),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(1,4,"EXPAND"))}}function su(s,t){if(s&1){let i=Se();Bt(0),A(1,"button",19),ce("click",function(){W(i);let n=E(),r=n.$implicit,c=n.index,g=E(3).$implicit,v=E(2);return g.lastUsed=c,z(v.activateTool(r.tool))}),Q(2,"i",13),D(),Ut()}if(s&2){let i=E().$implicit,e=E(5);x(),$e("dark",e.isDarkMode)("active",e.isActivated(i.tool)),O("title",e.isMobile?"":i.alt)("tooltip",St(9,Ea,i.alt)),ge("color",e.isDarkMode?"white":e.styleOfMenuTool(i))("aria-label",i.alt),x(),O("ngClass",i.iconClass)}}function au(s,t){if(s&1&&(Bt(0),se(1,su,3,11,"ng-container",4),Ut()),s&2){let i=t.$implicit;x(),O("ngIf",i.use)}}function cu(s,t){if(s&1&&(A(0,"div",18),se(1,au,2,1,"ng-container",10),D()),s&2){let i=E(2).$implicit;O("@menuState",i.menuState),x(),O("ngForOf",i.subtools)}}function lu(s,t){if(s&1){let i=Se();Bt(0),A(1,"div",11)(2,"button",12),ce("click",function(){W(i);let n=E().$implicit,r=E(2);return z(r.activateTool(r.isNestedMenuItem(n)?n.lastTool:n))}),Q(3,"i",13),be(4),D(),se(5,ru,3,6,"button",14)(6,cu,2,2,"div",15),D(),Ut()}if(s&2){let i=E().$implicit,e=E(2);x(),$e("expandable",e.isExpandable(i)),x(),$e("dark",e.isDarkMode)("ep-text-button",!i.text)("ep-button",i.text)("active",e.isActivated(i))("expandable",e.isExpandable(i)),O("title",e.isMobile?"":i.alt)("tooltip",St(21,eu,i.alt)),ge("color",e.isDarkMode||i.text?"white":"dark")("size",i.text?"tiny":null)("aria-label",i.alt),x(),O("ngClass",i.iconClass),x(),Kn(" ",i.text||""," "),x(),O("ngIf",e.isExpandable(i)),x(),O("ngIf",e.isExpandable(i)&&e.breakPointOfMobile<=e.windowWidth)}}function pu(s,t){if(s&1&&(Bt(0),se(1,lu,7,23,"ng-container",4),Ut()),s&2){let i=t.$implicit;x(),O("ngIf",i.use)}}function du(s,t){if(s&1&&(Bt(0),se(1,pu,2,1,"ng-container",10),Ut()),s&2){let i=E();x(),O("ngForOf",i.getToolMenus())}}function hu(s,t){s&1&&Q(0,"div",5)}function uu(s,t){if(s&1){let i=Se();A(0,"section",20)(1,"button",21),Y(2,"translate"),Y(3,"translate"),Y(4,"translate"),ce("click",function(){W(i);let n=E();return z(n.toggleRightSideView())}),Q(5,"i",22),D()()}if(s&2){let i=E();x(),$e("dark",i.isDarkMode)("active",i.isAnnotPropertyViewActive()),O("title",i.isMobile?"":X(2,8,"PROPERTIES_PANEL"))("tooltip",St(14,Ea,X(3,10,"PROPERTIES_PANEL"))),ge("color",i.isDarkMode&&!i.isAnnotPropertyViewActive()?"white":i.isAnnotPropertyViewActive()?"primary":"dark")("aria-label",X(4,12,"PROPERTIES_PANEL"))}}function gu(s,t){if(s&1){let i=Se();A(0,"div",23)(1,"button",24),Y(2,"translate"),ce("click",function(){W(i);let n=E();return z(n.onClickUndo())}),Q(3,"i",25),D(),A(4,"button",24),Y(5,"translate"),ce("click",function(){W(i);let n=E();return z(n.onClickRedo())}),Q(6,"i",26),D()()}if(s&2){let i=E();x(),$e("disabled",i.isDarkMode&&!i.canUndo),O("disabled",!i.canUndo)("tooltip",St(16,Ea,i.undoTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(2,12,"UNDO")),x(3),$e("disabled",i.isDarkMode&&!i.canRedo),O("disabled",!i.canRedo)("tooltip",St(18,Ea,i.redoTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(5,14,"REDO"))}}var qr=class qr{annotService;autoSaveService;contentService;dialogService;changeDetectorRef;defaultAnnot;pageService;toastService;annotSelectedService;documentService;subscriptionService;preferenceService;actionHistoryService;store$;translatePipe;signatureService;selectTextService;apiEventBridgeService;quickActionService;viewerService;get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}get DocumentAction(){return Ne}get undoTooltipWithShortcut(){return`${this.translatePipe.transform("UNDO")} (${ei.getShortcutString(Ui[Pe.UNDO_ACTION])})`}get redoTooltipWithShortcut(){return`${this.translatePipe.transform("REDO")} (${ei.getShortcutString(Ui[Pe.REDO_ACTION])})`}rightSideViewMode;menuItems=[];visibleRightSideView;formFieldHighlighted=!0;rulerActive;viewMode;annotContext;sideViewMode=null;sideViewVisible=!1;canUndo=!1;canRedo=!1;hidableMenus={};screenTheme;get windowWidth(){return G.width}get breakPointOfMobile(){return G.breakpoints.mobile.width}get showUndoRedoBtn(){return!this.viewerService.isSubToolbarType(lt.REDACT)&&K.get(ie.ANNOT_TOOLBAR_UNDO_REDO_BUTTONS)&&!this.hidableMenus[B.ANNOTATION_UNDO_REDO]}get isVisiblePropertyButton(){return this.viewerService.isSubToolbarType(lt.ANNOTATE)&&this.runtimeEnv.get(ie.ANNOT_TOOLBAR_ANNOT_PROPERTY_BUTTON)&&!this.hidableMenus[B.ANNOTATION_PROPERTY_PANEL]||this.viewerService.isSubToolbarType(lt.FORM)&&this.runtimeEnv.get(ie.FORM_TOOLBAR_ANNOT_PROPERTY_BUTTON)&&!this.hidableMenus[B.FORM_PROPERTY_PANEL]||this.viewerService.isSubToolbarType(lt.INSERT)||this.viewerService.isSubToolbarType(lt.REDACT)||this.viewerService.isSubToolbarType(lt.SIGN)}get HidableView(){return B}get isFormHighlightAvailable(){return K.get(ie.WIDGET_HIGHLIGHT_BUTTON)&&this.documentService.checkAuthority(Ne.FORM)}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return G.isMobile()}annotateMenus=[];insertMenus=[];redactMenus=[];signMenus=[];currentTool=null;dragMode;isDeepCopy=!1;selectedSubtools=[];constructor(t,i,e,n,r,c,g,v,y,M,V,Z,le,pe,he,Te,p,dt,vt,gt){this.annotService=t,this.autoSaveService=i,this.contentService=e,this.dialogService=n,this.changeDetectorRef=r,this.defaultAnnot=c,this.pageService=g,this.toastService=v,this.annotSelectedService=y,this.documentService=M,this.subscriptionService=V,this.preferenceService=Z,this.actionHistoryService=le,this.store$=pe,this.translatePipe=he,this.signatureService=Te,this.selectTextService=p,this.apiEventBridgeService=dt,this.quickActionService=vt,this.viewerService=gt,this.annotateMenus=this.initAnnotateMenus(),this.insertMenus=this.initInsertMenus(),this.redactMenus=this.initRedactMenus(),this.signMenus=this.initSignMenus()}initAnnotateMenus(){return[{tool:Qe.HIGHLIGHT,type:Fi.ANNOT,alt:this.translatePipe.transform("HIGHLIGHT"),iconClass:"papycon-text-highlight",use:K.get(ie.HIGHLIGHT_ANNOTATION_BUTTON)},{tool:Qe.STRIKE,type:Fi.ANNOT,alt:this.translatePipe.transform("STRIKEOUT"),iconClass:"papycon-text-strikeout",use:K.get(ie.STRIKEOUT_ANNOTATION_BUTTON)},{tool:Qe.UNDERLINE,type:Fi.ANNOT,alt:this.translatePipe.transform("UNDERLINE"),iconClass:"papycon-text-underline",use:K.get(ie.UNDERLINE_ANNOTATION_BUTTON)},{tool:Qe.TEXT_POPUP,type:Fi.ANNOT,alt:this.translatePipe.transform("TEXT_TOOL"),iconClass:"papycon-memo3",use:K.get(ie.MEMO_ANNOTATION_BUTTON)},{tool:Qe.STAMP,type:Fi.ANNOT,alt:this.translatePipe.transform("STAMP_TOOL"),iconClass:"papycon-stamp2",use:K.get(ie.STAMP_ANNOTATION_BUTTON)}]}initInsertMenus(){return[{tool:Qe.TEXT_FREE,type:Fi.ANNOT,alt:this.translatePipe.transform("FREE_TEXT_TOOL"),iconClass:"papycon-add-text",use:K.get(ie.FREE_TEXT_ANNOTATION_BUTTON)},{tool:Qe.STAMP,type:Fi.ANNOT,alt:this.translatePipe.transform("STAMP_TOOL"),iconClass:"papycon-image",use:K.get(ie.STAMP_ANNOTATION_BUTTON)}]}initRedactMenus(){return[{tool:Qe.REDACTION,type:Fi.ANNOT,alt:this.translatePipe.transform("MARK_FOR_REDACTION"),iconClass:"papycon-redaction-partial2",use:this.documentService.checkAuthority(Ne.DRAW_REDACTION)},{tool:De.SearchingRedaction,type:Fi.SIDE_VIEW,alt:this.translatePipe.transform("SEARCH"),iconClass:"papycon-text-search",use:this.documentService.checkAuthority(Ne.DRAW_REDACTION)}]}initSignMenus(){return[{tool:Qe.SIGNATURE,type:Fi.ANNOT,alt:this.translatePipe.transform("SIGN"),iconClass:"papycon-signature",use:K.get(ie.SIGNATURE_WIDGET_BUTTON)}]}ngOnInit(){this.initSubscriptions(),this.resize(),this.subscribeSubtoolMenuCloser(),this.initRegisterQuickActions()}onClickUndo(){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()}onClickRedo(){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()}activateTool(t){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}switch(t.type){case Fi.ANNOT:this.activateAnnotTool(t.tool);return;case Fi.DRAG:this.activateDragModeTool(t.tool);return;case Fi.SIDE_VIEW:this.activateSideView(t.tool);return}}activateAnnotTool(t,i){if(!this.documentService.checkAuthority(Ne.DRAW_ANNOTATION))return;this.menuItems.forEach(n=>{n.menuState="off"}),this.initAnnotationState();let e=this.currentTool;if(Qe.STAMP===t){this.dialogService.toggleDialogVisibility($i.STAMP_CREATION,!0);return}if(Qe.INSTANT_SIGNATURE===t){this.signatureService.prepareSignature().subscribe({next:()=>{this.signatureService.toggleOverlay(!1),this.signatureService.toggleSignatureModuleLoadingDialog(!1),this.store$.dispatch(Ki.selectTool({payload:t})),this.changeDetectorRef.markForCheck()}});return}else if(Qe.INVISIBLE_SIGNATURE===t){this.store$.dispatch(Ki.selectTool({payload:null})),this.signatureService.prepareSignature().pipe(Ve(()=>this.signatureService.createEmptySignatureAnnot(0)),st(n=>this.signatureService.injectSignature(n,"create")),F(n=>!!n)).subscribe();return}t===Qe.REDACTION&&this.sideViewMode===De.SearchingRedaction&&this.store$.dispatch(ue.set({key:"sideViewMode",value:De.Redaction})),t!==e?(this.store$.dispatch(Ki.selectTool({payload:t})),this.changeDetectorRef.markForCheck()):this.store$.dispatch(Ki.unselectTool()),this.windowWidth<this.breakPointOfMobile&&(this.selectedSubtools=[]),t===Qe.ERASER&&this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})),this.annotService.closeEditor()}activateDragModeTool(t){this.store$.dispatch(ue.set({key:"dragMode",value:t})),this.store$.dispatch(Ki.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor()}activateSideView(t){switch(t){case De.SearchingRedaction:this.sideViewVisible||this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0})),this.currentTool===Qe.REDACTION&&this.store$.dispatch(Ki.unselectTool());let i=this.sideViewMode===De.SearchingRedaction?De.Redaction:De.SearchingRedaction;this.store$.dispatch(ue.set({key:"sideViewMode",value:i}));return}}activateAnnotToolForStatistics(t,i){this.activateAnnotTool(i)}getToolMenus(){return this.viewerService.isSubToolbarType(lt.ANNOTATE)?this.annotateMenus:this.viewerService.isSubToolbarType(lt.INSERT)?this.insertMenus:this.viewerService.isSubToolbarType(lt.REDACT)?this.redactMenus:this.viewerService.isSubToolbarType(lt.SIGN)?this.signMenus:[]}expanderClicked(t){t.menuState=t.menuState==="off"?"on":"off",this.menuItems.forEach(i=>{!i.hasOwnProperty("subtools")||i===t||(i.menuState="off")}),t.hasOwnProperty("subtools")&&(this.selectedSubtools=t.menuState==="off"?[]:[...t.subtools])}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}isActivated(t){switch(t.type){case Fi.ANNOT:return this.currentTool===t.tool;case Fi.DRAG:return this.dragMode===t.tool&&this.currentTool===null;case Fi.SIDE_VIEW:return this.sideViewMode===t.tool;default:return console.error("Unknown tool menu type:",t.type),!1}}styleOfMenuTool(t){return this.isActivated(t)||!w.isDefined(t.tool)?"white":"dark"}toggleRightSideView(){this.rightSideViewMode!==Rt.AnnotProperty&&this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.AnnotProperty})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!this.visibleRightSideView}))}toggleFormFieldHighlight(t){this.preferenceService.updatePreferences(["formFieldHighlighted"],!this.formFieldHighlighted)}toggleFormFieldHighlightForStatistics(t){this.toggleFormFieldHighlight()}toggleRuler(t){this.store$.dispatch(ue.set({key:"rulerActive",value:!this.rulerActive}))}toggleRulerForStatistics(t){this.toggleRuler()}isAnnotPropertyViewActive(){return this.visibleRightSideView&&this.rightSideViewMode===Rt.AnnotProperty}createMenus(){let t=[...this.annotateMenus];if(!G.isMobile())return t;let i=[Qe.HIGHLIGHT,Qe.STRIKE,Qe.UNDERLINE];return t.filter(e=>!i.includes(e.tool))}subscribeAnnotContext(){this.subscriptionService.push(this.store$.pipe(Wo()).subscribe({next:t=>{if(this.currentTool=t,t===Qe.ERASER){this.annotSelectedService.unselectAll();return}if(t!==null){this.isDeepCopy=!1;let i=this.defaultAnnot.getAnnot(t,this.isDeepCopy);if(!i)return;this.annotSelectedService.unselectAll(),this.annotSelectedService.add({data:i,elementRef:void 0})}else this.annotSelectedService.unselectAll();this.changeDetectorRef.markForCheck()}}))}initSubscriptions(){this.subscribeAnnotContext(),this.subscriptionService.push(this.store$.pipe(oi("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("sideViewMode")).subscribe({next:t=>this.sideViewMode=t}),this.store$.pipe($("sideViewVisible")).subscribe({next:t=>this.sideViewVisible=t}),this.store$.pipe(fi([B.TOOLBAR_DRAG_MODE_SELECT_ANNOTATION,B.ANNOTATION_INK,B.ANNOTATION_LINE,B.ANNOTATION_SQUARE,B.ANNOTATION_CIRCLE,B.ANNOTATION_POLYLINE,B.ANNOTATION_POLYGON,B.ANNOTATION_CLOUD,B.ANNOTATION_TEXT_FREE,B.ANNOTATION_TEXT_CALLOUT,B.ANNOTATION_TEXT_POPUP,B.ANNOTATION_LINE_DIMENSION,B.ANNOTATION_POLYLINE_DIMENSION,B.ANNOTATION_POLYGON_DIMENSION,B.ANNOTATION_STAMP,B.ANNOTATION_HIGHLIGHT,B.ANNOTATION_STRIKE,B.ANNOTATION_UNDERLINE,B.ANNOTATION_LINK,B.ANNOTATION_SIGNATURE,B.ANNOTATION_TEXT_FIELD,B.ANNOTATION_COMBO_BOX,B.ANNOTATION_LIST_BOX,B.ANNOTATION_CHECK_BUTTON,B.ANNOTATION_RADIO_BUTTON,B.ANNOTATION_BUTTON,B.ANNOTATION_ERASER,B.ANNOTATION_PROPERTY_PANEL,B.ANNOTATION_UNDO_REDO,B.TOOLBAR_DRAG_MODE_SELECT_FORM,B.FORM_SIGNATURE,B.FORM_TEXT_FIELD,B.FORM_COMBO_BOX,B.FORM_LIST_BOX,B.FORM_CHECK_BUTTON,B.FORM_RADIO_BUTTON,B.FORM_BUTTON,B.FORM_PROPERTY_PANEL,B.FORM_UNDO_REDO,B.FORM_RULER,B.FORM_HIGHLIGHT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.annotateMenus=this.initAnnotateMenus(),Object.keys(this.hidableMenus).forEach(i=>{if(!this.hidableMenus[i])return;let[e,n]=i.split(".");this.hideAnnotTool(e,n)}),this.changeDetectorRef.markForCheck()}}),G.windowResize$.subscribe({next:t=>this.resize(t)}),this.documentService.authorityUpdate$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.annotEvent$.pipe(F(t=>t!==null)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.annotListEvent$.pipe(F(t=>t!==null)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>{this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:t=>{this.visibleRightSideView=t,this.selectedSubtools=[],this.changeDetectorRef.markForCheck()}}),this.store$.pipe(oi("formFieldHighlighted")).subscribe({next:t=>{this.formFieldHighlighted=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rulerActive")).subscribe({next:t=>{this.rulerActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("dragMode")).subscribe({next:t=>{this.dragMode=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("viewMode")).subscribe({next:t=>this.viewMode=t}),this.actionHistoryService.availableUndoCount$.subscribe({next:t=>{this.canUndo=t>0,this.changeDetectorRef.detectChanges()}}),this.actionHistoryService.availableRedoCount$.subscribe({next:t=>{this.canRedo=t>0,this.changeDetectorRef.detectChanges()}}),this.store$.pipe(fp()).subscribe({next:t=>this.annotContext=t}),this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.annotToolChangeAppliedSrc).subscribe({next:()=>{this.getToolMenus().forEach(t=>{if(!this.isNestedMenuItem(t)||!w.isDefined(this.annotService.annotTool)||!t.subtools.map(e=>e.tool).includes(this.annotService.annotTool))return;let i=t.subtools.findIndex(e=>e.tool===this.annotService.annotTool);i<0||(t.lastUsed=i)})}}),this.viewerService.subToolbar$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}isNestedMenuItem(t){return"subtools"in t}isExpandable(t){return this.isNestedMenuItem(t)&&t.subtools.filter(i=>i.use).length>1}hideAnnotTool(t,i){let e=[];t==="ANNOTATION"&&(e=this.annotateMenus);let n=-1,r=e.findIndex(g=>this.isNestedMenuItem(g)?(n=g.subtools.findIndex(v=>v.tool===i),n!==-1):g.tool===i),c=e[r];if(w.isDefined(c))if(this.isNestedMenuItem(c)){if(c.subtools[n].use=!1,n===c.lastUsed){let g=c.subtools.findIndex(v=>v.use);g===-1&&(c.use=!1),c.lastUsed=g,this.store$.dispatch(Ki.unselectTool())}}else c.use=!1}resize(t){this.menuItems=this.buildMenu(),t&&this.changeDetectorRef.markForCheck()}buildMenu(){return this.menuItems?this.menuItems:this.createMenus()}subscribeSubtoolMenuCloser(){this.subscriptionService.push()}closeAnnotationToolbar(){this.viewerService.closeSubToolbar(),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1}))}activateLastTool(t,i){this.menuItems.forEach(e=>{if(!this.isNestedMenuItem(e))return;let n=e.subtools.find(r=>r.tool===t.tool);w.isDefined(n)&&(e.lastUsed=i)})}initAnnotationState(){this.store$.dispatch(Ki.setAttributes({payload:null})),this.store$.dispatch(Ki.updateStampContext({payload:{width:null,height:null,dataURL:this.annotContext.stamp?.dataURL??null,name:null}})),this.annotService.initGesture()}initRegisterQuickActions(){this.quickActionService.registerActions([{id:ve.INK_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_INK_BY_QUICK_SEARCH,Qe.INK)},{id:ve.LINE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_LINE_BY_QUICK_SEARCH,Qe.LINE)},{id:ve.SQUARE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_SQUARE_BY_QUICK_SEARCH,Qe.SQUARE)},{id:ve.CIRCLE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_CIRCLE_BY_QUICK_SEARCH,Qe.CIRCLE)},{id:ve.POLYGON_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_POLYGON_BY_QUICK_SEARCH,Qe.POLYGON)},{id:ve.POLYLINE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_POLYLINE_BY_QUICK_SEARCH,Qe.POLYLINE)},{id:ve.POLYGON_CLOUD_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_POLYGON_CLOUD_BY_QUICK_SEARCH,Qe.CLOUD)},{id:ve.FREE_TEXT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_FREE_TEXT_BY_QUICK_SEARCH,Qe.TEXT_FREE)},{id:ve.FREE_TEXT_CALLOUT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_FREE_TEXT_CALLOUT_BY_QUICK_SEARCH,Qe.TEXT_CALLOUT)},{id:ve.TEXT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_TEXT_BY_QUICK_SEARCH,Qe.TEXT_POPUP)},{id:ve.DISTANCE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_DISTANCE_BY_QUICK_SEARCH,Qe.LINE_DIMENSION)},{id:ve.PERIMETER_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_DISTANCE_BY_QUICK_SEARCH,Qe.POLYLINE_DIMENSION)},{id:ve.AREA_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_AREA_BY_QUICK_SEARCH,Qe.POLYGON_DIMENSION)},{id:ve.STAMP_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_STAMP_BY_QUICK_SEARCH,Qe.STAMP)},{id:ve.HIGHLIGHT,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_HIGHLIGHT_BY_QUICK_SEARCH,Qe.HIGHLIGHT)},{id:ve.STRIKEOUT,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_STRIKEOUT_BY_QUICK_SEARCH,Qe.STRIKE)},{id:ve.UNDERLINE,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_UNDERLINE_BY_QUICK_SEARCH,Qe.UNDERLINE)},{id:ve.CREATE_LINK,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_CREATE_LINK_BY_QUICK_SEARCH,Qe.LINK)},{id:ve.ERASER,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_ERASER_BY_QUICK_SEARCH,Qe.ERASER)},{id:ve.SIGN,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_SIGN_BY_QUICK_SEARCH,Qe.SIGNATURE)},{id:ve.TEXT_FIELD,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_TEXT_FIELD_BY_QUICK_SEARCH,Qe.TEXT_FIELD)},{id:ve.COMBO_BOX,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_COMBO_BOX_BY_QUICK_SEARCH,Qe.COMBO_BOX)},{id:ve.LIST_BOX,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_LIST_BOX_BY_QUICK_SEARCH,Qe.LIST_BOX)},{id:ve.CHECK_BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_LIST_BOX_BY_QUICK_SEARCH,Qe.CHECK_BUTTON)},{id:ve.RADIO_BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_RADIO_BUTTON_BY_QUICK_SEARCH,Qe.RADIO_BUTTON)},{id:ve.BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_BUTTON_BY_QUICK_SEARCH,Qe.BUTTON)},{id:ve.RULER,actionFn:()=>this.toggleRulerForStatistics(fe.CHANGE_RULER_BY_QUICK_SEARCH)},{id:ve.FORMFIELD_HIGHLIGHTED,actionFn:()=>this.toggleFormFieldHighlightForStatistics(fe.CHANGE_FORMFIELD_HIGHLIGHTED_BY_QUICK_SEARCH)}])}};N(qr,"\u0275fac",function(i){return new(i||qr)(_(ri),_(jr),_(at),_(Pn),_(Ae),_(pp),_(zt),_(an),_(Ni),_(ct),_(ee),_(Uo),_(eo),_(ye),_(He),_(Gr),_(to),_(Qt),_(ln),_(Zt))}),N(qr,"\u0275cmp",Ce({type:qr,selectors:[["sd-annot-toolbar"]],standalone:!1,features:[xe([ee,{provide:qn,useValue:new Ht(300)}])],decls:9,vars:5,consts:[["redoUndo",""],[1,"left"],[1,"right"],[1,"annotation"],[4,"ngIf"],[1,"full","divider"],["class","panel",4,"ngIf"],[4,"ngTemplateOutlet"],[1,"divider"],[1,"redo-undo-container"],[4,"ngFor","ngForOf"],[1,"tool-container"],[1,"tool-button",3,"click","title","tooltip"],[1,"papycon",3,"ngClass"],["class","ep-text-button expand-button",3,"dark","click",4,"ngIf"],["class","subtool-menu",4,"ngIf"],[1,"ep-text-button","expand-button",3,"click"],[1,"papycon","papycon-chevron3-down"],[1,"subtool-menu"],[1,"ep-text-button",3,"click","title","tooltip"],[1,"panel"],[1,"ep-text-button","annot-property-toggle",3,"click","title","tooltip"],[1,"papycon","papycon-palette"],[1,"redo-undo"],["size","tiny",1,"ep-text-button",3,"click","disabled","tooltip"],[1,"papycon","papycon-undo"],[1,"papycon","papycon-redo"]],template:function(i,e){i&1&&(se(0,iu,3,1,"section",1),A(1,"section",2),se(2,ou,3,1),A(3,"section",3),se(4,du,2,1,"ng-container",4),D(),se(5,hu,1,0,"div",5)(6,uu,6,16,"section",6),D(),se(7,gu,7,20,"ng-template",null,0,Li)),i&2&&(Kt(e.showUndoRedoBtn?0:-1),x(2),Kt(e.showUndoRedoBtn&&e.windowWidth<e.breakPointOfMobile?2:-1),x(2),O("ngIf",e.documentService.checkAuthority(e.DocumentAction.DRAW_ANNOTATION)),x(),Kt(e.windowWidth<e.breakPointOfMobile?5:-1),x(),O("ngIf",e.isVisiblePropertyButton))},dependencies:[Oo,yi,bt,Js,wo,He],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}[_nghost-%COMP%]{position:relative;display:flex;box-sizing:border-box;background-color:var(--mono-00);border-bottom:1px solid var(--mono-30);z-index:2}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon){border-width:0;outline-offset:-2px;padding:2px}section[_ngcontent-%COMP%]{display:flex}section[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{align-self:center;height:24px;width:1px;background-color:var(--mono-30)}section[_ngcontent-%COMP%] > .divider.full[_ngcontent-%COMP%]{height:100%}section.right[_ngcontent-%COMP%]{width:100%}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]{align-items:center;padding:0 16px 0 24px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]{position:relative}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark.active[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark.active[_ngcontent-%COMP%]{color:var(--mono-00)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled,.active):hover, section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled,.active):hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i.papycon.bold[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i.papycon.bold[_ngcontent-%COMP%]{font-weight:500}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]{background-color:var(--mono-00);border-color:var(--mono-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%]{border-radius:4px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button.active[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button.active[_ngcontent-%COMP%]{background-color:#f166251a;color:var(--primary-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .active-indicator[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .active-indicator[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 3px);width:100%;height:3px;background-color:var(--primary-50);border-radius:2px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%] + .expand-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%] + .expand-button[_ngcontent-%COMP%]{margin-left:2px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%]{margin-left:20px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container.expandable[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container.expandable[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%]{margin-left:12px}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%]{margin-left:auto}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin:auto 12px}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%] > button.dark[_ngcontent-%COMP%]:not(.active):hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;position:absolute;top:calc(100% + 9px);column-gap:12px;box-sizing:border-box;padding:6px 8px;margin-top:5px;border:1px solid var(--mono-30);border-radius:2px;background-color:var(--mono-00);white-space:nowrap;z-index:3}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:var(--mono-00);background-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .subtool-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px}.redo-undo[_ngcontent-%COMP%]{padding:0 24px 0 16px;display:flex;gap:24px;align-items:center}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:22px}@media screen and (max-width: 811px){[_nghost-%COMP%]{justify-content:flex-end}}@media screen and (max-width: 575px){section.left[_ngcontent-%COMP%]{display:none}section.right[_ngcontent-%COMP%]{width:100%;position:relative}section.right[_ngcontent-%COMP%]   section.subtool-container[_ngcontent-%COMP%]{align-items:center;position:absolute;top:43px;width:100%;height:43px;padding:0 12px;gap:12px;background-color:var(--mono-10);box-shadow:0 2px 1px rgba(var(--mono-70),.12);border-bottom:1px solid var(--mono-30)}section.right[_ngcontent-%COMP%]   section.subtool-container[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--mono-00);background-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]{padding:0 14px;flex:1;white-space:nowrap;overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]{display:inline-block}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{vertical-align:middle}.redo-undo[_ngcontent-%COMP%]{padding:0 16px;display:flex;gap:10px;align-items:center}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:22px}}"],data:{animation:[Gl.expandSubTool()]},changeDetection:0}));var Ro=qr;ze([ot(it.annotToolbarComp.onClickRedo)],Ro.prototype,"onClickUndo",null);ze([ot(it.annotToolbarComp.onClickUndo)],Ro.prototype,"onClickRedo",null);ze([ot(it.annotToolbarComp.activateAnnotToolForStatistics)],Ro.prototype,"activateAnnotToolForStatistics",null);ze([ot(it.annotToolbarComp.toggleFormFieldHighlightForStatistics)],Ro.prototype,"toggleFormFieldHighlightForStatistics",null);ze([ot(it.annotToolbarComp.toggleRulerForStatistics)],Ro.prototype,"toggleRulerForStatistics",null);var ld=(()=>{let t=class t{};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({imports:[on,yn]}));let s=t;return s})();var Pi=(()=>{class s{bufferedPages=[];_pdfPages=[];get pdfPages(){return this._pdfPages}set pdfPages(i){this._pdfPages=i,this.resolver=new Un(this._pdfPages)}degree=0;isR2L=!1;isSlideshow=!1;resolver=new Un([]);getPageSize(i){return this.resolver.getPageSize(this.degree,i)}getPageFrameOffset(i,e){return this.resolver.getPageFrameOffset(i,this.degree,this.isR2L,e,this.isSlideshow)}getPageContainerSize(i,e){return this.resolver.getPageContainerSize(i,this.degree,e,this.isSlideshow)}}return N(s,"MARGIN",5),N(s,"OPTIONAL_VISIBLE_PAGE",2),s})();var Ma=(()=>{let t=class t{elementRef;renderer;page;constructor(e,n){this.elementRef=e,this.renderer=n}update(e){let{w:n,h:r}=this.page.bbox,c=this.page.r+e,g=Math.abs(Math.sin(c*Math.PI/180)),v=g*(n-r)/2,y=g*(r-n)/2,M=this.elementRef.nativeElement,V=M.querySelector(".loader");w.isDefined(V)&&this.renderer.setStyle(V,"display","flex"),this.renderer.setStyle(M,"marginTop",J.pixelOf(v)),this.renderer.setStyle(M,"marginLeft",J.pixelOf(y)),this.renderer.setStyle(M,"width",J.pixelOf(n)),this.renderer.setStyle(M,"height",J.pixelOf(r)),this.renderer.setStyle(M,"transform",J.rotationNote(c))}};N(t,"\u0275fac",function(n){return new(n||t)(_(ni),_($t))}),N(t,"\u0275dir",bn({type:t,selectors:[["","sdPageContentLayout",""]],inputs:{page:"page"},standalone:!1}));let s=t;return s})();var Ra=(()=>{let t=class t{elementRef;renderer;margin=`${J.pixelOf(Pi.MARGIN)} ${J.pixelOf(Pi.MARGIN)}`;childLayout;page;constructor(e,n){this.elementRef=e,this.renderer=n}update(e,n,r,c){let g=this.elementRef.nativeElement;if(!J.isVisible(this.page.i,n-1,r)){this.renderer.setStyle(g,"visibility","hidden");return}let{height:v,width:y}=e.getPageSize(this.page.i),{offsetX:M,offsetY:V}=e.getPageFrameOffset(r,this.page.i);this.renderer.setStyle(g,"visibility",""),this.renderer.setStyle(g,"height",J.pixelOf(v)),this.renderer.setStyle(g,"width",J.pixelOf(y)),this.renderer.setStyle(g,"margin",e.isSlideshow?J.pixelOf(0):this.margin),this.renderer.setStyle(g,"top",J.pixelOf(V,3)),this.renderer.setStyle(g,"left",J.pixelOf(M,3)),this.childLayout?.update(c)}};N(t,"\u0275fac",function(n){return new(n||t)(_(ni),_($t))}),N(t,"\u0275dir",bn({type:t,selectors:[["","sdPageFrameLayout",""]],contentQueries:function(n,r,c){if(n&1&&Bo(c,Ma,5),n&2){let g;Me(g=Re())&&(r.childLayout=g.first)}},inputs:{page:"page"},standalone:!1}));let s=t;return s})();var Ia=(()=>{let t=class t{elementRef;renderer;childLayout;constructor(e,n){this.elementRef=e,this.renderer=n}update(e,n,r,c,g){this.renderer.setStyle(this.elementRef.nativeElement,"transform",`scale(${J.normalizeScale(n)})`),this.childLayout.forEach(v=>v.update(e,r,c,g))}};N(t,"\u0275fac",function(n){return new(n||t)(_(ni),_($t))}),N(t,"\u0275dir",bn({type:t,selectors:[["","sdScrollExpanderLayout",""]],contentQueries:function(n,r,c){if(n&1&&Bo(c,Ra,4),n&2){let g;Me(g=Re())&&(r.childLayout=g)}},standalone:!1}));let s=t;return s})();var ro=(()=>{let t=class t{elementRef;renderer;static getOffset(e,n,r,c,g){let v=J.normalizeScale(r),y=e.getPageContainerSize(c,g-1),M=y.width*v,V=y.height*v,Z=n.offsetWidth-G.scrollbarSize.vertical,le=n.offsetHeight-G.scrollbarSize.horizontal;return{offsetX:Math.max((Z-M)/2,0),offsetY:Math.max((le-V)/2,0)}}childLayout;constructor(e,n){this.elementRef=e,this.renderer=n}update(e,n,r,c,g,v){let y=J.normalizeScale(r),M=e.getPageContainerSize(c,g-1),V=M.width*y,Z=M.height*y,le=t.getOffset(e,n,r,c,g),pe=this.elementRef.nativeElement;this.renderer.setStyle(pe,"paddingLeft",J.pixelOf(le.offsetX,3)),this.renderer.setStyle(pe,"paddingRight",J.pixelOf(le.offsetX,3)),this.renderer.setStyle(pe,"marginTop",J.pixelOf(le.offsetY,3)),this.renderer.setStyle(pe,"width",J.pixelOf(V,3)),this.renderer.setStyle(pe,"height",J.pixelOf(Z,3)),this.renderer.setStyle(pe,"overflow","hidden"),this.childLayout?.update(e,r,g,c,v)}};N(t,"\u0275fac",function(n){return new(n||t)(_(ni),_($t))}),N(t,"\u0275dir",bn({type:t,selectors:[["","sdScaleWrapperLayout",""]],contentQueries:function(n,r,c){if(n&1&&Bo(c,Ia,5),n&2){let g;Me(g=Re())&&(r.childLayout=g.first)}},standalone:!1}));let s=t;return s})();var Aa=(()=>{let t=class t{elementRef;childLayout;constructor(e){this.elementRef=e}update(e,n,r,c,g){this.childLayout?.update(e,this.elementRef.nativeElement,n,r,c,g)}};N(t,"\u0275fac",function(n){return new(n||t)(_(ni))}),N(t,"\u0275dir",bn({type:t,selectors:[["","sdContentViewLayout",""]],contentQueries:function(n,r,c){if(n&1&&Bo(c,ro,5),n&2){let g;Me(g=Re())&&(r.childLayout=g.first)}},standalone:!1}));let s=t;return s})();var hd=pl(dd());var mu=["containerWrapperRef"],vu=()=>({"object-fit":"contain"});function _u(s,t){s&1&&Q(0,"sd-loader")}function Su(s,t){if(s&1){let i=Se();A(0,"sd-image",8),ce("rendered",function(){W(i);let n=E().$implicit,r=E(2);return z(r.onImageRendered(n))}),D()}if(s&2){let i=E().$implicit,e=E(2);O("pdfPage",i)("documentId",e.documentId)("ngStyle",e.rotateImage(i.r))("imgStyle",Zs(4,vu))}}function bu(s,t){if(s&1&&(A(0,"div",5),se(1,_u,1,0,"sd-loader",6)(2,Su,1,5,"sd-image",7),D()),s&2){let i=t.$implicit,e=E(2);x(),O("ngIf",!e.isLoadedPage(i)),x(),O("ngIf",e.isVisiblePage(i))}}function Cu(s,t){if(s&1&&(A(0,"div",3),se(1,bu,3,2,"div",4),D()),s&2){let i=E();nn("visibility",i.eBookReady?"visible":"hidden"),O("ngStyle",i.eBookContainerStyle()),x(),O("ngForOf",i.pdfPages)}}var br=function(s){return s.SINGLE="single",s.DOUBLE="double",s}(br||{}),Da=function(s){return s.TL_TR="tl,tr",s.BL_BR="bl,br",s}(Da||{}),Sc=(()=>{let t=class t{contentService;documentService;elementRef;changeDetectorRef;shortcutService;subscriptionService;renderer;scrollController;store$;pageService;documentId;containerWrapperRef;eBookReady=!1;containerWrapperStyle={};WIDTH_MARGIN=64;HEIGHT_MARGIN=64;currentPageNo;pageCount;eBook;bookPageRatio;isR2L=!1;bookSize={width:0,height:0};bookDisplayMode;containerStyle={};loadedPageNoArr=[];prevPageNoRange=[];scale=100;dragListeners=[];prevDragEvent;pdfPages=[];get isDragging(){return this.dragListeners.length>0}get scrollContainer(){if(!w.isDefined(this.elementRef.nativeElement.parentElement))throw new Cn("Parent element is not defined.");return this.elementRef.nativeElement.parentElement}constructor(e,n,r,c,g,v,y,M,V,Z){this.contentService=e,this.documentService=n,this.elementRef=r,this.changeDetectorRef=c,this.shortcutService=g,this.subscriptionService=v,this.renderer=y,this.scrollController=M,this.store$=V,this.pageService=Z}ngOnInit(){this.initSubscriptions()}ngOnChanges(){this.eBookReady=!1,this.calcBookPageRatio(),this.eBook&&(this.eBook.turn("destroy"),this.eBook=void 0),setTimeout(()=>{this.bindEbook()})}onWrapperMousedown(e){this.prevDragEvent=e,this.dragListeners.push(this.renderer.listen(this.containerWrapperRef.nativeElement,"mousemove",n=>this.onMoveEvent(n)),this.renderer.listen(this.containerWrapperRef.nativeElement,"mouseup",()=>this.onEndDragEvent()),this.renderer.listen(this.containerWrapperRef.nativeElement,"mouseleave",()=>this.onEndDragEvent()))}eBookContainerStyle(){return this.containerStyle}isLoadedPage(e){return!!this.loadedPageNoArr[e.i+1]}isVisiblePage(e){return this.prevPageNoRange.includes(e.i+1)}onImageRendered(e){this.loadedPageNoArr[e.i+1]=!0,this.contentService.publishSomePageLoaded(!0),this.changeDetectorRef.markForCheck()}hasPageNo(e){return e.referencePoint===void 0}initSubscriptions(){this.subscriptionService.push(this.store$.pipe($("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),this.store$.pipe($("pageCount")).subscribe({next:e=>this.pageCount=e}),this.shortcutService.getShortcutEvent(Pe.EBOOK_PREVIOUS_PAGE).pipe(dr(100),F(()=>this.eBook)).subscribe({next:()=>this.eBook.turn("previous")}),this.shortcutService.getShortcutEvent(Pe.EBOOK_NEXT_PAGE).pipe(dr(100),F(()=>this.eBook)).subscribe({next:()=>this.eBook.turn("next")}),this.contentService.viewChangeRequest$.pipe(F(()=>this.eBook),F(this.hasPageNo),Ve(e=>e.pageNo),F(w.isDefined),Ve(e=>Math.min(Math.max(1,e),this.pageCount)),Yn()).subscribe({next:e=>this.eBook.turn("page",e)}),ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).subscribe({next:()=>{this.eBook&&this.safeCallTurnJS(()=>{this.decideDisplayMode(),this.calcBookSize(),this.eBook.turn("size",this.bookSize.width,this.bookSize.height)})}}),this.documentService.pdfInfo$.pipe(Sl(this.store$.pipe(oi("viewerDirection")))).subscribe({next:([e,n])=>this.decideR2L(e,n)}),this.store$.pipe($("scale")).subscribe({next:e=>{if(this.scale=e,this.eBook){let n=1,r=this.bookSize.width;this.safeCallTurnJS(()=>{this.decideDisplayMode(),this.calcBookSize(),n=this.bookSize.width/r,this.eBook.turn("size",this.bookSize.width,this.bookSize.height)});let c=this.scrollController.jumpingOrigin;c.x>0&&(this.scrollContainer.scrollLeft=(this.scrollContainer.scrollLeft+c.x)*n-c.x),c.y>0&&(this.scrollContainer.scrollTop=(this.scrollContainer.scrollTop+c.y)*n-c.y)}}}),this.pageService.pdfPages$.subscribe({next:e=>this.pdfPages=e}))}calcBookPageRatio(){if(!this.pdfPages)return;let e={},n=0,r=0;this.pdfPages.forEach(c=>{let g=(c.bbox.h/c.bbox.w).toFixed(5);e[g]?e[g]++:e[g]=1});for(let c in e)e[c]>n&&(n=e[c],r=Number(c));this.bookPageRatio=r}decideDisplayMode(){let e=this.bookDisplayMode||null;this.bookDisplayMode=G.isMobile()?br.SINGLE:br.DOUBLE,e&&e!==this.bookDisplayMode&&this.eBook.turn("display",this.bookDisplayMode)}calcBookSize(){this.bookPageRatio||this.calcBookPageRatio();let e=this.scrollContainer.clientWidth-(G.isMobile()?0:this.WIDTH_MARGIN*2),n=this.scrollContainer.clientHeight-(G.isMobile()?0:this.HEIGHT_MARGIN*2),r=n/e,c=this.bookDisplayMode===br.SINGLE?this.bookPageRatio:this.bookPageRatio/2,g,v;c>r?(v=n,g=v/c):(g=e,v=g*c),this.pdfPages.some(V=>V.r===90||V.r===270)&&(v=this.bookDisplayMode===br.SINGLE?g:g/2),this.bookSize.width=g*(this.scale/100),this.bookSize.height=v*(this.scale/100),this.containerWrapperStyle.width=`${this.bookSize.width}px`,this.containerWrapperStyle.height=`${this.bookSize.height}px`;let y="0",M="0";return this.bookSize.width<this.scrollContainer.clientWidth&&(y=`${((this.scrollContainer.clientWidth-this.bookSize.width)/2).toFixed(2)}px`),this.bookSize.height<this.scrollContainer.clientHeight&&(M=`${((this.scrollContainer.clientHeight-this.bookSize.height)/2).toFixed(2)}px`),this.containerWrapperStyle.transform=`translate(${y}, ${M})`,this.bookSize}bindEbook(){this.decideDisplayMode(),this.calcBookSize(),this.updateEbookStyle(),this.eBook=(0,hd.default)("#ebook"),this.eBook.turn({display:this.bookDisplayMode,elevation:50,gradients:!0,autoCenter:!1,acceleration:!0,pages:this.pdfPages.length,duration:500,page:this.currentPageNo,width:this.bookSize.width,height:this.bookSize.height,direction:this.isR2L?"rtl":"ltr",when:{start:(r,c,g)=>{let v=Da.TL_TR.includes(g)?Da.TL_TR:Da.BL_BR;this.eBook.turn("options",{turnCorners:v})},turning:(r,c)=>{let g=J.getEbookPageNo(c);this.updateEbookStyle(g),this.store$.dispatch(ue.set({key:"currentPageNo",value:this.bookDisplayMode===br.SINGLE?c:g})),this.scrollController.updateReadStatus(),this.changeDetectorRef.markForCheck()},end:()=>{let[r,c]=this.eBook.turn("range"),g=Array.from(new Array(c-r+1),(v,y)=>y+r);this.prevPageNoRange&&this.prevPageNoRange.forEach(v=>{g.includes(v)||(this.loadedPageNoArr[v]=!1)}),this.prevPageNoRange=g,this.changeDetectorRef.markForCheck()}}});let[e,n]=this.eBook.turn("range");this.prevPageNoRange=Array.from(new Array(n-e+1),(r,c)=>c+e),this.eBookReady=!0,this.changeDetectorRef.markForCheck()}updateEbookStyle(e){if(this.bookDisplayMode===br.SINGLE)return;let n=e;if(w.isDefined(n)||(n=this.currentPageNo),!w.isDefined(this.containerWrapperStyle.width))throw new Cn("Container wrapper style width is not defined.");let r=parseInt(this.containerWrapperStyle.width,10),c=Math.min(r-this.bookSize.width,this.bookSize.width/2)+(r-this.bookSize.width<this.bookSize.width/2?(this.bookSize.width/2-(r-this.bookSize.width))/2:0);n===1||n===this.pageCount?this.containerStyle["margin-left"]=`${this.isR2L!==(n===1)?"-":""}${c.toFixed(3)}px`:this.containerStyle["margin-left"]=null}decideR2L(e,n){let r=n===0?e?.ViewerPreferences?.Direction==="R2L":n===2;this.store$.dispatch(ue.set({key:"isR2L",value:r})),this.changeDirection(this.isR2L?"rtl":"ltr")}changeDirection(e){if(!this.eBook)return;this.eBook.turn("direction")!==e&&this.safeCallTurnJS(()=>{this.eBook.turn("direction",e)})}safeCallTurnJS(e){this.containerStyle.transition="none",this.containerStyle["margin-left"]=null,this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges(),e(),this.updateEbookStyle(),this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges(),this.containerStyle.transition=null}onMoveEvent(e){if(!w.isDefined(this.prevDragEvent))throw new ci("prevDragEvent is not initialized. Call onWrapperMousedown() first.");let n=e.clientX-this.prevDragEvent.clientX,r=e.clientY-this.prevDragEvent.clientY;n&&(this.scrollContainer.scrollLeft-=n),r&&(this.scrollContainer.scrollTop-=r),!(!r&&!n)&&(this.prevDragEvent=e)}onEndDragEvent(){this.dragListeners.forEach(e=>e()),this.dragListeners.splice(0),this.changeDetectorRef.markForCheck()}rotateImage(e){return{transform:`rotate(${e}deg)`}}};N(t,"\u0275fac",function(n){return new(n||t)(_(at),_(ct),_(ni),_(Ae),_(sn),_(ee),_($t),_(zi),_(ye),_(zt))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-ebook-view"]],viewQuery:function(n,r){if(n&1&&Ye(mu,7),n&2){let c;Me(c=Re())&&(r.containerWrapperRef=c.first)}},inputs:{documentId:"documentId"},standalone:!1,features:[xe([ee]),tn],decls:3,vars:4,consts:[["containerWrapperRef",""],[1,"container-wrapper",3,"mousedown","ngStyle"],["id","ebook","class","animated",3,"visibility","ngStyle",4,"ngIf"],["id","ebook",1,"animated",3,"ngStyle"],["class","pdf-page",4,"ngFor","ngForOf"],[1,"pdf-page"],[4,"ngIf"],[3,"pdfPage","documentId","ngStyle","imgStyle","rendered",4,"ngIf"],[3,"rendered","pdfPage","documentId","ngStyle","imgStyle"]],template:function(n,r){if(n&1){let c=Se();A(0,"div",1,0),ce("mousedown",function(v){return W(c),z(r.onWrapperMousedown(v))}),se(2,Cu,2,4,"div",2),D()}n&2&&($e("dragging",r.isDragging),O("ngStyle",r.containerWrapperStyle),x(2),O("ngIf",(r.pdfPages==null?null:r.pdfPages.length)>0))},styles:[".container-wrapper[_ngcontent-%COMP%]{cursor:grab;overflow:hidden}.container-wrapper.dragging[_ngcontent-%COMP%]{cursor:grabbing}#ebook[_ngcontent-%COMP%]{width:100%;height:100%;z-index:0;overflow:initial!important}.animated[_ngcontent-%COMP%]{transition:margin-left .2s ease-in-out}.pdf-page[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%;background-color:#fff}.pdf-page[_ngcontent-%COMP%]   sd-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]  .page.p-temporal{background-color:#fff}"],changeDetection:0}));let s=t;return s})();function xu(s,t){s&1&&Q(0,"sd-bottom-right-indicator")}function Tu(s,t){s&1&&Q(0,"sd-scale-indicator")}var Na=(()=>{let t=class t{changeDetectorRef;subscriptionService;store$;hidableMenus={};get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}viewMode;get isEbookMode(){return this.viewMode===4}get HidableView(){return B}constructor(e,n,r){this.changeDetectorRef=e,this.subscriptionService=n,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("viewMode")).subscribe({next:e=>{this.viewMode=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(fi([B.INDICATOR,B.INDICATOR_SCALE,B.INDICATOR_MEASURE,B.INDICATOR_PAGE])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(Ae),_(ee),_(ye))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-indicator"]],standalone:!1,features:[xe([ee])],decls:2,vars:2,consts:[[4,"ngIf"]],template:function(n,r){n&1&&se(0,xu,1,0,"sd-bottom-right-indicator",0)(1,Tu,1,0,"sd-scale-indicator",0),n&2&&(O("ngIf",!r.isEbookMode&&(!r.hidableMenus[r.HidableView.INDICATOR_MEASURE]||!r.hidableMenus[r.HidableView.INDICATOR_PAGE])),x(),O("ngIf",r.runtimeEnv.get(r.RuntimeEnvKey.SCALE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_SCALE]))},styles:["[_nghost-%COMP%]{pointer-events:none}"],changeDetection:0}));let s=t;return s})();var wu=["viewComp"];function yu(s,t){if(s&1&&Q(0,"sd-measure-body",3,0),s&2){let i=E();O("model",i.model)}}var ka=(()=>{let t=class t{contentService;annotSelectedService;changeDetectorRef;subscriptionService;indicatorState="off";indicatorStyle={};model=null;viewComp;constructor(e,n,r,c){this.contentService=e,this.annotSelectedService=n,this.changeDetectorRef=r,this.subscriptionService=c}ngOnInit(){this.subscriptionService.push(ut(ut(this.contentService.annotListEvent$,this.contentService.annotEvent$).pipe(F(w.isDefined),F(e=>e?.sdEventType===cn.SELECTED)),this.contentService.measureIndicatorEvent$.pipe(F(w.isDefined),F(e=>e.action==="create"))).subscribe({next:e=>this.toggleIndicator(e)}),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>this.toggleIndicator()}),this.contentService.measureIndicatorEvent$.pipe(F(e=>e?.action==="edit")).subscribe({next:()=>this.detectChanges()}))}detectChanges(){this.changeDetectorRef.destroyed||(this.changeDetectorRef.markForCheck(),this.viewComp?.detectChanges&&this.viewComp.detectChanges())}indicatorChanged(e,n){w.animDisplayChange(e,n,"block",null,()=>{this.indicatorState==="off"&&(this.model=null)})}turnOnIndicator(){this.indicatorState="on"}turnOffIndicator(){this.indicatorState="off"}toggleIndicator(e){let n=e;if(this.annotSelectedService.selectedComponents.length===0){this.turnOffIndicator(),this.detectChanges();return}w.isDefined(n)||(n={annot:this.annotSelectedService.selectedComponents[0].data}),Eo.hasDefinedProp(n,"annot")&&(Vt.isLineDimension(n.annot)||Vt.isPolyLineDimension(n.annot)||Vt.isPolygonDimension(n.annot))?(this.model=n.annot,this.turnOnIndicator()):this.turnOffIndicator(),this.detectChanges()}};N(t,"\u0275fac",function(n){return new(n||t)(_(at),_(Ni),_(Ae),_(ee))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-measure-indicator"]],viewQuery:function(n,r){if(n&1&&Ye(wu,5),n&2){let c;Me(c=Re())&&(r.viewComp=c.first)}},standalone:!1,features:[xe([ee])],decls:2,vars:3,consts:[["viewComp",""],[1,"container",3,"ngStyle"],[3,"model",4,"ngIf"],[3,"model"]],template:function(n,r){n&1&&(A(0,"div",1),ce("@indicatorState.done",function(g){return r.indicatorChanged(g,r.indicatorStyle)})("@indicatorState.start",function(g){return r.indicatorChanged(g,r.indicatorStyle)}),se(1,yu,2,1,"sd-measure-body",2),D()),n&2&&(O("@indicatorState",r.indicatorState)("ngStyle",r.indicatorStyle),x(),O("ngIf",r.model))},styles:[".container[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;box-sizing:border-box;min-width:192px;min-height:144px;position:relative;float:right;border:1px solid var(--mono-30);border-radius:2px;background-color:var(--mono-10);opacity:0;display:none;margin-right:35px;padding:16px;pointer-events:none}"],data:{animation:[Zn("indicatorState",[Tn("off",Bi({opacity:0})),Tn("on",Bi({opacity:1})),On("off <=> on",xn("250ms linear"))])]},changeDetection:0}));let s=t;return s})();function Pu(s,t){s&1&&(A(0,"div"),be(1),Y(2,"translate"),D()),s&2&&(x(),Ee(X(2,1,"RATIO")))}function Mu(s,t){s&1&&(A(0,"div"),be(1),Y(2,"translate"),D()),s&2&&(x(),Ee(X(2,1,"PRECISION")))}function Ru(s,t){s&1&&(A(0,"div"),be(1),Y(2,"translate"),D()),s&2&&(x(),Ee(X(2,1,"ROTATION")))}function Iu(s,t){if(s&1&&(A(0,"div"),be(1),D()),s&2){let i=E();x(),Ee(i.model.attributes.Measure.R)}}function Au(s,t){if(s&1&&(A(0,"div"),be(1),D()),s&2){let i=E();x(),Ee(1/i.precision)}}function Du(s,t){if(s&1&&(A(0,"div"),be(1),D()),s&2){let i=E();x(),Ee(i.lineDegree)}}var bc=(()=>{let t=class t{changeDetectorRef;translatePipe;model;get precision(){return!w.isDefined(this.model.attributes.Measure)||!w.isDefined(this.model.attributes.Measure.X)?2:this.model.attributes.Measure.X[0].D}get lineDegree(){if(!this.isLineDimension())return null;let{sp:e,ep:n}=this.model.attributes.coordinates;return ia.getTheta2(e.x,e.y,n.x,n.y).toFixed(Math.log10(this.precision))}get toolName(){return this.isLineDimension()?this.translatePipe.transform("DISTANCE"):this.isPolyLineDimension()?this.translatePipe.transform("PERIMETER"):this.isPolygonDimension()?this.translatePipe.transform("AREA"):this.translatePipe.transform("UNKNOWN")}get toolValue(){let e=Wl.calcMeasurement(this.model);return e.length===0?"0":(Vt.isPolygonDimension(this.model)&&(e+=this.translatePipe.transform("SQUARE_OF")),e)}constructor(e,n){this.changeDetectorRef=e,this.translatePipe=n}isLineDimension(){return Vt.isLineDimension(this.model)}isPolyLineDimension(){return Vt.isPolyLineDimension(this.model)}isPolygonDimension(){return Vt.isPolygonDimension(this.model)}detectChanges(){this.changeDetectorRef.markForCheck()}};N(t,"\u0275fac",function(n){return new(n||t)(_(Ae),_(He))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-measure-body"]],inputs:{model:"model"},standalone:!1,features:[xe([ee])],decls:16,vars:12,consts:[[1,"title"],[1,"property"],[1,"keys"],[4,"ngIf"],[1,"values"]],template:function(n,r){n&1&&(A(0,"div",0),be(1),Y(2,"translate"),D(),A(3,"div",1)(4,"div",2)(5,"div"),be(6),D(),se(7,Pu,3,3,"div",3)(8,Mu,3,3,"div",3)(9,Ru,3,3,"div",3),D(),A(10,"div",4)(11,"div"),be(12),D(),se(13,Iu,2,1,"div",3)(14,Au,2,1,"div",3)(15,Du,2,1,"div",3),D()()),n&2&&(x(),Qs("",r.toolName," ",X(2,10,"TOOL"),""),x(5),Ee(r.toolName),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.isLineDimension()),x(3),Ee(r.toolValue),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.isLineDimension()))},styles:[".title[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-bottom:14px}.property[_ngcontent-%COMP%]{display:flex}.property[_ngcontent-%COMP%]   div.keys[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-right:16px}.property[_ngcontent-%COMP%]   div.keys[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(:first-child){margin-top:2px}.property[_ngcontent-%COMP%]   div.values[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);flex-grow:1}.property[_ngcontent-%COMP%]   div.values[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(:first-child){margin-top:2px}"],changeDetection:0}));let s=t;return s})();var ud=(()=>{let t=class t{};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({imports:[on,yn]}));let s=t;return s})();ai(bc,[bt],[He]);ai(ka,[bt,qt,bc],[]);function Nu(s,t){s&1&&Q(0,"sd-measure-indicator")}function ku(s,t){s&1&&Q(0,"sd-page-indicator")}var Cc=(()=>{let t=class t{subscriptionService;store$;changeDetectorRef;hidableMenus={};get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}get WindowUtil(){return G}get HidableView(){return B}constructor(e,n,r){this.subscriptionService=e,this.store$=n,this.changeDetectorRef=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe(fi([B.INDICATOR_MEASURE,B.INDICATOR_PAGE])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(ee),_(ye),_(Ae))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-bottom-right-indicator"]],standalone:!1,features:[xe([ee])],decls:2,vars:2,consts:[[4,"ngIf"]],template:function(n,r){n&1&&se(0,Nu,1,0,"sd-measure-indicator",0)(1,ku,1,0,"sd-page-indicator",0),n&2&&(O("ngIf",r.runtimeEnv.get(r.RuntimeEnvKey.MEASURE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_MEASURE]),x(),O("ngIf",!r.WindowUtil.isMobile()&&r.runtimeEnv.get(r.RuntimeEnvKey.PAGE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_PAGE]))},styles:["[_nghost-%COMP%]{position:absolute;display:flex;bottom:0;right:0;padding-bottom:40px;flex-direction:column}@media screen and (max-width: 709px){[_nghost-%COMP%]{padding-bottom:82px}}"],changeDetection:0}));let s=t;return s})();var Vu=["img"];function Lu(s,t){s&1&&Q(0,"sd-loader")}var Io=function(s){return s.VISIBLE="visible",s.INVISIBLE="invisible",s}(Io||{}),xc=(()=>{let t=class t{pageService;changeDetectorRef;scrollController;renderer;documentService;contentService;subscriptionService;renderingService;store$;muPDFService;imgEl;MAX_WIDTH=200;MAX_HEIGHT=200;MARGIN=12;pdfPages=[];containerStyles={};imgStyles={};imgData;imgWidth;imgHeight;doc;changesSrc=new Ti;currentViewRect;currentPageNo;thumbnailRatio;currentRotation=0;cachedImageData=null;renderedPageNo=-1;renderingMode=gi.SERVER;get imgLoaded(){return this.imgEl?.nativeElement.style.visibility==="inherit"}get pageIndicatorVisible(){return this.pdfPages?.length&&this._pageIndicatorVisible||Io.INVISIBLE}set pageIndicatorVisible(e){this._pageIndicatorVisible=e}_pageIndicatorVisible=Io.INVISIBLE;constructor(e,n,r,c,g,v,y,M,V,Z){this.pageService=e,this.changeDetectorRef=n,this.scrollController=r,this.renderer=c,this.documentService=g,this.contentService=v,this.subscriptionService=y,this.renderingService=M,this.store$=V,this.muPDFService=Z}ngOnInit(){this.initSubscription()}initSubscription(){this.subscriptionService.push(this.store$.pipe($("currentPageNo")).pipe(Yn(),F(e=>this.currentPageNo!==e)).subscribe({next:e=>{this.currentPageNo=e,this.imgEl&&J.setVisibility(this.imgEl.nativeElement,!1,this.renderer,!0),this.changesSrc.next()}}),this.pageService.pdfPages$.subscribe({next:e=>{this.pdfPages=e,this.changesSrc.next()}}),this.documentService.openedDocument$.pipe(F(w.isDefined)).subscribe({next:e=>{this.doc=e,this.changesSrc.next()}}),this.store$.pipe($("degree")).subscribe({next:e=>{this.currentRotation=e,this.changesSrc.next()}}),this.pageService.pageArrangeEvt$.pipe(F(e=>this.pageService.arrangeAffectedChecker(this.pageNo-1,e))).subscribe({next:()=>{w.isDefined(this.imgEl)&&J.setVisibility(this.imgEl.nativeElement,!1,this.renderer,!0),this.renderedPageNo=-1,this.cachedImageData=null,this.changesSrc.next()}}),this.store$.pipe($("renderingMode"),rt(e=>this.renderingMode=e),F(e=>e===gi.HYBRID),st(()=>this.muPDFService.document$.pipe(F(e=>e.status==="OPENED")))).subscribe({next:()=>{this.renderedPageNo=-1,this.cachedImageData=null,this.fetch(),this.updatePage()}}),this.scrollController.currentViewRect$.pipe(F(w.isDefined),rt(e=>{this.currentViewRect=e.rect,this.updatePage()})).subscribe({next:()=>this.changesSrc.next()}),this.changesSrc.pipe(rt(()=>{this.detectChanges(),this.pageIndicatorVisible=Io.VISIBLE}),ii(50)).subscribe({next:()=>this.fetch()}),this.changesSrc.pipe(ii(2e3)).subscribe({next:()=>{this.pageIndicatorVisible=Io.INVISIBLE,this.renderedPageNo=-1,this.detectChanges()}}),this.contentService.reload$.pipe(Ve(e=>e.pageInfo),F(w.isDefined),F(e=>e[this.pageNo-1]),st(()=>Co(()=>this.renderingMode!==gi.CLIENT?ht(void 0):this.muPDFService.document$.pipe(F(e=>e.status==="OPENED"))))).subscribe({next:()=>{this.renderedPageNo=-1,this.cachedImageData=null,this.fetch()}}))}get pageNo(){return this.currentPageNo}get highlightRect(){return this.currentViewRect&&this.thumbnailRatio?{x:this.MARGIN+this.currentViewRect.x*this.thumbnailRatio,y:this.MARGIN+this.currentViewRect.y*this.thumbnailRatio,w:this.currentViewRect.w*this.thumbnailRatio,h:this.currentViewRect.h*this.thumbnailRatio}:{x:this.MARGIN,y:this.MARGIN,w:Number(this.imgStyles.width)||0,h:Number(this.imgStyles.height)||0}}updatePage(){if(!this.pageNo||!this.pdfPages||!this.pdfPages.length)return;let{bbox:e,r:n}=this.pdfPages[this.pageNo-1],r=this.MAX_WIDTH-this.MARGIN*2,c=this.MAX_HEIGHT-this.MARGIN*2,g=e.w,v=e.h,y=(n+this.currentRotation)/90%2===1;y&&([g,v]=[v,g]),g<v?(this.thumbnailRatio=c/v,r=g*this.thumbnailRatio):(this.thumbnailRatio=r/g,c=v*this.thumbnailRatio),this.imgWidth=r,this.imgHeight=c,this.imgStyles.display="block",this.imgStyles.width=`${y?c:r}px`,this.imgStyles.height=`${y?r:c}px`,this.imgStyles.transform=`rotate(${n+this.currentRotation}deg)`,this.containerStyles.width=`${r+this.MARGIN*2}px`,this.containerStyles.height=`${c+this.MARGIN*2}px`,this.detectChanges()}fetch(){let e=this.pageNo,n=this.cachedImageData;if(!(!this.doc||this.renderedPageNo===e||!this.pdfPages?.length)){if(n&&n.pageNo===e){if(!this.pageIndicatorVisible)return;setTimeout(()=>{this.renderedPageNo=e,this.imgData=si({},n.imageData),w.isDefined(this.imgEl)&&J.setVisibility(this.imgEl.nativeElement,!0,this.renderer,!0),this.detectChanges()});return}this.subscriptionService.set("httpSubscription",Ji([this.renderingService.fetchThumbnail(this.doc.streamdocsId,this.pdfPages[e-1].ref),this.store$.pipe(Yo("ALL"),Ve(r=>kn.filterChanges(r,c=>c.allowView?c.range==="all"?!0:!!Nn.parse(c.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(e-1):!1)),Ve(r=>kn.flattenWatermarks(r))),this.pageService.pageArrangeEvt$.pipe(F(r=>r.page===this.pdfPages[e-1]&&r.action==="rotate"),Lo(void 0))]).pipe(st(([r,c,g])=>{if(r.data===void 0)return this.fetch(),Gs;if(c.length===0)return ht(r);let v;switch(r.type){case"BLOB":v=URL.createObjectURL(r.data);break;case"BASE64":v=r.data;break;default:throw new _t("Cannot handle image data")}return new Ur({imgSrc:v,width:this.pdfPages[e-1].bbox.w,height:this.pdfPages[e-1].bbox.h,rotation:this.pdfPages[e-1].r},c).draw()})).subscribe({next:r=>{this.pageIndicatorVisible&&(this.cachedImageData={pageNo:e,imageData:si({},r)},this.renderedPageNo=e,this.imgData=r,w.isDefined(this.imgEl)&&J.setVisibility(this.imgEl.nativeElement,!0,this.renderer,!0),this.detectChanges())}}))}}detectChanges(){this.changeDetectorRef.destroyed||this.changeDetectorRef.markForCheck()}};N(t,"\u0275fac",function(n){return new(n||t)(_(zt),_(Ae),_(zi),_($t),_(ct),_(at),_(ee),_(jo),_(ye),_($o))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page-indicator"]],viewQuery:function(n,r){if(n&1&&Ye(Vu,5),n&2){let c;Me(c=Re())&&(r.imgEl=c.first)}},standalone:!1,features:[xe([ee])],decls:12,vars:22,consts:[["img",""],[3,"ngStyle"],["id","img-container",3,"ngStyle"],[4,"ngIf"],[3,"sdImage"],["id","page-ind-mask"],["fill","white"],["fill","black"],["fill","black","stroke","none","opacity","0.1","mask","url(#page-ind-mask)"],["fill","none","stroke","#ff2635","stroke-width","3"]],template:function(n,r){n&1&&(A(0,"div",1)(1,"div",2),se(2,Lu,1,0,"sd-loader",3),Q(3,"img",4,0),D(),Oi(),A(5,"svg",1)(6,"defs")(7,"mask",5),Q(8,"rect",6)(9,"rect",7),D()(),Q(10,"rect",8)(11,"rect",9),D()()),n&2&&(O("@showState",r.pageIndicatorVisible)("ngStyle",r.containerStyles),x(),O("ngStyle",r.imgStyles),x(),O("ngIf",!r.imgLoaded),x(),O("sdImage",r.imgData),x(2),O("ngStyle",r.containerStyles),x(3),ge("x",r.MARGIN)("y",r.MARGIN)("width",r.imgWidth)("height",r.imgHeight),x(),ge("x",r.highlightRect.x)("y",r.highlightRect.y)("width",r.highlightRect.w)("height",r.highlightRect.h),x(),ge("x",r.MARGIN)("y",r.MARGIN)("width",r.imgWidth)("height",r.imgHeight),x(),ge("x",r.highlightRect.x)("y",r.highlightRect.y)("width",r.highlightRect.w)("height",r.highlightRect.h))},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}*[_ngcontent-%COMP%]{pointer-events:none}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{position:relative;background:var(--mono-50);border-radius:2px;display:flex;float:right;align-items:center;justify-content:center;flex-direction:column;margin:12px 35px 0 0;z-index:5}div#img-container[_ngcontent-%COMP%]{display:none;background:#fff;position:relative}div#img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:relative;top:0;left:0;z-index:2}img[_ngcontent-%COMP%]{width:100%;height:auto;visibility:hidden}svg[_ngcontent-%COMP%]{position:absolute;left:0;top:0}"],data:{animation:[Zn("showState",[Tn(Io.INVISIBLE,Bi({opacity:0,display:"none"})),Tn(Io.VISIBLE,Bi({opacity:1,display:"flex"})),On(`${Io.VISIBLE} => ${Io.INVISIBLE}`,xn("400ms linear"))])]},changeDetection:0}));let s=t;return s})();var Hn=function(s){return s.VISIBLE="visible",s.INVISIBLE="invisible",s}(Hn||{}),gd=(()=>{let t=class t{changeDetectorRef;subscriptionService;translatePipe;store$;labelMap={};showScale=Hn.INVISIBLE;showLayout=Hn.INVISIBLE;scale;viewMode;visibilitySrc=new Ti;constructor(e,n,r,c){this.changeDetectorRef=e,this.subscriptionService=n,this.translatePipe=r,this.store$=c,this.labelMap={0:{icon:"papycon papycon-one-page3",label:this.translatePipe.transform("SINGLE_PAGE_VIEW")},1:{icon:"papycon papycon-one-page-continuous3",label:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS")},2:{icon:"papycon papycon-two-page3",label:this.translatePipe.transform("TWO_PAGE_VIEW")},3:{icon:"papycon papycon-two-page-continuous3",label:this.translatePipe.transform("TWO_PAGE_CONTINUOUS")},4:{icon:"papycon papycon-one-page",label:this.translatePipe.transform("LAYOUT_INDICATOR_EBOOK")}}}ngOnInit(){this.subscriptionService.push(this.visibilitySrc.pipe(ii(800)).subscribe({next:e=>{this.showScale=e,this.showLayout=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("scale"),Yn()).subscribe({next:e=>{this.scale=Number(e.toFixed(0)),this.showScale=Hn.VISIBLE,this.changeDetectorRef.markForCheck(),this.visibilitySrc.next(Hn.INVISIBLE)}}),this.store$.pipe($("viewMode")).subscribe({next:e=>{this.viewMode=e,this.showLayout=Hn.VISIBLE,this.changeDetectorRef.markForCheck(),this.visibilitySrc.next(Hn.INVISIBLE)}}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(Ae),_(ee),_(He),_(ye))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-scale-indicator"]],standalone:!1,features:[xe([ee])],decls:7,vars:6,consts:[[1,"page-layout"],[1,"page-scale"]],template:function(n,r){n&1&&(A(0,"div",0),Q(1,"i"),A(2,"span"),be(3),D()(),A(4,"div",1)(5,"span"),be(6),D()()),n&2&&(O("@showState",r.showLayout),x(),hr(r.labelMap[r.viewMode]==null?null:r.labelMap[r.viewMode].icon),x(2),Ee(r.labelMap[r.viewMode]==null?null:r.labelMap[r.viewMode].label),x(),O("@showState",r.showScale),x(2),Kn("",r.scale,"%"))},styles:["[_nghost-%COMP%]{position:absolute;display:flex;left:50%;top:50%;flex-direction:column;align-items:center;transform:translate(-50%,-50%);pointer-events:none}div[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;box-shadow:0 4px 8px #6c6c6c1f;color:var(--mono-99);display:flex;box-sizing:border-box;align-items:center;justify-content:center;background:var(--mono-10);border:1px solid var(--mono-30);border-radius:4px;text-align:center;cursor:default;z-index:1}div.page-layout[_ngcontent-%COMP%]{width:168px;height:168px;flex-direction:column;margin-bottom:20px}div.page-layout[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{width:80px;height:80px;font-size:80px;margin-bottom:19px}div.page-scale[_ngcontent-%COMP%]{width:100px;height:50px}"],data:{animation:[Zn("showState",[Tn(Hn.INVISIBLE,Bi({opacity:0,display:"none"})),Tn(Hn.VISIBLE,Bi({opacity:1,display:"flex"})),On(`${Hn.VISIBLE} => ${Hn.INVISIBLE}`,xn("400ms linear"))])]},changeDetection:0}));let s=t;return s})();var fd=(()=>{let t=class t{};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({imports:[on,va,ud,pa]}));let s=t;return s})();ai(Cc,[bt,ka,xc],[]);ai(Na,[bt,Cc,gd],[]);ai(xc,[bt,qt,Os,la],[]);var Uu=["searchComp"],Va=s=>({content:s});function Hu(s,t){s&1&&Q(0,"div",19)}function $u(s,t){if(s&1){let i=Se();A(0,"button",21),Y(1,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.useRegex=!n.useRegex)}),Q(2,"i",22),A(3,"label"),be(4),Y(5,"translate"),D()()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),ge("aria-label",X(1,11,"REGULAR_EXPRESSION"))("aria-checked",i.useRegex),x(2),$e("papycon-rounded-square",!i.useRegex)("papycon-check-mark4-filled",i.useRegex)("active",i.useRegex),x(2),Ee(X(5,13,"REGULAR_EXPRESSION"))}}function ju(s,t){if(s&1){let i=Se();A(0,"button",25),Y(1,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.onClickDetail())}),Q(2,"i",3),A(3,"span"),be(4),Y(5,"translate"),D()()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(1,5,"TEXT_SEARCH_VIEW_TITLE")),x(4),Ee(X(5,7,"ADVANCED_SEARCH"))}}function Wu(s,t){if(s&1){let i=Se();A(0,"div",16,1)(2,"div",20)(3,"button",21),Y(4,"translate"),ce("click",function(){W(i);let n=E();return z(n.searchCaseSensitive=!n.searchCaseSensitive)}),Q(5,"i",22),A(6,"label"),be(7),Y(8,"translate"),D()(),se(9,$u,6,15,"button",23),D(),se(10,ju,6,9,"button",24),D()}if(s&2){let i=E();x(3),$e("dark",i.isDarkMode),ge("aria-label",X(4,13,"SEARCH_CASE_SENSITIVE"))("aria-checked",i.searchCaseSensitive),x(2),$e("papycon-rounded-square",!i.searchCaseSensitive)("papycon-check-mark4-filled",i.searchCaseSensitive)("active",i.searchCaseSensitive),x(2),Ee(X(8,15,"SEARCH_CASE_SENSITIVE")),x(2),Kt(i.runtimeEnv.get(i.RuntimeEnvKey.TEXT_SEARCH_VIEW_REGEX)?9:-1),x(),Kt(i.runtimeEnv.get(i.RuntimeEnvKey.FULL_SEARCH_BUTTON)?10:-1)}}var Zr=class Zr{pageService;searchService;modalService;changeDetectorRef;subscriptionService;store$;apiEventBridgeService;translatePipe;selectTextService;redactionService;get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}pdfDoc;searchComp;get environment(){return Ze}searchedPage=new Set;pageCount;currentPageNo;searchCaseSensitive=!1;useRegex=!1;keyword=w.EMPTY_STRING;currentSelectedWord=0;totalSearchedWord=0;indicatorVisibility=!1;isMoreMenusVisible=!1;isSearching=!1;searchResult=[];bundleState={bundle:[],activeIndex:0};pagesLength;pages=[];isDestroying=!1;isAfterInit=!1;findSearchWordSrc=new Ti;countTotalSearchWordSrc=new Ti;keepSearchState=!1;checkWordCounting=!1;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return G.isMobile()}get searchIndicatorText(){return this.indicatorVisibility&&this.currentSelectedWord>0?`${this.currentSelectedWord} / ${this.totalSearchedWord}`:"0 / 0"}get isLessThanMobileWidth(){return G.width<G.breakpoints.mobile.width}constructor(t,i,e,n,r,c,g,v,y,M){this.pageService=t,this.searchService=i,this.modalService=e,this.changeDetectorRef=n,this.subscriptionService=r,this.store$=c,this.apiEventBridgeService=g,this.translatePipe=v,this.selectTextService=y,this.redactionService=M}ngOnInit(){this.subscriptionService.push(this.store$.pipe(oi("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("pageCount")).subscribe({next:t=>this.pageCount=t}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>this.currentPageNo=t}),this.pageService.pdfPages$.subscribe({next:t=>{this.pages=t,this.pagesLength=t?.length??0}}),this.findSearchWordSrc.pipe(ii(10)).subscribe({next:t=>this.initSearch(t)}),this.selectTextService.publishSelectedText$.pipe(F(()=>!this.isAfterInit),F(w.isDefined),en(1)).subscribe({next:t=>this.keyword=t.text}),this.redactionService.redactionReloadTextSearchResult$.subscribe({next:()=>{this.resubscribeSearchEvent(),this.searchStart(!0)}})),this.searchService.searchState.keyword&&(this.keyword=this.searchService.searchState.keyword,this.searchCaseSensitive=this.searchService.searchState.searchCaseSensitive,this.useRegex=this.searchService.searchState.useRegex,this.searchService.searchState.startPageIndex===-1&&(this.searchService.searchState.startPageIndex=this.searchService.searchState.pageIndex),(this.searchService.searchState.wordIndex===-1||this.searchService.searchState.pageIndex!==this.currentPageNo-1)&&(this.searchService.initSearchState(),this.searchService.bundle?.bundle.splice(0))),this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!0,data:void 0})}resubscribeSearchEvent(){let t=5,i=10,e=Math.max(Math.min(Math.ceil(this.pagesLength/10),100),10),n=0;this.subscriptionService.set("searchSub",this.countTotalSearchWordSrc.pipe(Lo({keyword:w.EMPTY_STRING,caseSensitive:this.searchCaseSensitive,regex:this.useRegex,streamdocsId:this.pdfDoc.streamdocsId,isForwardSearch:!0}),ii(100),Yn((r,c)=>r.keyword===c.keyword&&r.caseSensitive===c.caseSensitive&&r.regex===c.regex&&r.streamdocsId===c.streamdocsId?(this.bundleState.bundle[0].numOfItem&&this.findSearchWordSrc.next(c.isForwardSearch),!0):(t=5,n=0,!1)),F(r=>r.keyword!==w.EMPTY_STRING),rt(r=>{this.bundleState||(this.bundleState={bundle:[],activeIndex:0},this.searchService.bundle=this.bundleState),this.searchService.searchState.keyword!==r.keyword&&(this.searchService.clearSearchHighlight(),this.searchService.initSearchState(),this.searchService.searchState.keyword=r.keyword),this.indicatorVisibility=!0,this.checkWordCounting=!1,this.totalSearchedWord=0,this.currentSelectedWord=0,this.searchService.searchState.streamdocsId=r.streamdocsId,this.searchService.searchState.searchCaseSensitive=r.caseSensitive,this.searchService.searchState.useRegex=r.regex,this.bundleState.bundle=[],this.bundleState.activeIndex=0,this.pushNewBundle(),this.changeDetectorRef.markForCheck()}),st(r=>this.searchService.getSearchResult(r.streamdocsId,r.keyword,r.caseSensitive,r.regex,this.getPageIndexes(0,i)).pipe(bl((c,g)=>{let v=--t>0?i:e,y=t>0?(g+1)*v:n;return y>=this.pagesLength?ht(null):(this.isSearching=!0,n=y+v,this.searchService.getSearchResult(r.streamdocsId,r.keyword,r.caseSensitive,r.regex,this.getPageIndexes(y,v)))}),rt(c=>{c===null&&(this.checkWordCounting=!0)}),Cl(w.isDefined),Xn(()=>{!this.totalSearchedWord&&this.checkWordCounting&&(this.indicatorVisibility=!0),this.isSearching=!1,this.searchComp?.nativeElement.focus(),this.changeDetectorRef.markForCheck()})))).subscribe({next:r=>{let c=this.bundleState.bundle[this.bundleState.bundle.length-1],g=r.length;for(let v=0;v<g;v++)c.numOfItem>100&&(c=this.pushNewBundle()),c.results.push(r[v]),c.numOfItem+=r[v].words.length,this.currentSelectedWord===0&&(this.currentSelectedWord=1,this.indicatorVisibility=!0),this.totalSearchedWord+=r[v].words.length;this.bundleState.bundle[this.bundleState.bundle.length-1]=si({},c),this.changeDetectorRef.markForCheck()},error:()=>{this.clear(),this.modalService.createCommonModal({type:jt.ERROR,title:this.translatePipe.transform("SERVER_ERROR_TITLE"),content:this.translatePipe.transform("SERVER_ERROR_MESSAGE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})}}))}onKeyDown(t){if(t.key==="Enter"&&t.shiftKey){this.searchStart(!1);return}t.key==="Enter"&&this.searchStart(!0)}clear(){this.resubscribeSearchEvent(),this.bundleState&&(this.bundleState.bundle=[],this.bundleState.activeIndex=0),this.keyword=w.EMPTY_STRING,this.searchService.clearSearchHighlight()}getPageIndexes(t,i){let e=[],n=Math.min(t+i,this.pages.length);for(let r=t;r<n;++r)e.push(r);return e}pushNewBundle(){return this.bundleState.bundle[this.bundleState.bundle.push({numOfItem:0,results:[]})-1]}ngOnDestroy(){this.isDestroying=!0,this.keepSearchState||(this.searchService.clearSearchHighlight(),this.searchService.initSearchState()),this.searchResult.splice(0),this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!0,data:void 0})}ngAfterViewInit(){this.isAfterInit=!0,this.resubscribeSearchEvent(),this.keyword!==w.EMPTY_STRING&&this.searchStart(!0),this.searchComp?.nativeElement.focus()}searchStart(t){(!this.searchService.searchState.keyword||this.searchService.searchState.keyword!==this.keyword)&&this.findSearchWordSrc.next(t),this.publishCountTotalSearchWord(this.pdfDoc.streamdocsId,this.keyword,this.searchCaseSensitive,this.useRegex,t)}onClearWord(){this.indicatorVisibility=!1,this.isSearching=!1,this.currentSelectedWord=0,this.totalSearchedWord=0,this.searchService.searchState.keyword="",this.searchComp?.nativeElement.focus(),this.clear()}onClickMoreMenu(){this.isMoreMenusVisible=!this.isMoreMenusVisible,this.changeDetectorRef.markForCheck()}onClickDetail(){this.keyword===""&&(this.searchService.bundle=null),this.keepSearchState=!0,this.close(),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0}))}initSearch(t){if(this.pdfDoc){if(this.changeDetectorRef.markForCheck(),this.keyword.length===0){this.isSearching=!1,this.changeDetectorRef.markForCheck();return}else if(this.keyword===this.searchService.searchState.keyword&&this.searchCaseSensitive===this.searchService.searchState.searchCaseSensitive&&this.useRegex===this.searchService.searchState.useRegex&&this.pdfDoc.streamdocsId===this.searchService.searchState.streamdocsId&&w.isDefined(this.searchService.searchState.pageIndex)&&this.searchResult[this.searchService.searchState.pageIndex]){this.gotoNextWord(t);return}this.searchResult.splice(0),this.searchService.searchState.searchCaseSensitive=this.searchCaseSensitive,this.searchService.searchState.useRegex=this.useRegex,this.searchService.searchState.keyword=this.keyword,this.searchService.searchState.pageIndex=this.currentPageNo-1,this.searchService.searchState.wordIndex=-1,this.searchService.searchState.streamdocsId=this.pdfDoc.streamdocsId,this.searchService.searchState.startPageIndex=this.searchService.searchState.pageIndex,this.findWord(t)}}close(){this.store$.dispatch(ue.set({key:"searchToolActive",value:!1}))}gotoNextWord(t){let i=this.searchResult[this.searchService.safePageIndex].length;if(t){if(this.currentSelectedWord++,this.currentSelectedWord>this.totalSearchedWord&&(this.currentSelectedWord=1),w.isDefined(this.searchService.searchState.wordIndex)&&this.searchService.searchState.wordIndex+1===i){this.gotoNextPage(t);return}this.searchService.safeWordIndex++}else{if(this.currentSelectedWord--,this.currentSelectedWord===0&&(this.currentSelectedWord=this.totalSearchedWord),this.searchService.safeWordIndex-1<0){this.gotoNextPage(t);return}this.searchService.safeWordIndex--}this.activateWord()}gotoNextPage(t){if(this.searchedPage.add(this.searchService.safePageIndex),t?(this.searchService.safePageIndex++,this.searchService.safePageIndex%=this.pageCount):(this.searchService.safePageIndex--,this.searchService.searchState.pageIndex===-1&&(this.searchService.searchState.pageIndex=this.pageCount-1)),this.searchedPage.size===this.pageCount){this.isSearching=!1,this.searchService.searchState.wordIndex=-1,this.searchService.searchState.startPageIndex!==this.searchService.safePageIndex-1&&this.findWord(t),this.searchedPage.clear(),this.changeDetectorRef.markForCheck();return}this.searchService.searchState.wordIndex=-1,this.findWord(t)}findWord(t){if(!this.isDestroying){if(this.searchResult[this.searchService.safePageIndex]){if(this.searchResult.every(i=>i.length===0))return;this.validateWord(t);return}this.subscriptionService.set("dataSub",this.searchService.getSearchResult(this.pdfDoc.streamdocsId,this.searchService.searchState.keyword,this.searchService.searchState.searchCaseSensitive,this.searchService.searchState.useRegex,[this.searchService.safePageIndex]).subscribe({next:i=>{this.isDestroying||(this.searchResult[this.searchService.safePageIndex]=i.length?i[0].words:[],this.validateWord(t))},error:()=>{this.searchService.searchState.keyword=w.EMPTY_STRING,this.isSearching=!1,this.modalService.createCommonModal({type:jt.ERROR,title:this.translatePipe.transform("SERVER_ERROR_TITLE"),content:this.translatePipe.transform("SERVER_ERROR_MESSAGE"),confirmButton:!0})}}))}}validateWord(t){if(this.searchResult[this.searchService.safePageIndex].length>0){if(this.searchService.searchState.wordIndex===-1)this.searchService.searchState.wordIndex=t?0:this.searchResult[this.searchService.safePageIndex].length-1;else{this.gotoNextWord(t);return}this.activateWord()}else this.gotoNextPage(t)}activateWord(){let t=this.searchService.safePageIndex;this.searchService.activateWord(this.searchResult[t][this.searchService.safeWordIndex],this.pages[t]),this.changeDetectorRef.markForCheck()}publishCountTotalSearchWord(t,i,e,n,r){this.countTotalSearchWordSrc.next({keyword:i,caseSensitive:e,regex:n,streamdocsId:t,isForwardSearch:r})}};N(Zr,"\u0275fac",function(i){return new(i||Zr)(_(zt),_(io),_(rn),_(Ae),_(ee),_(ye),_(Qt),_(He),_(to),_($r))}),N(Zr,"\u0275cmp",Ce({type:Zr,selectors:[["sd-search-tool"]],viewQuery:function(i,e){if(i&1&&Ye(Uu,7),i&2){let n;Me(n=Re())&&(e.searchComp=n.first)}},inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[xe([ee,{provide:qn,useValue:new Ht(300)}])],decls:29,vars:55,consts:[["searchComp",""],["moreMenusRef",""],[1,"input"],[1,"papycon","papycon-search"],["type","text",3,"ngModelChange","keydown","clear","size","placeholder","maxLength","ngModel"],["class","spin-loader",4,"ngIf"],[1,"page-navigation"],["size","tiny","color","grey",1,"prev","ep-text-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-previous-symbol2"],[1,"page-number"],["size","tiny","color","grey",1,"next","ep-text-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-next-symbol2"],[1,"divider"],[1,"more-menu-container"],[1,"more-button","ep-text-button",3,"click","tooltip"],[1,"papycon","papycon-more-symbol3"],[1,"more-menus"],[1,"close","ep-text-button",3,"click","tooltip"],[1,"papycon","papycon-cross"],[1,"spin-loader"],[1,"options"],["role","switch","size","tiny","color","white",1,"ep-text-button",3,"click"],[1,"papycon"],["role","switch","size","tiny","color","white",1,"ep-text-button",3,"dark"],[1,"ep-text-button",3,"dark"],[1,"ep-text-button",3,"click"]],template:function(i,e){if(i&1){let n=Se();A(0,"div",2),Q(1,"i",3),A(2,"input",4,0),Y(4,"translate"),Ai("ngModelChange",function(c){return W(n),Ii(e.keyword,c)||(e.keyword=c),z(c)}),ce("keydown",function(c){return W(n),z(e.onKeyDown(c))})("clear",function(){return W(n),z(e.onClearWord())}),D(),se(5,Hu,1,0,"div",5),D(),A(6,"nav",6)(7,"button",7),Y(8,"translate"),Y(9,"translate"),Y(10,"translate"),ce("click",function(){return W(n),z(e.searchStart(!1))}),Q(11,"i",8),D(),A(12,"div",9),be(13),D(),A(14,"button",10),Y(15,"translate"),Y(16,"translate"),Y(17,"translate"),ce("click",function(){return W(n),z(e.searchStart(!0))}),Q(18,"i",11),D()(),Q(19,"div",12),A(20,"div",13)(21,"button",14),Y(22,"translate"),ce("click",function(){return W(n),z(e.onClickMoreMenu())}),Q(23,"i",15),D(),se(24,Wu,11,17,"div",16),D(),A(25,"button",17),Y(26,"translate"),Y(27,"translate"),ce("click",function(){return W(n),z(e.close())}),Q(28,"i",18),D()}i&2&&(x(2),O("size",e.isLessThanMobileWidth?14:28)("placeholder",X(4,27,e.isLessThanMobileWidth?"SEARCH":"SEARCH_DOCUMENT"))("maxLength",e.environment.textSearchLengthLimit),Ri("ngModel",e.keyword),x(3),O("ngIf",e.isSearching),x(2),$e("disabled",!e.totalSearchedWord||!e.keyword),O("title",e.isMobile?"":X(8,29,"BACKWARD_SEARCH"))("tooltip",St(47,Va,X(9,31,"BACKWARD_SEARCH")))("disabled",!e.totalSearchedWord||!e.keyword),ge("aria-label",X(10,33,"BACKWARD_SEARCH")),x(6),Kn(" ",e.searchIndicatorText," "),x(),$e("disabled",!e.totalSearchedWord||!e.keyword),O("title",e.isMobile?"":X(15,35,"FORWARD_SEARCH"))("tooltip",St(49,Va,X(16,37,"FORWARD_SEARCH")))("disabled",!e.totalSearchedWord||!e.keyword),ge("aria-label",X(17,39,"FORWARD_SEARCH")),x(7),$e("active",e.isMoreMenusVisible),O("tooltip",St(51,Va,X(22,41,"MORE_MENU"))),x(3),Kt(e.isMoreMenusVisible?24:-1),x(),$e("dark",e.isDarkMode),O("tooltip",St(53,Va,X(26,43,"CLOSE"))),ge("color",e.isDarkMode?"white":"dark")("aria-label",X(27,45,"CLOSE")))},styles:["[_nghost-%COMP%]{box-shadow:0 4px 8px #6c6c6c1f;position:absolute;top:8px;right:8px;padding:12px;display:flex;align-items:center;column-gap:12px;justify-content:flex-end;border:1px solid var(--mono-30);border-radius:8px;background-color:var(--mono-00)}div.input[_ngcontent-%COMP%]{display:flex;margin-right:auto;padding:12px;background-color:var(--input-background);border:1px solid var(--mono-30);border-radius:4px}div.input[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{margin-right:4px;font-size:20px}div.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:0;border:0;font-size:14px;-webkit-appearance:none;appearance:none;caret-color:var(--primary-50);background-color:var(--input-background);color:var(--mono-99)}div.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:0}div.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--mono-70);opacity:1}div.input[_ngcontent-%COMP%]:has(input:focus){border-color:var(--primary-50)}.spin-loader[_ngcontent-%COMP%]{width:20px;height:20px;pointer-events:none}nav.page-navigation[_ngcontent-%COMP%]{display:flex;align-items:center;column-gap:12px}nav.page-navigation[_ngcontent-%COMP%]   .page-number[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;font-size:14px}nav.page-navigation[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:16px;color:var(--mono-90)}nav.page-navigation[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:disabled > i.papycon[_ngcontent-%COMP%]{color:var(--mono-50)}div.divider[_ngcontent-%COMP%]{width:1px;margin:10px 0;background-color:var(--mono-30)}div.more-menu-container[_ngcontent-%COMP%]{position:relative}button.more-button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px;color:var(--mono-90)}button.more-button.active[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{color:var(--primary-50)}div.more-menus[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;position:absolute;top:calc(100% + 4px);right:0;background-color:var(--mono-00);border:1px solid var(--mono-30);border-radius:4px}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]{padding:0;display:flex;flex-direction:column;border:1px solid var(--mono-30)}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;column-gap:8px;cursor:pointer}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px;color:var(--mono-50)}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon.active[_ngcontent-%COMP%]{color:var(--primary-50)}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-family:NotoSans-Medium,sans-serif;font-size:13px;color:var(--mono-99);cursor:pointer}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover   i.papycon[_ngcontent-%COMP%]{color:var(--primary-50)}div.more-menus[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{padding:8px}div.more-menus[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px;color:var(--mono-90);margin-right:8px}div.more-menus[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:hover   i.papycon[_ngcontent-%COMP%]{color:var(--mono-90-hover)}button.close[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px}@media screen and (max-width: 991px){[_nghost-%COMP%]{top:0;left:0;right:0;border-radius:0}}"],changeDetection:0}));var Jr=Zr;ze([ot(it.searchToolComp.search),ot(it.searchToolComp.searchWithRegex),ot(it.searchToolComp.searchWithCaseSensitive)],Jr.prototype,"publishCountTotalSearchWord",null);function zu(s,t){if(s&1&&(Oi(),Q(0,"path")),s&2){let i=t.$implicit;ge("d",i.path)("fill",i.color)}}var vd=(()=>{let t=class t{apiHighlightService;changeDetectorRef;subscriptionService;pdfPage;renderingInfo=[];constructor(e,n,r){this.apiHighlightService=e,this.changeDetectorRef=n,this.subscriptionService=r}ngOnInit(){this.subscriptionService.push(this.apiHighlightService.highlightInfoMapChange$.pipe(F(e=>e.pageIndex===this.pdfPage.i)).subscribe({next:e=>this.updatePath()})),this.updatePath()}updatePath(){let e=this.apiHighlightService.highlightInfoMap[this.pdfPage.i];if(!e)return;let n={};e.forEach(r=>{n[r.color]?n[r.color]+=` ${r.path}`:n[r.color]=r.path}),this.renderingInfo.splice(0),Object.keys(n).forEach(r=>{this.renderingInfo.push({color:r,path:n[r]})}),this.changeDetectorRef.markForCheck()}};N(t,"\u0275fac",function(n){return new(n||t)(_(Zo),_(Ae),_(ee))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-api-highlight"]],inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([ee])],decls:2,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(n,r){n&1&&(Oi(),A(0,"svg"),se(1,zu,1,2,"path",0),D()),n&2&&(x(),O("ngForOf",r.renderingInfo))},dependencies:[yi],styles:["svg[_ngcontent-%COMP%]{mix-blend-mode:multiply;position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0}));let s=t;return s})();var La=class{triggerEvents=[];mainEvents=[];terminatorEvents=[];_isTriggered=!1;get isTriggered(){return this._isTriggered}listen(){this.triggerEvents.forEach(t=>{t.listening||(t.target.addEventListener(t.type,t.listener),t.listening=!0)})}unlisten(){[...this.triggerEvents,...this.mainEvents,...this.terminatorEvents].forEach(t=>{t.target.removeEventListener(t.type,t.listener),t.listening=!1}),this._isTriggered=!1}addTriggerEvent(t,i,e){this.triggerEvents.push({target:t,type:i,listener:n=>{let r=e?e(n):!0;!r&&r!==void 0||(this._isTriggered=!0,[...this.mainEvents,...this.terminatorEvents].forEach(c=>{c.listening||(c.target.addEventListener(c.type,c.listener),c.listening=!0)}))},listening:!1})}addMainEvent(t,i,e){this.mainEvents.push({target:t,type:i,listener:e,listening:!1})}addTerminatorEvent(t,i,e){this.terminatorEvents.push({target:t,type:i,listener:n=>{let r=e?e(n):!0;!r&&r!==void 0||(this._isTriggered=!1,[...this.mainEvents,...this.terminatorEvents].forEach(c=>{c.target.removeEventListener(c.type,c.listener),c.listening=!1}))},listening:!1})}};var ts=class ts{link;portalRef;elementRef;annotService;contentService;modalService;subscriptionService;translatePipe;store$;pageIdx="";url="";radioOption="GoTo";pageCount;constructor(t,i,e,n,r,c,g,v,y){this.link=t,this.portalRef=i,this.elementRef=e,this.annotService=n,this.contentService=r,this.modalService=c,this.subscriptionService=g,this.translatePipe=v,this.store$=y}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("pageCount")).subscribe({next:t=>this.pageCount=t}),Ge(window,"keydown",{capture:!0}).pipe(F(t=>t.key==="Escape"),F(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.close()})),this.elementRef.nativeElement.parentElement.style.minWidth="375px"}close(){this.portalRef.dispose()}createLink(){if(this.link.attributes.type=this.radioOption,this.radioOption==="GoTo"){if(this.pageIdx.length===0||isNaN(Number(this.pageIdx))){this.modalService.createCommonModal({type:jt.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("ONLY_NUMBER_CAN_BE_PAGE_INDEX"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")});return}if(parseInt(this.pageIdx,10)>this.pageCount||parseInt(this.pageIdx,10)<1){this.modalService.createCommonModal({type:jt.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("INVALID_PAGE_INDEX"),confirmButton:!0});return}this.link.attributes.dest=`${parseInt(this.pageIdx,10)-1}`,this.link.attributes.contents=this.translatePipe.transform("GO_TO_PAGE").replace("%s",`${parseInt(this.pageIdx,10)}`)}else{if(this.url.length===0){this.modalService.createCommonModal({type:jt.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("URL_CANNOT_BE_BLANK"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")});return}this.link.attributes.dest=this.url,this.link.attributes.contents=this.translatePipe.transform("GO_TO_SITE").replace("%s",this.link.attributes.dest)}this.annotService.putModel(this.link),this.contentService.fireAnnotEvent({sdEventType:cn.CREATE,annot:this.link}),this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:cn.CREATE,annot:this.link}),this.close()}};N(ts,"\u0275fac",function(i){return new(i||ts)(_(ea),_(ta),_(ni),_(ri),_(at),_(rn),_(ee),_(He),_(ye))}),N(ts,"\u0275cmp",Ce({type:ts,selectors:[["sd-link-creation-dialog"]],standalone:!1,features:[xe([ee])],decls:23,vars:40,consts:[["tabindex","0"],["value","GoTo",3,"ngModelChange","label","ngModel"],["size","tiny","type","text",3,"ngModelChange","disabled","placeholder","autofocus","ariaLabel","ngModel"],["value","URI",3,"ngModelChange","label","ngModel"],["size","tiny","type","text",3,"ngModelChange","disabled","placeholder","ariaLabel","ngModel"],["color","white","size","small",1,"ep-button",3,"click"],["color","primary","size","small",1,"ep-button","create",3,"click"]],template:function(i,e){i&1&&(A(0,"h3",0),be(1),Y(2,"translate"),D(),A(3,"main")(4,"pu-radio-button",1),Y(5,"translate"),Ai("ngModelChange",function(r){return Ii(e.radioOption,r)||(e.radioOption=r),r}),D(),A(6,"pu-input",2),Y(7,"translate"),Y(8,"translate"),Ai("ngModelChange",function(r){return Ii(e.pageIdx,r)||(e.pageIdx=r),r}),D(),A(9,"pu-radio-button",3),Y(10,"translate"),Ai("ngModelChange",function(r){return Ii(e.radioOption,r)||(e.radioOption=r),r}),D(),A(11,"pu-input",4),Y(12,"translate"),Y(13,"translate"),Ai("ngModelChange",function(r){return Ii(e.url,r)||(e.url=r),r}),D()(),A(14,"footer")(15,"button",5),Y(16,"translate"),ce("click",function(){return e.close()}),be(17),Y(18,"translate"),D(),A(19,"button",6),Y(20,"translate"),ce("click",function(){return e.createLink()}),be(21),Y(22,"translate"),D()()),i&2&&(x(),Ee(X(2,18,"CREATE_LINK")),x(3),O("label",X(5,20,"GO_TO_SPECIFIC_PAGE")),Ri("ngModel",e.radioOption),x(2),O("disabled",e.radioOption!=="GoTo")("placeholder",X(7,22,"PLEASE_ENTER_PAGE_NUMBER"))("autofocus",!0)("ariaLabel",X(8,24,"PLEASE_ENTER_PAGE_NUMBER")),Ri("ngModel",e.pageIdx),x(3),O("label",X(10,26,"OPEN_WEB_PAGE")),Ri("ngModel",e.radioOption),x(2),O("disabled",e.radioOption!=="URI")("placeholder",X(12,28,"PLEASE_ENTER_URL"))("ariaLabel",X(13,30,"PLEASE_ENTER_URL")),Ri("ngModel",e.url),x(4),ge("aria-label",X(16,32,"CANCEL")),x(2),Ee(X(18,34,"CANCEL")),x(2),ge("aria-label",X(20,36,"CREATE")),x(2),Ee(X(22,38,"CREATE")))},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0}main[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:var(--mono-70);white-space:pre-wrap;display:flex;flex-direction:column}main[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%], main[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{margin:8px 0}footer[_ngcontent-%COMP%]{text-align:right;margin-top:32px}footer[_ngcontent-%COMP%]   button.create[_ngcontent-%COMP%]{color:var(--mono-00)}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));var Cr=ts;ze([ot(it.linkCreationDialogComp.createLink)],Cr.prototype,"createLink",null);var Xu=["scrollContainerRef"],Ku=["scaleWrapper"],qu=["slideshowOverlay"];function Qu(s,t){s&1&&To(0)}function Zu(s,t){if(s&1&&Q(0,"sd-popups",15),s&2){E(2);let i=wi(2);O("contentViewRoot",i)}}function Ju(s,t){s&1&&Q(0,"sd-capture-backdrop")}function eg(s,t){if(s&1){let i=Se();A(0,"div",16)(1,"sd-page",17),ce("mousedown",function(){let n=W(i).$implicit,r=E(2);return z(r.onPageMouseDown(n))}),D()()}if(s&2){let i=t.$implicit,e=E(2);O("page",i),x(),$e("hide-outline",e.isSlideshow||e.isCaptureMode)("hide-background",e.isCaptureMode),O("priority",e.renderPriorityOf(i))("page",i)("documentId",e.documentId)}}function tg(s,t){if(s&1&&Q(0,"sd-contextmenu",18),s&2){let i=E(2);O("isClickOnGrayArea",i.isClickOnGrayArea)}}function ig(s,t){if(s&1&&(Bt(0),se(1,Zu,1,1,"sd-popups",10)(2,Ju,1,0,"sd-capture-backdrop",6),A(3,"div",11,2)(5,"div",12),se(6,eg,2,8,"div",13),D(),se(7,tg,1,1,"sd-contextmenu",14),D(),Ut()),s&2){let i=E();x(),O("ngIf",i.pdfPages.length),x(),O("ngIf",i.isCaptureMode),x(),$e("capture-mode",i.isCaptureMode),x(3),O("ngForOf",i.pdfPages)("ngForTrackBy",i.trackByPage),x(),O("ngIf",i.shouldShowContextMenu)}}function ng(s,t){if(s&1&&Q(0,"sd-ebook-view",19),s&2){let i=E();O("documentId",i.documentId)}}function og(s,t){s&1&&Q(0,"div",20,3)}function rg(s,t){s&1&&To(0)}function sg(s,t){s&1&&Q(0,"sd-quick-action")}function ag(s,t){if(s&1&&Q(0,"sd-search-tool",21),s&2){let i=E();O("pdfDoc",i.pdfDoc)}}function cg(s,t){s&1&&Q(0,"sd-indicator")}function lg(s,t){if(s&1&&Q(0,"sd-floating-nav",23),s&2){let i=E(2);O("pdfDoc",i.pdfDoc)}}function pg(s,t){if(s&1&&se(0,lg,1,1,"sd-floating-nav",22),s&2){let i=E();O("ngIf",i.runtimeEnv.get(i.MergedRuntimeEnvKey.FLOATING_NAVIGATION)&&!i.hidableMenus[i.HidableView.FLOATING_NAV]&&!1)}}var is=function(s){return s[s.UP=1]="UP",s[s.DOWN=2]="DOWN",s[s.UNKNOWN=3]="UNKNOWN",s}(is||{}),ns=class ns{acroFormService;annotService;changeDetectorRef;documentService;pageService;annotSelectedService;contentService;scrollController;store$;viewerService;subscriptionService;apiEventBridgeService;guideLineService;modalService;sdContextMenuService;selectTextService;renderer;toastService;translatePipe;dapService;shortcutService;loggingService;captureService;localStorageService;popupService;get RuntimeEnvKey(){return ie}get MergedRuntimeEnvKey(){return xt}get runtimeEnv(){return K}get HidableView(){return B}get shouldShowContextMenu(){return this.isContextMenuOpened&&!this.hidableMenus[B.CONTEXT_MENU]}pdfDoc;overWrittenZoom;centerPoint=null;scrollContainerRef;scaleWrapper;contentView;slideshowOverlay;scale;prevScale=null;degree;viewMode;dragMode;currentPageNo;pageCount;searchToolActive;isR2L;isContextMenuOpened=!1;clickedPage=null;isClickOnGrayArea=!1;isCaptureMode=!1;pdfPages=[];preferences=null;selectedText=null;hidableMenus={};originalViewMode;originalScale;originalPageNo;renderingMode;rulerActive;draggingListener=new La;bufferSize=null;get documentId(){return this.pdfDoc?this.pdfDoc.streamdocsId:null}stateHolder;get contentViewStyle(){return this.dragMode!==Pt.MOVE?null:{cursor:`grab${this.draggingListener.isTriggered?"bing":w.EMPTY_STRING}`}}get isSlideshow(){return this.stateHolder?.isSlideshow}get contentViewElement(){return this.scrollContainerRef.nativeElement}get lastViewScale(){return Number(this.localStorageService.get("SD_Scale","100"))}set lastViewScale(t){this.localStorageService.set("SD_Scale",t.toString())}mobileZoomer=null;pdfInfo=null;constructor(t,i,e,n,r,c,g,v,y,M,V,Z,le,pe,he,Te,p,dt,vt,gt,Mi,At,li,mi,Oe){this.acroFormService=t,this.annotService=i,this.changeDetectorRef=e,this.documentService=n,this.pageService=r,this.annotSelectedService=c,this.contentService=g,this.scrollController=v,this.store$=y,this.viewerService=M,this.subscriptionService=V,this.apiEventBridgeService=Z,this.guideLineService=le,this.modalService=pe,this.sdContextMenuService=he,this.selectTextService=Te,this.renderer=p,this.toastService=dt,this.translatePipe=vt,this.dapService=gt,this.shortcutService=Mi,this.loggingService=At,this.captureService=li,this.localStorageService=mi,this.popupService=Oe}ngOnChanges(){this.clearAllCache(),this.contentService.publishTSAValidation(null)}ngOnInit(){this.initDraggingListener(),this.initSubscribers(),G.isTouchableDevice()&&this.buildMobileZoomer()}ngOnDestroy(){this.draggingListener.unlisten(),this.dapService.resetCheckbox(),this.destroyMobileZoomer(),this.finalizeSubscribers(),this.scrollController.stop(),this.clearAllCache(),this.contentService.publishTSAValidation(null),Xi.destroy(this)}onRightMouseUp(t){t.button!==2||this.dragMode===Pt.MAGNIFY||this.annotSelectedService.selectedComponents.length||this.isSlideshow||K.get(ie.CONTEXT_MENU_TOOLS_IN_USE).length===0||(this.sdContextMenuService.rightClickAction?.(),this.sdContextMenuService.mouseEvent=t)}onPdfDocumentReady(t,i=null){this.pdfInfo=i,this.store$.dispatch(ue.set({key:"pageCount",value:t.length}));let e=this.preferences&&this.preferences.viewerDirection===0?this.pdfInfo?.ViewerPreferences?.Direction==="R2L":this.preferences?.viewerDirection===2;this.store$.dispatch(ue.set({key:"isR2L",value:e})),this.stateHolder=new Pi,this.stateHolder.pdfPages=t,this.stateHolder.degree=this.degree,this.stateHolder.isR2L=!!this.isR2L,this.scrollController.start(this.stateHolder,this.contentViewElement),this.subscribePageArrange(),this.subscribeMainViewResized(),this.subscribeViewChange(),this.subscribeWheelZoom(),this.subscriptionService.set("contextmenuPositionSub",G.windowMouseMoveEvent$.pipe(dr(50,nc,{trailing:!0})).subscribe({next:c=>this.sdContextMenuService.mouseEvent=c.srcEvent}));let n={fitWidth:0,fitHeight:1,fitPage:3,actualSize:4,maintain:7},r=w.isDefined(this.overWrittenZoom)&&this.overWrittenZoom.length>0&&!Number.isNaN(Number(this.overWrittenZoom))?{scale:Number(this.overWrittenZoom)}:{fitMode:w.isDefined(this.overWrittenZoom)?n[this.overWrittenZoom]:this.preferences?.pageFitMode};this.centerPoint?this.contentService.requestViewChange(Rr(si({},r),{center:this.centerPoint,pageNo:this.currentPageNo})):"scale"in r?this.contentService.requestViewChange(Rr(si({},r),{pageNo:this.currentPageNo})):this.contentService.requestViewChange(r),Xi.runAsync(()=>this.apiEventBridgeService.documentReadySrc.next({ok:!0,data:void 0}))}trackByPage(t,i){return`${i.i}/${i.ref}`}renderPriorityOf(t){return this.currentPageNo-t.i-1}onPageMouseDown(t){return this.pageService.publishPage(t),this.annotSelectedService.unselectAll(),!0}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}canTextSearch(){return this.documentService.checkAuthority(Ne.SEARCH_TEXT)}destroyMobileZoomer(){this.mobileZoomer&&this.mobileZoomer.destroy(),this.mobileZoomer=null}buildMobileZoomer(){this.destroyMobileZoomer(),this.mobileZoomer=new xp(this,this.contentViewElement,this.scrollController)}clearAllCache(){this.annotService.clearActionLogs(),this.acroFormService.clearActionLogs(),this.pageService.clearPageArrangeLogs()}isViewChangeRequestPosition(t){return t.position!==void 0}isViewChangeRequestViewport(t){return t.viewport!==void 0}isViewChangeRequestCenter(t){return t.center!==void 0}isViewChangeRequestReferencePoint(t){return t.referencePoint!==void 0}isPageOffsetReferencePoint(t){return t instanceof Object&&t.hasOwnProperty("pageNo")&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")}subscribeViewChange(){this.subscriptionService.get("viewChange")===void 0&&this.subscriptionService.set("viewChange",this.contentService.viewChangeRequest$.subscribe({next:t=>{let i=this.currentPageNo,e,n,r,c;this.isViewChangeRequestReferencePoint(t)||(t.pageNo!==void 0&&(i=Math.min(Math.max(1,t.pageNo<0?this.pageCount-t.pageNo+1:t.pageNo),this.pageCount+1)),t.viewMode!==void 0&&(e=t.viewMode),t.degree!==void 0&&(n=J.normalizeDegree(t.degree)),this.isViewChangeRequestViewport(t)||(r=t.fitMode)),!this.isViewChangeRequestViewport(t)&&t.scale!==void 0&&(c=t.scale);let g=this.getCurrentRenderingInfo();if(this.isSlideshow?c=this.calculateScaleForFit(i,6,e??this.viewMode,n??this.degree):this.isViewChangeRequestViewport(t)?c=this.calculateScaleForRect(i,t.viewport):w.isDefined(r)?(c=this.calculateScaleForFit(i,r,e??this.viewMode,n??this.degree),this.store$.dispatch(ue.set({key:"fitMode",value:r}))):w.isDefined(c)&&this.store$.dispatch(ue.set({key:"fitMode",value:null})),c!==void 0){let y=this.renderingMode===gi.SERVER?Ze.maxScale:K.get(ie.CLIENT_RENDERING_MAXIMUM_SCALE).value;t.checkScale&&(c=this.checkScaleForFit(this.scale,c,i,e??this.viewMode,n??this.degree)),this.store$.dispatch(ue.set({key:"scale",value:Math.min(Math.max(c,Ze.minScale),y)}))}e!==void 0&&this.store$.dispatch(ue.set({key:"viewMode",value:e})),n!==void 0&&(this.stateHolder.degree=n,this.store$.dispatch(ue.set({key:"degree",value:n}))),i!==this.currentPageNo&&this.store$.dispatch(ue.set({key:"currentPageNo",value:i})),this.bufferPages();let v=this.stateHolder.pdfPages[i-1];if(this.isViewChangeRequestPosition(t))this.scroll(v,{position:t.position});else if(this.isViewChangeRequestViewport(t)){let y=t.viewport;this.scroll(v,{x:(y.right+y.left)/2,y:(y.top+y.bottom)/2})}else if(this.isViewChangeRequestCenter(t))this.scroll(v,t.center);else if(this.isViewChangeRequestReferencePoint(t)){let y=this.isPageOffsetReferencePoint(t.referencePoint)?this.convertPageOffset2ViewOffset(g,t.referencePoint.pageNo,t.referencePoint.x,t.referencePoint.y):t.referencePoint,M=this.calculateScrollOnRescale(g,y);this.scroll(v,M)}else if(t.fitMode===void 0&&t.scale===void 0&&t.degree===void 0&&t.pageNo===void 0&&t.top===void 0&&t.left===void 0&&t.viewMode!==void 0){let y=this.calculateScrollOnViewModeChange(g);this.scroll(v,y)}else if(t.fitMode===void 0&&t.degree===void 0&&t.pageNo===void 0&&t.top===void 0&&t.left===void 0&&t.viewMode===void 0&&t.scale!==void 0){let y=this.calculateScrollOnRescale(g,{clientX:0,clientY:0});this.scroll(v,y)}else if(t.top===void 0&&t.left===void 0){let y=this.calculateScaleForFit(i,0,t.viewMode??this.viewMode,t.degree??this.degree);this.scroll(v,{position:this.scale>y?Ei.TOP_LEFT:Ei.TOP_CENTER})}else this.scroll(v,{x:t.left,y:t.top,placeInTopLeft:!0});if(!w.isDefined(this.scaleWrapper)){this.loggingService.common("error",Le.NOT_EXIST,"scaleWrapper");return}this.updateOffsetForGuideline(),this.scrollController.calcViewRectSrc.next(!0),this.apiEventBridgeService.viewModeChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.scaleChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.rotateChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.fitModeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.viewerSizeSrc.next({ok:!0,data:{width:this.scaleWrapper.nativeElement.offsetWidth,height:this.scaleWrapper.nativeElement.offsetHeight}})}}))}checkScaleForFit(t,i,e,n,r){let c=this.calculateScaleForFit(e,1,n,r),g=this.calculateScaleForFit(e,0,n,r),v=i;return t<i?t<g&&g<i&&t<c&&c<i?(v=Math.min(g,c),this.prevScale=i):t<g&&g<i?(v=g,this.prevScale=i):t<c&&c<i?(v=c,this.prevScale=i):typeof this.prevScale=="number"&&t<this.prevScale&&this.prevScale<i&&(v=this.prevScale,this.prevScale=null):t>i&&(t>g&&g>i&&t>c&&c>i?(v=Math.max(g,c),this.prevScale=i):t>g&&g>i?(v=g,this.prevScale=i):t>c&&c>i?(v=c,this.prevScale=i):typeof this.prevScale=="number"&&t>this.prevScale&&this.prevScale>i&&(v=this.prevScale,this.prevScale=null)),v}subscribeWheelZoom(){if(this.subscriptionService.get("wheelZoom")!==void 0)return;let t={x:0,y:0},i,e=G.windowScrollEvent$.pipe(F(()=>!this.scrollController.stateHolder?.isSlideshow),F(n=>n!==void 0&&(n.ctrlKey||n.metaKey||n.altKey)));this.subscriptionService.push(G.windowMouseMoveEvent$.pipe(dr(100,nc,{trailing:!0})).subscribe({next:n=>{t.x=n.x,t.y=n.y}}),e.pipe(dr(500)).subscribe({next:()=>{i=this.scrollContainerRef.nativeElement.getBoundingClientRect()}})),this.subscriptionService.set("wheelZoom",e.subscribe({next:n=>{n.preventDefault(),this.changeZoomByWheel(t,i,n.deltaY)}}))}subscribePageArrange(){this.subscriptionService.get("pageArrange")===void 0&&this.subscriptionService.set("pageArrange",this.pageService.pageArrangeEvt$.pipe(F(w.isDefined),rt(t=>{this.store$.dispatch(ue.set({key:"pageCount",value:this.stateHolder.pdfPages.length})),this.stateHolder.pdfPages=this.pageService.pdfPages,this.pdfPages.splice(0);let i=this.detectPageNo();if(this.bufferPages(),(t.action==="copy"||t.action==="delete")&&i>0){let e=this.stateHolder.pdfPages[i-1];this.scroll(e)}}),F(t=>!t.isTemporary),F(t=>t.action!=="rotate")).subscribe({next:t=>this.annotService.processPageArrangeEvt(t)}))}subscribeMainViewResized(){if(this.subscriptionService.get("mainViewResized")!==void 0)return;let t=()=>{this.viewMode!==4&&this.contentView.update(this.stateHolder,this.scale,this.viewMode,this.currentPageNo,this.degree),this.changeDetectorRef.markForCheck()};this.subscriptionService.set("mainViewResized",ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize")),this.store$.pipe(fi([B.SIDE_VIEW,B.SIDE_VIEW_THUMBNAIL,B.SIDE_VIEW_BOOKMARK,B.SIDE_VIEW_ANNOTATION,B.SIDE_VIEW_REDACTION,B.SIDE_VIEW_EMBEDDED_FILE,B.SIDE_VIEW_FORM,B.SIDE_VIEW_SIGNATURE,B.CONTEXT_MENU,B.FLOATING_NAV,B.INDICATOR]))).subscribe({next:i=>{Object.assign(this.hidableMenus,i),t(),this.subscriptionService.push(Xi.runAsync(()=>t()))}}))}initSubscribers(){this.subscriptionService.push(this.store$.pipe(oi("screenTheme")).subscribe({next:t=>this.setColorTheme(t)}),this.store$.pipe($("scale")).subscribe({next:t=>this.scale=t}),this.store$.pipe($("scale"),qs(1),ii(100)).subscribe({next:t=>this.lastViewScale=t}),this.store$.pipe($("degree")).subscribe({next:t=>this.degree=t}),this.store$.pipe($("viewMode")).subscribe({next:t=>this.viewMode=t}),this.store$.pipe($("renderingMode")).subscribe({next:t=>this.renderingMode=t}),this.store$.pipe($("rulerActive")).subscribe({next:t=>{this.rulerActive=t,this.rulerActive&&this.updateOffsetForGuideline()}}),this.store$.pipe($("dragMode")).subscribe({next:t=>{this.dragMode=t,this.dragMode===Pt.MOVE?this.draggingListener.listen():this.draggingListener.unlisten()}}),this.store$.pipe($("pageCount")).subscribe({next:t=>this.pageCount=t}),this.store$.pipe($("isR2L")).subscribe({next:t=>this.isR2L=t}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.updateOffsetForGuideline()}}),this.store$.pipe($("searchToolActive")).subscribe({next:t=>{if(!this.canTextSearch()){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new yo("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(oi()).subscribe({next:t=>{this.preferences=t;let i=this.preferences&&this.preferences.viewerDirection===0?this.pdfInfo?.ViewerPreferences?.Direction==="R2L":this.preferences.viewerDirection===2;if(this.isR2L!==i){if(this.store$.dispatch(ue.set({key:"isR2L",value:i})),this.pdfPages.splice(0),!this.scrollController||!this.stateHolder)return;this.stateHolder.isR2L=i,this.bufferPages()}this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("isCaptureMode")).subscribe({next:t=>{t&&(this.store$.dispatch(Ki.unselectTool()),this.annotSelectedService.unselectAll(),this.popupService.closeAllPopup()),this.isCaptureMode=t,this.changeDetectorRef.markForCheck()}}),Ji([this.contentService.bufferSizeChange$.pipe(F(w.isDefined)),this.store$.pipe($("pageCount"),F(t=>t>0))]).subscribe({next:([t,i])=>{if(t>=i||t===0){this.bufferSize=i;return}this.bufferSize=t}}),Ji([this.pageService.pdfPages$,this.documentService.pdfInfo$]).pipe(F(([t,i])=>t.length>0&&this.pdfInfo!==i)).subscribe({next:([t,i])=>this.onPdfDocumentReady(t,i)}),this.contentService.enableLinkCreationDialog$.subscribe({next:t=>this.modalService.createModal(Cr,t)}),this.contentService.rebufferPages$.subscribe({next:()=>{this.stateHolder.pdfPages=this.pageService.pdfPages,this.stateHolder.degree=this.degree,this.stateHolder.isR2L=!!this.isR2L,this.bufferPages()}}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:t=>{this.isContextMenuOpened=t,this.changeDetectorRef.markForCheck()}}),G.windowMousedown$.pipe(F(t=>w.isDefined(this.selectedText?.textBox)&&t.button===2)).subscribe({next:t=>{let i=this.selectedText.page.i,e=this.clickedPage?.i;(i!==e||t.target===this.scaleWrapper?.nativeElement)&&this.selectTextService.publishSelectedText(null)}}),G.windowMousedown$.pipe(F(()=>!this.isEbookMode())).subscribe({next:t=>this.isClickOnGrayArea=t.target===this.scaleWrapper.nativeElement}),this.pageService.clickedPage$.subscribe({next:t=>this.clickedPage=t}),this.selectTextService.publishSelectedText$.subscribe({next:t=>{t&&(G.isMobile()||G.isTablet()||G.isTouchableDevice())&&this.sdContextMenuService.publishContextMenuStatus(!0),this.selectedText=t}}),this.shortcutService.getShortcutEvent(Pe.COPY_TEXT).pipe(F(()=>K.get(ie.SHORTCUT_COPY_TEXT)),F(()=>this.documentService.checkAuthority(Ne.COPY_TEXT)),F(()=>w.isDefined(this.selectedText)&&this.selectedText.text.length>0),F(()=>!this.annotSelectedService.selectedComponents.length)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.copyToClipboard(this.selectedText.text)}}),this.store$.pipe($("isSlideshow"),F(t=>t),st(t=>{if(!w.getFullscreenMethod(this.contentViewElement))return this.store$.dispatch(ue.set({key:"isSlideshow",value:!1})),this.toastService.create({toastStyle:Wt.NOTIFICATION,content:this.translatePipe.transform("NOT_SUPPORTED_BROWSER_SLIDESHOW")}),ht();this.stateHolder.isSlideshow=t,this.originalViewMode=this.viewMode,this.originalScale=this.scale,this.originalPageNo=this.currentPageNo;let i=w.getFullscreenMethod(this.contentViewElement),e=this.contentViewElement;return i!=="requestFullscreen"?typeof e[i]=="function"?ht(e[i].call(this.contentViewElement)):Gn(()=>new Cn("Fullscreen is not supported in this browser or element.")):this.contentViewElement.requestFullscreen()})).subscribe(),bo(w.getFullscreenEventNames()).pipe(Ws(t=>Ge(G.nativeWindow,t)),F(t=>t.target===this.contentViewElement),ml(0),F(t=>t.length>0)).subscribe({next:()=>{if(w.isFullscreenMode()){this.renderer.setStyle(this.contentViewElement,"background-color","black"),this.renderer.setStyle(this.slideshowOverlay.nativeElement,"background-color","transparent"),this.subscribeSlideshowEvent(),this.contentService.requestViewChange({viewMode:0,fitMode:6,pageNo:1});return}this.unsubscribeSlideshowEvent(),this.stateHolder.isSlideshow=!1,this.scrollController.moveToPage(this.originalPageNo),this.renderer.setStyle(this.contentViewElement,"background-color",""),this.store$.dispatch(ue.set({key:"isSlideshow",value:!1})),this.contentService.requestViewChange({viewMode:this.originalViewMode,scale:this.originalScale})}}),this.viewerService.backgroundColor$.subscribe({next:t=>{this.renderer.setStyle(this.contentViewElement,"background-color",`${t}`)}}),(()=>{let t=()=>this.scrollContainerRef.nativeElement.scrollTop/J.normalizeScale(this.scale),i=t();return Ge(this.scrollContainerRef.nativeElement,"scroll",{passive:!1}).pipe(F(()=>!this.isEbookMode())).subscribe({next:e=>{if(this.scrollController.publishScrollEvent(e),this.scrollController.calcViewRectSrc.next(!0),!J.isContinuousMode(this.viewMode))return;let n=t();this.publishScrollPosition();let r=this.detectPageNo(i<n?is.DOWN:is.UP);i=n,r!==this.currentPageNo&&(this.store$.dispatch(ue.set({key:"currentPageNo",value:Math.min(Math.max(1,r),this.pageCount)})),this.bufferPages())}})})())}setColorTheme(t){switch(t){case"light":this.renderer.setAttribute(document.body,"theme","light");break;case"dark":this.renderer.setAttribute(document.body,"theme","dark");break;default:let i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";this.renderer.setAttribute(document.body,"theme",i)}}publishScrollPosition(){this.guideLineService.publishScrollOffset({offsetX:this.scrollContainerRef.nativeElement.scrollLeft,offsetY:this.scrollContainerRef.nativeElement.scrollTop})}convertPageOffset2ViewOffset(t,i,e,n){let r=t.pageOffsets.find(M=>M.index===i-1),c=J.normalizeScale(t.scale),g=this.stateHolder.pdfPages[i-1],{scrollLeft:v,scrollTop:y}=this.convertPDFCoord2DOMCoord(g,{x:e,y:n});return{clientX:r.left*c+v-this.scrollContainerRef.nativeElement.scrollLeft,clientY:r.top*c+y-this.scrollContainerRef.nativeElement.scrollTop}}detectPageNo(t=is.UNKNOWN){if(this.stateHolder.pdfPages.length<=1)return this.stateHolder.pdfPages.length;let i=J.normalizeScale(this.scale),e=this.scrollContainerRef.nativeElement,n=Math.min(this.currentPageNo,this.stateHolder.pdfPages.length),r=J.getPageMovement(this.viewMode),c=this.stateHolder.pdfPages[n-1],g=this.stateHolder.getPageFrameOffset(this.viewMode,c.i).offsetY*i;if(t===is.UP)g>e.scrollTop+e.clientHeight*2/3?(c=this.stateHolder.pdfPages.slice(0,c.i+1).reverse().find(v=>this.stateHolder.getPageFrameOffset(this.viewMode,v.i).offsetY*i<=e.scrollTop+e.clientHeight*2/3),c&&(n=c.i-c.i%r+1)):n=c.i+1;else if(t===is.DOWN)g+this.stateHolder.getPageSize(c.i).height*i<e.scrollTop+Number(e.clientHeight)/3?(c=this.stateHolder.pdfPages.slice(c.i).find(y=>i*(this.stateHolder.getPageFrameOffset(this.viewMode,y.i).offsetY+this.stateHolder.getPageSize(y.i).height)>e.scrollTop+Number(e.clientHeight)/3),c&&(n=c.i-c.i%r+1)):n=c.i+1;else{let v=e.clientHeight/2,y=this.stateHolder.pdfPages.find(M=>this.stateHolder.getPageFrameOffset(this.viewMode,M.i).offsetY*J.normalizeScale(this.scale)>e.scrollTop+v);n=y?Math.max(1,y.i):this.stateHolder.pdfPages.length}return n}bufferPages(){if(this.viewMode===4)return;let t=J.getPageMovement(this.viewMode),i=(J.isContinuousMode(this.viewMode)?Math.ceil(1/J.normalizeScale(this.scale)*t):t)+Pi.OPTIONAL_VISIBLE_PAGE,[e,n]=ia.truncateRange(0,this.pageCount,this.currentPageNo,w.isDefined(this.bufferSize)?this.bufferSize/2:i);this.stateHolder.bufferedPages.splice(0);for(let r=e;r<n;r++)this.stateHolder.bufferedPages.push(this.stateHolder.pdfPages[r]);this.pdfPages.splice(0),this.pdfPages.push(...this.stateHolder.bufferedPages),this.changeDetectorRef.detectChanges(),this.contentView.update(this.stateHolder,this.scale,this.viewMode,this.currentPageNo,this.degree),this.contentService.bufferPage(this.stateHolder.bufferedPages)}isPDFCoordDestination(t){return t instanceof Object&&(t.hasOwnProperty("x")||t.hasOwnProperty("y"))}isDOMCoordDestination(t){return t instanceof Object&&(t.hasOwnProperty("scrollLeft")||t.hasOwnProperty("scrollTop"))}isPositionDestination(t){return t instanceof Object&&t.hasOwnProperty("position")}scroll(t,i){if(this.viewMode===4){console.warn("Scroll request was ignored during eBook mode.");return}let e=this.stateHolder.getPageFrameOffset(this.viewMode,t.i),n=J.normalizeScale(this.scale),r={};if(this.isPDFCoordDestination(i)){let{scrollLeft:c,scrollTop:g}=this.convertPDFCoord2DOMCoord(t,{x:i.x??0,y:i.y??0});i.x!==void 0&&(r.scrollLeft=e.offsetX*n+c+Pi.MARGIN*n,i.placeInTopLeft||(r.scrollLeft-=this.scrollContainerRef.nativeElement.clientWidth/2)),i.y!==void 0&&(r.scrollTop=e.offsetY*n+g+Pi.MARGIN*n,i.placeInTopLeft||(r.scrollTop-=this.scrollContainerRef.nativeElement.clientHeight/2))}else this.isDOMCoordDestination(i)?r=i:this.isPositionDestination(i)&&(r=this.convertPosition2DOMCoord(t,{clientX:e.offsetX*n,clientY:e.offsetY*n},i));r.scrollLeft!==void 0&&(this.scrollContainerRef.nativeElement.scrollLeft=r.scrollLeft),r.scrollTop!==void 0&&(this.scrollContainerRef.nativeElement.scrollTop=r.scrollTop)}convertPDFCoord2DOMCoord(t,i){let e=t.bbox,n=J.normalizeScale(this.scale),r=J.normalizeDegree(this.degree+t.r);(i.x===void 0||i.y===void 0)&&this.loggingService.common("warn",Le.NOT_EXIST,"scrollDestination");let c=0,g=0,v=i.x,y=i.y;switch(r){case 0:c=v-e.x,g=e.h-(y-e.y);break;case 90:c=y-e.y,g=v-e.x;break;case 180:c=e.w-(v-e.x),g=y-e.y;break;case 270:c=e.h-(y-e.y),g=e.w-(v-e.x);break;default:throw Error("Rotate must be a multiple of 90")}return{scrollLeft:c*n,scrollTop:g*n}}convertPosition2DOMCoord(t,i,e){let n=t.bbox,r=J.normalizeScale(this.scale),g=J.normalizeDegree(this.degree+t.r)/90%2!==0,v,y;switch(e.position){case Ei.TOP_ONLY:case Ei.BOTTOM_ONLY:break;case Ei.TOP_LEFT:case Ei.LEFT_ONLY:case Ei.BOTTOM_LEFT:v=i.clientX;break;case Ei.TOP_CENTER:case Ei.BOTTOM_CENTER:v=i.clientX+(g?n.h:n.w)*r/2-this.scrollContainerRef.nativeElement.clientWidth/2+Pi.MARGIN*r;break;case Ei.RIGHT_ONLY:v=i.clientX+(g?n.h:n.w)*r-this.scrollContainerRef.nativeElement.clientWidth+Pi.MARGIN*r;break}switch(e.position){case Ei.LEFT_ONLY:case Ei.RIGHT_ONLY:break;case Ei.TOP_ONLY:case Ei.TOP_LEFT:case Ei.TOP_CENTER:y=i.clientY;break;case Ei.BOTTOM_ONLY:case Ei.BOTTOM_LEFT:case Ei.BOTTOM_CENTER:y=(g?n.w:n.h)*r-this.scrollContainerRef.nativeElement.clientHeight+Pi.MARGIN*r;break}return{scrollLeft:v,scrollTop:y}}getCurrentRenderingInfo(){let t=this.scrollContainerRef.nativeElement,i={degree:this.degree,scale:this.scale,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop,pageOffsets:[]},e=J.normalizeScale(this.scale);if(J.isContinuousMode(this.viewMode))this.pdfPages.forEach(n=>{let r=this.stateHolder.getPageFrameOffset(this.viewMode,n.i);i.pageOffsets.push({left:r.offsetX,top:r.offsetY,index:n.i})});else{let n=ro.getOffset(this.stateHolder,this.scrollContainerRef.nativeElement,this.scale,this.viewMode,this.currentPageNo);i.pageOffsets.push({left:n.offsetX/e,top:n.offsetY/e,index:this.currentPageNo-1})}return i}calculateScrollOnRescale(t,i){let e=J.normalizeScale(t.scale),n=J.normalizeScale(this.scale);return{scrollLeft:(t.scrollLeft+i.clientX)/e*n-i.clientX,scrollTop:(t.scrollTop+i.clientY)/e*n-i.clientY}}calculateScrollOnViewModeChange(t){let i=J.normalizeScale(t.scale),e=t.pageOffsets.find(y=>y.index===this.currentPageNo-1),n=e?e.left*i-t.scrollLeft:0,r=e?e.top*i-t.scrollTop:0,c,g,v=J.normalizeScale(this.scale);if(J.isContinuousMode(this.viewMode)){let y=this.stateHolder.getPageFrameOffset(this.viewMode,this.currentPageNo-1);c=y.offsetX*v,g=y.offsetY*v}else{let y=ro.getOffset(this.stateHolder,this.scrollContainerRef.nativeElement,this.scale,this.viewMode,this.currentPageNo);c=y.offsetX,g=y.offsetY}return{scrollLeft:c-n,scrollTop:g-r}}calculateScaleForRect(t,i){let e=this.scrollContainerRef.nativeElement,n=e.clientWidth/e.clientHeight,c=J.normalizeDegree(this.stateHolder.pdfPages[t-1].r+this.degree)/90%2!==0,g=Math.abs(i.right-i.left),v=Math.abs(i.top-i.bottom),y=g/v;return n>y?e.clientHeight/(c?g:v)*100/J.SCALE_CORRECTION_CONST:e.clientWidth/(c?v:g)*100/J.SCALE_CORRECTION_CONST}calculateScaleForFit(t,i,e,n){let{pdfPages:r}=this.stateHolder,c=J.isTwoPageMode(e)?2:1,g=t-1,v=g-g%c,[y,M]=r.slice(v,v+2),[V,Z]=lc.calculateMaxArea(y,n),[le,pe]=M?lc.calculateMaxArea(M,n):[0,0],he=this.contentViewElement.offsetWidth,Te=this.contentViewElement.offsetHeight,p=this.selectFitMode(i,V,Z,he,Te),dt=J.isTwoPageMode(e)&&(r.length%2!==1||t!==r.length),vt,gt=0,Mi=he/Te,At=this.stateHolder.getPageContainerSize(e,g),li=At.width/At.height;if(p===0)gt=he,Mi>li&&(gt-=G.scrollbarSize.vertical),vt=V+Pi.MARGIN*2+(dt?le+Pi.MARGIN*2:0);else if(p===1)gt=Te,Mi<li&&(gt-=G.scrollbarSize.horizontal),vt=(dt?Math.max(Z,pe):Z)+Pi.MARGIN*2;else{if(p===4)return 100;if(p===6){let Oe=this.selectFitMode(3,V,Z,he,Te);vt=Oe===0?V:Z,G.isLandscape()&&G.screenSize.height>G.screenSize.width?gt=Oe===0?G.screenSize.height:G.screenSize.width:gt=Oe===0?G.screenSize.width:G.screenSize.height}else{if(p===7)return this.lastViewScale;this.loggingService.common("warn",Le.INVALID,"fitMode",p)}}let mi=gt/vt*100;return(this.isSlideshow?mi:Math.floor(mi))/J.SCALE_CORRECTION_CONST}selectFitMode(t,i,e,n,r){switch(t){case 2:return G.isSmallDevice()||i>e?0:1;case 3:return i/e>n/r?0:1;case 5:return i*J.SCALE_CORRECTION_CONST>n?0:4;default:return t}}subscribeSlideshowEvent(){if(!this.slideshowOverlay){this.loggingService.common("error",Le.NOT_EXIST,"slideshowOverlay");return}this.subscriptionService.set("slideshowOrientationChange",Co(()=>G.nativeWindow.screen.orientation?Ge(G.nativeWindow.screen.orientation,"change"):ht(void 0)).subscribe({next:()=>{this.contentService.requestViewChange({fitMode:6})}})),this.subscriptionService.set("slideshowResizeEvent",Ge(G.nativeWindow,"resize").pipe(F(()=>{let t=w.getFullscreenElement();return!!document[t]&&this.stateHolder.isSlideshow})).subscribe({next:()=>{this.contentService.requestViewChange({fitMode:6})}})),this.subscriptionService.set("slideshowKeyboardEvent",Ge(G.nativeWindow,"keydown").subscribe({next:t=>{t.key!=="Tab"&&(t.preventDefault(),t.stopPropagation());let i=this.slideshowOverlay?.nativeElement;if(i?.style.backgroundColor!=="transparent"){this.renderer.setStyle(i,"background-color","transparent");return}if(t.key==="."||t.key==="B"||t.key==="b"){this.renderer.setStyle(i,"background-color","#000000");return}if(t.key===","||t.key==="W"||t.key==="w"){this.renderer.setStyle(i,"background-color","#FFFFFF");return}this.currentPageNo!==1&&(t.key==="ArrowLeft"||t.key==="ArrowUp"||t.key==="PageUp"||t.key==="Backspace")&&this.scrollController.moveToPrevPage(),this.currentPageNo!==this.pageCount&&(t.key==="ArrowRight"||t.key==="ArrowDown"||t.key==="PageDown"||t.key===" ")&&this.scrollController.moveToNextPage(),this.currentPageNo!==1&&t.key==="Home"&&this.scrollController.moveToPage(1),this.currentPageNo!==this.pageCount&&t.key==="End"&&this.scrollController.moveToPage(this.pageCount)}})),this.subscriptionService.set("slideshowMouseEvent",Ge(this.slideshowOverlay.nativeElement,"pointerdown").pipe(F(t=>t.pointerType==="mouse"&&t.button===0)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation();let i=this.slideshowOverlay?.nativeElement;if(i?.style.backgroundColor!=="transparent"){this.renderer.setStyle(i,"background-color","transparent");return}this.scrollController.moveToNextPage()}})),this.subscriptionService.set("slideshowTouchEvent",ut(Ge(this.slideshowOverlay.nativeElement,"touchstart"),Ge(this.slideshowOverlay.nativeElement,"touchmove"),Ge(this.slideshowOverlay.nativeElement,"touchend")).pipe(F(t=>t.touches.length>1)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation()}})),this.subscriptionService.set("slideshowToucheventEvent",Ge(this.slideshowOverlay.nativeElement,"touchend").pipe(F(t=>t.touches.length<1)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.scrollController.moveToNextPage()}}))}unsubscribeSlideshowEvent(){this.subscriptionService.get("slideshowOrientationChange")?.unsubscribe(),this.subscriptionService.get("slideshowResizeEvent")?.unsubscribe(),this.subscriptionService.get("slideshowKeyboardEvent")?.unsubscribe(),this.subscriptionService.get("slideshowMouseEvent")?.unsubscribe(),this.subscriptionService.get("slideshowTouchEvent")?.unsubscribe(),this.subscriptionService.get("slideshowToucheventEvent")?.unsubscribe()}updateOffsetForGuideline(){if(!this.rulerActive)return;let t=J.normalizeScale(this.scale),i=ro.getOffset(this.stateHolder,this.contentViewElement,this.scale,this.viewMode,this.currentPageNo),e=si({},this.stateHolder.getPageFrameOffset(this.viewMode,this.currentPageNo-1));e.offsetX=(e.offsetX+Pi.MARGIN)*t,e.offsetY=(e.offsetY+Pi.MARGIN)*t,this.guideLineService.publishContentViewOffset({offsetX:i.offsetX+e.offsetX,offsetY:i.offsetY+e.offsetY,width:this.contentViewElement.offsetWidth,height:this.contentViewElement.offsetHeight}),this.guideLineService.publishScrollOffset({offsetX:this.contentViewElement.scrollLeft,offsetY:this.contentViewElement.scrollTop})}initDraggingListener(){this.draggingListener.addTriggerEvent(this.contentViewElement,"mousedown",t=>{if(t.target instanceof Element&&t.target.classList.contains("no-scroller"))return!1;let i=document.activeElement;return!(i instanceof HTMLBodyElement)&&i instanceof HTMLElement&&i.blur(),t.preventDefault(),!0}),this.draggingListener.addMainEvent(window,"mousemove",t=>this.moveScrollByDragging(t)),this.draggingListener.addTerminatorEvent(window,"mouseup",()=>this.changeDetectorRef.markForCheck()),this.draggingListener.addTerminatorEvent(window,"blur",()=>this.changeDetectorRef.markForCheck())}moveScrollByDragging(t){this.contentViewElement.scrollLeft-=t.movementX,this.contentViewElement.scrollTop-=t.movementY}finalizeSubscribers(){this.pageService.publishPages([]),this.documentService.closeEBook()}copyToClipboard(t){G.copyToClipboard(t)}changeZoomByWheel(t,i,e){this.contentService.requestViewChange({scale:J.calculateNextScale(this.scale,e<0),checkScale:!0,referencePoint:{clientX:t.x-i.x,clientY:t.y-i.y}})}};N(ns,"\u0275fac",function(i){return new(i||ns)(_(En),_(ri),_(Ae),_(ct),_(zt),_(Ni),_(at),_(zi),_(ye),_(Zt),_(ee),_(Qt),_(jp),_(rn),_(qo),_(to),_($t),_(an),_(He),_(ga),_(sn),_(Di),_(ji),_(Fr),_(ha))}),N(ns,"\u0275cmp",Ce({type:ns,selectors:[["sd-content-view"]],viewQuery:function(i,e){if(i&1&&(Ye(Xu,7),Ye(Ku,5),Ye(Aa,7),Ye(qu,5)),i&2){let n;Me(n=Re())&&(e.scrollContainerRef=n.first),Me(n=Re())&&(e.scaleWrapper=n.first),Me(n=Re())&&(e.contentView=n.first),Me(n=Re())&&(e.slideshowOverlay=n.first)}},inputs:{pdfDoc:"pdfDoc",overWrittenZoom:"overWrittenZoom",centerPoint:"centerPoint"},standalone:!1,features:[xe([ee]),tn],decls:12,vars:9,consts:[["scrollContainerRef",""],["floatingNav",""],["scaleWrapper",""],["slideshowOverlay",""],[4,"ngTemplateOutlet"],["sdContentViewLayout","",1,"pre-scrollable",3,"mouseup","ngStyle"],[4,"ngIf"],[3,"documentId",4,"ngIf"],["id","slideshow-overlay",4,"ngIf"],["id","search-tool",3,"pdfDoc",4,"ngIf"],[3,"contentViewRoot",4,"ngIf"],["id","scale-wrapper","sdScaleWrapperLayout",""],["id","scroll-expander","sdScrollExpanderLayout",""],["class","page-frame","sdPageFrameLayout","",3,"page",4,"ngFor","ngForOf","ngForTrackBy"],[3,"isClickOnGrayArea",4,"ngIf"],[3,"contentViewRoot"],["sdPageFrameLayout","",1,"page-frame",3,"page"],["sdCopyPaste","","sdPageContentLayout","",3,"mousedown","priority","page","documentId"],[3,"isClickOnGrayArea"],[3,"documentId"],["id","slideshow-overlay"],["id","search-tool",3,"pdfDoc"],[3,"pdfDoc",4,"ngIf"],[3,"pdfDoc"]],template:function(i,e){if(i&1){let n=Se();se(0,Qu,1,0,"ng-container",4),A(1,"div",5,0),ce("mouseup",function(c){return W(n),z(e.onRightMouseUp(c))}),se(3,ig,8,7,"ng-container",6)(4,ng,1,1,"sd-ebook-view",7)(5,og,2,0,"div",8)(6,rg,1,0,"ng-container",4)(7,sg,1,0,"sd-quick-action",6),D(),se(8,ag,1,1,"sd-search-tool",9)(9,cg,1,0,"sd-indicator",6)(10,pg,1,1,"ng-template",null,1,Li)}if(i&2){let n=wi(11);O("ngTemplateOutlet",!e.isSlideshow&&n),x(),O("ngStyle",e.contentViewStyle),x(2),O("ngIf",!e.isEbookMode()),x(),O("ngIf",e.isEbookMode()),x(),O("ngIf",e.isSlideshow),x(),O("ngTemplateOutlet",e.isSlideshow&&n),x(),O("ngIf",!e.isSlideshow),x(),O("ngIf",e.canTextSearch()&&e.searchToolActive),x(),O("ngIf",e.runtimeEnv.get(e.MergedRuntimeEnvKey.INDICATOR)&&!e.isSlideshow&&!e.hidableMenus[e.HidableView.INDICATOR])}},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}#scale-wrapper[_ngcontent-%COMP%]{position:absolute;top:0}#scale-wrapper.capture-mode[_ngcontent-%COMP%]{z-index:4}#scroll-expander[_ngcontent-%COMP%]{display:table;transform-origin:0 0}.pre-scrollable[_ngcontent-%COMP%]{overflow:auto;position:relative;width:100%;height:100%;-webkit-overflow-scrolling:touch}.page-frame[_ngcontent-%COMP%]{position:absolute;display:table-cell}.hide-outline[_ngcontent-%COMP%]{outline:none}.hide-background[_ngcontent-%COMP%]{background-color:transparent}#slideshow-overlay[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;top:0;left:0;cursor:default}"],changeDetection:0}));var Ao=ns;ze([ot(it.contentViewComp.moveScrollByDragging,1e3)],Ao.prototype,"moveScrollByDragging",null);ze([ot(it.contentViewComp.copyToClipboard,1e3)],Ao.prototype,"copyToClipboard",null);ze([ot(it.contentViewComp.changeZoomByWheel,1e3)],Ao.prototype,"changeZoomByWheel",null);var Sd=(()=>{let t=class t{elementRef;subscriptionService;objectClipboardService;annotSelectedService;shortcutService;store$;page;degree;currentPageNo;constructor(e,n,r,c,g,v){this.elementRef=e,this.subscriptionService=n,this.objectClipboardService=r,this.annotSelectedService=c,this.shortcutService=g,this.store$=v}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),this.store$.pipe($("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),Ge(this.elementRef.nativeElement,"mouseenter").pipe(F(()=>this.page.i!==this.objectClipboardService.lastestEnteredPageIndex)).subscribe({next:()=>this.objectClipboardService.publishLastestEnteredPageIndex(this.page.i)}),ut(Ge(window,"copy"),this.shortcutService.getShortcutEvent(Pe.COPY_ANNOTS).pipe(F(e=>this.isFakeEvent(e)))).pipe(F(()=>K.get(ie.SHORTCUT_COPY_PASTE)),F(()=>this.annotSelectedService.pageIndex===this.page.i),F(e=>!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement))).subscribe({next:e=>{e.preventDefault(),this.objectClipboardService.copy(this.annotSelectedService.selectedComponents.map(n=>w.deepClone(n.data)),this.page.i,!(e instanceof KeyboardEvent)&&G.nativeWindow.isSecureContext)}}),ut(Ge(G.nativeWindow,"paste").pipe(F(()=>this.page.i===this.objectClipboardService.lastestEnteredPageIndex),xl(Ge(this.elementRef.nativeElement,"mousemove",{capture:!0}))),this.shortcutService.getShortcutEvent(Pe.PASTE_ANNOTS).pipe(F(()=>this.currentPageNo-1===this.page.i),F(e=>this.isFakeEvent(e)),Ve(e=>[e]))).pipe(F(()=>K.get(ie.SHORTCUT_COPY_PASTE)),F(([e])=>!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement))).subscribe({next:([e,n])=>{let r,c,g;!(e instanceof KeyboardEvent)&&w.isDefined(e.clipboardData)&&(r=e.clipboardData.getData("text/plain"),c=e.clipboardData.getData("text/html"),g=e.clipboardData.files.item(0)??void 0),this.objectClipboardService.paste({text:r,html:c,image:g},n?this.convertMouseToPagePoints(n,(this.page.r+this.degree)/90%4):null,this.page)}}))}convertMouseToPagePoints(e,n){let c=this.elementRef.nativeElement.getBoundingClientRect();switch(n){case 0:return{x:(e.clientX-c.left)*(this.page.bbox.w/c.width),y:this.page.bbox.h-(e.clientY-c.top)*(this.page.bbox.h/c.height)};case 1:return{x:(e.clientY-c.top)*(this.page.bbox.w/c.height),y:(e.clientX-c.left)*(this.page.bbox.h/c.width)};case 2:return{x:this.page.bbox.w-(e.clientX-c.left)*(this.page.bbox.w/c.width),y:(e.clientY-c.top)*(this.page.bbox.h/c.height)};case 3:return{x:this.page.bbox.w-(e.clientY-c.top)*(this.page.bbox.w/c.height),y:this.page.bbox.h-(e.clientX-c.left)*(this.page.bbox.h/c.width)};default:throw new _t(`Unsupported rotate: ${n}`)}}isFakeEvent(e){return!e.isTrusted}};N(t,"\u0275fac",function(n){return new(n||t)(_(ni),_(ee),_(ma),_(Ni),_(sn),_(ye))}),N(t,"\u0275dir",bn({type:t,selectors:[["","sdCopyPaste",""]],inputs:{page:"page"},standalone:!1,features:[xe([ee])]}));let s=t;return s})();var hg=["floatingNav"],Is=s=>({content:s});function ug(s,t){if(s&1){let i=Se();Bt(0),A(1,"div",6)(2,"pu-input",7),Y(3,"translate"),ce("keydown.enter",function(){W(i);let n=E(2);return z(n.goToPage(n.pageNoFormControl.value))})("focus",function(){W(i);let n=E(2);return z(n.onNavInputFocus())})("blur",function(){W(i);let n=E(2);return z(n.onNavInputBlur())}),D(),A(4,"div",8),be(5),D()(),Ut()}if(s&2){let i=E(2);x(2),O("readonly",i.isSlideshow)("autoResize",!0)("maxLength",i.pageCount.toString().length)("formControl",i.pageNoFormControl)("ariaLabel",X(3,7,"MOVE_SPECIFYING_PAGE")),x(2),O("ngStyle",i.pdfDoc?null:i.viewerService.disableStyle),x(),Kn(" /\xA0",i.pageCount,"")}}function gg(s,t){if(s&1){let i=Se();Bt(0),A(1,"div",9)(2,"button",10),Y(3,"translate"),Y(4,"translate"),Y(5,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.goPreviousPageForStatistics(n.ViewerStatisticData.CHANGE_PAGE_BY_FLOATING_NAV_BUTTON))})("focus",function(){W(i);let n=E(2);return z(n.onNavInputFocus())})("blur",function(){W(i);let n=E(2);return z(n.onNavInputBlur())}),Q(6,"i",11),D(),A(7,"button",12),Y(8,"translate"),Y(9,"translate"),Y(10,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.goNextPageForStatistics(n.ViewerStatisticData.CHANGE_PAGE_BY_FLOATING_NAV_BUTTON))})("focus",function(){W(i);let n=E(2);return z(n.onNavInputFocus())})("blur",function(){W(i);let n=E(2);return z(n.onNavInputBlur())}),Q(11,"i",13),D()(),Ut()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",i.prevButtonDisabled),O("disabled",i.prevButtonDisabled)("title",i.isMobile?"":X(3,18,"PREVIOUS_PAGE"))("tooltip",St(30,Is,X(4,20,"PREVIOUS_PAGE"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(5,22,"PREVIOUS_PAGE")),x(5),$e("dark",i.isDarkMode)("disabled",i.nextButtonDisabled),O("disabled",i.nextButtonDisabled)("title",i.isMobile?"":X(8,24,"NEXT_PAGE"))("tooltip",St(32,Is,X(9,26,"NEXT_PAGE"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(10,28,"NEXT_PAGE"))}}function fg(s,t){if(s&1){let i=Se();Bt(0),A(1,"div",14)(2,"button",15),Y(3,"translate"),Y(4,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.zoomOut(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))})("focus",function(){W(i);let n=E(2);return z(n.onNavInputFocus())})("blur",function(){W(i);let n=E(2);return z(n.onNavInputBlur())}),Q(5,"i",16),D(),A(6,"button",17),Y(7,"translate"),Y(8,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.zoomIn(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))})("focus",function(){W(i);let n=E(2);return z(n.onNavInputFocus())})("blur",function(){W(i);let n=E(2);return z(n.onNavInputBlur())}),Q(9,"i",18),D()(),Ut()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),O("disabled",!i.pdfDoc)("title",i.isMobile?"":X(3,18,"ZOOM_OUT"))("tooltip",St(26,Is,i.zoomOutTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(4,20,"ZOOM_OUT")),x(4),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),O("disabled",!i.pdfDoc)("title",i.isMobile?"":X(7,22,"ZOOM_IN"))("tooltip",St(28,Is,i.zoomInTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(8,24,"ZOOM_IN"))}}function mg(s,t){s&1&&Q(0,"div",4)}function vg(s,t){if(s&1){let i=Se();Bt(0),A(1,"div",19)(2,"button",20),Y(3,"translate"),Y(4,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.toggleSearchTool())})("focus",function(){W(i);let n=E(2);return z(n.onNavInputFocus())})("blur",function(){W(i);let n=E(2);return z(n.onNavInputBlur())}),Q(5,"i",21),D()(),Ut()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),O("disabled",!i.pdfDoc)("title",i.isMobile?"":X(3,10,"SEARCH"))("tooltip",St(14,Is,i.searchTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(4,12,"SEARCH"))("aria-expanded",i.searchToolActive)}}function _g(s,t){if(s&1){let i=Se();Bt(0),A(1,"div",22)(2,"button",23),Y(3,"translate"),Y(4,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.closeSlideshow())})("focus",function(){W(i);let n=E(2);return z(n.onNavInputFocus())})("blur",function(){W(i);let n=E(2);return z(n.onNavInputBlur())}),Q(5,"i",24),D()(),Ut()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),O("disabled",!i.pdfDoc)("title",i.isMobile?"":X(3,8,"CLOSE")),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(4,10,"CLOSE"))}}function Sg(s,t){if(s&1){let i=Se();A(0,"div",2,0),ce("mouseenter",function(){W(i);let n=E();return z(n.onMouseEnterNav())})("mouseleave",function(){W(i);let n=E();return z(n.onMouseLeaveNav())}),se(2,ug,6,9,"ng-container",3)(3,gg,12,34,"ng-container",3),Q(4,"div",4),se(5,fg,10,30,"ng-container",3)(6,mg,1,0,"div",5)(7,vg,6,16,"ng-container",3)(8,_g,6,12,"ng-container",3),D()}if(s&2){let i=E();nn("bottom",i.floatingPosition,"px"),O("@navFadeOut",i.shouldBeTransparent?"out":"in"),x(2),O("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.PAGE_NAVIGATION)),x(),O("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.MOVE_TO_ADJACENT_PAGE_BUTTON)),x(2),O("ngIf",!i.isSlideshow&&i.runtimeEnv.get(i.RuntimeEnvKey.ZOOM_BUTTON)),x(),O("ngIf",!i.isSlideshow&&i.runtimeEnv.get(i.MergedRuntimeEnvKey.SEARCH_BUTTON)&&!i.hidableMenus[i.HidableView.FLOATING_NAV_SEARCH]),x(),O("ngIf",!i.isSlideshow&&i.runtimeEnv.get(i.MergedRuntimeEnvKey.SEARCH_BUTTON)&&!i.hidableMenus[i.HidableView.FLOATING_NAV_SEARCH]),x(),O("ngIf",i.isSlideshow)}}var so=function(s){return s.TRANSPARENT="transparent",s.OPAQUE="opaque",s}(so||{}),bg=24,Cg=73,os=class os{changeDetectorRef;translatePipe;documentService;contentService;scrollController;store$;viewerService;subscriptionService;apiEventBridgeService;shortcutService;redactionService;quickActionService;get RuntimeEnvKey(){return ie}get MergedRuntimeEnvKey(){return xt}get runtimeEnv(){return K}get HidableView(){return B}get zoomInTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_IN")} (${ei.getShortcutString(Ui[Pe.INCREASE_ZOOM_NUMPAD])})`}get zoomOutTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_OUT")} (${ei.getShortcutString(Ui[Pe.DECREASE_ZOOM_NUMPAD])})`}get searchTooltipWithShortcut(){return`${this.translatePipe.transform("SEARCH")} (${ei.getShortcutString(Ui[Pe.SEARCH])})`}get prevButtonDisabled(){return this.currentPageNo<=1}get nextButtonDisabled(){return this.viewMode===4?J.getEbookPageNo(this.pageCount)<=this.currentPageNo:this.pageCount<=this.currentPageNo}get shouldDisplayNav(){return!this.isToolSelected}get shouldBeTransparent(){return!this._isMouseOnNav&&!this._isNavInputOnFocus&&!this.searchToolActive&&this._navTransparency===so.TRANSPARENT&&K.get(ie.FLOATING_NAVIGATION_AUTO_HIDE)}pdfDoc;floatingNavElement;scale;viewMode;currentPageNo;pageCount;isSlideshow;isToolSelected;searchToolActive;_isMouseOnNav=!1;_isNavInputOnFocus=!1;_navTransparency=so.OPAQUE;rightSideViewMode;rightSideViewVisible;hidableMenus={};pageNoFormControl=new fr(1);navVisibilityChanges=new Ht(so.OPAQUE);screenTheme;NAV_AREA_WIDTH_PC=G.breakpoints.mobile.width;NAV_AREA_HEIGHT_PC=166;NAV_VISIBLE_DURATION_MS=3e3;get ViewerStatisticData(){return fe}get floatingPosition(){return this.redactionService.isRedactingOnMobile()?Cg:bg}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return G.isMobile()}constructor(t,i,e,n,r,c,g,v,y,M,V,Z){this.changeDetectorRef=t,this.translatePipe=i,this.documentService=e,this.contentService=n,this.scrollController=r,this.store$=c,this.viewerService=g,this.subscriptionService=v,this.apiEventBridgeService=y,this.shortcutService=M,this.redactionService=V,this.quickActionService=Z}ngOnInit(){this.initSubscriptions(),this.subscribeVisibilityChange(),this.initRegisterQuickActions()}initSubscriptions(){this.subscriptionService.push(this.store$.pipe(fi([B.FLOATING_NAV_SEARCH])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(oi("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("scale")).subscribe({next:t=>this.scale=t}),this.store$.pipe($("pageCount")).subscribe({next:t=>{this.pageCount=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("viewMode")).subscribe({next:t=>this.viewMode=t}),this.store$.pipe($("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:t=>{this.rightSideViewVisible=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.pageNoFormControl.setValue(this.currentPageNo)}}),this.store$.pipe($("searchToolActive")).subscribe({next:t=>{if(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new yo("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("isSlideshow")).subscribe({next:t=>this.isSlideshow=t}),this.shortcutService.getShortcutEvent(Pe.SEARCH).subscribe({next:()=>{this.documentService.checkAuthority(Ne.SEARCH_TEXT)&&(K.get(ie.QUICK_SEARCH_BUTTON)||K.get(ie.FULL_SEARCH_BUTTON))&&!this.isEbookMode()&&this.pdfDoc&&this.toggleSearchTool()}}))}subscribeVisibilityChange(){this.subscriptionService.push(this.navVisibilityChanges.pipe(st(()=>(this._navTransparency=so.OPAQUE,this.changeDetectorRef.markForCheck(),lr(this.NAV_VISIBLE_DURATION_MS)))).subscribe({next:()=>{this._navTransparency=so.TRANSPARENT,this.changeDetectorRef.markForCheck()}}),G.windowResize$.subscribe({next:()=>this.navVisibilityChanges.next(so.OPAQUE)}),this.scrollController.viewScroll$.subscribe({next:()=>this.navVisibilityChanges.next(so.OPAQUE)}),G.windowMouseMoveEvent$.pipe(ii(10)).subscribe({next:t=>{this.floatingNavElement&&this.isMouseInsideActiveNavArea(t)&&this.navVisibilityChanges.next(so.OPAQUE)}}),this.store$.pipe(Wo()).subscribe({next:t=>{this.isToolSelected=t!==null,this.changeDetectorRef.markForCheck()}}),G.windowPointerUp$.pipe(F(()=>this.isSlideshow)).subscribe({next:()=>this.navVisibilityChanges.next(so.OPAQUE)}))}initRegisterQuickActions(){this.quickActionService.registerActions([{id:ve.PREVIOUS_PAGE,actionFn:()=>this.goPreviousPageForStatistics(fe.CHANGE_PAGE_BY_QUICK_SEARCH)},{id:ve.NEXT_PAGE,actionFn:()=>this.goNextPageForStatistics(fe.CHANGE_PAGE_BY_QUICK_SEARCH)},{id:ve.ZOOM_OUT,actionFn:()=>this.zoomOut(fe.CHANGE_ZOOM_BY_QUICK_SEARCH)},{id:ve.ZOOM_IN,actionFn:()=>this.zoomIn(fe.CHANGE_ZOOM_BY_QUICK_SEARCH)}])}getResponsiveActiveNavArea(t){if(G.width<=this.NAV_AREA_WIDTH_PC)return{left:0,right:G.width,top:G.height-this.NAV_AREA_HEIGHT_PC,bottom:G.height};let i=t.left+t.width/2;return{left:i-this.NAV_AREA_WIDTH_PC/2,right:i+this.NAV_AREA_WIDTH_PC/2,top:G.height-this.NAV_AREA_HEIGHT_PC,bottom:G.height}}isMouseInsideActiveNavArea(t){let i=this.floatingNavElement?.nativeElement.getBoundingClientRect(),e=this.getResponsiveActiveNavArea(i);return t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom}onNavInputFocus(){this._isNavInputOnFocus=!0}onNavInputBlur(){this.pageNoFormControl.value||this.pageNoFormControl.setValue(this.currentPageNo),this.pageNoFormControl.value!==this.currentPageNo&&this.goToPage(this.pageNoFormControl.value),this._isNavInputOnFocus=!1}onMouseEnterNav(){this._isMouseOnNav=!0}onMouseLeaveNav(){this._isMouseOnNav=!1}forceMouseLeaveNavInSlideShow(){this.isSlideshow&&this.onMouseLeaveNav()}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}goToPage(t){let i=Number(t);isNaN(i)||this.scrollController.moveToPage(i)}goPreviousPage(){this.forceMouseLeaveNavInSlideShow(),this.scrollController.moveToPrevPage()}goPreviousPageForStatistics(t){this.goPreviousPage()}goNextPage(){this.forceMouseLeaveNavInSlideShow(),this.scrollController.moveToNextPage()}goNextPageForStatistics(t){this.goNextPage()}publishScale(t,i){this.contentService.requestViewChange({scale:t,checkScale:i})}zoomIn(t){this.setScale(J.calculateNextScale(this.scale,!0),!0)}zoomOut(t){this.setScale(J.calculateNextScale(this.scale,!1),!0)}setScale(t,i=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,i)}toggleSearchTool(){if(!(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)||!this.pdfDoc)){if(K.get(ie.QUICK_SEARCH_BUTTON)){this.store$.dispatch(ue.set({key:"searchToolActive",value:!this.searchToolActive}));return}this.rightSideViewVisible&&this.rightSideViewMode===Rt.TextSearch?this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})):(this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})))}}closeSlideshow(){G.exitFullScreen()}};N(os,"\u0275fac",function(i){return new(i||os)(_(Ae),_(He),_(ct),_(at),_(zi),_(ye),_(Zt),_(ee),_(Qt),_(sn),_($r),_(ln))}),N(os,"\u0275cmp",Ce({type:os,selectors:[["sd-floating-nav"]],viewQuery:function(i,e){if(i&1&&Ye(hg,5),i&2){let n;Me(n=Re())&&(e.floatingNavElement=n.first)}},inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[xe([ee,{provide:qn,useValue:new Ht(300)}])],decls:1,vars:1,consts:[["floatingNav",""],["class","floating-page-nav",3,"bottom","mouseenter","mouseleave",4,"ngIf"],[1,"floating-page-nav",3,"mouseenter","mouseleave"],[4,"ngIf"],[1,"divider"],["class","divider",4,"ngIf"],[1,"page-input"],["size","tiny","align","left",1,"current-page-index","left-child",3,"keydown.enter","focus","blur","readonly","autoResize","maxLength","formControl","ariaLabel"],[1,"page-label",3,"ngStyle"],[1,"page-move"],[1,"ep-text-button","previous-page","left-child",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-previous-symbol2"],[1,"ep-text-button","next-page",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-next-symbol2"],[1,"zoom"],[1,"ep-text-button","zoom-out","left-child",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-minus"],[1,"ep-text-button","zoom-in",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-plus"],[1,"search"],["aria-controls","search-tool",1,"ep-text-button","search-button",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-search"],[1,"close"],[1,"ep-text-button","close-button",3,"click","focus","blur","disabled","title"],[1,"papycon","papycon-cross"]],template:function(i,e){i&1&&se(0,Sg,9,9,"div",1),i&2&&O("ngIf",e.shouldDisplayNav)},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}.floating-page-nav[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;z-index:5;background-color:var(--mono-00);display:flex;align-items:center;position:absolute;left:50%;transform:translate(-50%);border:1px solid var(--mono-30);border-radius:90px;height:42px}.floating-page-nav[_ngcontent-%COMP%]   button.disabled[_ngcontent-%COMP%]{opacity:.4}.floating-page-nav[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.divider){flex:1 1 auto;display:flex;justify-content:center;align-items:center;margin:0 12px}.floating-page-nav[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .left-child[_ngcontent-%COMP%]{margin-right:12px}.floating-page-nav[_ngcontent-%COMP%]   div.page-input[_ngcontent-%COMP%]{margin-left:20px;margin-right:0}.floating-page-nav[_ngcontent-%COMP%]   div.page-input[_ngcontent-%COMP%]   .left-child[_ngcontent-%COMP%]{margin-right:4px}.floating-page-nav[_ngcontent-%COMP%]   pu-input.current-page-index[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--input);border-radius:2px;box-sizing:content-box}.floating-page-nav[_ngcontent-%COMP%]   div.page-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);white-space:pre}.floating-page-nav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;border-width:0;outline-offset:-2px}.floating-page-nav[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}.floating-page-nav[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{color:#d7d7d7}.floating-page-nav[_ngcontent-%COMP%]   div.divider[_ngcontent-%COMP%]{height:24px;width:1px;background-color:var(--mono-30)}.floating-page-nav[_ngcontent-%COMP%]   div.search[_ngcontent-%COMP%]{margin-right:16px}.floating-page-nav[_ngcontent-%COMP%]   div.close[_ngcontent-%COMP%]{margin-right:16px;width:24px;height:24px}"],data:{animation:[Zn("navFadeOut",[Tn("in",Bi({opacity:1})),Tn("out",Bi({opacity:0})),On("in => out",[xn("400ms linear")]),On("out => in",[xn("0s")])])]},changeDetection:0}));var ao=os;ze([ot(it.floatingNavComp.goToPage)],ao.prototype,"goToPage",null);ze([ot(it.floatingNavComp.changePage)],ao.prototype,"goPreviousPageForStatistics",null);ze([ot(it.floatingNavComp.changePage)],ao.prototype,"goNextPageForStatistics",null);ze([ot(it.floatingNavComp.changeZoom,1e3)],ao.prototype,"zoomIn",null);ze([ot(it.floatingNavComp.changeZoom,1e3)],ao.prototype,"zoomOut",null);var xg=["imgEl"],bd=function(s){return s.Pixelated="pixelated",s}(bd||{}),Fa=(()=>{let t=class t{contentService;pageService;changeDetectorRef;renderer;apiEventBridgeService;subscriptionService;renderingService;store$;muPDFService;pdfPage;documentId;imgStyle={};resetted=new Fo;rendered=new Fo;failed=new Fo;imgElementRef;imgData;quality;normalizedScale;fetchFailCount=0;retryHandler=null;renderingMode=gi.SERVER;ngOnChange$=new Ht(!1);isRendered=!1;renderedDevicePixelRatio=devicePixelRatio;constructor(e,n,r,c,g,v,y,M,V){this.contentService=e,this.pageService=n,this.changeDetectorRef=r,this.renderer=c,this.apiEventBridgeService=g,this.subscriptionService=v,this.renderingService=y,this.store$=M,this.muPDFService=V}ngOnInit(){this.subscriptionService.push(ut(Ji([this.store$.pipe(oi("renderingOption")),this.store$.pipe(oi("hidpiRendering")),this.store$.pipe($("scale"),F(w.isDefined),ii(200),Ve(e=>gp(e,this.renderingService.renderingMode!==gi.SERVER)),F(e=>e!==this.normalizedScale),rt(e=>this.normalizedScale=e)),this.ngOnChange$.pipe(F(e=>e))]),this.contentService.reload$.pipe(F(e=>Go.typeAndPage(e,this.pdfPage.i,zo.Image)),st(()=>this.renderingMode!==gi.CLIENT?ht(void 0):this.muPDFService.document$.pipe(F(e=>e.status==="OPENED")))),Ge(G.nativeWindow,"resize").pipe(F(()=>this.renderedDevicePixelRatio!==devicePixelRatio),rt(()=>this.renderedDevicePixelRatio=devicePixelRatio))).subscribe({next:()=>this.startFetch()}),this.store$.pipe($("quality")).subscribe({next:e=>this.quality=e}),this.store$.pipe($("renderingMode"),rt(e=>this.renderingMode=e),F(e=>e===gi.HYBRID),st(()=>this.muPDFService.document$),F(e=>e.status==="OPENED")).subscribe({next:()=>this.startFetch()})),this.subscribePageArrangeEvent()}ngOnDestroy(){this.imgData=void 0,w.isDefined(this.imgElementRef.nativeElement.parentElement)&&this.imgElementRef.nativeElement.parentElement.removeChild(this.imgElementRef.nativeElement),Xi.destroy(this)}ngOnChanges(){this.renderer.setStyle(this.imgElementRef.nativeElement,J.SK_Z_INDEX,`${J.LayoutOrder.Image}${w.EMPTY_STRING}`),this.ngOnChange$.next(!0)}fetch(){if(!this.pdfPage)return;let e=this.renderingService.renderingMode!==gi.SERVER;this.subscriptionService.set("dataSub",this.drawWatermark(this.renderingService.fetchImage(this.documentId,this.pdfPage.ref,{zoom:this.normalizedScale,jpegQuality:this.quality,renderAnnots:!1,increasePrint:!1})).subscribe({next:n=>{e&&G.isChromium()&&K.get(ie.CLIENT_RENDERING_PIXELATED)&&(this.imgStyle.imageRendering=bd.Pixelated),this.render(n),this.apiEventBridgeService.watermarkCreatedSrc.next({ok:!0,data:void 0})},error:n=>this.onFetchFailed(n)}))}preloadFetch(){this.isRendered||!this.pdfPage||this.subscriptionService.set("preloadDataSub",this.drawWatermark(this.renderingService.fetchPreload(this.documentId,this.pdfPage.ref).pipe(F(()=>!this.imgData&&Math.max(this.pdfPage.bbox.w,this.pdfPage.bbox.h)>1e3),F(w.isDefined))).subscribe({next:e=>this.render(e)}))}startFetch(){this.clearRetryHandler(),this.fetchFailCount=0,this.preloadFetch(),this.fetch()}onFetchFailed(e){this.clearRetryHandler(),++this.fetchFailCount>Ze.retryCount?this.failed.emit(e):this.retryHandler=G.nativeWindow.setTimeout(()=>this.fetch(),Ze.retryInterval)}clearRetryHandler(){this.retryHandler!==null&&(clearTimeout(this.retryHandler),this.retryHandler=null)}render(e){e&&(this.imgData=e,this.isRendered=!0),J.setVisibility(this.imgElementRef.nativeElement,!0,this.renderer,!0),this.changeDetectorRef.markForCheck(),this.rendered.emit()}reset(){J.setVisibility(this.imgElementRef.nativeElement,!1,this.renderer),this.resetted.emit()}subscribePageArrangeEvent(){this.subscriptionService.push(this.pageService.pageArrangeEvt$.pipe(F(e=>this.pageService.arrangeAffectedChecker(this.pdfPage.originalIndex,e))).subscribe({next:()=>{this.reset(),this.ngOnChanges()}}))}drawWatermark(e){return Ji([e,this.store$.pipe(Yo("ALL"),Ve(n=>kn.filterChanges(n,r=>r.allowView?r.range==="all"?!0:!!Nn.parse(r.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(this.pdfPage.i):!1)),Ve(n=>kn.flattenWatermarks(n))),this.pageService.pageArrangeEvt$.pipe(F(n=>n.page===this.pdfPage&&n.action==="rotate"),rt(()=>this.reset()),Lo(void 0))]).pipe(st(([n,r,c])=>{if(n.data===void 0)return this.startFetch(),Gs;if(r.length===0)return ht(n);let g;switch(n.type){case"BLOB":g=URL.createObjectURL(n.data);break;case"BASE64":g=n.data;break;default:throw new _t("Cannot handle image data")}return new Ur({imgSrc:g,width:this.pdfPage.bbox.w,height:this.pdfPage.bbox.h,rotation:this.pdfPage.r},r).draw()}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(at),_(zt),_(Ae),_($t),_(Qt),_(ee),_(jo),_(ye),_($o))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-image"]],viewQuery:function(n,r){if(n&1&&Ye(xg,7),n&2){let c;Me(c=Re())&&(r.imgElementRef=c.first)}},inputs:{pdfPage:"pdfPage",documentId:"documentId",imgStyle:"imgStyle"},outputs:{resetted:"resetted",rendered:"rendered",failed:"failed"},standalone:!1,features:[xe([ee]),tn],decls:2,vars:2,consts:[["imgEl",""],[1,"image",3,"sdImage","ngStyle"]],template:function(n,r){n&1&&Q(0,"img",1,0),n&2&&O("sdImage",r.imgData)("ngStyle",r.imgStyle)},styles:["img.image[_ngcontent-%COMP%]{width:100%;height:100%;visibility:hidden;-webkit-user-select:none;user-select:none;pointer-events:none}"],changeDetection:0}));let s=t;return s})();var Cd=(()=>{let t=class t{store$;subscriptionService;changeDetectorRef;invisibleTracerService;styles={};rendered=new Fo;constructor(e,n,r,c){this.store$=e,this.subscriptionService=n,this.changeDetectorRef=r,this.invisibleTracerService=c}ngOnInit(){this.subscriptionService.push(Ji([this.store$.pipe($("scale")),G.windowResize$.pipe(Lo({}))]).subscribe({next:([e,n])=>{let r=window.devicePixelRatio,g=(G.isMobile()?4:screen.width*screen.height*Math.pow(r,2)<1920*1080?1:2)/r,v=(Ze.viewInvisibleTracerSize/J.normalizeScale(e)).toFixed(1);this.styles["background-size"]=`${v}px ${v}px`,this.styles.transform=`scale(${g.toFixed(8)})`,this.styles.width=`${(1/g*100).toFixed(6)}%`,this.styles.height=`${(1/g*100).toFixed(6)}%`,this.changeDetectorRef.markForCheck()}}),this.invisibleTracerService.viewBinary$.subscribe(e=>{this.styles["background-image"]=`url(${e.url})`,this.styles.opacity=this.invisibleTracerService.getOpacity().toString(),this.rendered.emit(),this.changeDetectorRef.markForCheck()}))}};N(t,"\u0275fac",function(n){return new(n||t)(_(ye),_(ee),_(Ae),_(ua))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-invisible-tracer-view"]],outputs:{rendered:"rendered"},standalone:!1,features:[xe([ee])],decls:1,vars:1,consts:[[3,"ngStyle"]],template:function(n,r){n&1&&Q(0,"div",0),n&2&&O("ngStyle",r.styles)},dependencies:[qt],styles:["[_nghost-%COMP%]{position:absolute;display:block;width:100%;height:100%;top:0;left:0;overflow:hidden}div[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;image-rendering:pixelated;transform-origin:top left}"],changeDetection:0}));let s=t;return s})();var Og=["magnifySvg"];function wg(s,t){if(s&1&&(Oi(),Q(0,"rect",3)),s&2){let i=E();ge("height",i.rectRender.h)("width",i.rectRender.w)("x",i.rectRender.x)("y",i.rectRender.y)}}var rs=class rs{changeDetectorRef;contentService;renderer;subscriptionService;store$;pdfPage;magnifySvgElementRef;scale;created=!1;startPoint={x:0,y:0};rectRender={x:0,y:0,w:0,h:0};prevEvent;onMouseMoveListener=null;onMouseUpListener=null;constructor(t,i,e,n,r){this.changeDetectorRef=t,this.contentService=i,this.renderer=e,this.subscriptionService=n,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:t=>this.scale=t}))}ngOnDestroy(){this.destroyMouseListeners()}onDown(t){return this.rectRender.x=t.offsetX,this.startPoint.x=this.rectRender.x,this.rectRender.y=t.offsetY,this.startPoint.y=this.rectRender.y,this.rectRender.h=0,this.rectRender.w=this.rectRender.h,this.onMouseUpListener=this.renderer.listen(this.magnifySvgElementRef.nativeElement,"mouseup",i=>this.onUp(i)),t.button!==0?!0:(t.preventDefault(),t.stopPropagation(),this.prevEvent=t,this.changeDetectorRef.markForCheck(),this.created=!0,this.onMouseMoveListener=this.renderer.listen(this.magnifySvgElementRef.nativeElement,"mousemove",i=>this.onMove(i)),!1)}onMove(t){return this.created?(t.preventDefault(),t.stopPropagation(),this.prevEvent?.offsetX===t.offsetX&&this.prevEvent?.offsetY===t.offsetY||(this.rectRender.x=Math.min(this.startPoint.x,t.offsetX),this.rectRender.y=Math.min(this.startPoint.y,t.offsetY),this.rectRender.w=Math.abs(t.offsetX-this.startPoint.x),this.rectRender.h=Math.abs(t.offsetY-this.startPoint.y),this.prevEvent=t,this.changeDetectorRef.markForCheck()),!1):!0}onUp(t){t.preventDefault(),t.stopPropagation(),this.destroyMouseListeners(),this.created=!1,this.changeDetectorRef.markForCheck();let i=this.pdfPage.bbox,e=i.y+i.h-this.rectRender.y,n={left:this.rectRender.x,top:e,right:this.rectRender.x+this.rectRender.w,bottom:e-this.rectRender.h};if(this.rectRender.w<10&&this.rectRender.h<10){if(t.button!==0&&t.button!==2)return!1;this.contentService.requestViewChange({scale:this.scale+(t.button===0?10:-10),checkScale:!1,referencePoint:{pageNo:this.pdfPage.i+1,x:(n.left+n.right)/2,y:(n.top+n.bottom)/2}})}else this.contentService.requestViewChange({pageNo:this.pdfPage.i+1,checkScale:!1,viewport:n});return!1}onMouseleave(){this.destroyMouseListeners(),this.created=!1,this.changeDetectorRef.markForCheck()}destroyMouseListeners(){w.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,w.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null}};N(rs,"\u0275fac",function(i){return new(i||rs)(_(Ae),_(at),_($t),_(ee),_(ye))}),N(rs,"\u0275cmp",Ce({type:rs,selectors:[["sd-magnify-tool"]],viewQuery:function(i,e){if(i&1&&Ye(Og,7),i&2){let n;Me(n=Re())&&(e.magnifySvgElementRef=n.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([ee])],decls:3,vars:1,consts:[["magnifySvg",""],["id","magnify-svg",3,"mousedown","mouseleave"],["fill","transparent","stroke-dasharray","8 8","stroke-width","1",4,"ngIf"],["fill","transparent","stroke-dasharray","8 8","stroke-width","1"]],template:function(i,e){if(i&1){let n=Se();Oi(),A(0,"svg",1,0),ce("mousedown",function(c){return W(n),z(e.onDown(c))})("mouseleave",function(){return W(n),z(e.onMouseleave())}),se(2,wg,1,4,"rect",2),D()}i&2&&(x(2),O("ngIf",e.created))},dependencies:[bt],styles:["#magnify-svg[_ngcontent-%COMP%]{z-index:999;position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none;cursor:crosshair;width:100%;height:100%;background-color:#fff0;stroke:var(--primary-50)}"],changeDetection:0}));var As=rs;ze([ot(it.magnifyToolComp.onUp)],As.prototype,"onUp",null);function Eg(s,t){if(s&1&&(Bt(0),A(1,"p",1),be(2),D(),Ut()),s&2){let i=t.$implicit,e=E();x(),O("ngStyle",e.setPositionOfScript(i)),x(),Ee(e.getFilteredScript(i.text))}}var xd=function(s){return s.FULL="full",s.LINE="line",s}(xd||{}),Td=(()=>{let t=class t{page;fetchedText;scripts=[];get isMergedScript(){return Ze.pageScriptInsertionType===xd.FULL}ngOnInit(){if(this.fetchedText=this.fetchedText.filter(e=>e.text.trim().length>0),!this.isMergedScript){this.scripts=this.fetchedText;return}this.scripts[0]={text:this.fetchedText.filter(e=>e.text.trim().length>0).map(e=>e.text).join(`
`),rect:[{top:this.page.bbox.h,bottom:0,left:0,right:this.page.bbox.w}],rotate:0,isVertical:!1}}setPositionOfScript(e){let n=e.rect.length;return{top:`${this.page.bbox.h-e.rect[0].top-4}px`,left:`${e.rect[0].left}px`,width:`${e.rect[n-1].right-e.rect[0].left}px`,height:`${Math.abs(e.rect[0].top-e.rect[0].bottom)+6}px`}}getFilteredScript(e){return e.trim().replace(/[^-a-zA-Z0-9\u4E00-\u9FFF\u3400-\u4DBF~!@#$%^&*()\-_=+\[{\]};:'".<,>\/? ]/gu,"")}};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page-script"]],inputs:{page:"page",fetchedText:"fetchedText"},standalone:!1,decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["tabindex","0",1,"script",3,"ngStyle"]],template:function(n,r){n&1&&se(0,Eg,3,2,"ng-container",0),n&2&&O("ngForOf",r.scripts)},dependencies:[yi,qt],styles:[".script[_ngcontent-%COMP%]{position:absolute;pointer-events:none}"]}));let s=t;return s})();var Mg=["normal"],Rg=["redactionMarks"],Ig=["redactionResults"],Od=(()=>{let t=class t{contentService;subscriptionService;pdfPage;result;redactionMarks;redactionResults;normalElementRef;redactionMarksElementRef;redactionResultsElementRef;isViewInit=!1;normalPainter=null;redactionMarksPainter=null;redactionResultsPainter=null;constructor(e,n){this.contentService=e,this.subscriptionService=n}ngOnInit(){this.normalPainter=new Ds(this.normalElementRef,this.pdfPage.bbox),this.redactionMarksPainter=new Ds(this.redactionMarksElementRef,this.pdfPage.bbox),this.redactionResultsPainter=new Ds(this.redactionResultsElementRef,this.pdfPage.bbox),this.subscriptionService.push(this.contentService.reload$.pipe(F(e=>Go.typeAndPage(e,this.pdfPage.i,zo.TextSearch))).subscribe({next:()=>this.clearRect()}))}ngOnChanges(){this.mark(this.isViewInit)}ngAfterViewInit(){this.mark(this.isViewInit=!0)}ngOnDestroy(){this.normalElementRef=null,this.redactionMarksElementRef=null,this.redactionResultsElementRef=null,this.normalPainter=null,this.redactionMarksPainter=null,this.redactionResultsPainter=null,Xi.destroy(this)}clearRect(){this.normalPainter?.clear(),this.redactionMarksPainter?.clear(),this.redactionResultsPainter?.clear()}mark(e){e&&(this.clearRect(),this.result&&this.normalPainter?.render(this.result.words.map(n=>n.rects)),this.redactionMarks&&this.redactionMarksPainter?.render(this.redactionMarks.words.map(n=>n.rects)),this.redactionResults&&this.redactionResultsPainter?.render(this.redactionResults.words.map(n=>n.rects)))}};N(t,"\u0275fac",function(n){return new(n||t)(_(at),_(ee))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-search-highlight"]],viewQuery:function(n,r){if(n&1&&(Ye(Mg,7),Ye(Rg,7),Ye(Ig,7)),n&2){let c;Me(c=Re())&&(r.normalElementRef=c.first),Me(c=Re())&&(r.redactionMarksElementRef=c.first),Me(c=Re())&&(r.redactionResultsElementRef=c.first)}},inputs:{pdfPage:"pdfPage",result:"result",redactionMarks:"redactionMarks",redactionResults:"redactionResults"},standalone:!1,features:[xe([ee]),tn],decls:7,vars:2,consts:[["normal",""],["redactionMarks",""],["redactionResults",""],[1,"normal"],[1,"redaction-marks"],[1,"redaction-results"]],template:function(n,r){n&1&&(Oi(),A(0,"svg"),Q(1,"path",3,0)(3,"path",4,1)(5,"path",5,2),D()),n&2&&ge("width",r.pdfPage.bbox.w+r.pdfPage.bbox.x)("height",r.pdfPage.bbox.h+r.pdfPage.bbox.y)},styles:["svg[_ngcontent-%COMP%]{mix-blend-mode:multiply;position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none}path.normal[_ngcontent-%COMP%]{fill:#00af0080}path.redaction-marks[_ngcontent-%COMP%]{fill:#00000080}path.redaction-results[_ngcontent-%COMP%]{fill:#fffb00}"],changeDetection:0}));let s=t;return s})(),Ds=class{elementRef;bbox;d=[];constructor(t,i){this.elementRef=t,this.bbox=i}clear(){this.d.splice(0),this.bindPath()}render(t){for(let i of t){let e=i[0],n=i[0];i.forEach((r,c)=>{e=r,n.top!==e.top&&(this.d[this.d.length]=this.mergeRects(n,i[c-1]),n=e)}),this.d[this.d.length]=this.mergeRects(n,e)}this.bindPath()}bindPath(){this.elementRef.nativeElement.setAttribute("d",this.generatePath())}generatePath(){return this.d.reduce((t,i)=>`${t}M ${i.x} ${i.y} L ${i.x+i.w} ${i.y} L ${i.x+i.w} ${i.y+i.h} L ${i.x} ${i.y+i.h} Z `,w.EMPTY_STRING)}mergeRects(t,i){return{x:t.left,y:this.bbox.h+this.bbox.y-t.top,w:i.right-t.left,h:t.top-t.bottom}}};var wd=(()=>{let t=class t{sanitizer;contentService;changeDetectorRef;textService;documentId;pdfPage;get innerHTML(){let e=this.sanitizer.sanitize(Ol.HTML,this._innerHTML);if(!w.isDefined(e))throw new _t("Possible unsafe HTML content");return e}get pageHeight(){return`${this.pdfPage.bbox.h}px`}_innerHTML=null;constructor(e,n,r,c){this.sanitizer=e,this.contentService=n,this.changeDetectorRef=r,this.textService=c}ngOnInit(){this.contentService.publishSomePageLoaded(!0),this.textService.fetchPdfPageScript(this.documentId,this.pdfPage.i).subscribe({next:e=>{this._innerHTML=e.scriptText,this.changeDetectorRef.markForCheck()}})}};N(t,"\u0275fac",function(n){return new(n||t)(_(Dl),_(at),_(Ae),_(Hr))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-tts-script"]],hostVars:3,hostBindings:function(n,r){n&2&&(Pl("innerHTML",r.innerHTML,wl),nn("height",r.pageHeight))},inputs:{documentId:"documentId",pdfPage:"pdfPage"},standalone:!1,features:[xe([ee])],decls:0,vars:0,template:function(n,r){},styles:["[_nghost-%COMP%]{padding-top:30px;margin-left:50px;display:block;overflow:auto;font-size:8px}"],changeDetection:0}));let s=t;return s})();var Ng=["selectText"],kg=["annot"],Vg=()=>[Hp,xa,bt,$p,zp,vd,As,Td,Od,wd];function Lg(s,t){if(s&1&&(A(0,"div",6),Q(1,"sd-loader"),D()),s&2){let i=E();O("ngStyle",i.getIndicatorStyle(!0))}}function Fg(s,t){if(s&1&&(A(0,"div",7),Q(1,"div",8),A(2,"span"),be(3),Y(4,"translate"),D()()),s&2){let i=E();O("ngStyle",i.getIndicatorStyle(!1)),x(3),Ee(X(4,2,"FAILED_TO_LOAD_PAGE"))}}function Bg(s,t){if(s&1){let i=Se();A(0,"sd-image",9),ce("resetted",function(){W(i);let n=E();return z(n.imgResetted())})("rendered",function(){W(i);let n=E();return z(n.imgRenderDone())})("failed",function(n){W(i);let r=E();return z(r.imgFetchFailed(n))}),D()}if(s&2){let i=E();O("pdfPage",i.page)("documentId",i.documentId),ge("aria-hidden",!0)}}function Ug(s,t){if(s&1){let i=Se();A(0,"sd-invisible-tracer-view",10),ce("rendered",function(){W(i);let n=E();return z(n.invisibleTracerRendered())}),D()}}function Hg(s,t){if(s&1&&Q(0,"sd-annot",19,0),s&2){let i=E(2);O("pdfPage",i.page)("documentId",i.documentId)("selectText",i.selectText)}}function $g(s,t){if(s&1&&Q(0,"sd-api-highlight",20),s&2){let i=E(2);O("pdfPage",i.page)}}function jg(s,t){if(s&1&&Q(0,"sd-search-highlight",21),s&2){let i=E(2);O("pdfPage",i.page)("result",i.searchResult)("redactionMarks",i.redactionMarks)("redactionResults",i.redactionResults)}}function Wg(s,t){if(s&1){let i=Se();A(0,"sd-select-text",22,1),ce("textFetched",function(n){W(i);let r=E(2);return z(r.fetchedText=n)}),D()}if(s&2){let i=E(2);O("pdfPage",i.page)("documentId",i.documentId)("isScreenReaderActive",i.isScreenReaderActive)}}function zg(s,t){if(s&1&&Q(0,"sd-page-script",23),s&2){let i=E(2);O("page",i.page)("fetchedText",i.fetchedText)}}function Gg(s,t){if(s&1&&Q(0,"sd-magnify-tool",20),s&2){let i=E(2);O("pdfPage",i.page)}}function Yg(s,t){if(s&1&&Q(0,"sd-capture-tool",24),s&2){let i=E(2);O("pdfPage",i.page)("annot",i.annot)}}function Xg(s,t){if(s&1&&Q(0,"sd-tts-script",25),s&2){let i=E(2);O("documentId",i.documentId)("pdfPage",i.page)}}function Kg(s,t){if(s&1&&Q(0,"sd-guide-line",26),s&2){let i=E(2);O("pdfPage",i.page)}}function qg(s,t){if(s&1&&se(0,Hg,2,3,"sd-annot",11)(1,$g,1,1,"sd-api-highlight",12)(2,jg,1,4,"sd-search-highlight",13)(3,Wg,2,3,"sd-select-text",14)(4,zg,1,2,"sd-page-script",15)(5,Gg,1,1,"sd-magnify-tool",12)(6,Yg,1,2,"sd-capture-tool",16)(7,Xg,1,2,"sd-tts-script",17)(8,Kg,1,1,"sd-guide-line",18),s&2){let i=E();O("ngIf",!i.supportTTS&&i.isEnabledAnnotation),x(),O("ngIf",i.apiHighlighted),x(),O("ngIf",(i.searchResult||i.redactionMarks||i.redactionResults)&&!i.supportTTS),x(),O("ngIf",i.isVisibleSelectText()&&!i.supportTTS),x(),O("ngIf",i.isScreenReaderActive&&i.fetchedText.length>0),x(),O("ngIf",i.isVisibleMagnifyTool()&&!i.supportTTS),x(),O("ngIf",i.isVisibleCaptureTool()&&!i.supportTTS),x(),O("ngIf",i.supportTTS),x(),O("ngIf",i.rulerActive)}}var Tc=(()=>{let t=class t{elementRef;changeDetectorRef;contentService;accessibilityService;subscriptionService;apiEventBridgeService;apiHighlightService;textService;translatePipe;documentService;store$;viewerService;renderer;searchService;priority;page;documentId;selectText;annot;supportTTS;scale;degree;dragMode;rulerActive;annotTool=null;isCaptureMode=!1;isReady=!1;isImgLoaded=!1;isImgFailed=!1;isInvisibleTracerRendered=!1;searchResult=null;redactionMarks=null;redactionResults=null;apiHighlighted=!1;fetchedText=[];isScreenReaderActive=!1;pageScript="";pageAriaLabels=[];get isEnabledAnnotation(){return this.documentService.checkAuthority(Ne.ANNOTATION)||this.documentService.checkAuthority(Ne.FORM)}get invisibleTracerEnabled(){return Ze.activateInvisibleTracer&&K.get(ie.INVISIBLE_TRACER).enable}changesSrc=new Ht(null);constructor(e,n,r,c,g,v,y,M,V,Z,le,pe,he,Te){this.elementRef=e,this.changeDetectorRef=n,this.contentService=r,this.accessibilityService=c,this.subscriptionService=g,this.apiEventBridgeService=v,this.apiHighlightService=y,this.textService=M,this.translatePipe=V,this.documentService=Z,this.store$=le,this.viewerService=pe,this.renderer=he,this.searchService=Te}ngOnChanges(e){this.changesSrc.next(e)}ngOnInit(){this.priority===0&&(this.isReady=!0),this.subscriptionService.push(this.store$.pipe($("isScreenReaderActive")).subscribe({next:e=>this.isScreenReaderActive=e}),this.store$.pipe($("isCaptureMode")).subscribe({next:e=>{this.isCaptureMode=e,this.changeDetectorRef.markForCheck()}}),ut(this.store$.pipe($("supportTTS")).pipe(rt(e=>this.supportTTS=e))).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe($("dragMode")).pipe(rt(e=>this.dragMode=e),qs(1)).subscribe({next:()=>{this.changeDetectorRef.markForCheck(),this.apiEventBridgeService.dragToolChangeAppliedSrc.next({ok:!0,data:void 0})}}),ut(this.store$.pipe($("degree")).pipe(rt(e=>this.degree=e)),this.store$.pipe($("scale")).pipe(rt(e=>this.scale=e))).subscribe({next:()=>{this.changeDetectorRef.destroyed||this.changeDetectorRef.detectChanges()}}),Ji([this.searchService.searchResult$.pipe(Ks(0)),this.searchService.searchRedactionMark$,this.searchService.searchRedactionResult$]).subscribe({next:([e,n,r])=>{this.bindSearchResult(e),this.bindRedactionMarks(n),this.bindRedactionResultsWithoutMarks(r,n,e)}}),this.changesSrc.pipe(F(w.isDefined),F(e=>!!e.page||!!e.documentId)).subscribe({next:()=>{this.render(),this.isScreenReaderActive&&this.dragMode!==Pt.SELECT_TEXT&&this.delayFetchTextData()}}),this.store$.pipe($("rulerActive")).subscribe({next:e=>{this.rulerActive=e,this.changeDetectorRef.markForCheck()}}),ut(ht(null),this.apiHighlightService.highlightInfoMapChange$).subscribe({next:()=>{this.apiHighlighted=this.apiHighlightService.highlightInfoMap[this.page.i]&&this.apiHighlightService.highlightInfoMap[this.page.i].length>0,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Wo()).subscribe({next:e=>{this.annotTool=e,this.changeDetectorRef.markForCheck()}}),this.accessibilityService.pageAriaLabel$.subscribe({next:e=>{this.pageAriaLabels=e,this.changeDetectorRef.markForCheck()}}),this.viewerService.pageBorderColor$.subscribe({next:e=>{this.renderer.setStyle(this.elementRef.nativeElement,"outline-color",`${e}`)}}))}ngAfterViewInit(){this.subscriptionService.push(Ge(this.elementRef.nativeElement,"mousemove").subscribe({next:e=>this.selectText?.publishIsTextHover(e)}))}ngOnDestroy(){w.removeElement(this.elementRef.nativeElement),Xi.destroy(this)}onClick(e){e.target.nodeName==="SD-PAGE"&&e.stopPropagation()}get hostTabIndex(){return this.isVisibleSelectText()&&!this.supportTTS?null:this.pageAriaLabels[this.page.i]?this.pageAriaLabels[this.page.i]:this.isScreenReaderActive&&this.pageScript.trim().length===0?this.translatePipe.transform("NO_CONTENT"):`${this.page.i+1} ${this.translatePipe.transform("PAGE")}`}delayFetchTextData(){this.subscriptionService.set("delayedTextDataFetchSub",lr(J.TaskPriority.TEXT).subscribe({next:()=>this.fetchTextData()}))}fetchTextData(){this.subscriptionService.set("textDataSub",this.textService.fetchPdfPageText(this.documentId,this.page.ref).subscribe({next:e=>{this.extractPageScript(e),this.fetchedText=e}}))}extractPageScript(e){e.forEach(n=>{this.pageScript+=n.text})}imgResetted(){this.isImgFailed=!1,this.isImgLoaded=this.isImgFailed}imgRenderDone(){this.isImgLoaded=!0,this.contentService.publishSomePageLoaded(!0)}imgFetchFailed(e){this.isImgFailed=!0,w.isDefined(e)&&(console.warn(e.message),this.apiEventBridgeService.watermarkCreatedSrc.next({ok:!1,error:e}))}invisibleTracerRendered(){this.isInvisibleTracerRendered=!0,this.changeDetectorRef.markForCheck()}isVisibleSelectText(){return this.isReady&&(this.dragMode===Pt.SELECT_TEXT||this.dragMode===Pt.AUTO||G.isMobile())&&!w.isDefined(this.annotTool)}isVisibleMagnifyTool(){return this.isReady&&this.dragMode===Pt.MAGNIFY&&!w.isDefined(this.annotTool)}isVisibleCaptureTool(){return this.isReady&&this.isCaptureMode&&!w.isDefined(this.annotTool)}getIndicatorStyle(e){let n={transform:J.rotationNote(-(this.page.r+this.degree))};return e&&(n.transform+=` scale(${100/this.scale})`),n}render(){if(this.isReady)return;let e=Math.abs(this.priority)*100+this.priority*10;this.subscriptionService.set("delayedFetchSub",lr(e).subscribe({next:()=>{this.isReady=!0,this.changeDetectorRef.markForCheck()}}))}bindSearchResult(e){this.searchResult=e?.pageIdx===this.page.i?e:null,this.changeDetectorRef.markForCheck()}bindRedactionMarks(e){let n=e&&e[this.page.i];n?.length>0?this.redactionMarks={words:[...n]}:this.redactionMarks=null,this.changeDetectorRef.markForCheck()}bindRedactionResultsWithoutMarks(e,n,r){let c=e&&e[this.page.i],g=n&&n[this.page.i]?n[this.page.i]:[],v=r&&r.pageIdx===this.page.i?r.words:[];if(c?.length>0){let y=[...g,...v];this.redactionResults=y.length>0?{words:[...c.filter(M=>!w.isDefined(y.find(V=>Object.keys(w.diff(M,V)).length===0)))],pageIdx:this.page.i}:{words:[...c],pageIdx:this.page.i}}else this.redactionResults=null;this.changeDetectorRef.markForCheck()}};N(t,"\u0275fac",function(n){return new(n||t)(_(ni),_(Ae),_(at),_(fa),_(ee),_(Qt),_(Zo),_(Hr),_(He),_(ct),_(ye),_(Zt),_($t),_(io))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page"]],viewQuery:function(n,r){if(n&1&&(Ye(Ng,5),Ye(kg,5)),n&2){let c;Me(c=Re())&&(r.selectText=c.first),Me(c=Re())&&(r.annot=c.first)}},hostVars:1,hostBindings:function(n,r){n&1&&ce("click",function(g){return r.onClick(g)}),n&2&&ge("aria-label",r.hostTabIndex)},inputs:{priority:"priority",page:"page",documentId:"documentId"},standalone:!1,features:[xe([ee]),tn],decls:7,vars:4,consts:[["annot",""],["selectText",""],["class","indicator loader",3,"ngStyle",4,"ngIf"],["class","indicator fail",3,"ngStyle",4,"ngIf"],["role","img",3,"pdfPage","documentId","resetted","rendered","failed",4,"ngIf"],["aria-hidden","true",3,"rendered",4,"ngIf"],[1,"indicator","loader",3,"ngStyle"],[1,"indicator","fail",3,"ngStyle"],[1,"image"],["role","img",3,"resetted","rendered","failed","pdfPage","documentId"],["aria-hidden","true",3,"rendered"],["aria-hidden","true",3,"pdfPage","documentId","selectText",4,"ngIf"],["aria-hidden","true",3,"pdfPage",4,"ngIf"],["aria-hidden","true",3,"pdfPage","result","redactionMarks","redactionResults",4,"ngIf"],["aria-hidden","true",3,"pdfPage","documentId","isScreenReaderActive","textFetched",4,"ngIf"],[3,"page","fetchedText",4,"ngIf"],["aria-hidden","true",3,"pdfPage","annot",4,"ngIf"],["aria-hidden","true",3,"documentId","pdfPage",4,"ngIf"],[3,"pdfPage",4,"ngIf"],["aria-hidden","true",3,"pdfPage","documentId","selectText"],["aria-hidden","true",3,"pdfPage"],["aria-hidden","true",3,"pdfPage","result","redactionMarks","redactionResults"],["aria-hidden","true",3,"textFetched","pdfPage","documentId","isScreenReaderActive"],[3,"page","fetchedText"],["aria-hidden","true",3,"pdfPage","annot"],["aria-hidden","true",3,"documentId","pdfPage"],[3,"pdfPage"]],template:function(n,r){n&1&&(se(0,Lg,2,1,"div",2)(1,Fg,5,4,"div",3)(2,Bg,1,3,"sd-image",4)(3,Ug,1,0,"sd-invisible-tracer-view",5)(4,qg,9,9),yl(5,4,Vg),El(10)),n&2&&(O("ngIf",!r.isImgLoaded&&!r.isImgFailed&&!r.supportTTS),x(),O("ngIf",!r.isImgLoaded&&r.isImgFailed),x(),O("ngIf",r.isReady&&(!r.invisibleTracerEnabled||r.isInvisibleTracerRendered)&&!r.supportTTS),x(),O("ngIf",r.invisibleTracerEnabled))},styles:['[_nghost-%COMP%]{display:block;background-color:#fff;outline:1px solid #E8E8E8}.indicator[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;z-index:-1}.indicator.fail[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.indicator.fail[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:163px;height:140px;background-image:url("./media/invalid-page-3SXNTMZY.svg");background-size:contain;background-repeat:no-repeat}.indicator.fail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-top:32px}.indicator.loader[_ngcontent-%COMP%]{display:none;align-items:center;justify-content:center}.indicator.loader[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:56px;height:56px}sd-watermark[_ngcontent-%COMP%]{position:absolute;top:0;left:0;overflow:hidden}'],changeDetection:0}));let s=t;return s})();var Qg=["svg"],Zg=["popup"],yd=s=>({content:s});function Jg(s,t){if(s&1&&(A(0,"div",18),be(1),D()),s&2){let i=E();x(),Ee(i.title)}}function ef(s,t){if(s&1){let i=Se();A(0,"pu-input",19),Y(1,"translate"),Y(2,"translate"),ce("blur",function(){W(i);let n=E();return z(n.finishEditTitle())})("keydown.enter",function(){W(i);let n=E();return z(n.finishEditTitle())}),D()}if(s&2){let i=E();O("placeholder",X(1,4,"ENTER_THE_AUTHOR_NAME"))("autofocus",!0)("formControl",i.titleFormControl)("ariaLabel",X(2,6,"ENTER_THE_AUTHOR_NAME"))}}function tf(s,t){if(s&1){let i=Se();A(0,"div",20)(1,"div",21),ce("click",function(){W(i);let n=E();return z(n.onColorPaletteClick())}),D()()}if(s&2){let i=E();$e("disabled",i.isLockedAnnot())("selected",i.isColorTabClicked),x(),nn("background",i.textAnnotColor)}}function nf(s,t){if(s&1){let i=Se();A(0,"pu-color-palette",22),Y(1,"translate"),Y(2,"translate"),Ai("ngModelChange",function(n){W(i);let r=E();return Ii(r.textAnnotColor,n)||(r.textAnnotColor=n),z(n)}),D()}if(s&2){let i=E();O("nullable",!1)("customColorLabel",X(1,5,"CUSTOM_COLOR"))("defaultColorLabel",X(2,7,"DEFAULT_COLOR"))("defaultColorPanelExpandedd",!0),Ri("ngModel",i.textAnnotColor)}}function of(s,t){if(s&1&&Q(0,"sd-popup-resizer",23),s&2){let i=t.$implicit;O("anchor",i)}}var Oc=s=>({process:(...t)=>{if(w.isDefined(t[s]))return t[s]()}}),rf=s=>{if(!s)return s;let t=s.substring(1);return t.length!==3?t:t[0]+t[0]+t[1]+t[1]+t[2]+t[2]},co=class co{annotService;contentService;documentService;renderer;changeDetectorRef;scrollController;elementRef;subscriptionService;store$;loggingService;translatePipe;get environment(){return Ze}popupInfo;popupOrder;contentViewRoot;svgElementRef;popupElementRef;get zoom(){return J.normalizeScale(this.scale)}popupSize={width:0,height:0};preferences={};isEditingTitle=!1;titleFormControl=new fr;degree;scale;currentPageNo;viewMode;_popupStyles={};linkStyles={};_containerStyle={};drag_startCursorPos={x:0,y:0};drag_startPopupPos={top:0,left:0,right:0,bottom:0};boundingTranslate={x:0,y:0};memoColor=null;popupViewCoords={x:0,y:0};onMouseMoveListener=null;onMouseUpListener=null;onTouchMoveListener=null;onTouchEndListener=null;txtTotalDelta={x:0,y:0};_containerPos;isColorTabClicked=!1;get anchorList(){return co.AnchorList}get data(){if(!w.isDefined(this.popupInfo.src))throw new ci("popupInfo.src is undefined.");return this.popupInfo.src}get isTextAnnot(){return w.isDefined(this.data)&&Vt.isText(this.data)}get popupOid(){return this.data?.Popup??Number.MAX_SAFE_INTEGER}get textAnnotColor(){return w.isDefined(this.data)&&Vt.isText(this.data)?this.data.attributes.color:(this.loggingService.common("warn",Le.INVALID,`${this.translatePipe.transform("ANNOTATION")} type`),null)}set textAnnotColor(t){if(w.isDefined(this.data)&&!Vt.isText(this.data)){this.loggingService.common("warn",Le.INVALID,`${this.translatePipe.transform("ANNOTATION")} type`);return}this.data.attributes.color=t,this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotEvent({from:"PopupComponent",sdEventType:cn.UPDATE,pageIdx:this.data.attributes.pageIdx,annot:this.data})}get popup(){return this.popupInfo.popup}get pdfPage(){if(!w.isDefined(this.popupInfo.pdfPage))throw new ci("popupInfo.pdfPage is undefined.");return this.popupInfo.pdfPage}get direction(){return J.rotate2Direction(this.pdfPage.r+this.degree)}get points(){return this.svg.firstElementChild.points}get svg(){return this.svgElementRef.nativeElement}get textCoords(){return this.data.attributes.rect}get popupCoords(){return this.popup.attributes.rect}get popupLinkBoxStyles(){return co.linkBoxStyle}get contents(){return this.data?.attributes?.contents||w.EMPTY_STRING}set contents(t){this.data.attributes.contents=t,this.contentService.publishAnnotContentsChange({annotOid:this.data.oid})}get title(){let t=this.data?.attributes?.T;return!w.isDefined(t)||t===""?this.translatePipe.transform("ENTER_THE_AUTHOR_NAME"):t}get popupStyles(){Object.assign(this.popupViewCoords,this.convertPDFCoord(this.popup.attributes.rect.left,this.popup.attributes.rect.top)),this.drawPopupLink(this.txtTotalDelta);let t=Ar.elementStyleOf(this.popup);t.bottom=null,t.right=t.bottom,t.top=t.right,t.left=t.top,t.transform=`translate(${this.popupViewCoords.x+this.boundingTranslate.x}px,${this.popupViewCoords.y+this.boundingTranslate.y}px)`;let i=null,e=rf(this.data.attributes.color);return e&&(this.memoColor={r:parseInt(`0x${e.substring(0,2)}`,16),g:parseInt(`0x${e.substring(2,4)}`,16),b:parseInt(`0x${e.substring(4,6)}`,16)},i={r:230+Math.floor(this.memoColor.r/10),g:230+Math.floor(this.memoColor.g/10),b:230+Math.floor(this.memoColor.b/10)}),t.background=i?`rgb(${i.r}, ${i.g}, ${i.b})`:"#ffeb98",this._popupStyles=si(si({},this._popupStyles||{color:null,background:null}),J.bindLayoutOrder(t,J.LayoutOrder.Popup+this.popupOrder.indexOf(this.popupOid)))}get popupLinkStyles(){return this.memoColor?(this.linkStyles.stroke=`rgb(${this.memoColor.r}, ${this.memoColor.g}, ${this.memoColor.b})`,this.linkStyles.fill=`rgba(${this.memoColor.r}, ${this.memoColor.g}, ${this.memoColor.b}, 0.1)`):(this.linkStyles.stroke="transparent",this.linkStyles.fill="transparent"),this.linkStyles}get popupContainerStyles(){let t=this.direction,i=J.isVisible(this.pdfPage.i,this.currentPageNo-1,this.viewMode);return this._containerStyle.visibility=i?null:"hidden",this._containerPos&&(this._containerStyle.left=`${this._containerPos.left[t]*this.zoom}px`,this._containerStyle.top=`${this._containerPos.top[t]*this.zoom}px`),this._containerStyle}constructor(t,i,e,n,r,c,g,v,y,M,V){this.annotService=t,this.contentService=i,this.documentService=e,this.renderer=n,this.changeDetectorRef=r,this.scrollController=c,this.elementRef=g,this.subscriptionService=v,this.store$=y,this.loggingService=M,this.translatePipe=V}ngOnChanges(t){t.popupInfo&&(this._containerPos={left:[-this.pdfPage.bbox.x,-this.pdfPage.bbox.y,this.pdfPage.bbox.x,this.pdfPage.bbox.y],top:[this.pdfPage.bbox.y,-this.pdfPage.bbox.x,-this.pdfPage.bbox.y,this.pdfPage.bbox.x]})}ngOnInit(){this.subscriptionService.push(this.store$.pipe(oi("popupFontSize")).subscribe({next:i=>{this.preferences.popupFontSize=i,setTimeout(()=>this.changeDetectorRef.markForCheck())}}),this.store$.pipe(oi("language")).subscribe({next:i=>{this.preferences.language=i,setTimeout(()=>this.changeDetectorRef.markForCheck())}}),this.annotService.text$.pipe(F(i=>this.data?.oid===i.model.oid)).subscribe({next:i=>{this.txtTotalDelta=i.totalDelta,this.changeDetectorRef.markForCheck()}}),this.contentService.annotEvent$.pipe(F(w.isDefined),F(i=>i.sdEventType===cn.SELECTED&&i.to==="popups"&&i.annot.oid!==this.popup.oid||i.sdEventType===cn.UPDATE&&i.annot.Popup===this.popup.oid)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),ut(this.store$.pipe($("currentPageNo")),this.store$.pipe($("viewMode")).pipe(rt(i=>this.viewMode=i)),this.store$.pipe($("scale")).pipe(rt(i=>this.scale=i),Ks(0)),this.store$.pipe($("degree")).pipe(rt(i=>this.degree=i))).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.postAnnotEdit$.pipe(F(i=>i.annotOid===this.data?.oid)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe($("currentPageNo")).subscribe({next:i=>this.currentPageNo=i}),this.annotService.annotVisibleEvent$.subscribe({next:i=>{w.isDefined(this.data)&&!i.includes(this.data.oid)&&this.togglePopup()}})),this.subscribeMainViewResized();let t=this.svg;!t||!t.firstElementChild||this.fixPoints(t,this.points,3)}ngOnDestroy(){this.destroyMouseListeners()}ngAfterViewInit(){let{width:t,height:i}=Ar.elementStyleOf(this.popup);if(w.isDefined(t)&&w.isDefined(i))this.popupSize.width=parseFloat(t),this.popupSize.height=parseFloat(i);else throw new ci("Cannot read popup annotation style.");let e=this.popupElementRef.nativeElement;this.locate(e),(this.data?.attributes.contents||w.EMPTY_STRING).length||setTimeout(()=>{let n=e.getElementsByTagName("textarea")[0];w.isDefined(n)&&n.focus()})}isReadonly(){return!this.documentService.checkAuthority(Ne.EDIT_ANNOTATION)||gr.get(this.data?.attributes.F??-1,7)}isLockedAnnot(){return gr.get(this.data?.attributes.F??-1,7)}onMouseDown(t){if(t.target!==t.currentTarget)return;t.stopPropagation(),t.preventDefault();let i=this.popupOrder.indexOf(this.popupOid);i>-1&&(this.popupOrder.splice(i,1),this.popupOrder.push(this.popupOid)),this.contentService.fireAnnotEvent({sdEventType:cn.SELECTED,annot:this.popup,to:"popups"}),this.applyTranslateToReal(),this.drag_startCursorPos.x=t.clientX,this.drag_startCursorPos.y=t.clientY,Object.assign(this.drag_startPopupPos,this.popupCoords),this.destroyMouseListeners(),this.onMouseMoveListener=this.renderer.listen("document","mousemove",e=>this.onMouseMove(e)),this.onMouseUpListener=this.renderer.listen("document","mouseup",e=>this.onMouseUp(e)),this.onTouchMoveListener=this.renderer.listen("document","touchmove",e=>this.onMouseMove(this.touchToMouse(e))),this.onTouchEndListener=this.renderer.listen("document","touchend",e=>this.onMouseUp(this.touchToMouse(e)))}touchToMouse(t){return w.touchToMouseEvt(t,this.degree,this.scale,this.pdfPage)}startEditTitle(){this.isLockedAnnot()||(this.titleFormControl.setValue(this.data?.attributes?.T??""),this.isEditingTitle=!0)}finishEditTitle(){this.data.attributes.T=this.titleFormControl.value,this.onPopupValueChanged(),this.isEditingTitle=!1}applyTranslateToReal(){let t=this.direction;if(this.boundingTranslate.x){let i=this.boundingTranslate.x/this.zoom;(t===2||t===3)&&(i*=-1),t===1||t===3?(this.popupCoords.top+=i,this.popupCoords.bottom+=i):(this.popupCoords.left+=i,this.popupCoords.right+=i),this.boundingTranslate.x=0}if(this.boundingTranslate.y){let i=this.boundingTranslate.y/this.zoom;(t===0||t===3)&&(i*=-1),t===1||t===3?(this.popupCoords.left+=i,this.popupCoords.right+=i):(this.popupCoords.top+=i,this.popupCoords.bottom+=i),this.boundingTranslate.y=0}}togglePopup(){this.annotService.togglePopup(this.data)}onMouseClickDelete(){this.contents="";let t={from:"PopupComponent",sdEventType:cn.DELETE,annot:Vt.isText(this.data)?this.data:this.popup};this.contentService.fireAnnotEvent(t),this.contentService.fireAnnotListEvent(t)}onColorPaletteClick(){this.isColorTabClicked=!this.isColorTabClicked}onPopupValueChanged(){this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotListEvent({from:"PopupComponent",sdEventType:cn.UPDATE,annot:this.data})}onMouseMove(t){t.stopPropagation(),t.preventDefault();let i=this.direction,e={x:t.clientX-this.drag_startCursorPos.x,y:this.drag_startCursorPos.y-t.clientY};return(i===1||i===3)&&([e.x,e.y]=[e.y,e.x]),Oc(i).process(null,()=>{e.x*=-1},()=>{e.x*=-1,e.y*=-1},()=>{e.y*=-1}),e.x/=this.zoom,e.y/=this.zoom,this.popupCoords.top=this.drag_startPopupPos.top+e.y,this.popupCoords.left=this.drag_startPopupPos.left+e.x,this.popupCoords.right=this.drag_startPopupPos.right+e.x,this.popupCoords.bottom=this.drag_startPopupPos.bottom+e.y,this.changeDetectorRef.markForCheck(),!1}onMouseUp(t){let i=this.elementRef.nativeElement.parentElement.getBoundingClientRect(),e=this.popupElementRef.nativeElement.getBoundingClientRect(),n=Math.max(i.left-e.left,0)/this.zoom,r=Math.min(e.top-i.top,0)/this.zoom;this.popupCoords.top+=r,this.popupCoords.left+=n,this.popupCoords.bottom+=r,this.popupCoords.right+=n,t.stopPropagation(),t.preventDefault(),this.destroyMouseListeners(),this.annotService.putModel(this.popup,"modify"),this.changeDetectorRef.markForCheck()}destroyMouseListeners(){w.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,w.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null,w.isDefined(this.onTouchMoveListener)&&this.onTouchMoveListener(),this.onTouchMoveListener=null,w.isDefined(this.onTouchEndListener)&&this.onTouchEndListener(),this.onTouchEndListener=null}convertPDFCoord(t,i){if(!w.isDefined(this.scrollController.stateHolder))throw new ci("stateHolder is undefined.");let e=this.scrollController.stateHolder.getPageSize(this.pdfPage.i),n=this.scrollController.stateHolder.getPageFrameOffset(this.viewMode,this.pdfPage.i),r={x:0,y:0},c=ro.getOffset(this.scrollController.stateHolder,this.contentViewRoot,this.scale,this.viewMode,this.currentPageNo),g=this.direction,v=t,y=i;return(g===1||g===3)&&([v,y]=[y,v]),Oc(g).process(()=>{r.x=n.offsetX,r.y=n.offsetY+e.height},()=>{r.x=n.offsetX,r.y=n.offsetY,y*=-1},()=>{r.x=n.offsetX+e.width,r.y=n.offsetY,v*=-1,y*=-1},()=>{r.x=n.offsetX+e.width,r.y=n.offsetY+e.height,v*=-1}),{x:(r.x+Pi.MARGIN+v)*this.zoom+c.offsetX,y:(r.y+Pi.MARGIN-y)*this.zoom+c.offsetY}}locate(t){if(!t)return;let i=this.contentViewRoot.getBoundingClientRect(),e=t.getBoundingClientRect();e.top<i.top?this.boundingTranslate.y=i.top-e.top:i.bottom<e.bottom&&(this.boundingTranslate.y=i.bottom-e.bottom),e.left<i.left?this.boundingTranslate.x=i.left-e.left:i.right<e.right&&(this.boundingTranslate.x=i.right-e.right)}fixPoints(t,i,e){let n=e-i.numberOfItems;for(let r=0;r<n;r++)i.appendItem(t.createSVGPoint());for(let r=n-1;r>=e;r++)i.removeItem(r);return i}centerPointOfPopup(){return{x:this.popupViewCoords.x+(this.popupCoords.right-this.popupCoords.left)/2+this.boundingTranslate.x,y:this.popupViewCoords.y+(this.popupCoords.top-this.popupCoords.bottom)/2+this.boundingTranslate.y}}drawPopupLink(t={x:0,y:0}){let i=Ar.centerPointOf(this.textCoords);i=this.convertPDFCoord(i.x,i.y);let e=si({},t),n=this.direction;(n===1||n===3)&&([e.x,e.y]=[e.y,e.x]),Oc(n).process(null,()=>{e.x*=-1},()=>{e.x*=-1,e.y*=-1},()=>{e.y*=-1}),i.x+=e.x*this.zoom,i.y+=e.y*this.zoom;let r=this.centerPointOfPopup(),c=[i,{x:r.x-10,y:r.y-10},{x:r.x+10,y:r.y+10}],g=this.points;c.length===g.numberOfItems&&c.forEach((v,y)=>Object.assign(g.getItem(y),v))}subscribeMainViewResized(){this.subscriptionService.push(ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).pipe(ii(0)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}};N(co,"linkBoxStyle",J.bindLayoutOrder({width:"initial",height:"initial","pointer-events":"none"},J.LayoutOrder.PopupLinker)),N(co,"AnchorList",["nw","ne","sw","se","n","s","w","e"]),N(co,"\u0275fac",function(i){return new(i||co)(_(ri),_(at),_(ct),_($t),_(Ae),_(zi),_(ni),_(ee),_(ye),_(Di),_(He))}),N(co,"\u0275cmp",Ce({type:co,selectors:[["sd-popup"]],viewQuery:function(i,e){if(i&1&&(Ye(Qg,7),Ye(Zg,7)),i&2){let n;Me(n=Re())&&(e.svgElementRef=n.first),Me(n=Re())&&(e.popupElementRef=n.first)}},inputs:{popupInfo:"popupInfo",popupOrder:"popupOrder",contentViewRoot:"contentViewRoot"},standalone:!1,features:[xe([ee,{provide:qn,useValue:new Ht(300)}]),tn],decls:27,vars:42,consts:[["popup",""],["inputTitleRef",""],["svg",""],[1,"popup-container",3,"ngStyle"],[1,"popup","no-scroller",3,"mousedown","touchstart","pointerdown","pointermove","pointerup","ngStyle"],[1,"nav"],[1,"label",3,"click"],["class","title",4,"ngIf","ngIfElse"],[1,"btns"],["class","color-picker-container",3,"disabled","selected",4,"ngIf"],["size","tiny",3,"nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel","ngModelChange",4,"ngIf"],["color","dark",1,"ep-text-button",3,"click","title","tooltip"],[1,"papycon","papycon-exit-fullscreen"],["color","dark",1,"ep-text-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-trash-can"],[3,"anchor",4,"ngFor","ngForOf"],[1,"no-scroller",3,"ngModelChange","change","keyup.esc","keydown","touchstart","pointerdown","pointermove","pointerup","placeholder","maxlength","readonly","ngModel"],[3,"ngStyle"],[1,"title"],[3,"blur","keydown.enter","placeholder","autofocus","formControl","ariaLabel"],[1,"color-picker-container"],[1,"color-rect",3,"click"],["size","tiny",3,"ngModelChange","nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel"],[3,"anchor"]],template:function(i,e){if(i&1){let n=Se();A(0,"div",3)(1,"div",4,0),ce("mousedown",function(c){return W(n),z(e.onMouseDown(c))})("touchstart",function(c){return W(n),z(e.onMouseDown(e.touchToMouse(c)))})("pointerdown",function(c){return W(n),z(c.stopPropagation())})("pointermove",function(c){return W(n),z(c.stopPropagation())})("pointerup",function(c){return W(n),z(c.stopPropagation())}),A(3,"div",5)(4,"div",6),ce("click",function(){return W(n),z(e.startEditTitle())}),se(5,Jg,2,1,"div",7)(6,ef,3,8,"ng-template",null,1,Li),D(),A(8,"div",8),se(9,tf,2,6,"div",9)(10,nf,3,9,"pu-color-palette",10),A(11,"button",11),Y(12,"translate"),Y(13,"translate"),Y(14,"translate"),ce("click",function(){return W(n),z(e.togglePopup())}),Q(15,"i",12),D(),A(16,"button",13),Y(17,"translate"),Y(18,"translate"),Y(19,"translate"),ce("click",function(){return W(n),z(e.onMouseClickDelete())}),Q(20,"i",14),D()()(),se(21,of,1,1,"sd-popup-resizer",15),A(22,"textarea",16),Y(23,"translate"),Ai("ngModelChange",function(c){return W(n),Ii(e.contents,c)||(e.contents=c),z(c)}),ce("change",function(){return W(n),z(e.onPopupValueChanged())})("keyup.esc",function(){return W(n),z(e.togglePopup())})("keydown",function(c){return W(n),z(c.stopPropagation())})("touchstart",function(c){return W(n),z(c.stopPropagation())})("pointerdown",function(c){return W(n),z(c.stopPropagation())})("pointermove",function(c){return W(n),z(c.stopPropagation())})("pointerup",function(c){return W(n),z(c.stopPropagation())}),D()(),Oi(),A(24,"svg",17,2),Q(26,"polygon",17),D()()}if(i&2){let n=wi(7);O("ngStyle",e.popupContainerStyles),x(),O("ngStyle",e.popupStyles),x(4),O("ngIf",!e.isEditingTitle)("ngIfElse",n),x(4),O("ngIf",e.isTextAnnot),x(),O("ngIf",e.isColorTabClicked),x(),O("title",X(12,24,"CLOSE"))("tooltip",St(38,yd,X(13,26,"CLOSE"))),ge("aria-label",X(14,28,"CLOSE")),x(5),O("title",X(17,30,"DELETE"))("tooltip",St(40,yd,X(18,32,"DELETE")))("disabled",e.isLockedAnnot()),ge("aria-label",X(19,34,"DELETE")),x(5),O("ngForOf",e.anchorList),x(),nn("font-size",e.preferences.popupFontSize+"px")("background",e.popupStyles.background),O("placeholder",X(23,36,"COMMENTS"))("maxlength",e.environment.annotation.contentsLengthLimit)("readonly",e.isReadonly()),Ri("ngModel",e.contents),x(2),O("ngStyle",e.popupLinkBoxStyles),x(2),O("ngStyle",e.popupLinkStyles)}},styles:["[_nghost-%COMP%]{display:block;height:100%}.popup[_ngcontent-%COMP%]{position:absolute;top:0;left:0;box-shadow:0 4px 9px #0000003d}.nav[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;height:40px;box-sizing:border-box;padding:0 16px;-webkit-user-select:none;user-select:none;pointer-events:none;white-space:nowrap}.nav[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{overflow:hidden;cursor:text;pointer-events:auto;margin-right:8px}.nav[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:#6c6c6c;overflow:hidden;text-overflow:ellipsis}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]{display:flex}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]{border:1px solid #DADADA;border-radius:2px;box-sizing:border-box;padding:3px;width:24px;height:24px;pointer-events:initial;cursor:pointer}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none;-webkit-user-select:none;user-select:none}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container.selected[_ngcontent-%COMP%]{background-color:rgba(var(--primary-50),.08);border:1px solid var(--primary-50);box-shadow:0 0 6px 0 var(--primary-50)}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]   .color-rect[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:2px;background-size:cover}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   pu-color-palette[_ngcontent-%COMP%]{background:var(--mono-00);border:1.2px solid var(--mono-30);border-radius:2px;box-sizing:border-box;position:absolute;margin-top:33.2px;pointer-events:initial;padding:10px;width:216px;overflow:hidden;z-index:10000}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-width:0;outline-offset:-2px;width:24px;height:24px;margin-left:8px;opacity:.8;pointer-events:initial}.popup-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0}textarea[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif;color:#1e1e1e;box-sizing:border-box;width:100%;max-width:100%;height:calc(100% - 40px);max-height:calc(100% - 20px);padding:16px;background-color:inherit;border:none;overflow:auto;resize:none}textarea[_ngcontent-%COMP%]:focus{outline:none}svg[_ngcontent-%COMP%]{position:absolute;left:0;cursor:auto;overflow:visible}polygon[_ngcontent-%COMP%]{stroke-width:1}"],changeDetection:0}));var er=co;ze([bp(it.popupComp.contents,1e3)],er.prototype,"contents",null);var Ed=(()=>{let t=class t{annotService;renderer;changeDetectorRef;popup;anchor;MIN_WIDTH=95;MIN_HEIGHT=50;_resizerStyles={};onMouseMoveListener=null;onMouseUpListener=null;onTouchMoveListener=null;onTouchEndListener=null;drag_startCursorPos={x:0,y:0};drag_startPopupPos={top:0,left:0,right:0,bottom:0};popup_prevSize={width:0,height:0};constructor(e,n,r,c){this.annotService=e,this.renderer=n,this.changeDetectorRef=r,this.popup=c}ngAfterViewInit(){Object.assign(this._resizerStyles,this.positionCalc(this.anchor,4)),Object.assign(this._resizerStyles,this.sizeCalc(this.anchor,10)),this._resizerStyles.cursor=`${this.anchor}-resize`,this._resizerStyles.position="absolute",this.detectChange()}ngOnDestroy(){this.destroyMouseListeners()}onMouseDown(e){e.target===e.currentTarget&&(e.stopPropagation(),e.preventDefault(),this.popup.applyTranslateToReal(),this.popup_prevSize.width=this.popup.popupSize.width,this.popup_prevSize.height=this.popup.popupSize.height,this.drag_startCursorPos.x=e.clientX,this.drag_startCursorPos.y=e.clientY,Object.assign(this.drag_startPopupPos,this.popup.popupCoords),this.onMouseMoveListener=this.renderer.listen("document","mousemove",n=>this.onMouseMove(n)),this.onMouseUpListener=this.renderer.listen("document","mouseup",n=>this.onMouseUp(n)),this.onTouchMoveListener=this.renderer.listen("document","touchmove",n=>this.onMouseMove(this.touchToMouse(n))),this.onTouchEndListener=this.renderer.listen("document","touchend",n=>this.onMouseUp(this.touchToMouse(n))))}onMouseMove(e){let n=this.popup.direction,r={left:0,top:0,right:0,bottom:0};return e.stopPropagation(),e.preventDefault(),this.anchor.includes("n")&&(r.top=this.drag_startCursorPos.y-e.clientY,this.popup_prevSize.height+r.top<this.MIN_HEIGHT&&(r.top=this.MIN_HEIGHT-Math.floor(this.popup_prevSize.height)),this.popup.popupSize.height=this.popup_prevSize.height+r.top,(n===1||n===2)&&(r.top*=-1),n===1||n===3?this.popup.popupCoords.left=this.drag_startPopupPos.left+r.top/this.popup.zoom:this.popup.popupCoords.top=this.drag_startPopupPos.top+r.top/this.popup.zoom),this.anchor.includes("w")&&(r.left=e.clientX-this.drag_startCursorPos.x,this.popup_prevSize.width-r.left<this.MIN_WIDTH&&(r.left=Math.floor(this.popup_prevSize.width)-this.MIN_WIDTH),this.popup.popupSize.width=this.popup_prevSize.width-r.left,(n===2||n===3)&&(r.left*=-1),n===1||n===3?this.popup.popupCoords.top=this.drag_startPopupPos.top+r.left/this.popup.zoom:this.popup.popupCoords.left=this.drag_startPopupPos.left+r.left/this.popup.zoom),this.anchor.includes("e")&&(r.right=e.clientX-this.drag_startCursorPos.x,this.popup_prevSize.width+r.right<this.MIN_WIDTH&&(r.right=this.MIN_WIDTH-Math.floor(this.popup_prevSize.width)),this.popup.popupSize.width=this.popup_prevSize.width+r.right,this.popup.popupCoords.right=this.drag_startPopupPos.right+r.right/this.popup.zoom),this.anchor.includes("s")&&(r.bottom=this.drag_startCursorPos.y-e.clientY,this.popup_prevSize.height-r.bottom<this.MIN_HEIGHT&&(r.bottom=Math.floor(this.popup_prevSize.height)-this.MIN_HEIGHT),this.popup.popupSize.height=this.popup_prevSize.height-r.bottom,this.popup.popupCoords.bottom=this.drag_startPopupPos.bottom+r.bottom/this.popup.zoom),this.popup.popupCoords.right=this.popup.popupCoords.left+this.popup.popupSize.width,this.popup.popupCoords.bottom=this.popup.popupCoords.top-this.popup.popupSize.height,this.detectChange(),!1}onMouseUp(e){e.stopPropagation(),e.preventDefault(),this.destroyMouseListeners(),this.annotService.putModel(this.popup.popup,"modify"),this.detectChange()}destroyMouseListeners(){w.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,w.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null,w.isDefined(this.onTouchMoveListener)&&this.onTouchMoveListener(),this.onTouchMoveListener=null,w.isDefined(this.onTouchEndListener)&&this.onTouchEndListener(),this.onTouchEndListener=null}get resizerStyles(){return this._resizerStyles}positionCalc(e,n){let r={};switch(e.includes("n")&&(r.top=`${-n}px`),e.includes("w")&&(r.left=`${-n}px`),e.includes("e")&&(r.right=`${-n}px`),e.includes("s")&&(r.bottom=`${-n}px`),e){case"n":case"s":r.left=`${n}px`;break;case"w":case"e":r.top=`${n}px`;break}return r}sizeCalc(e,n){let r={};if(e.length===2)return r.height=`${n}px`,r.width=r.height,r;switch(e){case"n":case"s":r.width=`calc(100% - ${n}px)`,r.height=`${n}px`;break;case"w":case"e":r.height=`calc(100% - ${n}px)`,r.width=`${n}px`;break}return r}touchToMouse(e){return this.popup.touchToMouse(e)}detectChange(){this.changeDetectorRef.destroyed||(this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges())}};N(t,"\u0275fac",function(n){return new(n||t)(_(ri),_($t),_(Ae),_(er,1))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-popup-resizer"]],inputs:{anchor:"anchor"},standalone:!1,features:[xe([ee])],decls:1,vars:1,consts:[[1,"no-scroller",3,"mousedown","pointerdown","pointermove","pointerup","touchstart","ngStyle"]],template:function(n,r){n&1&&(A(0,"div",0),ce("mousedown",function(g){return r.onMouseDown(g)})("pointerdown",function(g){return g.stopPropagation()})("pointermove",function(g){return g.stopPropagation()})("pointerup",function(g){return g.stopPropagation()})("touchstart",function(g){return r.onMouseDown(r.touchToMouse(g))}),D()),n&2&&O("ngStyle",r.resizerStyles)},dependencies:[qt],encapsulation:2,changeDetection:0}));let s=t;return s})();function af(s,t){if(s&1&&Q(0,"sd-popup",1),s&2){let i=t.$implicit,e=E();O("contentViewRoot",e.contentViewRoot)("popupInfo",i)("popupOrder",e.popupOrder)}}var wc=(()=>{let t=class t{contentService;popupService;changeDetectorRef;subscriptionService;store$;contentViewRoot;popups=[];popupOrder=[];isSelectedInAnnotView=!1;annotTool=null;constructor(e,n,r,c,g){this.contentService=e,this.popupService=n,this.changeDetectorRef=r,this.subscriptionService=c,this.store$=g}ngOnInit(){this.subscriptionService.push(this.store$.pipe(Wo()).subscribe({next:e=>this.annotTool=e}),this.contentService.annotEvent$.subscribe({next:e=>this.isSelectedInAnnotView=e?.from==="AnnotationViewComponent"}),this.popupService.popupHolder$.subscribe({next:e=>{this.toggle(e),this.popupService.publishOpenedPopupNumber(this.popups.length)}}),ut(this.contentService.reload$.pipe(F(e=>Go.type(e,zo.Annot))),this.popupService.closeAllPopup$).subscribe({next:()=>{this.clearPopups(),this.popupService.publishOpenedPopupNumber(0),this.changeDetectorRef.markForCheck()}}))}ngOnDestroy(){this.clearPopups()}clearPopups(){this.popups.splice(0),this.popupOrder.splice(0)}toggle({src:e,popup:n,pdfPage:r,open:c}){let g=this.popups.findIndex(v=>n.oid===v.popup.oid);if(g>=0&&(c===void 0||!c)){this.popups.splice(g,1),g=this.popupOrder.indexOf(n.oid),g>-1&&this.popupOrder.splice(g,1),this.changeDetectorRef.markForCheck();return}this.annotTool!==Qe.ERASER&&(c===void 0||c)&&(this.popupOrder.push(n.oid),this.isSelectedInAnnotView||this.popups.push({src:e,popup:n,pdfPage:r}),this.changeDetectorRef.markForCheck())}};N(t,"\u0275fac",function(n){return new(n||t)(_(at),_(ha),_(Ae),_(ee),_(ye))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-popups"]],inputs:{contentViewRoot:"contentViewRoot"},standalone:!1,features:[xe([ee])],decls:1,vars:1,consts:[[3,"contentViewRoot","popupInfo","popupOrder",4,"ngFor","ngForOf"],[3,"contentViewRoot","popupInfo","popupOrder"]],template:function(n,r){n&1&&se(0,af,1,3,"sd-popup",0),n&2&&O("ngForOf",r.popups)},encapsulation:2,changeDetection:0}));let s=t;return s})();var cf=["quickActionRef"],lf=["actionsContainerRef"],pf=["actionItemRef"],df=()=>({"background-color":"var(--mono-10)","padding-left":"30px"}),Pd=(s,t)=>({focused:s,disabled:t});function hf(s,t){if(s&1){let i=Se();Bt(0),A(1,"button",14,2),Y(3,"translate"),ce("click",function(){let n=W(i).$implicit,r=E(3);return z(r.onActionClick(n))})("mouseenter",function(){let n=W(i).index,r=E(3);return z(r.onMouseEnterAction(n))}),A(4,"div",15)(5,"div",16),Q(6,"i"),D(),A(7,"span"),be(8),Y(9,"translate"),D()()(),Ut()}if(s&2){let i=t.$implicit,e=t.index,n=E(3);x(),O("ngClass",sc(9,Pd,e===n.focusedActionIndex,n.shouldDisableAction(i))),ge("aria-label",X(3,5,i.name)),x(5),hr(i.icon),x(2),Ee(X(9,7,i.name))}}function uf(s,t){if(s&1&&(A(0,"div")(1,"h4"),be(2),Y(3,"translate"),D(),se(4,hf,10,12,"ng-container",13),D()),s&2){let i=E(2);x(2),Ee(X(3,3,"RECENT_ACTION")),x(2),O("ngForOf",i.recentActions)("ngForTrackBy",i.trackByAction)}}function gf(s,t){s&1&&(A(0,"h4"),be(1),Y(2,"translate"),D()),s&2&&(x(),Ee(X(2,1,"SHORTCUT")))}function ff(s,t){if(s&1){let i=Se();Bt(0),A(1,"button",14,2),Y(3,"translate"),ce("click",function(){let n=W(i).$implicit,r=E(2);return z(r.onActionClick(n))})("mouseenter",function(){let n=W(i).index,r=E(2);return z(r.onMouseEnterAction(n+r.recentActions.length))}),A(4,"div",15)(5,"div",16),Q(6,"i"),D(),A(7,"span"),be(8),Y(9,"translate"),D()(),A(10,"span",17),be(11),D()(),Ut()}if(s&2){let i=t.$implicit,e=t.index,n=E(2);x(),O("ngClass",sc(10,Pd,e+n.recentActions.length===n.focusedActionIndex,n.shouldDisableAction(i))),ge("aria-label",X(3,6,i.name)),x(5),hr(i.icon),x(2),Ee(X(9,8,i.name)),x(3),Ee(i.shortcut)}}function mf(s,t){if(s&1){let i=Se();A(0,"nav",4,0),ce("mousedown",function(n){return W(i),z(n.stopPropagation())}),A(2,"div",5)(3,"div",6),Q(4,"i",7),A(5,"pu-input",8),Y(6,"translate"),Ai("ngModelChange",function(n){W(i);let r=E();return Ii(r.actionKeyword,n)||(r.actionKeyword=n),z(n)}),ce("ngModelChange",function(n){W(i);let r=E();return z(r.onSearchChange(n))}),D()(),A(7,"button",9),ce("click",function(){W(i);let n=E();return z(n.onCloseClick())}),Q(8,"i",10),D()(),A(9,"div",11,1),ce("wheel",function(n){return W(i),z(n.stopPropagation())}),se(11,uf,5,5,"div",12),A(12,"div"),se(13,gf,3,3,"h4",12)(14,ff,12,13,"ng-container",13),D()()()}if(s&2){let i=E();x(5),O("placeholder",X(6,8,"SEARCH_FEATURE"))("autofocus",!0)("inputStyle",Zs(10,df)),Ri("ngModel",i.actionKeyword),x(6),O("ngIf",i.recentActions.length>0),x(2),O("ngIf",i.actionKeyword.length===0),x(),O("ngForOf",i.displayedActions)("ngForTrackBy",i.trackByAction)}}var yc=(()=>{let t=class t{changeDetectorRef;store$;viewerService;subscriptionService;shortcutService;localstorageService;quickActionService;actionHistoryService;annotSelectedService;pageService;documentService;objectClipboardService;DEFAULT_FOCUSED_ACTION_INDEX=0;actionKeyword=w.EMPTY_STRING;focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX;shouldDisplayPalette=!1;viewMode;currentPageNo;pageCount;canUndo=!1;canRedo=!1;isNavigatingByKeyboard=!1;quickActionRef;actionsContainerRef;actionItemRefs;constructor(e,n,r,c,g,v,y,M,V,Z,le,pe){this.changeDetectorRef=e,this.store$=n,this.viewerService=r,this.subscriptionService=c,this.shortcutService=g,this.localstorageService=v,this.quickActionService=y,this.actionHistoryService=M,this.annotSelectedService=V,this.pageService=Z,this.documentService=le,this.objectClipboardService=pe}get displayedActions(){return this.actionKeyword.length>0?this.quickActionService.filterActionsByKeyword(this.actionKeyword.trim()):this.quickActionService.getActionsByIds(Ip)}get recentActions(){let e=this.getRecentActionsFromLocalStorage();return e.length===0||this.actionKeyword.length>0?[]:e}get combinedActions(){return this.actionKeyword.length>0?this.displayedActions:[...this.recentActions,...this.displayedActions]}ngOnInit(){this.initSubscriptions()}initSubscriptions(){this.subscriptionService.push(G.windowMousedown$.pipe(F(()=>this.shouldDisplayPalette&&w.isDefined(this.quickActionRef))).subscribe({next:e=>{let n=e.clientX,r=e.clientY,c=this.quickActionRef.nativeElement.getBoundingClientRect();n>=c.left&&n<=c.right&&r>=c.top&&r<=c.bottom||(this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck())}}),this.quickActionService.paletteVisibility$.subscribe({next:e=>{this.shouldDisplayPalette=e,this.focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX,this.actionKeyword=w.EMPTY_STRING,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Pe.QUICK_ACTION).pipe(F(()=>K.get(ie.SHORTCUT_QUICK_ACTION)),F(()=>!G.isSmallWidth())).subscribe({next:()=>{this.quickActionService.togglePaletteVisibility(),this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Pe.ESCAPE).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:()=>{this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Pe.MOVE_BOTTOM).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:e=>this.navigateToActionByKeyboard(Pe.MOVE_BOTTOM,e)}),this.shortcutService.getShortcutEvent(Pe.MOVE_TOP).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:e=>this.navigateToActionByKeyboard(Pe.MOVE_TOP,e)}),this.shortcutService.getShortcutEvent(Pe.ENTER).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:()=>{let e=this.combinedActions[this.focusedActionIndex];this.onActionClick(e)}}),this.store$.pipe($("viewMode")).subscribe({next:e=>this.viewMode=e}),this.store$.pipe($("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),this.store$.pipe($("pageCount")).subscribe({next:e=>this.pageCount=e}),this.actionHistoryService.availableUndoCount$.subscribe({next:e=>this.canUndo=e>0}),this.actionHistoryService.availableRedoCount$.subscribe({next:e=>this.canRedo=e>0}))}shouldDisableAction(e){let n=this.pageService.pdfPages[this.currentPageNo-1];switch(e.id){case ve.UNDO:return!this.canUndo;case ve.REDO:return!this.canRedo;case ve.COPY:return this.annotSelectedService.pageIndex!==n.ref&&(this.annotSelectedService.selectedComponents.length===0||!this.annotSelectedService.selectedComponents.every(g=>g.data.oid!==null));case ve.PASTE:return!this.objectClipboardService.hasAnnotsInLegacyClipboard;case ve.CHANGE_TO_EBOOK_MODE:return this.quickActionService.isEbookMode;case ve.CHANGE_TO_THE_READING_MODE:return!this.quickActionService.isEbookMode;case ve.ROTATE_CCW:return this.quickActionService.isEbookMode;case ve.ROTATE_CW:return this.quickActionService.isEbookMode;case ve.REDACT_AREA:return!this.documentService.checkAuthority(Ne.DRAW_REDACTION);case ve.REDACT_PAGE:return!this.documentService.checkAuthority(Ne.DRAW_REDACTION);case ve.REDACT_SEARCH:return!this.documentService.checkAuthority(Ne.SEARCH_TEXT);case ve.PREVIOUS_PAGE:return this.currentPageNo<=1;case ve.NEXT_PAGE:return this.viewMode===4?J.getEbookPageNo(this.pageCount)<=this.currentPageNo:this.pageCount<=this.currentPageNo;case ve.DELETE:let r=this.annotSelectedService.selectedComponents.every(g=>Vt.isWidget(g.data)&&K.get(ie.DELETE_FORM)||!Vt.isWidget(g.data)&&K.get(ie.DELETE_ANNOTATION)),c=this.annotSelectedService.selectedComponents.every(g=>!gr.get(g.data.attributes.F??-1,7));return!(r&&c&&this.annotSelectedService.selectedComponents.every(g=>g.data.oid!==null)&&this.annotSelectedService.selectedComponents.length>0);default:return!1}}trackByAction(e,n){return`${n.id}/${n.name}`}onSearchChange(e){this.actionKeyword=e,this.focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX}onCloseClick(){this.quickActionService.setPaletteVisibility(!1)}navigateToActionByKeyboard(e,n){n.preventDefault(),n.stopPropagation(),this.isNavigatingByKeyboard=!0,e===Pe.MOVE_BOTTOM?this.focusedActionIndex=Math.min(this.combinedActions.length-1,this.focusedActionIndex+1):this.focusedActionIndex=Math.max(0,this.focusedActionIndex-1),this.scrollToFocusedAction(),this.changeDetectorRef.markForCheck()}scrollToFocusedAction(){let n=this.actionItemRefs.toArray()[this.focusedActionIndex];if(!n)return;let c=this.actionsContainerRef.nativeElement.getBoundingClientRect(),g=n.nativeElement.getBoundingClientRect(),v=g.top<c.top,y=g.bottom>c.bottom;(v||y)&&n.nativeElement.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"})}onMouseEnterAction(e){if(this.isNavigatingByKeyboard){this.isNavigatingByKeyboard=!1;return}this.focusedActionIndex=e,this.changeDetectorRef.markForCheck()}onActionClick(e){this.shouldDisableAction(e)||(this.saveRecentAction(e),e.actionFn(),this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck())}getRecentActionsFromLocalStorage(){if(!this.localstorageService?.isEnabledLocalStorage)return[];let e=JSON.parse(this.localstorageService.get("SD_RecentActions","[]"));return this.quickActionService.getActionsByIds(e)}saveRecentAction(e){if(!this.localstorageService?.isEnabledLocalStorage)return;let n=JSON.parse(this.localstorageService.get("SD_RecentActions","[]"));n=n.filter(r=>r!==e.id),n.unshift(e.id),n=n.slice(0,2),this.localstorageService.set("SD_RecentActions",JSON.stringify(n))}};N(t,"\u0275fac",function(n){return new(n||t)(_(Ae),_(ye),_(Zt),_(ee),_(sn),_(Fr),_(ln),_(eo),_(Ni),_(zt),_(ct),_(ma))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-quick-action"]],viewQuery:function(n,r){if(n&1&&(Ye(cf,5),Ye(lf,5),Ye(pf,5)),n&2){let c;Me(c=Re())&&(r.quickActionRef=c.first),Me(c=Re())&&(r.actionsContainerRef=c.first),Me(c=Re())&&(r.actionItemRefs=c)}},standalone:!1,features:[xe([ee])],decls:1,vars:1,consts:[["quickActionRef",""],["actionsContainerRef",""],["actionItemRef",""],["aria-label","Quick actions","class","quick-action-palette",3,"mousedown",4,"ngIf"],["aria-label","Quick actions",1,"quick-action-palette",3,"mousedown"],[1,"navigation"],["role","search",1,"search-bar"],[1,"papycon","papycon-search"],["size","small",3,"ngModelChange","placeholder","autofocus","inputStyle","ngModel"],["aria-label","Close quick action palette",1,"ep-button","close",3,"click"],["aria-hidden","true",1,"papycon","papycon-cross"],["role","menu","aria-label","Available actions",1,"actions-container",3,"wheel"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"action",3,"click","mouseenter","ngClass"],[1,"action-info"],[1,"icon-container"],[1,"shortcut"]],template:function(n,r){n&1&&se(0,mf,15,11,"nav",3),n&2&&O("ngIf",r.shouldDisplayPalette)},styles:[".quick-action-palette[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:#1e1e1e;font-family:NotoSans-Regular,sans-serif;display:flex;flex-direction:column;row-gap:8px;box-sizing:border-box;width:344px;height:322px;border-radius:8px;z-index:5;position:fixed;left:50%;transform:translate(-50%);top:212px;background-color:var(--mono-00);box-shadow:0 4px 8px #6c6c6c1f;border:1px solid var(--mono-30);padding:12px;cursor:default}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]{display:flex;flex-direction:row;column-gap:12px;align-items:center;width:100%;flex-shrink:0}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;height:40px;display:flex;flex-direction:row;column-gap:8px;align-items:center;border-radius:4px;background-color:var(--mono-10)}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{position:relative;flex:1}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;z-index:1;left:20px;font-size:24px;color:var(--mono-50)}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .ep-button.close[_ngcontent-%COMP%]{display:none;height:30px;background-color:var(--mono-00);border:1px solid var(--mono-30)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{overflow:auto;width:100%;flex:1;display:flex;flex-direction:column;row-gap:8px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:12px;line-height:20px;color:#6c6c6c;font-family:NotoSans-Regular,sans-serif;margin:0}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{box-sizing:border-box;width:calc(100% - 4px);height:38px;padding:8px;border-radius:4px;display:flex;align-items:center;justify-content:space-between;flex-direction:row;background:none;border:none}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;column-gap:8px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{width:22px;height:22px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:var(--mono-90)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i.reverse[_ngcontent-%COMP%]{transform:scaleX(-1)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--mono-99)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .shortcut[_ngcontent-%COMP%]{font-size:12px;line-height:20px;color:var(--mono-70)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action.focused[_ngcontent-%COMP%]{background-color:var(--mono-10)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--button-pressed)}@media screen and (max-width: 577px){.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .ep-button.close[_ngcontent-%COMP%]{display:flex}}@media screen and (max-width: 397px){.quick-action-palette[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:0;top:0}}"],changeDetection:0}));let s=t;return s})();var Md=(()=>{let t=class t{};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({providers:[zi],imports:[Yp,Ta,on,Up,Nr,ba,yn,fd,Mp,va,Ql,sa,Vr,ca,kr,pa,Gp,Op]}));let s=t;return s})();ai(Ao,[qp,yi,bt,Js,qt,Bp,Na,Aa,Sd,Sc,ao,Tc,Ma,Ra,wc,yc,ro,Ia,Jr],[]);ai(Sc,[yi,bt,qt,Os,Fa],[]);ai(ao,[bt,qt,wn,Vn,Ts,wo],[He]);ai(Fa,[qt,la],[]);ai(Cr,[wn,Po,Vn,aa],[He]);ai(Tc,[bt,qt,Os,Fa,Cd],[He]);ai(er,[yi,bt,qt,xs,wn,oa,Po,ql,Vn,Ts,wo,Ed],[He]);ai(wc,[yi,er],[]);ai(yc,[Oo,yi,bt,wn,Po,Vn],[He]);ai(Jr,[bt,xs,wn,Po,wo],[He]);ai(Dp,[Oo,yi,bt,qt,Kl,Yl,Xl,wo],[He]);var xr=class xr{documentService;translatePipe;productService;store$;customUIService;annotSelectedService;actionHistoryService;modalService;dialogService;changeService;downloadService;viewerService;preferencesService;quickActionService;loggingService;hidableMenus={};leftSectionFirstCustomUI=[];leftSectionLastCustomUI=[];isSpreadsheets=!1;constructor(t,i,e,n,r,c,g,v,y,M,V,Z,le,pe,he){this.documentService=t,this.translatePipe=i,this.productService=e,this.store$=n,this.customUIService=r,this.annotSelectedService=c,this.actionHistoryService=g,this.modalService=v,this.dialogService=y,this.changeService=M,this.downloadService=V,this.viewerService=Z,this.preferencesService=le,this.quickActionService=pe,this.loggingService=he,this.store$.pipe(fi([B.TOOLBAR_EBOOK,B.TOOLBAR_PREFERENCES,B.TOOLBAR_DOCUMENT_INFO,B.TOOLBAR_SD_INFO,B.TOOLBAR_SAVE,B.TOOLBAR_PRINT,B.TOOLBAR_DOWNLOAD,B.TOOLBAR_SLIDESHOW,B.TOOLBAR_SCREEN_THEME])).subscribe({next:Te=>{this.hidableMenus=si(si({},this.hidableMenus),Te)}}),this.customUIService.customButtonUI$.subscribe({next:Te=>{this.leftSectionFirstCustomUI=Te.filter(p=>p.position==="TOOLBAR.LEFT_SECTION.FIRST"),this.leftSectionLastCustomUI=Te.filter(p=>p.position==="TOOLBAR.LEFT_SECTION.LAST")}}),this.store$.pipe(Br("isSpreadsheets")).subscribe({next:Te=>this.isSpreadsheets=Te}),this.initRegisterQuickActions()}get isLessThanMobileWidth(){return G.width<=G.breakpoints.mobile.width}get isLessThanDesktopWidth(){return G.width<G.breakpoints.desktop.width}get shouldAddSaveButton(){return this.documentService.checkAuthority(Ne.SAVE_DOCUMENT)&&K.get(ie.SAVE_BUTTON)&&!K.get(ie.AUTO_SAVE)&&!this.hidableMenus[B.TOOLBAR_SAVE]&&(K.get(ie.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanMobileWidth)}get shouldAddOriginalDownloadButton(){return this.productService.isStreamDocsVu&&this.documentService.checkAuthority(Ne.DOWNLOAD_DOCUMENT)&&K.get(ie.ORIGINAL_DOWNLOAD_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DOWNLOAD]&&this.documentService.hasOriginalFile&&!this.documentService.isDAP}get shouldAddPdfDownloadButton(){return this.documentService.checkAuthority(Ne.DOWNLOAD_DOCUMENT)&&K.get(ie.PDF_DOWNLOAD_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DOWNLOAD]&&(K.get(ie.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanDesktopWidth)}get shouldAddDocInfoButton(){return K.get(ie.DOCUMENT_INFO_BUTTON)&&K.get(xt.DOCUMENT_INFO_DIALOG)&&!this.hidableMenus[B.TOOLBAR_DOCUMENT_INFO]}get shouldAddPrintButton(){return this.documentService.checkAuthority(Ne.PRINT_DOCUMENT)&&K.get(ie.PRINT_BUTTON)&&K.get(xt.PRINT_DIALOG)&&!this.hidableMenus[B.TOOLBAR_PRINT]&&(K.get(ie.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanDesktopWidth)}buildMainMenu(t){let i=[],e={items:[]};if(this.isLessThanMobileWidth){let n=this.buildFirstCustomMenu();n.items.length>0&&i.push(n)}if([this.isLessThanMobileWidth?this.buildActionMenu(t):[],this.buildFileMenu(),this.buildViewMenu(t),this.buildSettingMenu(),this.buildInfoMenu()].forEach(n=>{n.length!==0&&(e.items.length>0&&e.items.push({type:ep.LINE,label:"DIVISION_LINE"}),e.items.push(...n))}),e.items.length>0&&i.push(e),this.isLessThanMobileWidth){let n=this.buildLastCustomMenu();n.items.length>0&&i.push(n)}return i}buildActionMenu(t){if(!t.runtimeEnv.get(xt.UNDO_REDO_BUTTONS)||this.isSpreadsheets)return[];let i=[];return i.push({label:this.translatePipe.transform("UNDO"),subLabel:ei.getShortcutString(Ui[Pe.UNDO_ACTION]),command:()=>{this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()},disabled:!t.canUndo}),i.push({label:this.translatePipe.transform("REDO"),subLabel:ei.getShortcutString(Ui[Pe.REDO_ACTION]),command:()=>{this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()},disabled:!t.canRedo}),i}buildFileMenu(){let t=[];return this.shouldAddSaveButton&&t.push({label:this.translatePipe.transform("SAVE"),command:()=>this.changeService.saveDocumentForStatistics(fe.SAVE_DOCUMENT_BY_BUTTON,void 0,void 0,void 0)}),this.shouldAddOriginalDownloadButton&&t.push({label:this.translatePipe.transform("ORIGINAL_DOWNLOAD"),command:()=>this.downloadService.downloadOriginalDocument()}),this.shouldAddPdfDownloadButton&&t.push({label:this.translatePipe.transform(this.productService.isStreamDocsVu?"PDF_DOWNLOAD":"DOWNLOAD_DOC"),command:()=>this.downloadService.downloadDocument()}),this.shouldAddDocInfoButton&&t.push({label:this.translatePipe.transform("DOC_PROPERTY_MENU"),command:()=>this.dialogService.toggleDialogVisibilityForStatistics(fe.DOCUMENT_INFO_BY_BUTTON,$i.DOCUMENT_INFO,!0)}),this.shouldAddPrintButton&&t.push({label:this.translatePipe.transform("PRINT_MENU"),subLabel:ei.getShortcutString(Ui[Pe.PRINT]),command:()=>this.dialogService.toggleDialogVisibility($i.PRINT)}),t}buildViewMenu(t){if(this.isSpreadsheets)return[];let i=[];return K.get(ie.SLIDESHOW_BUTTON)&&!this.hidableMenus[B.TOOLBAR_SLIDESHOW]&&i.push({label:this.translatePipe.transform("SLIDESHOW"),command:()=>this.viewerService.setSlideshow()}),K.get(ie.CAPTURE_MODE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_CAPTURE_MODE]&&G.isSmallWidth()&&i.push({label:this.translatePipe.transform("CAPTURE"),command:()=>this.store$.dispatch(ue.set({key:"isCaptureMode",value:!0}))}),K.get(ie.EBOOK_BUTTON)&&!this.hidableMenus[B.TOOLBAR_EBOOK]&&i.push({label:t.isEbookMode()?this.translatePipe.transform("CHANGE_TO_THE_READING_MODE"):this.translatePipe.transform("CHANGE_TO_EBOOK_MODE"),command:()=>this.viewerService.toggleEbookModeForStatistics(fe.CHANGE_TO_EBOOK)}),i}buildChildrenOfScreenThemeMenu(t){let i=[],e=this.viewerService.screenTheme;i.push({label:this.translatePipe.transform("LIGHT_MODE"),icon:e==="light"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(fe.LIGHT_THEME_BY_BUTTON,"light")}),i.push({label:this.translatePipe.transform("DARK_MODE"),icon:e==="dark"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(fe.DARK_THEME_BY_BUTTON,"dark")}),i.push({label:this.translatePipe.transform("SYSTEM_SYNCHRONIZATION"),icon:e==="System synchronization"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(fe.SYSTEM_THEME_BY_BUTTON,"System synchronization")}),t.push({items:i})}buildSettingMenu(){let t=[],i=[];return K.get(ie.SCREEN_THEME_MENU)&&!this.hidableMenus[B.TOOLBAR_SCREEN_THEME]&&!this.isSpreadsheets&&(this.buildChildrenOfScreenThemeMenu(i),t.push({label:this.translatePipe.transform("SCREEN_THEME"),children:i})),K.get(ie.PREFERENCES_BUTTON)&&K.get(xt.PREFERENCES_DIALOG)&&!this.hidableMenus[B.TOOLBAR_PREFERENCES]&&t.push({label:this.translatePipe.transform("PREFERENCE_MENU"),command:()=>this.dialogService.toggleDialogVisibility($i.PREFERENCES,!0)}),t}buildInfoMenu(){let t=[];return K.get(ie.SD_INFO_BUTTON)&&!this.hidableMenus[B.TOOLBAR_SD_INFO]&&t.push({label:this.translatePipe.transform("SD_INFO"),command:()=>this.showProductInfoForStatistics(fe.OPEN_SD_INFO_BY_BUTTON)}),t}showProductInfo(){this.productService.getProductLicenseInfo().subscribe({next:t=>{this.modalService.createCommonModal({type:jt.PRODUCT,logo:this.productService.logo,description:this.productService.copyRight,content:t,accordionTitle:this.translatePipe.transform("OPEN_SOURCE_LICENSE_NOTICE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})},error:()=>{this.modalService.createCommonModal({type:jt.PRODUCT,logo:this.productService.logo,description:this.productService.copyRight,content:this.translatePipe.transform("NO_PRODUCT_INFO"),accordionTitle:this.translatePipe.transform("OPEN_SOURCE_LICENSE_NOTICE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})}})}showProductInfoForStatistics(t){this.showProductInfo()}buildRightMenu(){let t=[];return this.shouldAddPrintButton&&t.push({label:this.translatePipe.transform("PRINT"),icon:"papycon papycon-print",command:()=>{this.dialogService.toggleDialogVisibility($i.PRINT)}}),this.shouldAddPdfDownloadButton&&t.push({label:this.translatePipe.transform("DOWNLOAD"),icon:"papycon papycon-download",command:()=>{this.downloadService.downloadDocument()}}),t}buildFirstCustomMenu(){let t={items:[]};return this.leftSectionFirstCustomUI.forEach(i=>{t.items.push({label:i.label,command:e=>{if(!w.isDefined(e)){this.loggingService.common("warn",Le.NOT_EXIST,"event");return}i.onclick(Qn.simplifyMouseEvent(e))}})}),t}buildLastCustomMenu(){let t={items:[]};return this.leftSectionLastCustomUI.forEach(i=>{t.items.push({label:i.label,command:e=>{if(!w.isDefined(e)){this.loggingService.common("warn",Le.NOT_EXIST,"event");return}i.onclick(Qn.simplifyMouseEvent(e))}})}),t}changeScreenThemeForStatistics(t,i){this.preferencesService.updatePreferences(["screenTheme"],i)}initRegisterQuickActions(){this.quickActionService.registerActions([{id:ve.SD_INFO,actionFn:()=>this.showProductInfoForStatistics(fe.OPEN_SD_INFO_BY_QUICK_SEARCH)},{id:ve.LIGHT_THEME,actionFn:()=>this.changeScreenThemeForStatistics(fe.LIGHT_THEME_BY_QUICK_SEARCH,"light")},{id:ve.DARK_THEME,actionFn:()=>this.changeScreenThemeForStatistics(fe.DARK_THEME_BY_QUICK_SEARCH,"dark")},{id:ve.SYSTEM_THEME,actionFn:()=>this.changeScreenThemeForStatistics(fe.SYSTEM_THEME_BY_QUICK_SEARCH,"System synchronization")}])}};N(xr,"\u0275fac",function(i){return new(i||xr)(Ue(ct),Ue(He),Ue(Lr),Ue(ye),Ue(Wr),Ue(Ni),Ue(eo),Ue(rn),Ue(Pn),Ue(Xo),Ue(Ko),Ue(Zt),Ue(Uo),Ue(ln),Ue(Di))}),N(xr,"\u0275prov",di({token:xr,factory:xr.\u0275fac}));var tr=xr;ze([ot(it.menuService.showProductInfoForStatistics)],tr.prototype,"showProductInfoForStatistics",null);ze([ot(it.menuService.changeScreenThemeForStatistics)],tr.prototype,"changeScreenThemeForStatistics",null);var Sf=["mainMenuRef"],bf=["subToolbarRef"],Cf=["sideViewMenuRef"],xf=["iconMenuRef"],Tf=["dragToolMenuRef"],Of=["rightMenuRef"],wf=["scaleMenuRef"],$n=s=>({content:s});function yf(s,t){if(s&1&&Q(0,"pu-menu",18,0),s&2){let i=E(4);O("size",i.SizeType.SMALL)("menus",i.sideViewMenus)}}function Ef(s,t){if(s&1){let i=Se();Bt(0),A(1,"button",16),ce("click",function(){W(i);let n=E(3);return z(n.leftSideViewButton.onClick())})("mousedown",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))})("touchstart",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))}),Q(2,"i"),D(),se(3,yf,2,2,"pu-menu",17),Ut()}if(s&2){let i=E(3);x(),$e("dark",i.isDarkMode&&!i.sideViewVisible),O("tooltip",St(7,$n,i.leftSideViewButton.label)),ge("aria-label",i.leftSideViewButton.label)("color",i.isDarkMode&&!i.sideViewVisible?"white":i.sideViewVisible?"primary":"dark"),x(),ge("class",i.leftSideViewButton.icon),x(),O("ngIf",i.sideViewMenus.length>0)}}function Pf(s,t){if(s&1&&(A(0,"div",15),se(1,Ef,4,9,"ng-container",8),D()),s&2){let i=E(2);x(),O("ngIf",i.isSideViewButtonVisible)}}function Mf(s,t){s&1&&Q(0,"div",19)}function Rf(s,t){s&1&&Q(0,"div",19)}function If(s,t){if(s&1&&(A(0,"section",20),Q(1,"img",21),D(),se(2,Rf,1,0,"div",19)),s&2){let i=E(2);x(),O("src",i.logoDataURL,Sn),x(),Kt(i.isLessThanDesktopWidth?-1:2)}}function Af(s,t){if(s&1){let i=Se();A(0,"button",22),ce("click",function(n){let r=W(i).$implicit,c=E(2);return z(c.onClickCustomUI(r,n))}),Q(1,"i",23),D()}if(s&2){let i=t.$implicit,e=E(2);$e("dark",e.isDarkMode),O("title",e.isMobile?"":i.label)("tooltip",St(7,$n,i.label)),ge("color",e.isDarkMode?"white":"dark")("aria-label",i.label),x(),O("ngClass",i.icon)}}function Df(s,t){if(s&1){let i=Se();A(0,"button",25),ce("click",function(){W(i);let n=E(3);return z(n.onToolbarMenuClick(n.SubToolbar.ANNOTATE))})("mousedown",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))})("touchstart",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))}),be(1),Y(2,"translate"),D()}if(s&2){let i=E(3);$e("active",i.isSubToolbarType(i.SubToolbar.ANNOTATE)),ge("color",i.isSubToolbarType(i.SubToolbar.ANNOTATE)?"primary-70":i.isDarkMode?"white":"dark"),x(),Ee(X(2,4,"ANNOTATE"))}}function Nf(s,t){if(s&1){let i=Se();A(0,"button",25),ce("click",function(){W(i);let n=E(3);return z(n.onToolbarMenuClick(n.SubToolbar.REDACT))})("mousedown",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))})("touchstart",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))}),be(1),Y(2,"translate"),D()}if(s&2){let i=E(3);$e("active",i.isSubToolbarType(i.SubToolbar.REDACT)),ge("color",i.isSubToolbarType(i.SubToolbar.REDACT)?"primary-70":i.isDarkMode?"white":"dark"),x(),Ee(X(2,4,"TOOLBAR_REDACT"))}}function kf(s,t){if(s&1&&se(0,Df,3,6,"button",24)(1,Nf,3,6,"button",24),s&2){let i=E(2);Kt(i.canShowAnnotToolbar?0:-1),x(),Kt(i.canShowRedactToolbar?1:-1)}}function Vf(s,t){if(s&1){let i=Se();A(0,"div",14)(1,"button",26),ce("click",function(){W(i);let n=E(2);return z(n.onSubToolbarMenuClick())})("mousedown",function(n){W(i);let r=E(2);return z(r.stopPropagation(n))})("touchstart",function(n){W(i);let r=E(2);return z(r.stopPropagation(n))}),A(2,"span"),be(3),D(),Q(4,"i",27),D(),Q(5,"pu-menu",28,1),D()}if(s&2){let i=E(2);x(3),Ee(i.subToolbarMenuTitle),x(2),O("menus",i.subToolbarMenus)}}function Lf(s,t){if(s&1){let i=Se();A(0,"button",22),ce("click",function(n){let r=W(i).$implicit,c=E(2);return z(c.onClickCustomUI(r,n))}),Q(1,"i",23),D()}if(s&2){let i=t.$implicit,e=E(2);$e("dark",e.isDarkMode),O("title",e.isMobile?"":i.label)("tooltip",St(7,$n,i.label)),ge("color",e.isDarkMode?"white":"dark")("aria-label",i.label),x(),O("ngClass",i.icon)}}function Ff(s,t){if(s&1&&(A(0,"section",9),se(1,Pf,2,1,"div",10)(2,Mf,1,0,"div",11)(3,If,3,2),A(4,"section",12),se(5,Af,2,9,"button",13)(6,kf,2,2)(7,Vf,7,2,"div",14)(8,Lf,2,9,"button",13),D()()),s&2){let i=E();x(),O("ngIf",i.isSideMenuVisible),x(),O("ngIf",!i.isLessThanMobileWidth),x(),Kt(i.logoDataURL?3:-1),x(2),O("ngForOf",i.leftSectionFirstCustomUI),x(),Kt(i.isLessThanDesktopWidth?7:6),x(2),O("ngForOf",i.leftSectionLastCustomUI)}}function Bf(s,t){if(s&1){let i=Se();A(0,"div",30)(1,"button",34),Y(2,"translate"),Y(3,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.zoomOut(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))}),Q(4,"i",35),D(),A(5,"div",36)(6,"input",37),Y(7,"translate"),ce("keyup.enter",function(){W(i);let n=E(2);return z(n.onConfirmScaleInput())})("blur",function(){W(i);let n=E(2);return z(n.onConfirmScaleInput())}),D(),A(8,"button",38),Y(9,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.onScaleMenuClick())}),Q(10,"i",27),D(),Q(11,"pu-menu",28,2),D(),A(13,"button",34),Y(14,"translate"),Y(15,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.zoomIn(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))}),Q(16,"i",39),D()()}if(s&2){let i=E(2);x(),$e("dark",i.isDarkMode)("disabled",!i.doc),O("disabled",!i.doc)("title",i.isMobile?"":X(2,23,"ZOOM_OUT"))("tooltip",St(35,$n,i.zoomOutTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(3,25,"ZOOM_OUT")),x(5),O("disabled",!i.doc)("formControl",i.scaleFormControl),ge("aria-label",X(7,27,"EDIT_MAGNIFICATION")),x(2),ge("aria-label",X(9,29,"EXPAND")),x(3),O("menus",i.scaleMenus),x(2),$e("dark",i.isDarkMode)("disabled",!i.doc),O("disabled",!i.doc)("title",i.isMobile?"":X(14,31,"ZOOM_IN"))("tooltip",St(37,$n,i.zoomInTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(15,33,"ZOOM_IN"))}}function Uf(s,t){s&1&&Q(0,"div",19)}function Hf(s,t){if(s&1){let i=Se();A(0,"div",31)(1,"pu-input",40),Y(2,"translate"),ce("keydown.enter",function(){W(i);let n=E(2);return z(n.goToPage(n.pageNoFormControl.value))})("blur",function(){W(i);let n=E(2);return z(n.onPageInputBlur())}),D(),A(3,"div",41),be(4),D()()}if(s&2){let i=E(2);x(),O("autoResize",!0)("maxLength",i.pageCount.toString().length)("formControl",i.pageNoFormControl)("ariaLabel",X(2,5,"MOVE_SPECIFYING_PAGE")),x(3),Kn(" /\xA0",i.pageCount,"")}}function $f(s,t){s&1&&Q(0,"div",19)}function jf(s,t){if(s&1){let i=Se();A(0,"button",42),Y(1,"translate"),Y(2,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.onClickSearchButton())}),Q(3,"i",43),D()}if(s&2){let i=E(2);$e("dark",i.isDarkMode&&!i.searchToolActive)("disabled",!i.doc),O("disabled",!i.doc)("title",i.isMobile?"":X(1,10,"SEARCH"))("tooltip",St(14,$n,i.searchTooltipWithShortcut)),ge("color",i.searchToolActive?"primary-70":i.isDarkMode?"white":"dark")("aria-label",X(2,12,"SEARCH"))("aria-expanded",i.searchToolActive)}}function Wf(s,t){if(s&1){let i=Se();A(0,"div",33)(1,"button",44),Y(2,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.onMoreMenuButtonClick())})("mousedown",function(n){W(i);let r=E(2);return z(r.stopPropagation(n))})("touchstart",function(n){W(i);let r=E(2);return z(r.stopPropagation(n))}),Q(3,"i",23)(4,"i",45),D(),Q(5,"pu-icon-menu",46,3),D()}if(s&2){let i=E(2);x(),$e("dark",i.isDarkMode),O("title",i.isMobile?"":i.activeMoreMenu==null?null:i.activeMoreMenu.label)("tooltip",St(12,$n,i.activeMoreMenu==null?null:i.activeMoreMenu.label)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(2,10,"DEFAULT_VIEW_MODE")),x(2),O("ngClass",i.activeMoreMenu==null?null:i.activeMoreMenu.icon),x(2),O("iconMenus",i.iconMenus)("isMobile",i.isMobile)("isDarkMode",i.isDarkMode)}}function zf(s,t){if(s&1&&(A(0,"section",29),se(1,Bf,17,39,"div",30)(2,Uf,1,0,"div",19)(3,Hf,5,7,"div",31)(4,$f,1,0,"div",19)(5,jf,4,16,"button",32)(6,Wf,7,14,"div",33),D()),s&2){let i=E();x(),Kt(i.isScaleMenuVisible?1:-1),x(),Kt(i.isLessThanDesktopWidth?-1:2),x(),Kt(i.isPageMenuVisible?3:-1),x(),Kt(i.isLessThanDesktopWidth?-1:4),x(),Kt(i.isSearchMenuVisible?5:-1),x(),Kt(i.isViewModeVisible?6:-1)}}function Gf(s,t){if(s&1){let i=Se();A(0,"button",52),Y(1,"translate"),Y(2,"translate"),ce("click",function(){W(i);let n=E(4);return z(n.printDoc())}),Q(3,"i",53),D()}if(s&2){let i=E(4);$e("dark",i.isDarkMode),O("disabled",!i.doc)("title",X(1,7,"PRINT"))("tooltip",St(11,$n,i.printTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(2,9,"PRINT"))}}function Yf(s,t){if(s&1){let i=Se();A(0,"button",54),Y(1,"translate"),Y(2,"translate"),Y(3,"translate"),ce("click",function(){W(i);let n=E(4);return z(n.downloadDoc())}),Q(4,"i",55),D()}if(s&2){let i=E(4);$e("dark",i.isDarkMode),O("disabled",!i.doc)("title",X(1,7,"PDF_DOWNLOAD"))("tooltip",St(13,$n,X(2,9,"PDF_DOWNLOAD"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(3,11,"PDF_DOWNLOAD"))}}function Xf(s,t){if(s&1&&se(0,Gf,4,13,"button",50)(1,Yf,5,15,"button",51),s&2){let i=E(3);O("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.PRINT_BUTTON)&&i.runtimeEnv.get(i.MergedRuntimeEnvKey.PRINT_DIALOG)&&i.hasPrintPermission&&!i.hidableMenus[i.HidableView.TOOLBAR_PRINT]),x(),O("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.PDF_DOWNLOAD_BUTTON)&&i.hasDownloadPermission&&!i.hidableMenus[i.HidableView.TOOLBAR_DOWNLOAD])}}function Kf(s,t){if(s&1){let i=Se();A(0,"button",56),Y(1,"translate"),Y(2,"translate"),Y(3,"translate"),ce("click",function(){W(i);let n=E(3);return z(n.onRightMenuClick())})("mousedown",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))})("touchstart",function(n){W(i);let r=E(3);return z(r.stopPropagation(n))}),Q(4,"i",57),D(),Q(5,"pu-menu",58,4)}if(s&2){let i=E(3);$e("dark",i.isDarkMode),O("title",i.isMobile?"":X(1,8,"MORE_MENU"))("tooltip",St(14,$n,X(2,10,"MORE_MENU"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(3,12,"MORE_MENU")),x(5),O("size",i.SizeType.SMALL)("menus",i.rightMenus)}}function qf(s,t){if(s&1&&(A(0,"div",48),se(1,Xf,2,2)(2,Kf,7,16),D()),s&2){let i=E(2);x(),Kt(i.isLessThanDesktopWidth?2:1)}}function Qf(s,t){if(s&1){let i=Se();A(0,"button",59),Y(1,"translate"),Y(2,"translate"),ce("click",function(n){W(i);let r=E(2);return z(r.dapMenuItem.command==null?null:r.dapMenuItem.command(n,r.dapMenuItem))})("mousedown",function(n){W(i);let r=E(2);return z(r.stopPropagation(n))})("touchstart",function(n){W(i);let r=E(2);return z(r.stopPropagation(n))}),Q(3,"i",60),D()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),O("tooltip",St(9,$n,X(1,5,"DAP_DOCUMENT"))),ge("color",i.isDarkMode&&!(i.rightSideViewVisible&&i.rightSideViewMode===i.RightSideViewMode.DAP)?"white":i.rightSideViewVisible&&i.rightSideViewMode===i.RightSideViewMode.DAP?"primary":"dark")("aria-label",X(2,7,"DAP_DOCUMENT"))}}function Zf(s,t){if(s&1&&(A(0,"section",47),se(1,qf,3,1,"div",48)(2,Qf,4,11,"button",49),D()),s&2){let i=E();x(),Kt(!i.runtimeEnv.get(i.RuntimeEnvKey.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)&&(!i.hidableMenus[i.HidableView.TOOLBAR_PRINT]||!i.hidableMenus[i.HidableView.TOOLBAR_DOWNLOAD])?1:-1),x(),O("ngIf",i.isDapButtonVisible)}}function Jf(s,t){if(s&1){let i=Se();Bt(0),A(1,"button",67),ce("click",function(){let n=W(i).$implicit;return z(n.command())}),Q(2,"i"),D(),Ut()}if(s&2){let i=t.$implicit,e=E(3);x(),$e("dark",e.isDarkMode),O("title",e.isMobile?"":i.label)("disabled",!e.doc),ge("color",e.isDarkMode&&!e.isActiveSideView(i.data)?"white":e.isActiveSideView(i.data)?"primary":"dark")("aria-label",i.label),x(),hr(i.icon)}}function em(s,t){if(s&1&&(Bt(0),se(1,Jf,3,8,"ng-container",66),Ut()),s&2){let i=t.$implicit;x(),O("ngForOf",i.items)}}function tm(s,t){if(s&1){let i=Se();Bt(0),A(1,"section",61)(2,"section",62)(3,"button",63),Y(4,"translate"),Y(5,"translate"),ce("click",function(){W(i);let n=E();return z(n.closeSideViewToolbar())}),Q(6,"i",64),D()(),Q(7,"div",19),A(8,"section",65),se(9,em,2,1,"ng-container",66),D()(),Ut()}if(s&2){let i=E();x(3),$e("dark",i.isDarkMode),O("title",i.isMobile?"":X(4,6,"CLOSE")),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(5,8,"CLOSE")),x(6),O("ngForOf",i.sideViewMenus)}}var ss=class ss{contentService;annotService;autoSaveService;dialogService;changeDetectorRef;menuService;documentService;downloadService;toastService;shortcutService;subscriptionService;actionHistoryService;annotSelectedService;store$;translatePipe;acroFormService;changeService;customUIService;selectTextService;toolbarService;pageService;viewerService;quickActionService;loggingService;panelService;logoService;scrollController;apiEventBridgeService;subToolbarToTitleMap={[lt.ANNOTATE]:"ANNOTATE",[lt.INSERT]:"INSERT",[lt.REDACT]:"TOOLBAR_REDACT",[lt.SIGN]:"TOOLBAR_SIGN",[lt.FORM]:"FORM"};get RuntimeEnvKey(){return ie}get MergedRuntimeEnvKey(){return xt}get runtimeEnv(){return K}get SizeType(){return tp}get ViewerStatisticData(){return fe}doc;mainMenuRef;subToolbarRef;sideViewMenuRef;iconMenuRef;dragToolMenuRef;rightMenuRef;scaleMenuRef;logoDataURL=null;scalePreset=[400,200,150,100,75,50].map(t=>this.convertToScalePreset(t));scaleMenus=[];currentPageNo;dragMode;previousDragMode;viewMode;rightSideViewMode;rightSideViewVisible;degree;canUndo=!1;canRedo=!1;quickActionPaletteVisible=!1;isSpreadsheets=!1;subToolbar=null;moreMenuIconArrayMap=[];dragModeTooltipMap=new Map([]);get activeDragModeLabel(){return this.dragModeTooltipMap.get(this.dragMode)??""}mainMenus=[];subToolbarMenus=[];sideViewMenus=[];iconMenus=[];dragToolMenus=[];rightMenus=[];activeFitMode;activeMoreMenu;isOpenedSideView=!1;get leftSideViewButton(){let t=this.sideViewMenus.length>0&&this.sideViewMenus[0].items.length===1,i={icon:Ln.MENU,label:this.translatePipe.transform("DOCUMENT_PANEL"),onClick:()=>this.onSideViewMenuClick()};if(t){let[e]=this.sideViewMenus[0].items;i.icon=typeof e.icon=="string"?e.icon:e.icon?.()??Ln.MENU,i.label=typeof e.label=="string"?e.label:e.label?.()??"unknown",i.onClick=()=>{if(!w.isDefined(e.command)){this.loggingService.common("warn",Le.NOT_EXIST,"Command");return}e.command()}}return i}get isActionMenuVisible(){return this.leftSectionFirstCustomUI.length>0||this.leftSectionLastCustomUI.length>0}get sideViewVisible(){return this.panelService.isPanelOpened}get RightSideViewMode(){return Rt}get SubToolbar(){return lt}get subToolbarMenuTitle(){return w.isDefined(this.subToolbar)?this.translatePipe.transform(this.subToolbarToTitleMap[this.subToolbar]):this.translatePipe.transform("MENU")}hasSignedSignature=!1;pageNoFormControl=new fr(1,{nonNullable:!0});pageCount=0;searchToolActive=!1;scaleFormControl=new fr;mainMenuStyle={left:"0",top:"100%"};get scale(){return this._scale}set scale(t){this._scale=t,this.scaleFormControl.setValue(`${Math.round(this._scale)}%`,{emitEvent:!1})}_scale;dapMenuItem;get hasSavePermission(){return this.documentService.checkAuthority(Ne.SAVE_DOCUMENT)}get hasDownloadPermission(){return this.documentService.checkAuthority(Ne.DOWNLOAD_DOCUMENT)}get hasPrintPermission(){return this.documentService.checkAuthority(Ne.PRINT_DOCUMENT)}get isLessThanMobileWidth(){return G.width<G.breakpoints.mobile.width}get isLessThanTabletWidth(){return G.width<G.breakpoints.tablet.width}get isLessThanDesktopWidth(){return G.width<G.breakpoints.desktop.width}get isMobile(){return G.isMobile()}get hidableDragMode(){return!this.hidableMenus[B.TOOLBAR_DRAG_MODE_SELECT_ANNOTATION]||!this.hidableMenus[B.TOOLBAR_DRAG_MODE_SELECT_TEXT]||!this.hidableMenus[B.TOOLBAR_DRAG_MODE_MOVE]||!this.hidableMenus[B.TOOLBAR_DRAG_MODE_ZOOM]}get HidableView(){return B}hidableMenus={};leftSectionFirstCustomUI=[];leftSectionLastCustomUI=[];screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get hasDragTools(){return this.dragToolMenus[0]?.menus.length>0}constructor(t,i,e,n,r,c,g,v,y,M,V,Z,le,pe,he,Te,p,dt,vt,gt,Mi,At,li,mi,Oe,Fe,h,u){this.contentService=t,this.annotService=i,this.autoSaveService=e,this.dialogService=n,this.changeDetectorRef=r,this.menuService=c,this.documentService=g,this.downloadService=v,this.toastService=y,this.shortcutService=M,this.subscriptionService=V,this.actionHistoryService=Z,this.annotSelectedService=le,this.store$=pe,this.translatePipe=he,this.acroFormService=Te,this.changeService=p,this.customUIService=dt,this.selectTextService=vt,this.toolbarService=gt,this.pageService=Mi,this.viewerService=At,this.quickActionService=li,this.loggingService=mi,this.panelService=Oe,this.logoService=Fe,this.scrollController=h,this.apiEventBridgeService=u,this.moreMenuIconArrayMap=[{label:this.translatePipe.transform("SINGLE_PAGE_VIEW"),icon:"papycon papycon-one-page3"},{label:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS"),icon:"papycon papycon-one-page-continuous3"},{label:this.translatePipe.transform("TWO_PAGE_VIEW"),icon:"papycon papycon-two-page3"},{label:this.translatePipe.transform("TWO_PAGE_CONTINUOUS"),icon:"papycon papycon-two-page-continuous3"}],this.scaleMenus=[{items:this.scalePreset},{items:[{label:this.translatePipe.transform("FIT_TO_HEIGHT_2"),icon:"fit-height3",command:()=>this.fitToHeightForStatistics(fe.CHANGE_ZOOM_DROPDOWN_FIT)},{label:this.translatePipe.transform("FIT_TO_WIDTH_2"),icon:"papycon papycon-fit-width3",command:()=>this.fitToWidthForStatistics(fe.CHANGE_ZOOM_DROPDOWN_FIT)}]}],this.dragModeTooltipMap=new Map([[Pt.MOVE,this.translatePipe.transform("SCROLL_MODE")],[Pt.SELECT_TEXT,this.translatePipe.transform("SELECT_TEXT")],[Pt.SELECT_ANNOT,this.translatePipe.transform("SELECT_ANNOT_TOOL")],[Pt.MAGNIFY,this.translatePipe.transform("MAGNIFY_TOOL")]]),this.dapMenuItem={label:this.translatePipe.transform("DAP_DOCUMENT"),command:()=>{this.toggleDapView(),this.changeDetectorRef.markForCheck()},icon:"papycon papycon-composite-document"}}ngOnInit(){if(this.subscriptionService.push(this.store$.pipe(oi("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.mainMenus=this.menuService.buildMainMenu(this),this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.pageNoFormControl.setValue(this.currentPageNo)}}),this.store$.pipe($("pageCount")).subscribe({next:t=>{this.pageCount=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("searchToolActive")).subscribe({next:t=>{if(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new yo("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.logoService.logoDataURL$.subscribe({next:t=>{this.logoDataURL=t,this.changeDetectorRef.markForCheck()}}),this.quickActionService.paletteVisibility$.subscribe({next:t=>{this.quickActionPaletteVisible=t,this.changeDetectorRef.markForCheck()}}),this.panelService.panelMenu$.pipe(Ve(t=>(w.isDefined(this.doc)||t.forEach(i=>i.items.forEach(e=>{e.disabled=!0})),t))).subscribe({next:t=>{this.sideViewMenus=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:t=>{this.rightSideViewVisible=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("degree")).subscribe({next:t=>{this.degree=t,K.get(ie.VIEW_MODE_BUTTON)||(this.activeMoreMenu={label:this.translatePipe.transform("ROTATE_CW"),icon:"papycon papycon-rotate"})}}),this.store$.pipe($("scale")).subscribe({next:t=>{this.scale=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("dragMode")).subscribe({next:t=>{this.previousDragMode=t,t!==Pt.SELECT_ANNOT&&(this.dragMode=t,this.changeDetectorRef.markForCheck())}}),this.store$.pipe($("viewMode")).subscribe({next:t=>{this.viewMode=t,K.get(ie.VIEW_MODE_BUTTON)&&this.viewMode!==4&&(this.activeMoreMenu=this.moreMenuIconArrayMap[t]),this.iconMenus=this.buildIconMenu(),this.changeDetectorRef.markForCheck()}}),G.windowResize$.subscribe({next:()=>this.resize()}),this.documentService.authorityUpdate$.subscribe({next:()=>{this.render(!0)}}),this.store$.pipe($("rightSideViewVisible")).pipe(F(w.isDefined)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe(Br("isSpreadsheets")).subscribe({next:t=>this.isSpreadsheets=t}),this.acroFormService.hasSignedSignature$.subscribe({next:t=>{this.hasSignedSignature=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(fi([B.TOOLBAR,B.TOOLBAR_LEFT,B.TOOLBAR_CENTER,B.TOOLBAR_RIGHT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),!Object.keys(t).every(i=>!this.hidableMenus[i])&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.store$.pipe(fi([B.TOOLBAR_EBOOK,B.TOOLBAR_PREFERENCES,B.TOOLBAR_DOCUMENT_INFO,B.TOOLBAR_SAVE,B.TOOLBAR_PRINT,B.TOOLBAR_DOWNLOAD,B.TOOLBAR_SLIDESHOW,B.TOOLBAR_QUICK_ACTION,B.TOOLBAR_CAPTURE_MODE,B.TOOLBAR_VIEW_MODE,B.TOOLBAR_ROTATE,B.TOOLBAR_ZOOM,B.TOOLBAR_DRAG_MODE_SELECT_TEXT,B.TOOLBAR_DRAG_MODE_MOVE,B.TOOLBAR_DRAG_MODE_ZOOM,B.TOOLBAR_ANNOTATION,B.TOOLBAR_FORM,B.TOOLBAR_SLIDESHOW,B.TOOLBAR_SD_INFO,B.TOOLBAR_SCREEN_THEME,B.TOOLBAR_SCREEN_FIT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.buildMenu(),this.hidableMenus[B.TOOLBAR_VIEW_MODE]&&this.hidableMenus[B.TOOLBAR_ROTATE]&&this.hidableMenus[B.TOOLBAR_ZOOM]&&this.iconMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(fi([B.TOOLBAR_ANNOTATION,B.TOOLBAR_FORM])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),(this.hidableMenus[B.TOOLBAR_ANNOTATION]&&this.viewerService.isSubToolbarType(lt.ANNOTATE)||this.hidableMenus[B.TOOLBAR_FORM]&&this.viewerService.isSubToolbarType(lt.FORM))&&this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck()}}),this.documentService.openedDocument$.subscribe({next:t=>{t?this.enableFormControl():(this.viewerService.closeSubToolbar(),this.disableFormControl())}}),this.toolbarService.toggleMainToolbar$.subscribe({next:t=>{t?this.mainMenuRef?.openMenu():this.mainMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.toolbarService.toggleSideViewToolbar$.subscribe({next:t=>{if(this.isLessThanMobileWidth){this.isOpenedSideView=!0;return}t?this.sideViewMenuRef?.openMenu():this.sideViewMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.toolbarService.toggleAnnotToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(lt.ANNOTATE)&&(this.viewerService.openSubToolbar(lt.ANNOTATE),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(lt.ANNOTATE)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleFormToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(lt.FORM)&&(this.viewerService.openSubToolbar(lt.FORM),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(lt.FORM)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleSignatureToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(lt.SIGN)&&(this.viewerService.openSubToolbar(lt.SIGN),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(lt.SIGN)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleQuickActionPalette$.subscribe({next:t=>this.quickActionService.setPaletteVisibility(t)}),this.customUIService.customButtonUI$.subscribe({next:t=>{this.leftSectionFirstCustomUI=t.filter(i=>i.position==="TOOLBAR.LEFT_SECTION.FIRST"),this.leftSectionLastCustomUI=t.filter(i=>i.position==="TOOLBAR.LEFT_SECTION.LAST"),this.render(!0)}}),this.shortcutService.getShortcutEvent(Pe.ESCAPE).subscribe({next:t=>{t.preventDefault(),this.undoDragMode()}}),this.shortcutService.getShortcutEvent(Pe.SEARCH).subscribe({next:()=>{this.documentService.checkAuthority(Ne.SEARCH_TEXT)&&(K.get(ie.QUICK_SEARCH_BUTTON)||K.get(ie.FULL_SEARCH_BUTTON))&&!this.isEbookMode()&&this.doc&&this.onClickSearchButton()}}),this.viewerService.subToolbar$.pipe(F(t=>this.subToolbar!==t)).subscribe({next:t=>{this.subToolbar=t,this.changeDetectorRef.markForCheck()}})),this.render(!1),this.subscribeZoomHotkey(),this.subscribeUndoRedo(),this.subscribePrint(),this.pageNoFormControl.reset(this.currentPageNo),K.get(ie.USE_CLIENT_RENDERING)&&K.get(ie.CLIENT_RENDERING_MAXIMUM_SCALE).value!==Ze.maxScale){let t=K.get(ie.CLIENT_RENDERING_MAXIMUM_SCALE);this.scalePreset.unshift(this.convertToScalePreset(t.value))}this.initRegisterQuickActions()}ngOnChanges(){this.render(!0)}stopPropagation(t){w.stopPropagation(t)}isSubToolbarType(t){return this.viewerService.isSubToolbarType(t)}get printTooltipWithShortcut(){return`${this.translatePipe.transform("PRINT")} (${ei.getShortcutString(Ui[Pe.PRINT])})`}get quickActionTooltipWithShortcut(){return`${this.translatePipe.transform("QUICK_ACTION")} (${ei.getShortcutString(Ui[Pe.QUICK_ACTION])})`}isEbookMode(){return this.viewMode===4}get isDAP(){return this.documentService.isDAP}get isEditable(){return!this.hasSignedSignature||this.documentService.checkAuthority(Ne.EDIT_ANNOTATION)}get canDrawAnnot(){return this.documentService.checkAuthority(Ne.DRAW_ANNOTATION)&&this.documentService.checkAuthority(Ne.ANNOTATION)}get canShowAnnotToolbar(){return this.canDrawAnnot&&K.get(xt.ANNOT_TOOLBAR)&&!this.isEbookMode()&&!this.hidableMenus[B.TOOLBAR_ANNOTATION]}get canShowRedactToolbar(){return this.documentService.checkAuthority(Ne.DRAW_REDACTION)&&!this.isEbookMode()}onMenuImageClick(){this.mainMenuRef?.toggleMenu()}isActiveSideView(t){return this.panelService.isOpened(t)}onSideViewMenuClick(){if(this.mainMenuRef?.closeMenu(),this.isLessThanMobileWidth){this.isOpenedSideView=!0;return}this.sideViewMenuRef?.toggleMenu()}onQuickActionButtonClick(){this.quickActionService.togglePaletteVisibility()}get searchTooltipWithShortcut(){return`${this.translatePipe.transform("SEARCH")} (${ei.getShortcutString(Ui[Pe.SEARCH])})`}goToPage(t){let i=Number(t);if(isNaN(i)){console.debug("goToPage target is not a number",t);return}this.scrollController.moveToPage(i)}onPageInputBlur(){this.pageNoFormControl.value||this.pageNoFormControl.setValue(this.currentPageNo),this.pageNoFormControl.value!==this.currentPageNo&&this.goToPage(this.pageNoFormControl.value)}onClickSearchButton(){this.toggleSearchTool()}toggleSearchTool(){if(!(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)||!this.doc)){if(K.get(ie.QUICK_SEARCH_BUTTON)){this.store$.dispatch(ue.set({key:"searchToolActive",value:!this.searchToolActive}));return}this.rightSideViewVisible&&this.rightSideViewMode===Rt.TextSearch?this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})):(this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})))}}get zoomInTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_IN")} (${ei.getShortcutString(Ui[Pe.INCREASE_ZOOM_NUMPAD])})`}get zoomOutTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_OUT")} (${ei.getShortcutString(Ui[Pe.DECREASE_ZOOM_NUMPAD])})`}zoomIn(t){this.setScale(J.calculateNextScale(this.scale,!0),!0)}zoomOut(t){this.setScale(J.calculateNextScale(this.scale,!1),!0)}setScale(t,i=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,i)}onScaleMenuClick(){this.scaleMenuRef?.toggleMenu()}onConfirmScaleInput(){this.changeScaleDropdown(this.scaleFormControl.value)}convertToScalePreset(t){return{label:`${t}%`,command:()=>this.changeScaleDropdown(t)}}onMoreMenuButtonClick(){this.iconMenuRef&&this.iconMenuRef.toggleMenu()}onDragToolMenuExpandClick(){this.dragToolMenuRef?.toggleMenu()}onRightMenuClick(){this.rightMenuRef?.toggleMenu()}onToolbarMenuClick(t){this.mainMenuRef?.closeMenu(),this.iconMenuRef?.closeMenu(),this.dragToolMenuRef?.closeMenu(),this.sideViewMenuRef?.closeMenu(),this.rightMenuRef?.closeMenu(),this.viewerService.toggleSubToolbar(t)}zoom(t){this.setZoom(this.scale+t)}setZoom(t,i=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,i)}fitToWidth(){this.contentService.requestViewChange({fitMode:0}),this.activeFitMode=0,this.changeDetectorRef.markForCheck()}fitToWidthForStatistics(t){this.fitToWidth()}fitToHeight(){this.contentService.requestViewChange({fitMode:1}),this.activeFitMode=1,this.changeDetectorRef.markForCheck()}fitToHeightForStatistics(t){this.fitToHeight()}rotate(t){this.contentService.requestViewChange({degree:this.degree+t})}rotateForStatistics(t,i){this.rotate(i)}saveDoc(t,i){this.changeService.saveDocumentForStatistics(fe.SAVE_DOCUMENT_BY_BUTTON,void 0,t,i)}downloadDoc(){this.downloadService.downloadDocument()}printDoc(){this.dialogService.toggleDialogVisibility($i.PRINT,!0)}changeViewMode(t){this.viewMode!==t&&this.contentService.requestViewChange({viewMode:t})}changeViewModeForStatistics(t,i){this.changeViewMode(i)}dragModeClicked(t){t&&(this.store$.dispatch(ue.set({key:"dragMode",value:t})),this.store$.dispatch(Ki.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor())}dragModeClickedForStatistics(t,i){this.dragModeClicked(i)}getSelectedDragMode(){let t=this.dragToolMenus[0]?.menus?.find(i=>i.mode===this.dragMode);return w.isDefined(t)?t:this.dragToolMenus[0].menus[0]}toggleDapView(){this.rightSideViewMode===Rt.DAP?this.rightSideViewVisible?this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})):this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})):(this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.DAP})))}onClickCustomUI(t,i){t.onclick(Qn.simplifyMouseEvent(i))}resize(){this.mainMenuRef!==void 0&&this.mainMenuRef.closeMenu(),this.render()}render(t=!0){this.buildMenu(),t&&this.changeDetectorRef.markForCheck()}buildMenu(){this.mainMenus=this.menuService.buildMainMenu(this),this.subToolbarMenus=this.buildSubToolbarMenu(),this.iconMenus=this.buildIconMenu(),this.dragToolMenus=this.buildDragToolMenu(),this.rightMenus=[{items:this.menuService.buildRightMenu()}],this.disableMenuWhenNoDoc(),this.changeDetectorRef.markForCheck()}disableMenuWhenNoDoc(){this.doc||[...this.mainMenus].forEach(t=>{t.items.forEach(i=>{["PREFERENCES","SLIDESHOW"].map(n=>this.translatePipe.transform(n)).includes(i.label)||(i.disabled=!0)})})}buildDragToolMenu(){let t=[];return K.get(ie.DRAG_MODE_MOVE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DRAG_MODE_MOVE]&&t.push({mode:Pt.MOVE,icon:"papycon papycon-hand",action:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SCROLL_MODE_BY_BUTTON,Pt.MOVE),isActive:()=>this.dragMode===Pt.MOVE,tooltip:this.translatePipe.transform("SCROLL_MODE")}),K.get(ie.DRAG_MODE_SELECT_TEXT_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DRAG_MODE_SELECT_TEXT]&&t.push({mode:Pt.SELECT_TEXT,icon:"papycon papycon-selection-annotation-text",action:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SELECT_TEXT_BY_BUTTON,Pt.SELECT_TEXT),isActive:()=>this.dragMode===Pt.SELECT_TEXT,tooltip:this.translatePipe.transform("SELECT_TEXT"),disabled:!this.doc}),K.get(ie.DRAG_MODE_MAGNIFY_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DRAG_MODE_ZOOM]&&!G.isTouchableDevice()&&t.push({mode:Pt.MAGNIFY,icon:"papycon papycon-area-zoom2",action:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_MAGNIFY_TOOL_BY_BUTTON,Pt.MAGNIFY),isActive:()=>this.dragMode===Pt.MAGNIFY,tooltip:this.translatePipe.transform("MAGNIFY_TOOL")}),[{menus:t,align:"center"}]}buildIconMenu(){let t=[];return K.get(ie.VIEW_MODE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_VIEW_MODE]&&t.push({label:this.translatePipe.transform("PAGE_DISPLAY"),align:G.isSmallWidth()?"justify":"left",wrap:G.isSmallWidth()?"wrap":"nowrap",menus:[{icon:"papycon papycon-one-page3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_ONE,0),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===0,tooltip:this.translatePipe.transform("SINGLE_PAGE_VIEW"),disabled:!1},{icon:"papycon papycon-one-page-continuous3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_ONE_C,1),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===1,tooltip:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS"),disabled:!1},{icon:"papycon papycon-two-page3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_TWO,2),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===2,tooltip:this.translatePipe.transform("TWO_PAGE_VIEW"),disabled:!1},{icon:"papycon papycon-two-page-continuous3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_TWO_C,3),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===3,tooltip:this.translatePipe.transform("TWO_PAGE_CONTINUOUS"),disabled:!1}]}),K.get(ie.ROTATION_BUTTON)&&!this.hidableMenus[B.TOOLBAR_ROTATE]&&t.push({label:this.translatePipe.transform("ROTATE"),align:G.isSmallWidth()?"justify":"left",menus:[{icon:"papycon papycon-reverse",action:()=>(this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_BUTTON,-90),!0),tooltip:this.translatePipe.transform("ROTATE_CCW"),disabled:this.isEbookMode()},{icon:"papycon papycon-rotate",action:()=>(this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_BUTTON,90),!0),tooltip:this.translatePipe.transform("ROTATE_CW"),disabled:this.isEbookMode()}]}),this.doc||t.forEach(i=>{let e=["PAGE_DISPLAY"].map(n=>this.translatePipe.transform(n));w.isDefined(i.label)&&e.includes(i.label)||i.menus.forEach(n=>n.disabled=!0)}),t}buildSubToolbarMenu(){let t={items:[]};return this.canShowAnnotToolbar&&t.items.push({label:this.translatePipe.transform("ANNOTATE"),command:()=>this.onToolbarMenuClick(lt.ANNOTATE),data:lt.ANNOTATE}),t.items.push({label:this.translatePipe.transform("TOOLBAR_REDACT"),command:()=>this.onToolbarMenuClick(lt.REDACT),data:lt.REDACT}),[t]}publishScale(t,i){this.contentService.requestViewChange({scale:t,checkScale:i})}subscribeZoomHotkey(){this.subscriptionService.push(ut(this.shortcutService.getShortcutEvent(Pe.INCREASE_ZOOM),this.shortcutService.getShortcutEvent(Pe.INCREASE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Pe.INCREASE_ZOOM)}}),ut(this.shortcutService.getShortcutEvent(Pe.DECREASE_ZOOM),this.shortcutService.getShortcutEvent(Pe.DECREASE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Pe.DECREASE_ZOOM)}}),ut(this.shortcutService.getShortcutEvent(Pe.RESTORE_ZOOM),this.shortcutService.getShortcutEvent(Pe.RESTORE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Pe.RESTORE_ZOOM)}}))}subscribeUndoRedo(){this.subscriptionService.push(this.actionHistoryService.availableUndoCount$.pipe(F(()=>K.get(xt.UNDO_REDO_BUTTONS))).subscribe({next:t=>{this.canUndo=t>0;let i=this.mainMenus[0]?.items.find(e=>e.label===this.translatePipe.transform("UNDO"));this.mainMenus.length&&G.width<640&&w.isDefined(i)&&(i.disabled=!this.canUndo)}}),this.actionHistoryService.availableRedoCount$.pipe(F(()=>K.get(xt.UNDO_REDO_BUTTONS))).subscribe({next:t=>{this.canRedo=t>0;let i=this.mainMenus[0]?.items.find(e=>e.label===this.translatePipe.transform("REDO"));this.mainMenus.length&&G.width<640&&w.isDefined(i)&&(i.disabled=!this.canRedo)}}),this.shortcutService.getShortcutEvent(Pe.UNDO_ACTION).pipe(F(()=>K.get(ie.SHORTCUT_UNDO_REDO))).subscribe({next:t=>{if(t.preventDefault(),this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()}}),ut(this.shortcutService.getShortcutEvent(Pe.REDO_ACTION),this.shortcutService.getShortcutEvent(Pe.REDO_ACTION2)).pipe(F(()=>K.get(ie.SHORTCUT_UNDO_REDO))).subscribe({next:t=>{if(t.preventDefault(),this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()}}))}subscribePrint(){this.subscriptionService.push(this.shortcutService.getShortcutEvent(Pe.PRINT).subscribe({next:t=>{if(t.preventDefault(),K.get(ie.SHORTCUT_PRINT)&&K.get(xt.PRINT_DIALOG)&&this.hasPrintPermission&&!this.hidableMenus[B.TOOLBAR_PRINT]){this.dialogService.toggleDialogVisibility($i.PRINT,!0);return}this.toastService.create({toastStyle:Wt.FAILURE,header:this.translatePipe.transform("INFO"),content:this.translatePipe.transform("NO_PRINT_PERMISSION")})}}))}get isMainMenuVisible(){return!this.hidableMenus[B.TOOLBAR_LEFT]&&this.mainMenus.length>0}get isSideMenuVisible(){return this.isSideViewButtonVisible||this.isQuickActionButtonVisible||this.isCaptureModeButtonVisible}get isSideViewButtonVisible(){return(this.isDAP?K.get(ie.THUMBNAIL_VIEW_BUTTON):K.get(xt.LEFT_SIDE_VIEW_BUTTON))&&!this.isSpreadsheets&&this.sideViewMenus[0]?.items.length>0}get isQuickActionButtonVisible(){return K.get(ie.QUICK_ACTION_BUTTON)&&!this.hidableMenus[B.TOOLBAR_QUICK_ACTION]&&!this.isSpreadsheets&&!G.isSmallWidth()}get isCaptureModeButtonVisible(){return K.get(ie.CAPTURE_MODE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_CAPTURE_MODE]&&!this.isSpreadsheets&&!G.isSmallWidth()}get isScaleMenuVisible(){return K.get(ie.SCALE_DROPDOWN)&&!this.hidableMenus[B.TOOLBAR_ZOOM]&&!this.isLessThanDesktopWidth}get isPageMenuVisible(){return K.get(ie.PAGE_NAVIGATION)&&!this.isLessThanDesktopWidth}get isSearchMenuVisible(){return K.get(xt.SEARCH_BUTTON)}get isFitMenuVisible(){return K.get(ie.FIT_BUTTON)&&!this.hidableMenus[B.TOOLBAR_SCREEN_FIT]&&!this.isEbookMode()&&!this.isSpreadsheets}get isViewModeVisible(){return K.get(xt.VIEW_MODE_BUTTON)&&this.iconMenus.length>0&&!this.isSpreadsheets}get isDragModeMenuVisible(){return K.get(xt.DRAG_MODE_BUTTONS)&&this.hasDragTools&&this.hidableDragMode&&!this.isEbookMode()&&!this.isSpreadsheets}get isDapButtonVisible(){return K.get(xt.DAP_VIEW)&&K.get(ie.DAP_VIEW_BUTTON)&&this.isDAP&&!this.isLessThanMobileWidth&&!this.isSpreadsheets}initRegisterQuickActions(){this.quickActionService.registerActions([{id:ve.FIT_TO_WIDTH,actionFn:()=>this.fitToWidthForStatistics(fe.CHANGE_ZOOM_TO_FIT_BY_QUICK_SEARCH)},{id:ve.FIT_TO_HEIGHT,actionFn:()=>this.fitToHeightForStatistics(fe.CHANGE_ZOOM_TO_FIT_BY_QUICK_SEARCH)},{id:ve.SINGLE_PAGE_VIEW,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_SINGLE_PAGE_VIEW_BY_QUICK_SEARCH,0)},{id:ve.SINGLE_PAGE_CONTINUOUS,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_SINGLE_PAGE_CONTINUOUS_BY_QUICK_SEARCH,1)},{id:ve.TWO_PAGE_VIEW,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_TWO_PAGE_VIEW_BY_QUICK_SEARCH,2)},{id:ve.TWO_PAGE_CONTINUOUS,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_TWO_PAGE_CONTINUOUS_BY_QUICK_SEARCH,3)},{id:ve.ROTATE_CCW,actionFn:()=>this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_QUICK_SEARCH,-90)},{id:ve.ROTATE_CW,actionFn:()=>this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_QUICK_SEARCH,90)},{id:ve.SCROLL_MODE,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SCROLL_MODE_BY_QUICK_SEARCH,Pt.MOVE)},{id:ve.SELECT_TEXT,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SELECT_TEXT_BY_QUICK_SEARCH,Pt.SELECT_TEXT)},{id:ve.MAGNIFY_TOOL,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_MAGNIFY_TOOL_BY_QUICK_SEARCH,Pt.MAGNIFY)},{id:ve.SELECT_ANNOT_TOOL,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SELECT_ANNOT_TOOL_BY_QUICK_SEARCH,Pt.SELECT_ANNOT)}])}enableFormControl(){this.pageNoFormControl.enable(),this.scaleFormControl.enable({emitEvent:!1})}disableFormControl(){this.pageNoFormControl.disable(),this.scaleFormControl.disable({emitEvent:!1})}closeSideViewToolbar(){this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),this.isOpenedSideView=!1}undoDragMode(){this.store$.dispatch(ue.set({key:"dragMode",value:this.previousDragMode})),this.store$.dispatch(Ki.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor()}changeScaleDropdown(t){let i=typeof t=="string"?Number.parseFloat(t):t;this.setZoom(Number.isNaN(i)?this.scale:i)}changeZoomByShortcut(t){switch(t){case Pe.INCREASE_ZOOM:case Pe.INCREASE_ZOOM_NUMPAD:this.setZoom(J.calculateNextScale(this.scale,!0),!0);break;case Pe.DECREASE_ZOOM:case Pe.DECREASE_ZOOM_NUMPAD:this.setZoom(J.calculateNextScale(this.scale,!1),!0);break;case Pe.RESTORE_ZOOM:case Pe.RESTORE_ZOOM_NUMPAD:this.zoom(100-this.scale);break}}onSubToolbarMenuClick(){this.subToolbarRef?.toggleMenu()}};N(ss,"\u0275fac",function(i){return new(i||ss)(_(at),_(ri),_(jr),_(Pn),_(Ae),_(tr),_(ct),_(Ko),_(an),_(sn),_(ee),_(eo),_(Ni),_(ye),_(He),_(En),_(Xo),_(Wr),_(to),_(Np),_(zt),_(Zt),_(ln),_(Di),_(Mo),_(Kr),_(zi),_(Qt))}),N(ss,"\u0275cmp",Ce({type:ss,selectors:[["sd-toolbar"]],viewQuery:function(i,e){if(i&1&&(Ye(Sf,5),Ye(bf,5),Ye(Cf,5),Ye(xf,5),Ye(Tf,5),Ye(Of,5),Ye(wf,5)),i&2){let n;Me(n=Re())&&(e.mainMenuRef=n.first),Me(n=Re())&&(e.subToolbarRef=n.first),Me(n=Re())&&(e.sideViewMenuRef=n.first),Me(n=Re())&&(e.iconMenuRef=n.first),Me(n=Re())&&(e.dragToolMenuRef=n.first),Me(n=Re())&&(e.rightMenuRef=n.first),Me(n=Re())&&(e.scaleMenuRef=n.first)}},inputs:{doc:"doc"},standalone:!1,features:[xe([tr,ee,{provide:qn,useValue:new Ht(300)}]),tn],decls:4,vars:4,consts:[["sideViewMenuRef",""],["subToolbarRef",""],["scaleMenuRef",""],["iconMenuRef",""],["rightMenuRef",""],["class","left",4,"ngIf"],["class","center",4,"ngIf"],["class","right",4,"ngIf"],[4,"ngIf"],[1,"left"],["class","side-menu-container",4,"ngIf"],["class","divider",4,"ngIf"],[1,"toolbar-menu-container"],["class","ep-text-button custom-ui",3,"dark","title","tooltip","click",4,"ngFor","ngForOf"],[1,"sub-toolbar-container"],[1,"side-menu-container"],[1,"ep-text-button","side-view-menu",3,"click","mousedown","touchstart","tooltip"],["class","side-view-menu",3,"size","menus",4,"ngIf"],[1,"side-view-menu",3,"size","menus"],[1,"divider"],[1,"logo-container"],[3,"src"],[1,"ep-text-button","custom-ui",3,"click","title","tooltip"],[3,"ngClass"],[1,"ep-text-button","tool-button",3,"active"],[1,"ep-text-button","tool-button",3,"click","mousedown","touchstart"],["color","dark",1,"ep-text-button","subtoolbar-menu-button",3,"click","mousedown","touchstart"],[1,"papycon","papycon-chevron3-down"],[3,"menus"],[1,"center"],[1,"scale-menus"],[1,"page-menus"],["aria-controls","search-tool",1,"ep-text-button","search-button",3,"dark","disabled","title","tooltip"],[1,"more-menu-container"],[1,"ep-text-button",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-minus"],[1,"scale-dropdown"],["type","text","maxlength","4",3,"keyup.enter","blur","disabled","formControl"],[1,"ep-text-button",3,"click"],[1,"papycon","papycon-plus"],["size","tiny","align","left",1,"current-page-index",3,"keydown.enter","blur","autoResize","maxLength","formControl","ariaLabel"],[1,"page-label"],["aria-controls","search-tool",1,"ep-text-button","search-button",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-search"],[1,"ep-text-button","more-button",3,"click","mousedown","touchstart","title","tooltip"],[1,"papycon","papycon-chevron3-down","expand-icon"],[1,"more-menu",3,"iconMenus","isMobile","isDarkMode"],[1,"right"],[1,"file-menus"],["class","ep-text-button dap-button",3,"dark","tooltip","click","mousedown","touchstart",4,"ngIf"],["class","ep-text-button print",3,"dark","disabled","title","tooltip","click",4,"ngIf"],["class","ep-text-button download",3,"dark","disabled","title","tooltip","click",4,"ngIf"],[1,"ep-text-button","print",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-print"],[1,"ep-text-button","download",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-download"],[1,"ep-text-button",3,"click","mousedown","touchstart","title","tooltip"],[1,"papycon","papycon-more-symbol3"],[3,"size","menus"],[1,"ep-text-button","dap-button",3,"click","mousedown","touchstart","tooltip"],[1,"papycon","papycon-composite-document"],[1,"side-view-toolbar"],[1,"close"],[1,"ep-text-button","close-button",3,"click","title"],[1,"papycon","papycon-cross"],[1,"side-view-toolbar-menu-container"],[4,"ngFor","ngForOf"],[1,"ep-text-button",3,"click","title","disabled"]],template:function(i,e){i&1&&se(0,Ff,9,6,"section",5)(1,zf,7,6,"section",6)(2,Zf,3,2,"section",7)(3,tm,10,10,"ng-container",8),i&2&&(O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_LEFT]),x(),O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_CENTER]),x(),O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_RIGHT]),x(),O("ngIf",e.isLessThanMobileWidth&&e.isOpenedSideView))},dependencies:[Oo,yi,bt,xs,wn,oa,Vn,Jl,ip,Ts,wo,He],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}[_nghost-%COMP%]{position:relative;display:flex;justify-content:space-between;box-sizing:border-box;background:var(--mono-00);border-bottom:1px solid var(--mono-30);z-index:3}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon){border-width:0;outline-offset:-2px;padding:2px}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon)   i.papycon-chevron3-down[_ngcontent-%COMP%]{font-size:12px}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon)   i.papycon[_ngcontent-%COMP%]:not(.papycon-chevron3-down){font-size:20px}section[_ngcontent-%COMP%]{display:flex}section[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{width:1px;background-color:var(--mono-30);margin:8px 0}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]{position:relative;display:flex}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 16px}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover, section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;min-width:148px}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]     .menu .division-line .line, section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]     .menu .division-line .line{background-color:var(--mono-30)}section.left[_ngcontent-%COMP%]   div.main-menu-container.main-menu[_ngcontent-%COMP%]     pu-menu .menu-item, section.left[_ngcontent-%COMP%]   div.side-menu-container.main-menu[_ngcontent-%COMP%]     pu-menu .menu-item{padding-right:24px}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:0}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{margin-right:16px}section.left[_ngcontent-%COMP%]   i.papycon-chevron3-down[_ngcontent-%COMP%]{color:var(--mono-70)}section.left[_ngcontent-%COMP%]   .logo-container[_ngcontent-%COMP%]{padding:0 16px;height:100%;display:flex;align-items:center}section.left[_ngcontent-%COMP%]   .logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:24px;max-width:100px;object-fit:fill;-webkit-user-select:none;user-select:none;pointer-events:none}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]{margin:0 16px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]   .subtoolbar-menu-button[_ngcontent-%COMP%]{padding:8px;height:29px;display:flex;gap:4px;align-items:center;border-radius:6px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{top:100%;left:0}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]{padding:8px 12px;outline-offset:-2px;border-width:0}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.tool-button[_ngcontent-%COMP%]{margin:6.5px 0;border-radius:6px;font-size:13px;line-height:1}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.custom-ui[_ngcontent-%COMP%]{margin:auto 16px;padding:2px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.active[_ngcontent-%COMP%]{background-color:#f166251a}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{display:flex;align-items:center}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:14px}section.center[_ngcontent-%COMP%]{display:flex;column-gap:12px;align-items:center;height:100%;position:absolute;left:50%;transform:translate(-50%)}section.center[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{display:none;height:26px}section.center[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + .divider[_ngcontent-%COMP%]{display:block}section.center[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.center[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.center[_ngcontent-%COMP%]   div.scale-menus[_ngcontent-%COMP%]{display:flex;align-items:center;column-gap:8px}section.center[_ngcontent-%COMP%]   div.page-menus[_ngcontent-%COMP%]{display:flex;align-items:center}section.center[_ngcontent-%COMP%]   div.page-menus[_ngcontent-%COMP%]   pu-input.current-page-index[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--input);border-radius:2px;box-sizing:content-box}section.center[_ngcontent-%COMP%]   div.page-menus[_ngcontent-%COMP%]   div.page-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);white-space:pre}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]{display:flex;position:relative;box-sizing:border-box;padding:3px 4px 3px 10px;width:70px;border:1px solid var(--mono-30);border-radius:4px;background-color:var(--input-background)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]:has(input:focus){border-color:var(--primary-50)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;font-size:14px;line-height:24px;padding:0;width:100%;border:0;-webkit-appearance:none;appearance:none;caret-color:var(--primary-50);background-color:var(--input-background);color:var(--input)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:0}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:transparent}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0;color:var(--input)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0}section.center[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;height:100%}section.center[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;height:34px}section.center[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]   pu-icon-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0}section.right[_ngcontent-%COMP%]{position:relative;margin-right:16px;height:100%}section.right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   i.papycon-chevron3-down[_ngcontent-%COMP%]{color:var(--mono-70)}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]   button.toolbar-menu-button[_ngcontent-%COMP%]{position:relative}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]   pu-menu.toolbar-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:calc(100% - 51px);min-width:120px}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative;margin-left:24px}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}@media screen and (max-width: 991px){section.center[_ngcontent-%COMP%]{position:unset;left:0;transform:none;margin-left:auto}section.right[_ngcontent-%COMP%]{margin-left:0;margin-right:0}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{margin:auto 12px;height:100%}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{top:100%;right:0}}@media screen and (max-width: 575px){section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]{margin:0}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 8px}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{margin-right:8px}section.center[_ngcontent-%COMP%]{left:0;position:relative;margin-right:6px}section.center[_ngcontent-%COMP%]   button.fit[_ngcontent-%COMP%]{display:none}section.center[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] + div[_ngcontent-%COMP%]{margin-left:20px}section.center[_ngcontent-%COMP%]   div.spreadsheets-zoom-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px}section.side-view-toolbar[_ngcontent-%COMP%]{background:var(--mono-00);position:absolute;width:100%;height:100%}section.side-view-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:auto 12px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]{position:relative;display:flex;overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 12px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]{width:24px;height:24px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button.expandable[_ngcontent-%COMP%]{margin-right:0}}"],changeDetection:0}));var mn=ss;ze([ot(it.floatingNavComp.changeZoom,1e3)],mn.prototype,"zoomIn",null);ze([ot(it.floatingNavComp.changeZoom,1e3)],mn.prototype,"zoomOut",null);ze([ot(it.mainToolbarComp.changeZoomToFit,1e3)],mn.prototype,"fitToWidthForStatistics",null);ze([ot(it.mainToolbarComp.changeZoomToFit,1e3)],mn.prototype,"fitToHeightForStatistics",null);ze([ot(it.mainToolbarComp.rotateForStatistics,1e3)],mn.prototype,"rotateForStatistics",null);ze([ot(it.mainToolbarComp.changeViewModeForStatistics)],mn.prototype,"changeViewModeForStatistics",null);ze([ot(it.mainToolbarComp.dragModeClickedForStatistics)],mn.prototype,"dragModeClickedForStatistics",null);ze([ot(it.mainToolbarComp.changeScaleDropdown)],mn.prototype,"changeScaleDropdown",null);ze([ot(it.mainToolbarComp.changeZoomByShortcut,1e3)],mn.prototype,"changeZoomByShortcut",null);var Rd=(()=>{let t=class t{};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({providers:[Kr,Mo],imports:[on,Nr,yn,Zl,Vr,np,kr,_a]}));let s=t;return s})();var as=(()=>{let t=class t{baseHref;http;downloadService;latestVersion=Ze.sdPluginVersion;sdAgentEnableHTTPS=Ze.sdAgentEnableHTTPS;sdAgentURLScheme=this.sdAgentEnableHTTPS?"https://":"http://";sdAgentURLPrefix=`${this.sdAgentURLScheme}127.0.0.1:`;sdAgentHeaders;sdAgentHttpPorts=[13980,23980,33980];sdAgentHttpsPorts=[13981,23981,33981];constructor(e,n,r){this.baseHref=e,this.http=n,this.downloadService=r,this.sdAgentHeaders={"Papyrus-Module":Ze.sdAgentModule,"Content-Type":"application/x-www-form-urlencoded"}}reqAgent(e,n){let r=this.sdAgentEnableHTTPS?this.sdAgentHttpsPorts:this.sdAgentHttpPorts,c=r.length;return new wt(g=>{let v=()=>{c||g.error();let y=`${this.sdAgentURLPrefix}${r[r.length-c]}${e}`;this.http.post(y,n,{observe:"response",responseType:"text",headers:this.sdAgentHeaders}).subscribe({next:M=>{g.next(M),g.complete()},error:M=>{--c>0?setTimeout(v,100):g.error(M)}})};v()})}checkVersion(){return this.reqAgent("/version/info",w.EMPTY_STRING)}print(e,n,r,c,g,v,y){let M=new Il().set("host",e).set("path",n).set("port",r).set("protocol",c).set("hide-timestamp",String(!Ze.printTimestampInPlugin)).set("current-page-index",v).set("withoutDialog",String(Ze.printWithoutDialogInPlugin)).set("open-without-memory",String(Ze.openWithoutMemory));return Number.isNaN(Ze.defaultPluginPrintScale)||(M=M.set("print-scale",Ze.defaultPluginPrintScale)),w.isDefined(y)&&(M=M.set("pageRange",y)),Dr.token?.accessToken&&(document.cookie=`accessToken=${Dr.token.accessToken}`,M=M.set("cookie",document.cookie)),g&&(M=M.set("timestamp-status",g)),this.reqAgent("/print/execute",M.toString())}isLatestVersion(e){let n=e.match(/(\d+)\.(\d+)\.(\d+).*/)?.slice(1,4),r=this.latestVersion.split(".");if(n===void 0||!n.every(this.isValidPart)||!r.every(this.isValidPart)||n.length!==r.length)return!1;let c=n.map(Number),g=r.map(Number);for(let v=0;v<c.length;++v){if(g.length===v)return!0;if(c[v]!==g[v])return c[v]>g[v]}return!0}isValidPart(e){return/^\d+$/.test(e)}downloadSDAgent(){let e=`${this.baseHref}v4/resources/sdagent-modern`;this.downloadService.executeFileDownloader(e)}};N(t,"\u0275fac",function(n){return new(n||t)(Ue(Ml),Ue(Al),Ue(Ko))}),N(t,"\u0275prov",di({token:t,factory:t.\u0275fac}));let s=t;return s})();var yy=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[as]}}};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({}));let s=t;return s})();var Mc=(()=>{let t=class t{modalParam;modalService;agentService;portalRef;subscriptionService;get status(){return this.modalParam.status}constructor(e,n,r,c,g){this.modalParam=e,this.modalService=n,this.agentService=r,this.portalRef=c,this.subscriptionService=g}ngOnInit(){this.subscriptionService.push(Ge(window,"keydown",{capture:!0}).pipe(F(e=>e.key==="Escape"),F(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.onButtonClick(!1)}))}onButtonClick(e){e&&this.agentService.downloadSDAgent(),this.portalRef.dispose()}};N(t,"\u0275fac",function(n){return new(n||t)(_(ea),_(rn),_(as),_(ta),_(ee))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-module-download"]],standalone:!1,features:[xe([ee])],decls:16,vars:18,consts:[["color","grey","size","tiny",1,"ep-button",3,"click"],["color","primary","size","small",1,"ep-button",3,"click"]],template:function(n,r){n&1&&(A(0,"h3"),be(1),Y(2,"translate"),D(),A(3,"main")(4,"div"),be(5),Y(6,"translate"),D(),A(7,"button",0),Y(8,"translate"),ce("click",function(){return r.onButtonClick(!0)}),be(9),Y(10,"translate"),D()(),A(11,"footer")(12,"button",1),Y(13,"translate"),ce("click",function(){return r.onButtonClick(!1)}),be(14),Y(15,"translate"),D()()),n&2&&(x(),Ee(X(2,6,r.status==="notInstall"?"INSTALL_PLUGIN":"UPDATE_PLUGIN")),x(4),Ee(X(6,8,r.status==="notInstall"?"NO_PRINT_PLUGIN":"NEW_VERSION_AVAILABLE")),x(2),ge("aria-label",X(8,10,"DOWNLOAD")),x(2),Ee(X(10,12,"DOWNLOAD")),x(3),ge("aria-label",X(13,14,"OK")),x(2),Ee(X(15,16,"OK")))},dependencies:[He],styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0}main[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:var(--mono-70);white-space:pre-wrap}main[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:20px}footer[_ngcontent-%COMP%]{text-align:right;margin-top:32px}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--mono-00)}"],changeDetection:0}));let s=t;return s})();function om(s,t){if(s&1){let i=Se();A(0,"section",9)(1,"pu-radio-group"),Y(2,"translate"),A(3,"pu-radio-button",10),Y(4,"translate"),Ai("ngModelChange",function(n){W(i);let r=E(3);return Ii(r.pageOption,n)||(r.pageOption=n),z(n)}),D(),A(5,"pu-radio-button",11),Y(6,"translate"),Ai("ngModelChange",function(n){W(i);let r=E(3);return Ii(r.pageOption,n)||(r.pageOption=n),z(n)}),D()(),A(7,"span",12),be(8),Y(9,"translate"),D(),A(10,"pu-input",13),Y(11,"translate"),Ai("ngModelChange",function(n){W(i);let r=E(3);return Ii(r.pageRange,n)||(r.pageRange=n),z(n)}),D()()}if(s&2){let i=E(3);x(),ge("aria-label",X(2,12,"SELECT_PRINT_RANGE")),x(2),O("label",X(4,14,"ALL")),Ri("ngModel",i.pageOption),x(2),O("label",X(6,16,"SPECIFY_PRINT_RANGE")),Ri("ngModel",i.pageOption),x(2),$e("disabled",i.pageOption!=="partial"),x(),Ee(X(9,18,"RANGE")),x(2),O("ariaLabel",X(11,20,"RANGE"))("disabled",i.pageOption!=="partial")("placeholder",i.pageRangePlaceholder),Ri("ngModel",i.pageRange)}}function rm(s,t){if(s&1&&(se(0,om,12,22,"section",8),Y(1,"async")),s&2){let i=E(2);O("ngIf",!X(1,1,i.donePrint))}}function sm(s,t){s&1&&(A(0,"section",9)(1,"span",14),be(2),Y(3,"translate"),D()()),s&2&&(x(2),Ee(X(3,1,"DONE_PRINT_MODAL")))}function am(s,t){if(s&1){let i=Se();A(0,"button",15),ce("click",function(){W(i);let n=E(2);return z(n.onClose())}),be(1),Y(2,"translate"),D(),A(3,"button",16),Y(4,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.onConfirm(!0))}),be(5),Y(6,"translate"),D()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),x(),Ee(X(2,5,"CANCEL")),x(2),ge("aria-label",X(4,7,"PRINT")),x(2),Ee(X(6,9,"PRINT"))}}function cm(s,t){if(s&1){let i=Se();A(0,"button",17),Y(1,"translate"),ce("click",function(){W(i);let n=E(2);return z(n.onClose(!0))}),be(2),Y(3,"translate"),D()}s&2&&(ge("aria-label",X(1,2,"CLOSE")),x(2),Ee(X(3,4,"CLOSE")))}function lm(s,t){if(s&1){let i=Se();A(0,"pu-dialog",7),Y(1,"async"),Y(2,"async"),Y(3,"translate"),ce("close",function(){W(i);let n=E();return z(n.onClose())}),se(4,rm,2,3,"ng-template",null,0,Li)(6,sm,4,3,"ng-template",null,1,Li)(8,am,7,11,"ng-template",null,2,Li)(10,cm,4,6,"ng-template",null,3,Li),D()}if(s&2){let i=wi(5),e=wi(7),n=wi(9),r=wi(11),c=E();O("bodyTemplate",X(1,3,c.donePrint)?e:i)("footerTemplate",X(2,5,c.donePrint)?r:n)("header",X(3,7,"PRINT"))}}function pm(s,t){if(s&1){let i=Se();A(0,"div")(1,"img",18),ce("load",function(){W(i);let n=E();return z(n.onLoad())})("error",function(n){W(i);let r=E();return z(r.onError(n))}),D()()}if(s&2){let i=t.$implicit;x(),ge("src",i,Sn)}}var cs=class cs{elementRef;annotService;acroFormService;contentService;changeDetectorRef;dataService;modalService;toastService;agentService;pageService;changeService;documentService;subscriptionService;dapService;store$;translatePipe;dialogService;downloadService;apiEventBridgeService;authService;printService;invisibleTracerService;muPDFService;renderingService;signatureService;PRINT_PROGRESS_RATIO=80;get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}get lastCommonModal(){return(this.modalService.lastModal?.instance).nestedRef?.instance}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}doc;immediatePrintConfig;finish=new Fo;currentPageNo=0;pageOption="all";pageRange=w.EMPTY_STRING;printImagesDataUrls=[];_dialogVisible=!0;tempDocId="";enablePdfPages=[];pageNumbers=[];nLoadedImage=0;pageDescriptions=[];dominantPageOrientation="portrait";dejavuToken="";tracerImageUrl="";screenTheme="light";constructor(t,i,e,n,r,c,g,v,y,M,V,Z,le,pe,he,Te,p,dt,vt,gt,Mi,At,li,mi,Oe){this.elementRef=t,this.annotService=i,this.acroFormService=e,this.contentService=n,this.changeDetectorRef=r,this.dataService=c,this.modalService=g,this.toastService=v,this.agentService=y,this.pageService=M,this.changeService=V,this.documentService=Z,this.subscriptionService=le,this.dapService=pe,this.store$=he,this.translatePipe=Te,this.dialogService=p,this.downloadService=dt,this.apiEventBridgeService=vt,this.authService=gt,this.printService=Mi,this.invisibleTracerService=At,this.muPDFService=li,this.renderingService=mi,this.signatureService=Oe}get dialogVisible(){return this._dialogVisible}get pdfPages(){return this.enablePdfPages.length>0?this.enablePdfPages:this.pageService.originalPdfPages}get pageRangePlaceholder(){return`${this.translatePipe.transform("EX")} 1-5, 8, 11-13`}get openedDialogByApi(){return this.dialogService.openedDialogByApi}get donePrint(){return this.printService.doneEvent$}ngOnInit(){if(this.subscriptionService.push(this.store$.pipe(oi("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>this.currentPageNo=t}),this.documentService.pdfInfo$.pipe(F(t=>t.DocumentType==="DAP")).subscribe({next:()=>this.initDapInfoSubscription()})),this.immediatePrintConfig){this._dialogVisible=!1,this.immediatePrint();return}!K.get(ie.BROWSER_PRINT)&&K.get(ie.PLUGIN_PRINT)&&!this.openedDialogByApi&&(this._dialogVisible=!1,this.onConfirm(!1)),this.dialogVisible&&this.elementRef.nativeElement.focus()}ngOnDestroy(){this.printImagesDataUrls.splice(0)}onConfirm(t){if(!window.print||G.isKakaoInAppBrowser()){this.onClose(),t&&this.authService.deleteCookie("accessToken"),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.ERROR,content:this.translatePipe.transform("NOT_SUPPORTED_BROWSER_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}this.modalService.createCommonModal({type:jt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PREPARING_TO_PRINT")}),this.subscriptionService.set("mainSub",oc(this.documentService.isDAP?this.validateDAPInfo():_n,this.validatePageRange(),this.muPDFService.docRaw===null?this.checkPrintStatus(this.doc.streamdocsId):_n,t?_n:this.checkLatestModuleInstallation(),t&&this.invisibleTracerService.isEnabled?this.prepareInvisibleTracer():_n,this.saveChanges(t),t&&this.muPDFService.docRaw===null?this.getDejavuToken():_n,Co(()=>(this.pdfPages&&this.pdfPages.length!==0&&(this.dominantPageOrientation=this.determineDominantPageOrientation()),_n)),Co(()=>t?this.printUsingBrowser():this.printUsingModule())).subscribe({next:i=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.INFO,content:i||"",confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())},error:i=>{this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:i instanceof Error?i:new ur(`Failed to print. (${i})`)}),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.ERROR,content:i?.message??this.translatePipe.transform("FAILED_TO_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())},complete:()=>{!t||this.muPDFService.docRaw!==null||(this.dataService.getPostPrint(this.tempDocId,this.dejavuToken,this.tempDocId!==this.doc.streamdocsId?this.doc.streamdocsId:void 0).subscribe(),this.authService.deleteCookie("accessToken"))}}))}onClose(t){if(this.dialogService.openedDialogByApi=!1,!t&&(G.isTablet()||G.isMobile()||G.isSamsungBrowser())){this.dialogService.toggleDialogVisibility($i.PRINT,!0),this.printService.finishPrint();return}this.dialogService.toggleDialogVisibility($i.PRINT,!1),this.nLoadedImage=0,this.finish.emit()}onLoad(){++this.nLoadedImage;let t=this.nLoadedImage/this.pageNumbers.length*(100-this.PRINT_PROGRESS_RATIO);this.lastCommonModal?.setProgressValue(this.PRINT_PROGRESS_RATIO+t),this.nLoadedImage===this.pageNumbers.length&&(window.print(),this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!0,data:{status:"PRINTED"}}),this.modalService.lastModal?.dispose(),this.onClose())}onError(t){console.error(this.translatePipe.transform("FAILED_TO_LOAD_IMAGE"),t),this.changeDetectorRef.markForCheck(),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.ERROR,content:this.translatePipe.transform("FAILED_TO_LOAD_DOC_TO_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())}trackByImage(t){return t}immediatePrint(){this.immediatePrintConfig.pageRange&&this.immediatePrintConfig.pageRange!=="all"&&(this.pageRange=this.immediatePrintConfig.pageRange,this.pageOption="partial"),this.onConfirm(!0)}initDapInfoSubscription(){this.subscriptionService.push(this.documentService.pageDescriptions$.pipe(F(w.isDefined)).subscribe({next:t=>{this.pageDescriptions=t,this.calcEnablePages()}}))}calcEnablePages(){let t=[];this.pageService.originalPdfPages.forEach((i,e)=>{this.dapService.isDisabled(this.dapService.getPageRefId(i))&&t.push(e)}),this.enablePdfPages=w.deepClone(this.pageService.originalPdfPages),t.sort((i,e)=>e-i),t.forEach(i=>this.enablePdfPages.splice(i,1))}finishPrint(){this.subscriptionService.get("mainSub")?.unsubscribe(),this.dialogVisible||this.onClose()}validateDAPInfo(){return new wt(t=>{if(!this.pageDescriptions){t.error(new Ul("Printing is temporarily unavailable.")),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.WARN,content:this.translatePipe.transform("FAILED_TO_PRINT_TEMPORARILY"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}if(this.pageDescriptions.reduce((e,n)=>e.includes(n.refId)?e:e.concat(n.refId),[]).every(e=>this.dapService.isDisabled(e))){t.error(new Bl("No document has been selected for printing.")),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.WARN,content:this.translatePipe.transform("ALL_DAP_DISABLED"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}t.complete()})}validatePageRange(){return new wt(t=>{if(this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("CHECKING_PAGE_RANGE")}),this.pageOption!=="all"?(this.pageNumbers=Nn.parse(this.pageRange,{min:1,max:this.pdfPages.length})??[],this.immediatePrintConfig&&this.pageNumbers.length>0&&(this.pageNumbers=this.pageNumbers.map(i=>i+1))):this.pageNumbers=Array.from({length:this.pdfPages.length}).map((i,e)=>e+1),!this.pageNumbers||this.pageNumbers.length===0||this.pageNumbers.filter(i=>!i||i>this.pdfPages.length).length>0){t.error(new Vl(`Invalid page range. (min: 0, max: ${this.pdfPages.length})`)),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.WARN,content:this.translatePipe.transform("INVALID_PAGE_RANGE"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}this.pageNumbers.length>Ze.printCriticalPageLength?(this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.WARN,content:G.isPlatformWindows?this.translatePipe.transform("RECOMMEND_PRINT_PLUGIN"):this.translatePipe.transform("WARN_MANY_PAGES_PRINT"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CONTINUE"),cancelButton:!0}).addOnDisposeListener(i=>{if(!i){this.finishPrint();return}t.complete()})):t.complete()})}checkLatestModuleInstallation(){return new wt(t=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("CHECKING_PRINT_PLUGIN")}),this.agentService.checkVersion().subscribe({next:i=>{if(i.body&&this.agentService.isLatestVersion(i.body)){t.complete();return}t.error(new Fl("Please update the plugin.")),this.modalService.lastModal?.dispose(),this.modalService.createModal(Mc,{status:"needUpdate"}).addOnDisposeListener(()=>this.finishPrint())},error:()=>{t.error(new Ll("The plugin is not installed.")),this.modalService.lastModal?.dispose(),this.modalService.createModal(Mc,{status:"notInstall"}).addOnDisposeListener(()=>this.finishPrint())}})})}prepareInvisibleTracer(){return new wt(t=>{if(!this.invisibleTracerService.isEnabled){t.complete();return}this.invisibleTracerService.printBinary$.subscribe(i=>{if(i?.binary?.type==="BLOB")this.tracerImageUrl=URL.createObjectURL(i.binary.data);else if(i?.binary?.type==="BASE64")this.tracerImageUrl=i?.binary.data??"";else{t.error("Binary data type error(RAW)");return}this.changeDetectorRef.markForCheck(),t.complete()})})}applyChangesForDap(t){return this.store$.pipe(Yo("ALL",!0),en(1),st(i=>kn.hasChanges(i)||this.annotService.hasLog()||this.invisibleTracerService.isEnabled?this.exportChanges({streamdocsId:this.tempDocId},t,!0):_n))}saveChanges(t){return new wt(i=>{if(this.muPDFService.docRaw!==null){this.muPDFService.applyChanges(this.annotService.getActionLog(),this.acroFormService.getActionLog(),()=>{this.annotService.clearActionLogs(),this.acroFormService.clearActionLogs()},this.documentService.openedDocument?.streamdocsId).subscribe({error:e=>i.error(e),complete:()=>i.complete()});return}oc(this.exportChanges(this.doc,t),this.prepareDocument(),this.doc.isDap?this.applyChangesForDap(t):_n,Co(()=>this.contentService.tsaValidation$?this.validateTSA():_n),Co(()=>this.renderingService.renderingMode!==gi.CLIENT?_n:this.openChangedDocument(this.doc))).subscribe({next:e=>i.next(e),error:e=>i.error(e),complete:()=>i.complete()})})}validateTSA(){let{fontName:t,text:i,validity:e}=this.contentService.tsaValidation$,n=this.changeService.exportExtraCommand({streamdocsId:this.tempDocId},[{command:"changeTsaAppearance",argument:[{fontName:t,validity:e,text:this.signatureService.shouldRenderTimeStamp?i:""}]}],{incremental:!1,toTemp:!0});if(n===void 0)throw new ci("Failed to create change observable for document validation.");return n.pipe(rt(r=>this.tempDocId=r.streamdocsId),st(()=>_n))}getNewRotatedImage(t,i){return new wt(e=>{let n=this.getEffectiveRotation(i);if(n===180||n===0)e.next(t),e.complete();else{let r=new Image;r.onload=()=>{let c=document.createElement("canvas"),g=c.getContext("2d");if(g===null){e.error(new _t("Failed to get CanvasRenderingContext2D"));return}c.width=r.height,c.height=r.width,g.translate(c.width/2,c.height/2),g.rotate(n*Math.PI/180),g.drawImage(r,-r.width/2,-r.height/2),e.next(c.toDataURL("image/png")),e.complete()},r.onerror=c=>e.error(c),r.src=t}})}getEffectiveRotation(t){let i=this.pdfPages[t];return this.getEffectivePageOrientation(i)===this.dominantPageOrientation?i.r:(i.r+90)%360}getEffectivePageOrientation(t){let i=Math.abs(t.r%360),e=t.bbox.w>t.bbox.h?"landscape":"portrait";return i===270||i===90?e==="portrait"?"landscape":"portrait":e}determineDominantPageOrientation(){let t=this.pdfPages.length,i=3,e=1,r=i-Math.exp(.05*(t-1)),c=Math.max(e,r),g=1,v={portrait:0,landscape:0};return this.pdfPages.forEach((y,M)=>{v[this.getEffectivePageOrientation(y)]+=M===0?c:g}),v.landscape>v.portrait?"landscape":"portrait"}prepareDocument(){return new wt(t=>{if(!this.documentService.isDAP){t.complete();return}if(this.modalService.lastModal?.dispose(),this.pageDescriptions.reduce((n,r)=>n.includes(r.refId)?n:n.concat(r.refId),[]).every(n=>this.dapService.isDisabled(n))){t.next(this.translatePipe.transform("PRINT_CANCELLED"));return}this.modalService.createCommonModal({type:jt.PROGRESS,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PREPARING_TO_PRINT")});let e=this.downloadService.makeDownloadId(this.tempDocId);e.pipe(F(n=>n.status==="progress")).subscribe({next:n=>{n.action==="split"?this.lastCommonModal?.setProgressValue(Math.round(n.progress??0*50)):n.action==="merge"&&this.lastCommonModal?.setProgressValue(50+Math.round(n.progress??0*50))},error:()=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.ERROR,content:this.translatePipe.transform("FAILED_TO_SPLIT_MERGE_TO_PRINT"),confirmButton:!0})}}),e.pipe(F(n=>n.status==="complete")).subscribe({next:n=>{this.tempDocId=n.id??"",t.complete()}})})}exportChanges(t,i,e=!1){return new wt(n=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:jt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("SAVING_CHANGE_TO_PRINT_DOC")});let r=this.changeService.exportChange(t,{reload:!1,incremental:!1,toTemp:!0,print:!0,afterMergingDap:e,addInvisibleTracer:this.invisibleTracerService.isEnabled&&!i});if(!r){this.tempDocId=t.streamdocsId,n.complete();return}r.pipe(rt(c=>this.tempDocId=c.streamdocsId)).subscribe({next:()=>n.complete(),error:()=>n.error(new ur(this.translatePipe.transform("FAILED_TO_SAVE_TO_PRINT")))})})}getDejavuToken(){return new wt(t=>{this.dataService.getDejavuToken(this.tempDocId).subscribe({next:i=>{if(!i||!i.token){t.error(this.translatePipe.transform("FAILED_TO_PRINT"));return}this.dejavuToken=i.token,t.complete()},error:()=>t.error(this.translatePipe.transform("FAILED_TO_PRINT"))})})}checkPrintStatus(t){return new wt(i=>{this.dataService.checkPrintStatus(t).subscribe({next:()=>i.complete(),error:()=>i.error(new ur(this.translatePipe.transform("FAILED_TO_PRINT_LIMIT_EXCEEDED")))})})}openChangedDocument(t){return new wt(i=>{if(this.tempDocId===t.streamdocsId){i.complete();return}this.dataService.getDocRaw(this.tempDocId).pipe(st(e=>this.muPDFService.call(dc.OPEN_DOCUMENT,e.arrayBuffer,"temp.pdf",this.tempDocId)),pr(e=>(console.error(e),e))).subscribe({next:()=>i.complete(),error:()=>i.error(new ur(this.translatePipe.transform("FAILED_TO_OPEN_CHANGED_DOCUMENT_FOR_PRINT")))})})}printUsingBrowser(){return new wt(t=>{this.modalService.lastModal?.dispose();let i=this.modalService.createCommonModal({type:jt.PROGRESS,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PRINTING"),cancelButton:!0});Dr.token!==null&&this.authService.setCookie("accessToken",Dr.token?.accessToken);let e=this.pageNumbers.map(c=>this.muPDFService.call(dc.GET_PRINT_URL,c-1,!0,Ze.dpiForPrint,this.tempDocId).pipe(st(g=>this.renderingService.renderingMode===gi.CLIENT?ht(g):this.renderingService.fetchPrintImage(g)),st(g=>this.getNewRotatedImage(g,c-1)),st(g=>this.invisibleTracerService.isEnabled?this.addInvisibleTracer(g,c-1):ht(g)))),n=0,r=(this.muPDFService.docRaw===null?this.dataService.increasePrintCount(this.doc.streamdocsId):ht(void 0)).pipe(st(()=>bo(e)),Ys(Ze.browserPrintImageRequestChunkSize),Xs(c=>zs(c)),rt(c=>{n+=c.length,this.lastCommonModal?.setProgressValue(Math.floor(n/this.pageNumbers.length*this.PRINT_PROGRESS_RATIO))}),vl((c,g)=>c.concat(g),[])).subscribe({next:c=>{this.printImagesDataUrls=c,this.changeDetectorRef.markForCheck(),t.complete()},error:c=>t.error(this.translatePipe.transform(c.message))});this.subscriptionService.set("fetchImage",r),i.addOnDisposeListener(c=>{c===!1&&(this.subscriptionService.get("fetchImage")?.unsubscribe(),this.toastService.create({toastStyle:Wt.NOTIFICATION,content:this.translatePipe.transform("PRINT_CANCELLED"),header:this.translatePipe.transform("BROWSER_PRINT")}),this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:new ur(this.translatePipe.transform("PRINT_CANCELLED"))}),this.finishPrint())})})}addInvisibleTracer(t,i){return new wt(e=>{let n=document.createElement("canvas"),r=n.getContext("2d");if(r===null)throw new _t("Failed to get CanvasRenderingContext2D");let{w:c,h:g}=this.pdfPages[i].bbox,v=Math.round(pc.convert(Cs.POINT,Cs.INCH,c)*Ze.invisibleTracerDpiForPrint),y=Math.round(pc.convert(Cs.POINT,Cs.INCH,g)*Ze.invisibleTracerDpiForPrint),M=new Image,V=new Image;M.crossOrigin="Anonymous";let Z=new Ti,le=new Ti,pe=xo(Z,le).pipe(en(1)).subscribe({next:()=>{let he=Math.min(Math.ceil(M.naturalWidth/v),2);n.width=v*he,n.height=y*he,r.drawImage(M,0,0,n.width,n.height),r.globalAlpha=this.invisibleTracerService.getOpacity(!1);let Te=Ze.printInvisibleTracerSize*he;for(let p=0;p<n.width;p+=Te)for(let dt=0;dt<n.height;dt+=Te)r.drawImage(V,p,dt,Te,Te);e.next(n.toDataURL(up.png)),e.complete()}});V.onload=()=>le.next(),V.onerror=he=>{pe.unsubscribe(),e.error(he)},M.onload=()=>Z.next(),M.onerror=he=>{pe.unsubscribe(),e.error(he)},M.src=t,V.src=this.tracerImageUrl})}printUsingModule(){if(this.modalService.lastModal?.dispose(),this.printService.pluginPrintSub&&!this.printService.pluginPrintSub.closed)return new wt(i=>{this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PENDING_PLUGIN_PRINT_REQUEST")}),i.complete()});let t=this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PRINTING"),timeout:null});return this.printService.pluginPrintSub=this.dataService.getDownloadUrl({docId:this.tempDocId,originalId:this.tempDocId!==this.doc.streamdocsId?this.doc.streamdocsId:void 0}).pipe(st(i=>{let e=G.nativeWindow;return this.agentService.print(e.location.hostname,i,e.location.port,e.location.protocol,this.contentService.tsaValidation$?.validity??"",`${this.currentPageNo-1}`,this.pageNumbers&&this.pageRange.length>0?Nn.stringify(this.pageNumbers):void 0)}),Ve(i=>{if(i.body===null)throw new $l("No response body received.");return/([a-zA-Z]+#)?(\-?[0-9]+)/.exec(i.body)?.[2]||"Unknown"}),Ve(i=>{let e={success:!1,canceled:!1,message:""};if(Number(i)<0)switch(i){case"-3":e.canceled=!0,e.message=this.translatePipe.transform("PRINT_CANCELLED");break;case"-20":e.message=this.translatePipe.transform("FAILED_TO_LOAD_DOC_TO_PRINT");break;default:e.message=`${this.translatePipe.transform("FAILED_TO_PRINT")}
(${this.translatePipe.transform("ERROR_CODE")}: ${i})`;break}else e.success=!0,e.message=this.translatePipe.transform("PRINT_COMPLETED");return e}),st(i=>i.success?this.dataService.increasePrintCount(this.doc.streamdocsId).pipe(Ve(()=>i)):ht(i)),rt(i=>{if(i.success||i.canceled){this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!0,data:{status:i.canceled?"CANCELLED":"PRINTED"}});return}this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:new ur(`Failed to print. (${i.message})`)})}),pr(()=>{throw this.translatePipe.transform("FAILED_TO_PRINT")})).subscribe({next:i=>{t.dispose(),this.printService.pluginPrintSub=null,this.toastService.create({toastStyle:i.success?Wt.SUCCESS:Wt.FAILURE,header:this.translatePipe.transform("PRINT"),content:i.message})},error:i=>{t.dispose(),this.printService.pluginPrintSub=null,this.toastService.create({toastStyle:Wt.FAILURE,header:this.translatePipe.transform("PRINT"),content:i})}}),new wt(i=>{this.onClose(),i.complete()})}};N(cs,"\u0275fac",function(i){return new(i||cs)(_(ni),_(ri),_(En),_(at),_(Ae),_(da),_(rn),_(an),_(as),_(zt),_(Xo),_(ct),_(ee),_(ga),_(ye),_(He),_(Pn),_(Ko),_(Qt),_(ap),_(zr),_(ua),_($o),_(jo),_(Gr))}),N(cs,"\u0275cmp",Ce({type:cs,selectors:[["sd-print-view"]],inputs:{doc:"doc",immediatePrintConfig:"immediatePrintConfig"},outputs:{finish:"finish"},standalone:!1,features:[xe([ee])],decls:3,vars:3,consts:[["dialogBody",""],["finishDialogBody",""],["dialogFooter",""],["finishDialogFooter",""],["width","360",3,"bodyTemplate","footerTemplate","header","close",4,"ngIf"],["id","print-container"],[4,"ngFor","ngForOf","ngForTrackBy"],["width","360",3,"close","bodyTemplate","footerTemplate","header"],["class","dialog-body",4,"ngIf"],[1,"dialog-body"],["value","all",3,"ngModelChange","label","ngModel"],["value","partial",3,"ngModelChange","label","ngModel"],[1,"range-label"],["size","tiny",3,"ngModelChange","ariaLabel","disabled","placeholder","ngModel"],[1,"complete-description"],["color","white","size","small",1,"ep-button","cancel",3,"click"],["color","primary","size","small",1,"ep-button","print",3,"click"],["color","white","size","small",1,"ep-button",3,"click"],[3,"load","error"]],template:function(i,e){i&1&&(se(0,lm,12,9,"pu-dialog",4),A(1,"div",5),se(2,pm,2,1,"div",6),D()),i&2&&(O("ngIf",e.dialogVisible),x(2),O("ngForOf",e.printImagesDataUrls)("ngForTrackBy",e.trackByImage))},dependencies:[yi,bt,wn,Po,ra,Vn,aa,rp,Rl,He],styles:[".dialog-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:24px;margin-bottom:32px}.dialog-body[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]{margin-top:16px}.dialog-body[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]:first-child{margin-top:0}.dialog-body[_ngcontent-%COMP%]   .range-label[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);margin-top:18px}.dialog-body[_ngcontent-%COMP%]   .range-label.disabled[_ngcontent-%COMP%]{opacity:.5}.dialog-body[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{width:160px}.dialog-body[_ngcontent-%COMP%]   .horizontal-division-line[_ngcontent-%COMP%]{width:100%;height:1px;margin:16px 0;background-color:var(--mono-30)}.dialog-body[_ngcontent-%COMP%]   .plugin-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);display:block}.dialog-body[_ngcontent-%COMP%]   .plugin-description[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);margin-top:6px}.dialog-body[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{margin-top:24px}.dialog-body[_ngcontent-%COMP%]   .complete-description[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70)}button[_ngcontent-%COMP%]{color:var(--mono-00)}button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:8px}button.print[_ngcontent-%COMP%]{color:var(--mono-00)}button.cancel.dark[_ngcontent-%COMP%]{color:var(--mono-90);background-color:var(--mono-30);border-color:var(--mono-30)}img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{display:none}"],changeDetection:0}));var ls=cs;ze([ot(it.printViewComp.printUsingBrowser)],ls.prototype,"printUsingBrowser",null);ze([ot(it.printViewComp.printUsingModule)],ls.prototype,"printUsingModule",null);var um=["sdToastOutlet"],gm=["sdModalOutlet"],fm=s=>({error:s});function mm(s,t){if(s&1){let i=Se();A(0,"sd-toolbar",19),ce("contextmenu",function(n){W(i);let r=E(2);return z(r.onContextMenu(n))}),D()}if(s&2){let i=E(2);nn("display",i.isVisibleToolbar?void 0:"none"),O("doc",i.doc)}}function vm(s,t){if(s&1&&Q(0,"sd-annot-toolbar"),s&2){let i=E(2);nn("display",!i.isSubToolbarOpened||i.isEbookMode()?"none":void 0)}}function _m(s,t){if(s&1&&(A(0,"aside"),Q(1,"sd-side-view",18),D()),s&2){let i=E(2);$e("side-view",!i.isRedactingOnMobile),O("@sideViewAnimation",i.isSmallWidthScreen&&!i.isRedactingOnMobile),x(),O("pdfDoc",i.doc)}}function Sm(s,t){if(s&1&&(A(0,"aside",20),Q(1,"sd-right-side-view",18),D()),s&2){let i=E(2);O("@sideViewAnimation",i.isSmallWidthScreen),x(),O("pdfDoc",i.doc)}}function bm(s,t){if(s&1&&Q(0,"sd-content-view",23),s&2){let i=E(3);O("pdfDoc",i.doc)("centerPoint",i.centerPointParam)("overWrittenZoom",i.zoomParam)("ngStyle",i.contentViewStyle)}}function Cm(s,t){s&1&&Q(0,"sd-ruler")}function xm(s,t){if(s&1){let i=Se();A(0,"span",24),ce("contextmenu",function(n){W(i);let r=E(3);return z(r.onContextMenu(n))}),be(1),D()}if(s&2){let i=E(3);ge("aria-label",i.pageNumberAriaLabel),x(),Qs("",i.currentPageNo,"/",i.pageCount,"")}}function Tm(s,t){if(s&1&&(Bt(0),se(1,bm,1,4,"sd-content-view",21)(2,Cm,1,0,"sd-ruler",5)(3,xm,2,3,"span",22),Ut()),s&2){let i=E(2);x(),O("ngIf",i.doc),x(),O("ngIf",i.rulerActive),x(),O("ngIf",i.isPageIdxIndicatorVisible)}}function Om(s,t){s&1&&Q(0,"sd-spreadsheets-view")}function wm(s,t){if(s&1&&(A(0,"div",29),be(1),D()),s&2){let i=E(4);x(),Ee(i.passwordErrorMessage)}}function ym(s,t){if(s&1){let i=Se();A(0,"div",26),be(1),Y(2,"translate"),D(),A(3,"pu-input",27),Y(4,"translate"),Y(5,"translate"),Ai("ngModelChange",function(n){W(i);let r=E(3);return Ii(r.password,n)||(r.password=n),z(n)}),ce("keydown.enter",function(){W(i);let n=E(3);return z(n.password&&!n.passwordChecking?n.checkPassword():null)}),D(),se(6,wm,2,1,"div",28)}if(s&2){let i=E(3);x(),Ee(X(2,8,"THIS_DOCUMENT_WAS_ENCRYPTED")),x(2),O("autofocus",!0)("ngClass",St(14,fm,i.passwordErrorMessage))("placeholder",X(4,10,"INPUT_PASSWORD"))("ariaLabel",X(5,12,"INPUT_PASSWORD"))("readonly",i.passwordChecking),Ri("ngModel",i.password),x(3),O("ngIf",i.passwordErrorMessage)}}function Em(s,t){if(s&1){let i=Se();A(0,"button",30),Y(1,"translate"),ce("click",function(){W(i);let n=E(3);return z(n.checkPassword())}),be(2),Y(3,"translate"),D()}if(s&2){let i=E(3);O("disabled",!i.password||i.passwordChecking),ge("aria-label",X(1,3,"OK")),x(2),Ee(X(3,5,"OK"))}}function Pm(s,t){if(s&1&&(A(0,"pu-dialog",25),Y(1,"translate"),se(2,ym,7,16,"ng-template",null,3,Li)(4,Em,4,7,"ng-template",null,4,Li),D()),s&2){let i=wi(3),e=wi(5);O("bodyTemplate",i)("footerTemplate",e)("header",X(1,4,"ENCRYPTED_DOCUMENT"))("headerIcon","papycon papycon-questionmark")}}function Mm(s,t){if(s&1){let i=Se();A(0,"sd-print-view",31),ce("finish",function(){W(i);let n=E(2);return z(n.onFinishPrint())}),D()}if(s&2){let i=E(2);O("doc",i.doc)("immediatePrintConfig",i.immediatePrintConfig)}}function Rm(s,t){if(s&1){let i=Se();Bt(0),se(1,mm,1,3,"sd-toolbar",6)(2,vm,1,2,"sd-annot-toolbar",7),A(3,"div",8),ce("contextmenu",function(n){W(i);let r=E();return z(r.onContextMenu(n))}),se(4,_m,2,4,"aside",9)(5,Sm,2,2,"aside",10),A(6,"section",11),se(7,Tm,4,3,"ng-container",12)(8,Om,1,0,"ng-template",null,0,Li),A(10,"div",13),To(11,null,1),D(),A(13,"div",14),To(14,null,2),D()()(),A(16,"section",15),se(17,Pm,6,6,"pu-dialog",16),D(),se(18,Mm,1,2,"sd-print-view",17),Q(19,"sd-dialog",18),Ut()}if(s&2){let i=wi(9),e=E();x(),O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR]),x(),O("ngIf",!e.supportTTS&&e.isSubToolbarOpened),x(2),O("ngIf",e.sideViewVisible),x(),O("ngIf",e.rightSideViewVisible),x(),O("ngClass",e.DragMode[e.dragMode]),x(),O("ngIf",!e.isSpreadsheets)("ngIfElse",i),x(10),O("ngIf",e.suspendedDocId),x(),O("ngIf",e.printDialogView||e.immediatePrintConfig),x(),O("pdfDoc",e.doc)}}var Dd="400ms",Nd="cubic-bezier(0.86, 0, 0.07, 1)",FE=(()=>{let t=class t{acroFormService;contentService;annotService;modalService;changeDetectorRef;textSearchService;dataService;toastService;annotSelectedService;documentService;viewerService;shortcutService;subscriptionService;sdContextMenuService;store$;externalApiService;dialogService;printService;apiEventBridgeService;translatePipe;localStorageService;configsService;preferencesService;router;muPDFService;redactionService;autoSaveService;loggingService;get DragMode(){return Pt}sdToastOutlet;sdModalOutlet;viewMode;dragMode;pageCount;currentPageNo;supportTTS;rulerActive;sideViewSize;rightSideViewSize;get contentViewStyle(){if(!this.rulerActive)return{};let e=`${36}px`,n=`calc(100% - ${36}px)`;return{top:e,left:e,width:n,height:n}}printDialogView=!1;immediatePrintConfig=null;suspendedDocId=w.EMPTY_STRING;password=w.EMPTY_STRING;passwordChecking=!1;passwordErrorMessage=w.EMPTY_STRING;sideViewVisible=!1;rightSideViewVisible=!1;isSmallWidthScreen=G.isSmallWidth();loading=this.checkDelayLoading;isSpreadsheets=K.get(ie.USE_SPREADSHEETS_VIEWER);get checkDelayLoading(){return!!K.get(ie.DELAY_LOADING)&&!G.isRootWindow()}get doc(){return this._doc}get isSubToolbarOpened(){return!this.viewerService.isSubToolbarType(null)}get HidableView(){return B}get isRedactingOnMobile(){return this.redactionService.isRedactingOnMobile()}get useLastViewedPage(){return this.localStorageService.isEnabledLocalStorage&&Ze.continueFromLastView}get isVisibleToolbar(){return K.get(ie.SAVE_BUTTON)&&!K.get(ie.AUTO_SAVE)||K.get(ie.ORIGINAL_DOWNLOAD_BUTTON)||K.get(ie.PDF_DOWNLOAD_BUTTON)||K.get(ie.PRINT_BUTTON)&&K.get(xt.PRINT_DIALOG)||K.get(ie.DOCUMENT_INFO_BUTTON)&&K.get(xt.DOCUMENT_INFO_DIALOG)||K.get(ie.SLIDESHOW_BUTTON)||K.get(ie.EBOOK_BUTTON)||K.get(ie.PREFERENCES_BUTTON)&&K.get(xt.PREFERENCES_DIALOG)||K.get(ie.SCREEN_THEME_MENU)||K.get(ie.SD_INFO_BUTTON)||K.get(xt.LEFT_SIDE_VIEW_BUTTON)||K.get(ie.SCALE_DROPDOWN)||K.get(ie.FIT_BUTTON)||K.get(xt.VIEW_MODE_BUTTON)||K.get(xt.DRAG_MODE_BUTTONS)||K.get(xt.ANNOT_TOOLBAR)||K.get(xt.FORM_TOOLBAR)||K.get(xt.PKI_SIGNATURE_TOOLBAR)||this.documentService.isDAP&&K.get(xt.DAP_VIEW)&&K.get(ie.DAP_VIEW_BUTTON)}get isPageIdxIndicatorVisible(){return!!this.pageCount&&!this.hidableMenus[B.INDICATOR]&&!this.hidableMenus[B.INDICATOR_PAGE_NUMBER]}get pageNumberAriaLabel(){return this.translatePipe.transform("CURRENT_PAGE_AND_TOTAL_PAGE").replace("%d",this.currentPageNo.toString()).replace("%d",this.pageCount.toString())}_doc=null;isFullScreen=w.isFullscreenMode();isContextMenuOpened=!1;hidableMenus={};zoomParam;centerPointParam=null;currentPageNoParam;constructor(e,n,r,c,g,v,y,M,V,Z,le,pe,he,Te,p,dt,vt,gt,Mi,At,li,mi,Oe,Fe,h,u,b,T){this.acroFormService=e,this.contentService=n,this.annotService=r,this.modalService=c,this.changeDetectorRef=g,this.textSearchService=v,this.dataService=y,this.toastService=M,this.annotSelectedService=V,this.documentService=Z,this.viewerService=le,this.shortcutService=pe,this.subscriptionService=he,this.sdContextMenuService=Te,this.store$=p,this.externalApiService=dt,this.dialogService=vt,this.printService=gt,this.apiEventBridgeService=Mi,this.translatePipe=At,this.localStorageService=li,this.configsService=mi,this.preferencesService=Oe,this.router=Fe,this.muPDFService=h,this.redactionService=u,this.autoSaveService=b,this.loggingService=T}ngOnInit(){this.checkDelayLoading||this.contentService.togglePageLoader(!1),this.initializeConfigToStore(),this.subscribe(),this.bindParams(),this.initSearchResult(),this.annotSelectedService.unselectAll(),this.subscriptionService.push(this.autoSaveService.initAutoSave(),this.shortcutService.getShortcutEvent(Pe.FULLSCREEN).subscribe({next:e=>{e.preventDefault(),e.stopPropagation(),this.isFullScreen?G.exitFullScreen():G.enterFullScreen()}}),G.windowResize$.pipe(rt(()=>this.isSmallWidthScreen=G.isSmallWidth()),F(()=>this.isFullScreen!==w.isFullscreenMode()),st(()=>gl(100).pipe(F(()=>!w.isFullscreenMode()),en(1)))).subscribe({next:()=>{G.exitFullScreen()}}),this.documentService.openedDocument$.subscribe({next:e=>{if(this.initPassword(),!e){this.closeDocument();return}this._doc=e,this.viewerService.closeSubToolbar(),w.isDefined(this.currentPageNoParam)||this.checkLastViewedPage(),this.acroFormService.resetAcroFieldByPage(),this.changeDetectorRef.markForCheck()}}),this.localStorageService.localStorage$.subscribe({next:()=>{this.toastService.create({toastStyle:Wt.FAILURE,content:this.translatePipe.transform("FAILED_TO_ACCESS_LOCAL_STORAGE")})}})),this.printService.setBrowserPrintGripperMargin(Ze.defaultPrintMargin),this.localStorageService.isEnabledLocalStorage||this.toastService.create({toastStyle:Wt.FAILURE,content:this.translatePipe.transform("FAILED_TO_ACCESS_LOCAL_STORAGE")})}ngOnDestroy(){this.viewerService.closeDocument()}ngAfterViewChecked(){this.sdToastOutlet&&this.sdModalOutlet&&(this.toastService.registerOutlet(this.sdToastOutlet),this.modalService.registerOutlet(this.sdModalOutlet))}isEbookMode(){return this.viewMode===4}checkPassword(e){this.passwordChecking=!0,this.passwordErrorMessage=w.EMPTY_STRING;let n=e||this.suspendedDocId;if(!w.isDefined(n))throw new Cn("No valid document ID provided.");this.viewerService.openDocument(n,!Ze.skipPasswordCheck,this.password).pipe(Xn(()=>this.passwordChecking=!1)).subscribe({next:()=>{this.suspendedDocId=null},error:r=>{if(this.viewerService.closeSubToolbar(),r.fail){let c=Ze.skipPasswordCheck&&r.log.status===401?`errorCode=${r.errorCode}`:"",g=[`view/error-pages/${r.log.status}`,c].join(";");this.router.navigateByUrl(g)}else this.suspendedDocId=e||this.suspendedDocId,e||(this.passwordErrorMessage=this.translatePipe.transform("WRONG_PASSWORD"));this.changeDetectorRef.markForCheck()}})}onContextMenu(e){e.preventDefault(),e.stopPropagation()}onFinishPrint(){this.immediatePrintConfig&&(this.immediatePrintConfig=null)}initSearchResult(){this.textSearchService.clear(),this.textSearchService.searchRedactionMark([]),this.textSearchService.searchRedactionResult([])}bindParams(){let{streamdocsId:e,currentPage:n,viewMode:r,zoom:c,supportTTS:g,option:v,centerPoint:y}={},M=Number.parseInt(v,16),V={singlePage:0,singlePageScroll:1,doublePage:2,doublePageScroll:3,eBook:4};n!==""&&!Number.isNaN(Number(n))&&(this.currentPageNoParam=Number(n),this.store$.dispatch(ue.set({key:"currentPageNo",value:Number(n)}))),V.hasOwnProperty(r)&&this.store$.dispatch(ue.set({key:"viewMode",value:V[r]})),this.zoomParam=c,this.centerPointParam=typeof y=="string"?(()=>{let[Z,le]=y.split(",").map(Number);return w.isDefined(Z)&&w.isDefined(le)&&!Number.isNaN(Z)&&!Number.isNaN(le)?{x:Math.floor(Z),y:Math.floor(le)}:null})():null,this.store$.dispatch(ue.set({key:"supportTTS",value:g==="true"})),this.store$.dispatch(ue.set({key:"isScreenReaderActive",value:K.get(ie.PAGE_TEXT_FOR_SCREEN_READER)})),this.store$.dispatch(Rp.set({value:Number.isNaN(M)?0:M})),e&&this.checkPassword(e)}checkLastViewedPage(){if(!this.useLastViewedPage||!this.doc)return;let e=JSON.parse(this.localStorageService.get("SD_History","{}")),n=e[this.doc.streamdocsId]?.lastViewedPage;if(!e[this.doc.streamdocsId]){this.loggingService.common("debug",Le.NOT_EXIST,"history",`(${this.translatePipe.transform("LOCAL_STORAGE")})`);return}this.store$.dispatch(ue.set({key:"currentPageNo",value:n>0?n:1}))}updateLastViewedPage(e){if(!this.useLastViewedPage||!this.doc)return;let n=JSON.parse(this.localStorageService.get("SD_History","{}"));n[this.doc.streamdocsId]?n[this.doc.streamdocsId].lastViewedPage=e>0?e:1:n[this.doc.streamdocsId]={lastViewedPage:e>0?e:1},this.localStorageService.set("SD_History",JSON.stringify(n))}subscribe(){this.subscriptionService.push(this.store$.pipe(Br("isSpreadsheets")).subscribe({next:e=>this.isSpreadsheets=e}),Ge(window,"mousedown").pipe(F(()=>this.isContextMenuOpened)).subscribe({next:()=>{this.sdContextMenuService.publishContextMenuStatus(!1)}}),this.store$.pipe($("viewMode")).subscribe({next:e=>this.viewMode=e}),this.store$.pipe($("pageCount")).subscribe({next:e=>this.pageCount=e}),this.store$.pipe($("currentPageNo")).subscribe({next:e=>{this.currentPageNo=e,this.updateLastViewedPage(e)}}),this.store$.pipe($("supportTTS")).subscribe({next:e=>this.supportTTS=e}),this.store$.pipe($("dragMode")).subscribe({next:e=>this.dragMode=e}),this.store$.pipe($("sideViewVisible")).subscribe({next:e=>{this.sideViewVisible=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:e=>{this.rightSideViewVisible=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("sideViewSize")).subscribe({next:e=>{this.sideViewSize=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewSize")).subscribe({next:e=>{this.rightSideViewSize=e,this.changeDetectorRef.markForCheck()}}),this.printService.print$.pipe(F(e=>e!==null)).subscribe({next:e=>{this.immediatePrintConfig=e,this.changeDetectorRef.markForCheck()}}),this.dialogService.dialogVisibilityChange$.subscribe({next:()=>{if(this.dialogService.dialogVisibility[$i.PRINT]){if(!this.documentService.checkAuthority(Ne.PRINT_DOCUMENT)){this.apiEventBridgeService.dialogVisibilityChangedSrc.next({ok:!1,error:new _t("Unauthorized")});return}if(!this.doc){this.toastService.create({toastStyle:Wt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("SELECT_FILE")});return}}this.printDialogView=!!this.dialogService.dialogVisibility[$i.PRINT],this.changeDetectorRef.markForCheck(),setTimeout(()=>this.apiEventBridgeService.dialogVisibilityChangedSrc.next({ok:!0,data:void 0}))}}),G.windowResize$.subscribe({next:()=>{this.changeDetectorRef.markForCheck(),!J.canSideViewBeDisplayed(this.sideViewVisible,this.rightSideViewVisible,this.sideViewSize,this.rightSideViewSize)&&(!this.sideViewVisible&&!this.rightSideViewVisible||(this.sideViewVisible&&this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),this.rightSideViewVisible&&this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1}))))}}),ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).subscribe({next:()=>{this.changeDetectorRef.detectChanges()}}),this.documentService.pdfInfo$.subscribe({next:e=>{e.DocumentType==="DAP"&&K.get(xt.DAP_VIEW)&&K.get(ie.DAP_VIEW_BUTTON)&&K.get(ie.DAP_VIEW_DEFAULT_OPEN)?G.width>Ze.rightSideView.initialSize*2&&(this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.DAP})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0}))):(this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})))}}),G.fullScreenState$.subscribe({next:e=>this.isFullScreen=e}),this.acroFormService.acroFieldsChange$.pipe(ii(300),st(()=>w.isDefined(this.doc)?this.acroFormService.updateAcroFieldByPage(this.doc.streamdocsId):Gn(()=>new Cn("Document is not defined.")))).subscribe(),this.store$.pipe($("rulerActive")).subscribe({next:e=>{this.rulerActive=e,this.changeDetectorRef.markForCheck()}}),this.contentService.reload$.pipe(F(e=>Go.type(e,zo.AcroForm)),st(()=>(this.acroFormService.resetAcroFieldByPage(),w.isDefined(this.doc)?this.dataService.getPdfAcroFields(this.doc.streamdocsId):Gn(()=>new Cn("Document is not defined.")))),st(({fields:e,props:n})=>(this.acroFormService.publishAcroFields(e,n),w.isDefined(this.doc)?this.acroFormService.updateAcroFieldByPage(this.doc.streamdocsId):Gn(()=>new Cn("Document is not defined."))))).subscribe(),Ge(document,"visibilitychange").pipe(F(()=>document.visibilityState==="hidden")).subscribe({next:()=>this.autoSaveService.fireAutoSave(uc.EXIT)}),Ge(window,"beforeunload").pipe(rt(()=>this.autoSaveService.fireAutoSave(uc.EXIT)),F(()=>{if(G.isAOS()){let e=window.parent.document.referrer,n=window.parent.location.hostname,r=e?new URL(e).hostname!==n:!0;return(K.get(ie.WARNING_LEAVE_WITHOUT_SAVE)||K.get(ie.AUTO_SAVE))&&!!this.annotService.getActionLog().length&&!(history.length<=1||!e||r)}return(K.get(ie.WARNING_LEAVE_WITHOUT_SAVE)||K.get(ie.AUTO_SAVE))&&!!this.annotService.getActionLog().length})).subscribe({next:e=>e.preventDefault()}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:e=>this.isContextMenuOpened=e}),Ji([this.store$.pipe($("renderingMode"),F(e=>e!==gi.SERVER)),this.viewerService.loadMuPDF$.pipe(F(e=>e?.length>0),rt(()=>this.muPDFService.closeDocument()))]).subscribe({next:([e,n])=>{let r=e===gi.CLIENT;ht(this.muPDFService.docRaw).pipe(F(w.isDefined),st(({arrayBuffer:c,filename:g})=>this.muPDFService.prepareDocument(n,c,g,r)),Xn(()=>this.modalService.lastModal?.dispose())).subscribe()}}),this.viewerService.requestPasswordToUser$.subscribe({next:e=>{this.initPassword(),this.suspendedDocId=e,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Pe.SEARCH).subscribe({next:e=>{e.preventDefault(),e.stopPropagation()}})),K.get(ie.RULER_BUTTON)&&this.subscriptionService.push(this.shortcutService.getShortcutEvent(Pe.RULER_VISIBILITY).subscribe({next:()=>this.store$.dispatch(ue.set({key:"rulerActive",value:!this.rulerActive}))})),this.checkDelayLoading&&this.subscriptionService.push(this.contentService.pageLoader$.pipe(F(e=>!e),en(1)).subscribe({next:e=>{this.loading=e,this.changeDetectorRef.markForCheck()}})),this.subscriptionService.push(this.store$.pipe(fi([B.TOOLBAR,B.TOOLBAR_LEFT,B.TOOLBAR_CENTER,B.TOOLBAR_RIGHT,B.INDICATOR,B.INDICATOR_PAGE_NUMBER])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}closeDocument(){this._doc=null,this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})),this.dialogService.closeAll(),this.store$.dispatch(ue.set({key:"fitMode",value:null})),this.changeDetectorRef.detectChanges()}initializeConfigToStore(){let e=this.configsService.radioConfig,n=this.preferencesService.savedPreferences,r=gi.SERVER;K.get(ie.USE_CLIENT_RENDERING)&&(this.muPDFService.initWorker(),r=gi.CLIENT),this.store$.dispatch(ue.set({key:"renderingMode",value:r})),[Ho.DEFAULT_VIEW_MODE,Ho.DEFAULT_DRAG_MODE].forEach(c=>{if(!Eo.hasDefinedProp(e,c))throw new bs(`Configuration for '${c}' is not defined in radioConfig.`);e[c].items.forEach(g=>{if(!K.get(g.key))return;let[v,y,M]=g.key.split(".");this.store$.dispatch(ue.set({key:M,value:g.value}))})}),[Ho.DEFAULT_ZOOM,Ho.RENDERING_OPTION,Ho.DEFAULT_SCREEN_THEME,Ho.DEFAULT_CONTINUE_WRITING].forEach(c=>{if(!Eo.hasDefinedProp(e,c))throw new bs(`Configuration for '${c}' is not defined in radioConfig.`);e[c].items.forEach(g=>{if(!K.get(g.key))return;let[v,y,M]=g.key.split("."),V=[M];switch(c){case Ho.DEFAULT_CONTINUE_WRITING:if(V=["annot","continueWriting"],w.isDefined(n.annot?.continueWriting))return;break;default:if(Eo.hasDefinedProp(n,M))return}this.store$.dispatch(lp.update({payload:{keys:V,value:g.value}}))})})}initPassword(){this.password=w.EMPTY_STRING,this.passwordChecking=!1,this.passwordErrorMessage=w.EMPTY_STRING,this.suspendedDocId=w.EMPTY_STRING}};N(t,"\u0275fac",function(n){return new(n||t)(_(En),_(at),_(ri),_(rn),_(Ae),_(io),_(da),_(an),_(Ni),_(ct),_(Zt),_(sn),_(ee),_(qo),_(ye),_(Sr),_(Pn),_(zr),_(Qt),_(He),_(Fr),_(Vp),_(Uo),_(Ir),_($o),_($r),_(jr),_(Di))}),N(t,"\u0275cmp",Ce({type:t,selectors:[["sd-viewer"]],viewQuery:function(n,r){if(n&1&&(Ye(um,5,rc),Ye(gm,5,rc)),n&2){let c;Me(c=Re())&&(r.sdToastOutlet=c.first),Me(c=Re())&&(r.sdModalOutlet=c.first)}},standalone:!1,features:[xe([ee])],decls:1,vars:1,consts:[["spreadsheetsViewRef",""],["sdToastOutlet",""],["sdModalOutlet",""],["dialogBody",""],["dialogFooter",""],[4,"ngIf"],[3,"doc","display","contextmenu",4,"ngIf"],[3,"display",4,"ngIf"],[1,"main-window",3,"contextmenu"],[3,"side-view",4,"ngIf"],["class","right-side-view",4,"ngIf"],[1,"main-view",3,"ngClass"],[4,"ngIf","ngIfElse"],[1,"sd-toast-container"],[1,"sd-modal-container"],[1,"dialogs"],["width","360","height","300",3,"bodyTemplate","footerTemplate","header","headerIcon",4,"ngIf"],[3,"doc","immediatePrintConfig","finish",4,"ngIf"],[3,"pdfDoc"],[3,"contextmenu","doc"],[1,"right-side-view"],[3,"pdfDoc","centerPoint","overWrittenZoom","ngStyle",4,"ngIf"],["class","page",3,"contextmenu",4,"ngIf"],[3,"pdfDoc","centerPoint","overWrittenZoom","ngStyle"],[1,"page",3,"contextmenu"],["width","360","height","300",3,"bodyTemplate","footerTemplate","header","headerIcon"],[1,"password-dialog-label"],["size","tiny","type","password",3,"ngModelChange","keydown.enter","autofocus","ngClass","placeholder","ariaLabel","readonly","ngModel"],["class","password-dialog-error",4,"ngIf"],[1,"password-dialog-error"],["color","primary","size","small",1,"ep-button",3,"click","disabled"],[3,"finish","doc","immediatePrintConfig"]],template:function(n,r){n&1&&se(0,Rm,20,10,"ng-container",5),n&2&&O("ngIf",!r.loading)},dependencies:[Ro,Oo,bt,qt,Ao,Cp,wn,Po,Wp,mn,ra,Vn,Lp,Ap,wp,ls,He],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}@media print{[_nghost-%COMP%]   *[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   sd-print-view[_ngcontent-%COMP%]{display:block}}[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.pre-wrap[_ngcontent-%COMP%]{white-space:pre-wrap}sd-toolbar[_ngcontent-%COMP%], sd-annot-toolbar[_ngcontent-%COMP%]{flex:0 0 43px}.main-window[_ngcontent-%COMP%]{overflow:hidden;flex:1}.main-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;overflow:hidden}sd-content-view[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block}.side-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;float:left}sd-side-view[_ngcontent-%COMP%]{height:100%;position:relative}.right-side-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;float:right}.sd-toast-container[_ngcontent-%COMP%]{position:absolute;top:40px;right:50px;display:flex;flex-direction:column;pointer-events:none;z-index:5}span.page[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;position:absolute;bottom:20px;right:40px;font-size:12px;color:var(--mono-70)}.password-dialog-label[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);margin-top:10px}.password-dialog-error[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--exception)}pu-input[_ngcontent-%COMP%]{width:100%;margin-top:2px}pu-input.error[_ngcontent-%COMP%]  input{border-color:var(--exception)}sd-dialog[_ngcontent-%COMP%]{z-index:5}@media screen and (max-width: 577px){.main-window[_ngcontent-%COMP%]{position:relative}.side-view[_ngcontent-%COMP%], .right-side-view[_ngcontent-%COMP%]{position:absolute;width:100%;z-index:1}.sd-toast-container[_ngcontent-%COMP%]{top:32px;right:16px}}"],data:{animation:[Zn("sideViewAnimation",[On("void => true",[Bi({transform:"translateY(calc(100% - 100px))"}),xn(`${Dd} ${Nd}`,Bi({transform:"translateY(0)"}))]),On("true => void",[Bi({zIndex:1,position:"absolute"}),xn(`${Dd} ${Nd}`,Bi({transform:"translateY(calc(100% - 53px))"}))])])]},changeDetection:0}));let s=t;return s})();var pP=(()=>{let t=class t{};N(t,"\u0275fac",function(n){return new(n||t)}),N(t,"\u0275mod",ui({type:t})),N(t,"\u0275inj",hi({providers:[Ca,ln,Sr],imports:[ld,Ta,on,Md,Pp,Nr,ba,yn,Rd,sa,Vr,op,ca,sp,kr,Fp,_a,yp,_p]}));let s=t;return s})();export{Ca as a,Xm as b,qv as c,s_ as d,rd as e,Sr as f,yy as g,pP as h,FE as i};
